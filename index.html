<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maestro Mario - HVAC Training App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{--accent:#ff6b2b;--electric:#00d4ff;--gold:#f1c40f;--dark:#0a1628;--card:#111d33;--card2:#162440;--txt:#e8f0ff;--muted:#7a93b8;--r:16px}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Nunito',sans-serif;background:var(--dark);color:var(--txt);min-height:100vh;min-height:100dvh;overflow-x:hidden}
        .bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
        .bg .o{position:absolute;border-radius:50%;filter:blur(90px);opacity:.12;animation:d 22s ease-in-out infinite}
        .bg .o:nth-child(1){width:420px;height:420px;background:var(--accent);top:-120px;left:-120px}
        .bg .o:nth-child(2){width:360px;height:360px;background:var(--electric);bottom:-100px;right:-100px;animation-delay:-8s}
        .bg .o:nth-child(3){width:280px;height:280px;background:#6366f1;top:40%;left:40%;animation-delay:-15s}
        @keyframes d{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(30px,-30px) scale(1.08)}66%{transform:translate(-20px,20px) scale(.92)}}
        .gr{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,212,255,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,.025) 1px,transparent 1px);background-size:44px 44px}
        .app{position:relative;z-index:1;max-width:460px;margin:0 auto;min-height:100vh;min-height:100dvh;padding:16px 18px;display:flex;flex-direction:column}
        .s{display:none;flex-direction:column;align-items:center;flex:1;animation:si .55s cubic-bezier(.16,1,.3,1)}
        .s.on{display:flex}
        @keyframes si{from{opacity:0;transform:translateY(36px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
        
        /* VIDEO FLOTANTE DESDE LA DERECHA */
        .video-float{position:fixed;bottom:100px;right:-320px;z-index:900;width:300px;transition:right 0.6s cubic-bezier(.34,1.56,.64,1);pointer-events:none}
        .video-float.active{right:20px;pointer-events:auto}
        .video-float.hiding{right:-320px}
        .video-float-inner{position:relative;border-radius:20px;overflow:hidden;box-shadow:0 15px 50px rgba(255,107,43,0.6),0 0 0 3px var(--accent);background:#000}
        .video-float video{width:100%;display:block;border-radius:17px}
        .video-float-label{position:absolute;top:12px;left:12px;background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:12px;font-weight:700;padding:6px 14px;border-radius:20px;display:flex;align-items:center;gap:8px;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .video-float-label::before{content:'';width:10px;height:10px;border-radius:50%;background:#00ff00;animation:blink 1s infinite;box-shadow:0 0 10px #00ff00}
        @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
        .video-float-close{position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,0.7);border:2px solid rgba(255,255,255,0.3);color:white;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s}
        .video-float-close:hover{background:var(--accent);border-color:var(--accent);transform:scale(1.1)}
        .video-float-glow{position:absolute;inset:-4px;border-radius:24px;background:conic-gradient(var(--accent),var(--electric),var(--gold),var(--accent));z-index:-1;animation:sp 3s linear infinite}
        
        /* MODAL AI CHAT */
        .ai-modal{position:fixed;inset:0;z-index:600;background:rgba(10,22,40,0.95);display:flex;align-items:flex-end;justify-content:center;opacity:0;visibility:hidden;transition:all 0.3s}
        .ai-modal.active{opacity:1;visibility:visible}
        .ai-chat{width:100%;max-width:460px;height:75vh;background:var(--card);border-radius:24px 24px 0 0;display:flex;flex-direction:column;transform:translateY(100%);transition:transform 0.4s cubic-bezier(.16,1,.3,1)}
        .ai-modal.active .ai-chat{transform:translateY(0)}
        .ai-chat-header{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:12px}
        .ai-chat-avatar{width:48px;height:48px;border-radius:50%;overflow:hidden;border:2px solid var(--accent)}
        .ai-chat-avatar img{width:100%;height:100%;object-fit:cover}
        .ai-chat-title{flex:1}
        .ai-chat-title h3{font-family:'Fredoka',sans-serif;font-size:17px;color:var(--txt)}
        .ai-chat-title span{font-size:12px;color:var(--electric)}
        .ai-chat-close{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.1);border:none;color:var(--txt);font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .ai-chat-close:hover{background:var(--accent)}
        .ai-chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}
        .ai-msg{max-width:85%;padding:14px 18px;border-radius:18px;font-size:15px;line-height:1.5}
        .ai-msg.mario{background:linear-gradient(135deg,rgba(255,107,43,0.2),rgba(0,212,255,0.1));border:1px solid rgba(255,107,43,0.3);align-self:flex-start;border-bottom-left-radius:4px}
        .ai-msg.user{background:var(--card2);align-self:flex-end;border-bottom-right-radius:4px}
        .ai-chat-input{padding:16px;border-top:1px solid rgba(255,255,255,0.1);display:flex;gap:12px}
        .ai-chat-input input{flex:1;padding:14px 18px;border-radius:25px;border:2px solid rgba(255,255,255,0.1);background:var(--dark);color:var(--txt);font-size:15px;outline:none}
        .ai-chat-input input:focus{border-color:var(--accent)}
        .ai-chat-input button{width:50px;height:50px;border-radius:50%;background:var(--accent);border:none;color:white;font-size:22px;cursor:pointer}
        .ai-chat-input button:disabled{opacity:0.5;cursor:not-allowed}
        
        /* SPEAKING INDICATOR */
        .speaking-indicator{display:none;align-items:center;gap:8px;padding:10px 16px;background:rgba(255,107,43,0.2);border-radius:12px;margin-top:8px}
        .speaking-indicator.active{display:flex}
        .speaking-indicator .waves{display:flex;gap:3px;align-items:center}
        .speaking-indicator .wave{width:4px;height:16px;background:var(--accent);border-radius:2px;animation:wave 0.8s ease-in-out infinite}
        .speaking-indicator .wave:nth-child(2){animation-delay:0.1s}
        .speaking-indicator .wave:nth-child(3){animation-delay:0.2s}
        .speaking-indicator .wave:nth-child(4){animation-delay:0.3s}
        @keyframes wave{0%,100%{height:8px}50%{height:20px}}
        .speaking-indicator span{font-size:13px;color:var(--accent);font-weight:600}
        
        /* CONFETTI */
        .cw{position:fixed;inset:0;pointer-events:none;z-index:100}.cf{position:absolute;top:-16px;animation:cff 2.8s ease-out forwards}
        @keyframes cff{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
        
        /* AVATAR - CLICKEABLE PARA ABRIR AI */
        .aw{position:relative;margin:16px auto 12px;cursor:pointer;transition:transform 0.3s}
        .aw:hover{transform:scale(1.05)}
        .aw.lg{width:190px;height:190px}.aw.md{width:140px;height:140px}.aw.sm{width:120px;height:120px}
        .ar{position:absolute;inset:-6px;border-radius:50%;background:conic-gradient(var(--accent),var(--electric),var(--accent));animation:sp 4s linear infinite}
        @keyframes sp{to{transform:rotate(360deg)}}
        .ag{position:absolute;inset:-20px;border-radius:50%;background:radial-gradient(circle,var(--accent) 0%,transparent 70%);opacity:.25;animation:pu 3s ease-in-out infinite}
        @keyframes pu{0%,100%{transform:scale(1);opacity:.25}50%{transform:scale(1.12);opacity:.4}}
        .ai{position:relative;width:100%;height:100%;border-radius:50%;overflow:hidden;border:4px solid var(--dark);animation:fl 4.5s ease-in-out infinite}
        .ai img{width:100%;height:100%;object-fit:cover}
        @keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        
        /* BADGE DE AI EN AVATAR */
        .aw .ai-badge{position:absolute;bottom:5px;right:5px;background:var(--accent);color:white;font-family:'Fredoka',sans-serif;font-size:10px;font-weight:700;padding:4px 8px;border-radius:10px;border:2px solid var(--dark)}
        
        /* BURBUJA */
        .bb{background:var(--card);border:1.5px solid rgba(0,212,255,.15);border-radius:var(--r);padding:18px 22px;margin:0 6px 20px;position:relative;box-shadow:0 6px 28px rgba(0,0,0,.25);text-align:center;font-size:16.5px;line-height:1.55;font-weight:600;min-height:60px}
        .bb::before{content:'';position:absolute;top:-10px;left:50%;transform:translateX(-50%);border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid rgba(0,212,255,.15)}
        .bb::after{content:'';position:absolute;top:-8px;left:50%;transform:translateX(-50%);border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--card)}
        
        /* OTROS ESTILOS */
        .lo{text-align:center;padding:4px 0}.lo-t{font-family:'Fredoka',sans-serif;font-size:26px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.lo-s{font-size:12px;color:var(--muted);letter-spacing:2.5px;text-transform:uppercase;margin-top:2px}
        .pb{width:100%;height:5px;background:rgba(255,255,255,.06);border-radius:3px;margin:12px 0 6px;overflow:hidden}.pbf{height:100%;background:linear-gradient(90deg,var(--accent),var(--electric));border-radius:3px;transition:width .6s}
        .ps{font-size:12px;color:var(--muted);margin-bottom:12px;text-align:center}.ps b{color:var(--accent)}
        .os{width:100%;display:flex;flex-direction:column;gap:10px}
        .oc{background:var(--card);border:2px solid rgba(255,255,255,.06);border-radius:var(--r);padding:16px 18px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px}
        .oc:hover{border-color:rgba(255,107,43,.4);background:var(--card2);transform:translateY(-1px)}
        .oc.sel{border-color:var(--accent);background:linear-gradient(135deg,rgba(255,107,43,.12),rgba(0,212,255,.06))}
        .oi{width:44px;height:44px;border-radius:12px;background:rgba(255,255,255,.05);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;transition:all .25s}
        .oc.sel .oi{background:var(--accent);transform:scale(1.08)}
        .ot{font-family:'Fredoka',sans-serif;font-size:15px;font-weight:600}.od{font-size:12.5px;color:var(--muted);margin-top:1px}
        .ck{width:22px;height:22px;border-radius:7px;border:2px solid rgba(255,255,255,.12);margin-left:auto;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;color:white}
        .oc.sel .ck{background:var(--accent);border-color:var(--accent)}.oc.sel .ck::after{content:'‚úì'}
        .mh{font-size:12.5px;color:var(--muted);text-align:center;margin-bottom:8px}
        .fl{display:flex;gap:18px;justify-content:center;margin-top:16px}
        .fc{width:135px;height:155px;background:var(--card);border:2.5px solid rgba(255,255,255,.06);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;cursor:pointer;transition:all .3s}
        .fc:hover{border-color:var(--accent);transform:translateY(-3px);box-shadow:0 10px 28px rgba(255,107,43,.18)}
        .fe{font-size:42px;line-height:1}.fn{font-family:'Fredoka',sans-serif;font-size:17px;font-weight:600}
        .bt{width:100%;padding:16px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:17px;font-weight:700;cursor:pointer;margin-top:20px;transition:all .25s;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .bt:hover{transform:translateY(-2px);box-shadow:0 7px 24px rgba(255,107,43,.35)}.bt:disabled{opacity:.35;cursor:not-allowed;transform:none}
        .ip{width:100%;padding:16px 18px;border:2px solid rgba(255,255,255,.06);border-radius:var(--r);background:var(--card);color:var(--txt);font-size:16px;font-weight:600;outline:none}.ip:focus{border-color:var(--accent)}.ip::placeholder{color:var(--muted)}
        .sp{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;text-align:center}
        .sp-t{font-family:'Fredoka',sans-serif;font-size:40px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.15}
        .sp-s{font-size:17px;color:var(--muted);max-width:280px}
        .badge{display:inline-flex;align-items:center;gap:7px;background:rgba(255,107,43,.1);border:1px solid rgba(255,107,43,.25);border-radius:28px;padding:5px 14px;font-family:'Fredoka',sans-serif;font-size:13px;color:var(--accent)}
        .rt{background:var(--card);border:1.5px solid rgba(0,212,255,.12);border-radius:var(--r);padding:16px 18px;margin-bottom:10px;display:flex;align-items:center;gap:14px;animation:ri .5s ease-out backwards}
        @keyframes ri{from{opacity:0;transform:translateX(-24px)}to{opacity:1;transform:translateX(0)}}
        .rn{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--electric));display:flex;align-items:center;justify-content:center;font-family:'Fredoka',sans-serif;font-weight:700;font-size:16px;flex-shrink:0}
        .rtt{font-family:'Fredoka',sans-serif;font-size:14.5px;font-weight:600}.rd{font-size:12px;color:var(--muted)}
        .rl{width:2px;height:16px;background:linear-gradient(var(--accent),var(--electric));margin-left:35px;border-radius:2px}
        .typing{display:inline-flex;gap:4px;align-items:center;padding:4px 0}
        .typing .dot{width:8px;height:8px;border-radius:50%;background:var(--electric);animation:tblink 1.4s infinite both}
        .typing .dot:nth-child(2){animation-delay:.2s}.typing .dot:nth-child(3){animation-delay:.4s}
        @keyframes tblink{0%,80%,100%{opacity:.3;transform:scale(.8)}40%{opacity:1;transform:scale(1)}}
        
        /* MUSIC BUTTON */
        .music-btn{position:fixed;top:20px;right:76px;z-index:800;width:44px;height:44px;border-radius:50%;background:var(--card);border:2px solid rgba(0,212,255,0.3);color:var(--electric);font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .music-btn:hover{background:var(--card2);border-color:var(--electric);transform:scale(1.1)}
        .music-btn.muted{color:var(--muted);border-color:rgba(255,255,255,0.1)}
        .music-settings{position:fixed;top:20px;right:128px;z-index:800;width:44px;height:44px;border-radius:50%;background:var(--card);border:2px solid rgba(0,212,255,0.15);color:var(--electric);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.3)}
        .music-settings:hover{transform:scale(1.15);border-color:var(--electric)}
        
        /* QUIZ SELECTOR */
        .quiz-sel-card{background:var(--card);border:2px solid rgba(255,255,255,0.06);border-radius:16px;padding:18px 16px;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:14px;position:relative;overflow:hidden}
        .quiz-sel-card:hover{border-color:var(--electric);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,212,255,0.15)}
        .quiz-sel-card.locked{opacity:0.5;cursor:not-allowed}
        .quiz-sel-card .qs-icon{font-size:40px;width:56px;height:56px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.04);border-radius:14px;flex-shrink:0}
        .quiz-sel-card .qs-info{flex:1}
        .quiz-sel-card .qs-title{font-family:'Fredoka',sans-serif;font-size:17px;font-weight:700;margin-bottom:2px}
        .quiz-sel-card .qs-desc{font-size:12px;color:var(--muted);line-height:1.3}
        .quiz-sel-card .qs-badge{position:absolute;top:8px;right:10px;font-size:10px;padding:2px 8px;border-radius:8px;font-weight:700;text-transform:uppercase}
        .quiz-sel-card .qs-badge.new{background:var(--electric);color:var(--bg)}
        .quiz-sel-card .qs-badge.done{background:rgba(76,175,80,0.2);color:#4caf50}
        .quiz-sel-card .qs-count{font-size:11px;color:var(--electric);font-weight:600;margin-top:4px}
        .quiz-sel-card .qs-stars{margin-top:4px;font-size:12px}

        /* QUIZ STYLES */
        .quiz-header{width:100%;display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
        .quiz-cat{font-size:11px;color:var(--electric);text-transform:uppercase;letter-spacing:1.5px;font-weight:700}
        .quiz-score{display:flex;align-items:center;gap:8px;font-family:'Fredoka',sans-serif;font-size:14px}
        .quiz-score .correct{color:#2ecc71}.quiz-score .wrong{color:#e74c3c}
        .quiz-num{font-family:'Fredoka',sans-serif;font-size:15px;color:var(--txt);text-align:center;margin:4px 0}
        .quiz-q{background:var(--card);border:1.5px solid rgba(0,212,255,.15);border-radius:var(--r);padding:20px;margin:12px 0;text-align:center;font-size:17px;font-weight:700;line-height:1.5}
        .quiz-opts{width:100%;display:flex;flex-direction:column;gap:10px}
        .quiz-opt{background:var(--card);border:2px solid rgba(255,255,255,.08);border-radius:var(--r);padding:16px 18px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px;font-size:15px;font-weight:600}
        .quiz-opt:hover{border-color:rgba(255,107,43,.4);background:var(--card2);transform:translateY(-1px)}
        .quiz-opt.correct{border-color:#2ecc71;background:rgba(46,204,113,0.15)}
        .quiz-opt.correct .quiz-letter{background:#2ecc71}
        .quiz-opt.wrong{border-color:#e74c3c;background:rgba(231,76,60,0.15)}
        .quiz-opt.wrong .quiz-letter{background:#e74c3c}
        .quiz-opt.disabled{pointer-events:none;opacity:0.6}
        .quiz-opt.disabled.correct{opacity:1}
        .quiz-letter{width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center;font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;flex-shrink:0;transition:all .3s}
        .quiz-explain{background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:var(--r);padding:14px 18px;margin-top:12px;font-size:14px;line-height:1.5;display:none}
        .quiz-explain.show{display:block}
        .quiz-explain b{color:var(--electric)}
        .quiz-next{width:100%;padding:14px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;cursor:pointer;margin-top:14px;display:none;transition:all .25s;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .quiz-next:hover{transform:translateY(-2px)}
        .quiz-next.show{display:block}
        .quiz-nav{display:flex;gap:10px;width:100%;margin-top:14px}
        .quiz-nav button{flex:1;padding:14px;border:none;border-radius:var(--r);font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:all .25s;display:none}
        .quiz-nav button.show{display:block}
        .quiz-prev{background:var(--card);border:2px solid rgba(0,212,255,0.3) !important;color:var(--electric)}
        .quiz-prev:hover{border-color:var(--electric) !important;transform:translateY(-2px)}
        .quiz-fwd{background:linear-gradient(135deg,var(--accent),#e84500);color:white;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .quiz-fwd:hover{transform:translateY(-2px)}
        .quiz-result{text-align:center;width:100%}
        .quiz-result-score{font-family:'Fredoka',sans-serif;font-size:64px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .quiz-result-label{font-size:18px;color:var(--muted);margin-top:4px}
        .quiz-result-msg{font-size:16px;margin-top:16px;line-height:1.5}
        .quiz-medal{font-size:80px;margin:16px 0}
        .quiz-stars{display:flex;justify-content:center;gap:6px;margin:12px 0}
        .quiz-stars span{font-size:32px;opacity:0.2;transition:all 0.5s}
        .quiz-stars span.lit{opacity:1;animation:starPop 0.5s ease-out}
        @keyframes starPop{0%{transform:scale(0)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
        
        /* CELEBRATION EFFECTS */
        @keyframes screenShake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-4px)}30%,70%{transform:translateX(4px)}}
        @keyframes bigShake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-8px) rotate(-1deg)}30%,70%{transform:translateX(8px) rotate(1deg)}}
        @keyframes lightning{0%{opacity:0}5%{opacity:0.8}10%{opacity:0}15%{opacity:1}20%{opacity:0}100%{opacity:0}}
        @keyframes streakPulse{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
        @keyframes fireFloat{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-120px) scale(0.3);opacity:0}}
        .shake{animation:screenShake 0.4s ease}
        .big-shake{animation:bigShake 0.6s ease}
        .streak-badge{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:900;font-size:48px;font-family:'Fredoka',sans-serif;font-weight:700;color:white;text-shadow:0 0 30px rgba(255,107,43,0.8),0 0 60px rgba(255,107,43,0.4);animation:streakPulse 0.6s ease;pointer-events:none;white-space:nowrap}
        .lightning-flash{position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:850;pointer-events:none;animation:lightning 0.4s ease}
        .fire-emoji{position:fixed;z-index:850;font-size:36px;pointer-events:none;animation:fireFloat 1.2s ease-out forwards}
        
        /* PROFILE SYSTEM */
        .profile-btn{position:fixed;top:20px;right:20px;z-index:800;width:48px;height:48px;border-radius:50%;background:var(--card);border:2px solid rgba(255,215,0,0.4);color:var(--gold);font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .profile-btn:hover{transform:scale(1.1);border-color:var(--gold)}
        .prof-card{background:var(--card);border:2px solid rgba(255,215,0,0.2);border-radius:16px;padding:20px;text-align:center;width:100%}
        .prof-name{font-family:'Fredoka',sans-serif;font-size:24px;font-weight:700;margin-top:8px}
        .prof-title{color:var(--electric);font-size:13px;text-transform:uppercase;letter-spacing:1.5px;margin-top:4px}
        .prof-level{display:flex;align-items:center;justify-content:center;gap:12px;margin:16px 0}
        .prof-lvl-num{font-family:'Fredoka',sans-serif;font-size:48px;font-weight:700;background:linear-gradient(135deg,var(--gold),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .prof-xp{width:100%;margin-top:8px}
        .prof-xp-bar{width:100%;height:12px;background:rgba(255,255,255,0.08);border-radius:6px;overflow:hidden}
        .prof-xp-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--accent));border-radius:6px;transition:width 0.5s}
        .prof-xp-txt{font-size:12px;color:var(--muted);margin-top:4px}
        .prof-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:16px}
        .prof-stat{background:rgba(255,255,255,0.04);border-radius:12px;padding:12px 8px;text-align:center}
        .prof-stat-num{font-family:'Fredoka',sans-serif;font-size:22px;font-weight:700;color:var(--electric)}
        .prof-stat-label{font-size:11px;color:var(--muted);margin-top:2px}
        .medals-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:16px;width:100%}
        .medal-slot{background:var(--card);border:2px solid rgba(255,255,255,0.06);border-radius:14px;padding:16px 10px;text-align:center;transition:all 0.3s}
        .medal-slot.earned{border-color:rgba(255,215,0,0.3);background:rgba(255,215,0,0.05)}
        .medal-slot .medal-icon{font-size:36px;opacity:0.2}
        .medal-slot.earned .medal-icon{opacity:1}
        .medal-slot .medal-name{font-size:11px;margin-top:6px;color:var(--muted);font-weight:600}
        .medal-slot.earned .medal-name{color:var(--gold)}
        
        /* AVATAR PICKER */
        .prof-avatar{font-size:64px;cursor:pointer;transition:transform 0.3s;position:relative}
        .prof-avatar:hover{transform:scale(1.1)}
        .prof-avatar-edit{position:absolute;bottom:-4px;right:-4px;background:var(--accent);color:white;border-radius:50%;width:24px;height:24px;font-size:12px;display:flex;align-items:center;justify-content:center}
        .avatar-picker{display:none;background:var(--card);border:2px solid rgba(0,212,255,0.2);border-radius:16px;padding:16px;margin-top:12px;width:100%}
        .avatar-picker.open{display:block}
        .avatar-picker-title{font-family:'Fredoka',sans-serif;font-size:14px;font-weight:700;color:var(--electric);margin-bottom:12px;text-align:center}
        .avatar-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
        .avatar-option{font-size:36px;padding:10px;text-align:center;border-radius:12px;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:rgba(255,255,255,0.03)}
        .avatar-option:hover{background:rgba(0,212,255,0.1);transform:scale(1.15)}
        .avatar-option.selected{border-color:var(--gold);background:rgba(255,215,0,0.1)}
        
        /* MUSIC PICKER */
        .music-panel{position:fixed;top:72px;right:12px;z-index:810;background:var(--card);border:2px solid rgba(0,212,255,0.2);border-radius:16px;padding:16px;width:290px;display:none;box-shadow:0 8px 32px rgba(0,0,0,0.5);max-height:80vh;overflow-y:auto}
        .music-panel.open{display:block;animation:fadeIn 0.3s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .music-panel-title{font-family:'Fredoka',sans-serif;font-size:14px;font-weight:700;color:var(--electric);margin-bottom:12px;text-align:center}
        .music-option{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;transition:all 0.2s;border:2px solid transparent;margin-bottom:6px;background:rgba(255,255,255,0.03)}
        .music-option:hover{background:rgba(0,212,255,0.08)}
        .music-option.selected{border-color:var(--electric);background:rgba(0,212,255,0.1)}
        .music-option-icon{font-size:24px;width:36px;text-align:center}
        .music-option-info{flex:1}
        .music-option-name{font-family:'Fredoka',sans-serif;font-size:14px;font-weight:600}
        .music-option-desc{font-size:11px;color:var(--muted)}
        .music-upload{margin-top:8px;padding:10px;border:2px dashed rgba(255,255,255,0.15);border-radius:10px;text-align:center;cursor:pointer;transition:all 0.2s}
        .music-upload:hover{border-color:var(--electric);background:rgba(0,212,255,0.05)}
        .music-upload-label{font-size:12px;color:var(--muted)}
        .music-upload-name{font-size:12px;color:var(--electric);margin-top:4px;font-weight:600;display:none}
        
        /* ========== 3-ZONE HUB ========== */
        .hub-title{font-family:'Fredoka',sans-serif;font-size:22px;font-weight:700;text-align:center;margin:8px 0 4px;color:var(--txt)}
        .hub-sub{font-size:13px;color:var(--muted);text-align:center;margin-bottom:16px}
        .zone-cards{width:100%;display:flex;flex-direction:column;gap:14px}
        .zone-card{background:var(--card);border:2.5px solid rgba(255,255,255,0.06);border-radius:20px;padding:20px 18px;cursor:pointer;transition:all 0.35s;display:flex;align-items:center;gap:16px;position:relative;overflow:hidden}
        .zone-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--zone-color,transparent) 0%,transparent 60%);opacity:0.06;transition:opacity 0.3s}
        .zone-card:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,0,0,0.3)}
        .zone-card:hover::before{opacity:0.12}
        .zone-card:active{transform:scale(0.98)}
        .zone-icon{width:64px;height:64px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;transition:all 0.3s}
        .zone-card:hover .zone-icon{transform:scale(1.08)}
        .zone-info{flex:1}
        .zone-name{font-family:'Fredoka',sans-serif;font-size:18px;font-weight:700;margin-bottom:2px}
        .zone-desc{font-size:12.5px;color:var(--muted);line-height:1.4}
        .zone-badge{position:absolute;top:12px;right:12px;font-size:10px;padding:3px 10px;border-radius:10px;font-weight:700;text-transform:uppercase;font-family:'Fredoka',sans-serif}
        .zone-stat{display:flex;gap:8px;margin-top:6px}
        .zone-stat-item{font-size:11px;color:var(--electric);font-weight:600;display:flex;align-items:center;gap:4px}
        .zone-card.quiz-zone{border-color:rgba(0,212,255,0.2);--zone-color:#00d4ff}
        .zone-card.quiz-zone .zone-icon{background:rgba(0,212,255,0.12);color:#00d4ff}
        .zone-card.quiz-zone .zone-name{color:#00d4ff}
        .zone-card.quiz-zone:hover{border-color:rgba(0,212,255,0.5)}
        .zone-card.study-zone{border-color:rgba(255,107,43,0.2);--zone-color:#ff6b2b}
        .zone-card.study-zone .zone-icon{background:rgba(255,107,43,0.12);color:#ff6b2b}
        .zone-card.study-zone .zone-name{color:#ff6b2b}
        .zone-card.study-zone:hover{border-color:rgba(255,107,43,0.5)}
        .zone-card.video-zone{border-color:rgba(155,89,182,0.2);--zone-color:#9b59b6}
        .zone-card.video-zone .zone-icon{background:rgba(155,89,182,0.12);color:#9b59b6}
        .zone-card.video-zone .zone-name{color:#9b59b6}
        .zone-card.video-zone:hover{border-color:rgba(155,89,182,0.5)}
        .zone-count{background:rgba(255,255,255,0.06);border-radius:8px;padding:2px 8px;font-size:11px;color:var(--muted);font-weight:600}
        
        /* STUDY ZONE */
        .study-empty{text-align:center;padding:40px 20px}
        .study-empty-icon{font-size:72px;margin-bottom:16px}
        .study-empty-title{font-family:'Fredoka',sans-serif;font-size:20px;font-weight:700;color:var(--electric);margin-bottom:8px}
        .study-empty-desc{font-size:14px;color:var(--muted);line-height:1.5;max-width:300px;margin:0 auto}
        .study-topic{background:var(--card);border:2px solid rgba(255,107,43,0.15);border-radius:14px;padding:14px 16px;margin-bottom:10px;cursor:pointer;transition:all 0.25s;display:flex;align-items:center;gap:12px}
        .study-topic:hover{border-color:var(--accent);transform:translateY(-2px)}
        .study-topic-icon{font-size:28px;width:44px;text-align:center}
        .study-topic-info{flex:1}
        .study-topic-name{font-family:'Fredoka',sans-serif;font-size:15px;font-weight:700}
        .study-topic-count{font-size:12px;color:var(--accent);font-weight:600;margin-top:2px}
        .study-alert{background:linear-gradient(135deg,rgba(255,107,43,0.12),rgba(231,76,60,0.08));border:1.5px solid rgba(255,107,43,0.25);border-radius:14px;padding:14px 16px;margin-bottom:16px;text-align:center;font-size:13px;color:var(--accent);line-height:1.5}
        .study-alert b{color:var(--txt)}
        
        /* VIDEO ZONE */
        .video-card{background:var(--card);border:2px solid rgba(155,89,182,0.15);border-radius:16px;padding:16px;margin-bottom:12px;cursor:pointer;transition:all 0.25s;display:flex;align-items:center;gap:14px}
        .video-card:hover{border-color:rgba(155,89,182,0.4);transform:translateY(-2px)}
        .video-card-thumb{width:72px;height:50px;border-radius:10px;background:rgba(155,89,182,0.15);display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
        .video-card-info{flex:1}
        .video-card-title{font-family:'Fredoka',sans-serif;font-size:14px;font-weight:700}
        .video-card-desc{font-size:11px;color:var(--muted);margin-top:2px}
        .video-card-dur{font-size:11px;color:#9b59b6;font-weight:600;margin-top:4px}
        .video-section-title{font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;color:var(--txt);margin:16px 0 10px;display:flex;align-items:center;gap:8px}
        
        /* STUDY REDIRECT BANNER */
        .study-redirect{background:linear-gradient(135deg,rgba(255,107,43,0.15),rgba(231,76,60,0.1));border:2px solid rgba(255,107,43,0.3);border-radius:16px;padding:18px;margin-top:14px;text-align:center;animation:pulse-border 2s infinite}
        @keyframes pulse-border{0%,100%{border-color:rgba(255,107,43,0.3)}50%{border-color:rgba(255,107,43,0.7)}}
        .study-redirect-icon{font-size:40px;margin-bottom:8px}
        .study-redirect-title{font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;color:var(--accent)}
        .study-redirect-desc{font-size:13px;color:var(--muted);margin:6px 0 12px;line-height:1.4}
    </style>
</head>
<body>
<div class="bg"><div class="o"></div><div class="o"></div><div class="o"></div></div>
<div class="gr"></div>

<!-- VIDEO FLOTANTE DESDE LA DERECHA -->
<div class="video-float" id="videoFloat">
    <div class="video-float-glow"></div>
    <div class="video-float-inner">
        <div class="video-float-label">üî¥ EN VIVO</div>
        <button class="video-float-close" onclick="closeVideo()">‚úï</button>
        <video id="marioVideo" playsinline webkit-playsinline></video>
    </div>
</div>

<!-- MODAL AI CHAT -->
<div class="ai-modal" id="aiModal">
    <div class="ai-chat">
        <div class="ai-chat-header">
            <div class="ai-chat-avatar"><img src="mario.jpg" alt="Mario"></div>
            <div class="ai-chat-title"><h3>Maestro Mario AI</h3><span>üü¢ Disponible para ayudarte</span></div>
            <button class="ai-chat-close" onclick="closeAIChat()">‚úï</button>
        </div>
        <div class="ai-chat-messages" id="aiMessages">
            <div class="ai-msg mario">¬°√ìrale t√©cnico! Soy el Maestro Mario con inteligencia artificial. ¬øEn qu√© te puedo ayudar? Preg√∫ntame lo que quieras sobre HVAC, refrigeraci√≥n, o electricidad. üîß</div>
        </div>
        <div class="speaking-indicator" id="speakingIndicator">
            <div class="waves"><div class="wave"></div><div class="wave"></div><div class="wave"></div><div class="wave"></div></div>
            <span>Maestro Mario est√° hablando...</span>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiInput" placeholder="Escribe tu pregunta..." onkeydown="if(event.key==='Enter'&&!event.shiftKey)sendAIMessage()">
            <button id="sendBtn" onclick="sendAIMessage()">‚û§</button>
        </div>
    </div>
</div>

<!-- AUDIO PLAYER PARA VOZ DE AI -->
<audio id="aiAudio" style="display:none"></audio>

<div class="app">
<!-- PANTALLA INICIO -->
<div class="s on" id="s0"><div class="sp">
    <div class="aw lg" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="Maestro Mario"></div><span class="ai-badge">AI</span></div>
    <div><div class="sp-t">MAESTRO<br>MARIO</div><div class="badge">‚ö° NIVEL 33</div></div>
    <div class="sp-s">Si no mides, est√°s adivinando</div>
    <button class="bt" onclick="startWithVideo()" style="max-width:260px">Comenzar / Start</button>
</div></div>

<!-- IDIOMA -->
<div class="s" id="s1">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div><div class="lo-s">HVAC ‚Ä¢ ELECTRICAL ‚Ä¢ TRAINING</div></div>
    <div class="aw md" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb">¬°Hola! Choose your language<br>Elige tu idioma</div>
    <div class="fl"><div class="fc" onclick="setLang('es')"><span class="fe">üá≤üáΩ</span><span class="fn">Espa√±ol</span></div><div class="fc" onclick="setLang('en')"><span class="fe">üá∫üá∏</span><span class="fn">English</span></div></div>
</div>

<!-- NOMBRE -->
<div class="s" id="s2">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:20%"></div></div><div class="ps"><b data-t="step_1"></b></div>
    <div class="aw md" id="a2" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb2"><span data-t="welcome_speech"></span></div>
    <div style="width:100%"><input class="ip" id="nm" data-tp="name_ph" oninput="document.getElementById('b2').disabled=this.value.trim().length<2"><button class="bt" id="b2" disabled onclick="sName()" data-t="continue"></button></div>
</div>

<!-- NIVEL -->
<div class="s" id="s3">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:40%"></div></div><div class="ps"><b data-t="step_2"></b></div>
    <div class="aw sm" id="a3" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb3"><span data-t="level_speech"></span></div>
    <div class="os" id="lo"></div>
    <button class="bt" id="b3" disabled onclick="sLvl()" data-t="continue"></button>
</div>

<!-- ESPECIALIDADES -->
<div class="s" id="s4">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:60%"></div></div><div class="ps"><b data-t="step_3"></b></div>
    <div class="aw sm" id="a4" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb4"><span data-t="spec_speech"></span></div>
    <p class="mh" data-t="multi_hint"></p>
    <div class="os" id="so"></div>
    <button class="bt" id="b4" disabled onclick="sSpc()" data-t="continue"></button>
</div>

<!-- ESCUELA -->
<div class="s" id="s5">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:80%"></div></div><div class="ps"><b data-t="step_4"></b></div>
    <div class="aw sm" id="a5" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb5"><span data-t="school_speech"></span></div>
    <div class="os" id="sco"></div>
    <button class="bt" id="b5" disabled onclick="sSch()" data-t="continue"></button>
</div>

<!-- METAS -->
<div class="s" id="s6">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:90%"></div></div><div class="ps"><b data-t="step_5"></b></div>
    <div class="aw sm" id="a6" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb6"><span data-t="goals_speech"></span></div>
    <p class="mh" data-t="multi_hint"></p>
    <div class="os" id="go2"></div>
    <button class="bt" id="b6" disabled onclick="sGol()" data-t="continue"></button>
</div>

<!-- RUTA FINAL -->
<div class="s" id="s7">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:100%"></div></div>
    <div class="aw md" id="a7" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--gold) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb7"><span data-t="route_speech"></span></div>
    <div id="rl" style="width:100%"></div>
    <button class="bt" onclick="startApp()" data-t="start_btn"></button>
</div>

<!-- ========== 3-ZONE HUB ========== -->
<div class="s" id="s-hub">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--electric) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="hubBubble">¬øQu√© quieres hacer hoy?</div>
    
    <div class="zone-cards">
        <!-- QUIZ ZONE -->
        <div class="zone-card quiz-zone" onclick="goQuizZone()">
            <div class="zone-icon">üìù</div>
            <div class="zone-info">
                <div class="zone-name">Quiz Zone</div>
                <div class="zone-desc">Toma quizzes y demuestra lo que sabes</div>
                <div class="zone-stat">
                    <span class="zone-stat-item" id="hubQuizCount">üìã 0 quizzes</span>
                    <span class="zone-stat-item" id="hubQuizTotal">üìä 0 preguntas</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(0,212,255,0.15);color:#00d4ff" id="hubQuizBadge">¬°Vamos!</div>
        </div>
        
        <!-- STUDY ZONE -->
        <div class="zone-card study-zone" onclick="goStudyZone()">
            <div class="zone-icon">üìö</div>
            <div class="zone-info">
                <div class="zone-name">Study Zone</div>
                <div class="zone-desc">Repasa las preguntas que m√°s se te dificultan</div>
                <div class="zone-stat">
                    <span class="zone-stat-item" id="hubStudyCount">üîÑ 0 por repasar</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(255,107,43,0.15);color:#ff6b2b;display:none" id="hubStudyBadge">‚ö†Ô∏è Repasa</div>
        </div>
        
        <!-- VIDEO ZONE -->
        <div class="zone-card video-zone" onclick="goVideoZone()">
            <div class="zone-icon">üé•</div>
            <div class="zone-info">
                <div class="zone-name">Video Zone</div>
                <div class="zone-desc">Videos de Maestro Mario para aprender visualmente</div>
                <div class="zone-stat">
                    <span class="zone-stat-item">üé¨ Videos de entrenamiento</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(155,89,182,0.15);color:#9b59b6">Pronto</div>
        </div>
    </div>
    
    <button class="bt" onclick="go('s10');renderProfile()" style="background:var(--card);border:2px solid var(--gold);margin-top:16px">üë§ Mi Perfil</button>
    <button class="bt" onclick="go('s7')" style="background:var(--card);border:2px solid var(--accent);margin-top:8px">‚Üê Mi Ruta</button>
</div>

<!-- QUIZ ZONE SELECTOR -->
<div class="s" id="s7b">
    <div class="lo"><div class="lo-t">üìù QUIZ ZONE</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--electric) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb">¬øQu√© quiz quieres tomar hoy?</div>
    <div id="quizSelList" style="width:100%;display:flex;flex-direction:column;gap:12px;margin-top:16px"></div>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--electric);margin-top:16px">‚Üê Volver al Hub</button>
</div>

<!-- STUDY ZONE -->
<div class="s" id="s-study">
    <div class="lo"><div class="lo-t">üìö STUDY ZONE</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--accent) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="studyBubble">Aqu√≠ repasamos lo que necesitas reforzar.</div>
    <div id="studyContent" style="width:100%;margin-top:16px"></div>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);margin-top:16px">‚Üê Volver al Hub</button>
</div>

<!-- STUDY QUIZ (reuses quiz UI but in study mode) -->
<div class="s" id="s-study-quiz">
    <div class="quiz-header">
        <div class="quiz-cat" id="sqCat">üìö REPASO</div>
        <div class="quiz-score">‚úÖ <span class="correct" id="sqRight">0</span> | ‚ùå <span class="wrong" id="sqWrong">0</span></div>
    </div>
    <div class="pb"><div class="pbf" id="sqBar" style="width:0%"></div></div>
    <div class="quiz-num" id="sqNum"></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="sqBubble"></div>
    <div class="quiz-q" id="sqText"></div>
    <div class="quiz-opts" id="sqOpts"></div>
    <div class="quiz-explain" id="sqExplain"></div>
    <div class="quiz-nav">
        <button class="quiz-prev" id="sqPrev" onclick="studyPrev()">‚Üê Anterior</button>
        <button class="quiz-fwd" id="sqNext" onclick="studyNext()">Siguiente ‚Üí</button>
    </div>
</div>

<!-- STUDY RESULT -->
<div class="s" id="s-study-result">
    <div class="aw md" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--accent) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="quiz-result">
        <div class="quiz-medal" id="srMedal"></div>
        <div class="quiz-result-score" id="srScore"></div>
        <div class="quiz-result-label" id="srLabel"></div>
        <div class="bb quiz-result-msg" id="srMsg"></div>
    </div>
    <button class="bt" onclick="startStudyQuiz(lastStudyCat)">üîÑ Repasar de Nuevo</button>
    <button class="bt" onclick="go('s-study');renderStudyZone()" style="background:var(--card);border:2px solid var(--accent);margin-top:10px">üìö Study Zone</button>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--electric);margin-top:10px">‚Üê Volver al Hub</button>
</div>

<!-- VIDEO ZONE -->
<div class="s" id="s-videos">
    <div class="lo"><div class="lo-t">üé• VIDEO ZONE</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,#9b59b6 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb">Videos del Maestro Mario para que aprendas viendo.</div>
    <div id="videoContent" style="width:100%;margin-top:16px"></div>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid rgba(155,89,182,0.3);margin-top:16px">‚Üê Volver al Hub</button>
</div>

<!-- QUIZ -->
<div class="s" id="s8">
    <div class="quiz-header">
        <div class="quiz-cat" id="qCat"></div>
        <div class="quiz-score">‚úÖ <span class="correct" id="qRight">0</span> | ‚ùå <span class="wrong" id="qWrong">0</span></div>
    </div>
    <div class="pb"><div class="pbf" id="qBar" style="width:0%"></div></div>
    <div class="quiz-num" id="qNum"></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="qBubble"></div>
    <div class="quiz-q" id="qText"></div>
    <div class="quiz-opts" id="qOpts"></div>
    <div class="quiz-explain" id="qExplain"></div>
    <div class="quiz-nav">
        <button class="quiz-prev" id="qPrev" onclick="prevQuestion()">‚Üê Anterior</button>
        <button class="quiz-fwd" id="qNext" onclick="nextQuestion()">Siguiente ‚Üí</button>
    </div>
</div>

<!-- QUIZ RESULT -->
<div class="s" id="s9">
    <div class="aw md" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--gold) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="quiz-result">
        <div class="quiz-medal" id="rMedal"></div>
        <div class="quiz-result-score" id="rScore"></div>
        <div class="quiz-result-label" id="rLabel"></div>
        <div class="quiz-stars" id="rStars"><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span></div>
        <div class="bb quiz-result-msg" id="rMsg"></div>
        <div id="rMedalEarned" style="display:none;margin-top:16px;padding:16px;background:rgba(255,215,0,0.1);border:2px solid var(--gold);border-radius:14px;text-align:center">
            <div style="font-size:48px" id="rNewMedal"></div>
            <div style="font-family:'Fredoka',sans-serif;font-size:18px;font-weight:700;color:var(--gold);margin-top:8px" id="rMedalName"></div>
        </div>
        <!-- STUDY ZONE REDIRECT (shown when score < 70%) -->
        <div class="study-redirect" id="rStudyRedirect" style="display:none">
            <div class="study-redirect-icon">üìö</div>
            <div class="study-redirect-title">¬°Maestro Mario te recomienda repasar!</div>
            <div class="study-redirect-desc" id="rStudyDesc">Tienes preguntas que necesitas reforzar. Ve a la Study Zone para dominarlas.</div>
            <button class="bt" onclick="go('s-study');renderStudyZone()" style="background:var(--accent);margin-top:8px;padding:12px">üìö Ir a Study Zone ‚Üí</button>
        </div>
    </div>
    <button class="bt" onclick="retryQuiz()">üîÑ Intentar de Nuevo</button>
    <button class="bt" onclick="renderQuizSelector();go('s7b')" style="background:var(--card);border:2px solid var(--electric);margin-top:10px">üìù Otro Quiz</button>
    <button class="bt" onclick="go('s10');renderProfile()" style="background:var(--card);border:2px solid var(--gold);margin-top:10px">üë§ Ver Mi Perfil</button>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);margin-top:10px">‚Üê Volver al Hub</button>
</div>

<!-- PROFILE -->
<div class="s" id="s10">
    <div class="prof-card">
        <div class="prof-avatar" id="profAvatar" onclick="toggleAvatarPicker()">üë§<div class="prof-avatar-edit">‚úèÔ∏è</div></div>
        <div class="avatar-picker" id="avatarPicker">
            <div class="avatar-picker-title">Elige tu avatar</div>
            <div class="avatar-grid" id="avatarGrid"></div>
        </div>
        <div class="prof-name" id="profName"></div>
        <div class="prof-title" id="profTitle"></div>
        <div class="prof-level">
            <div>
                <div style="font-size:12px;color:var(--muted)">NIVEL</div>
                <div class="prof-lvl-num" id="profLevel">1</div>
            </div>
        </div>
        <div class="prof-xp">
            <div class="prof-xp-bar"><div class="prof-xp-fill" id="profXpBar" style="width:0%"></div></div>
            <div class="prof-xp-txt" id="profXpTxt">0 / 100 XP</div>
        </div>
    </div>
    <div class="prof-stats">
        <div class="prof-stat"><div class="prof-stat-num" id="profPts">0</div><div class="prof-stat-label">Puntos</div></div>
        <div class="prof-stat"><div class="prof-stat-num" id="profAcc">0%</div><div class="prof-stat-label">Precisi√≥n</div></div>
        <div class="prof-stat"><div class="prof-stat-num" id="profStrk">0</div><div class="prof-stat-label">Mejor Racha</div></div>
    </div>
    <div style="width:100%;margin-top:20px;font-family:'Fredoka',sans-serif;font-size:18px;font-weight:700;text-align:center">üèÖ Medallas</div>
    <div class="medals-grid" id="medalsGrid"></div>
    <button class="bt" onclick="renderQuizSelector();go('s7b')" style="margin-top:20px">üìù Tomar un Quiz</button>
    <button class="bt" onclick="toggleMusicPanel()" style="background:var(--card);border:2px solid rgba(0,212,255,0.3);margin-top:10px">üé∂ Cambiar M√∫sica</button>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);margin-top:10px">‚Üê Volver al Hub</button>
</div>
</div>
<div class="cw" id="conf"></div>
<button class="music-btn" id="musicBtn" onclick="toggleMusic()">üéµ</button>
<button class="music-settings" onclick="toggleMusicPanel()">üé∂</button>
<div class="music-panel" id="musicPanel">
    <div class="music-panel-title">üé∂ Elige tu m√∫sica</div>
    <div id="musicOptions"></div>
    <div class="music-upload" onclick="document.getElementById('musicFile').click()">
        <div>üìÅ <b>Mi M√∫sica</b></div>
        <div class="music-upload-label">Sube tu MP3, WAV o audio favorito</div>
        <div class="music-upload-name" id="musicFileName"></div>
    </div>
    <input type="file" id="musicFile" accept="audio/*" style="display:none" onchange="loadCustomMusic(this)">
</div>
<button class="profile-btn" id="profileBtn" onclick="go('s10');renderProfile()">üë§</button>

<script>
const D={lang:'es',name:'',level:null,specs:[],school:null,goals:[]};
let videoPlaying=false;
let currentVideoCallback=null;
let isSpeaking=false;
let audioUnlocked=false;

function unlockAudio(){
    if(audioUnlocked)return;
    const audio=document.getElementById('aiAudio');
    audio.src='data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYoRwAAAAAAAAAAAAAAAAAAAAAAAA==';
    audio.play().then(()=>{audio.pause();audioUnlocked=true;}).catch(()=>{});
}

// ========== CHIPTUNE MUSIC ENGINE ==========
let musicCtx=null;
let musicPlaying=false;
let musicMuted=false;
let musicGain=null;
let musicTimers=[];
let musicVolume=0.5;
let musicMode='onboarding';
let currentMusicStyle='pokemon';
let customAudio=null;
let musicPanelOpen=false;

const MUSIC_STYLES=[
    {id:'pokemon',icon:'üéÆ',name:'Pok√©mon Adventure',desc:'8-bit cl√°sico'},
    {id:'lofi',icon:'üéß',name:'Lo-Fi Chill',desc:'Relajado para estudiar'},
    {id:'battle',icon:'‚öîÔ∏è',name:'Boss Battle',desc:'√âpico e intenso'},
    {id:'reggaeton',icon:'üé∫',name:'Reggaet√≥n Study',desc:'Ritmo latino'},
    {id:'jazz',icon:'üé∑',name:'Jazz Smooth',desc:'Suave y elegante'},
    {id:'tropical',icon:'üå¥',name:'Tropical Vibes',desc:'Cumbia y playa'},
    {id:'rock8bit',icon:'üé∏',name:'Rock 8-Bit',desc:'Rock cl√°sico pixelado'},
    {id:'ambient',icon:'üåô',name:'Ambient Night',desc:'Calmado nocturno'},
    {id:'mariachi',icon:'üá≤üáΩ',name:'Mariachi Digital',desc:'Orgullo mexicano'},
    {id:'silent',icon:'üîá',name:'Sin M√∫sica',desc:'Solo silencio'}
];

function noteFreq(note,octave){
    const notes={C:261.63,D:293.66,E:329.63,F:349.23,G:392.00,A:440.00,B:493.88};
    const base=notes[note]||261.63;
    return base*Math.pow(2,octave-4);
}

function playNote(type,freq,start,dur,vol){
    if(!musicCtx)return;
    const osc=musicCtx.createOscillator();
    const gain=musicCtx.createGain();
    osc.type=type;
    osc.frequency.setValueAtTime(freq,start);
    gain.gain.setValueAtTime(vol,start);
    gain.gain.setValueAtTime(vol,start+dur*0.8);
    gain.gain.linearRampToValueAtTime(0,start+dur);
    osc.connect(gain);
    gain.connect(musicGain);
    osc.start(start);
    osc.stop(start+dur);
}

function playMusicLoop(){
    if(!musicCtx||!musicPlaying||currentMusicStyle==='custom'||currentMusicStyle==='silent')return;
    const style=currentMusicStyle;
    const bpm=style==='battle'?160:style==='reggaeton'?95:style==='lofi'?75:130;
    const beat=60/bpm;
    const half=beat/2;
    const now=musicCtx.currentTime+0.05;
    
    if(style==='pokemon'){
        const melody=[['E',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['D',5],['C',5],['D',5],['E',5],['G',5],['A',5],['G',5],['E',5],['G',5],['A',5],['B',5],['C',6],['B',5],['A',5],['G',5],['A',5],['B',5],['G',5],['E',5],['D',5],['E',5],['C',5],['D',5],['E',5],['E',5]];
        const bass=[['C',3],['C',3],['G',3],['G',3],['A',3],['A',3],['E',3],['E',3],['F',3],['F',3],['C',3],['C',3],['G',3],['G',3],['G',3],['G',3],['A',3],['A',3],['F',3],['F',3],['C',3],['C',3],['G',3],['G',3],['F',3],['F',3],['G',3],['G',3],['C',3],['C',3],['C',3],['C',3]];
        const arp=[['C',4],['E',4],['G',4],['E',4],['A',4],['C',5],['E',5],['C',5],['F',4],['A',4],['C',5],['A',4],['G',4],['B',4],['D',5],['B',4],['A',4],['C',5],['E',5],['C',5],['F',4],['A',4],['C',5],['A',4],['G',4],['B',4],['D',5],['B',4],['C',4],['E',4],['G',4],['E',4]];
        for(let i=0;i<melody.length;i++){playNote('square',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.85,0.08);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.12);}
        for(let i=0;i<arp.length;i++){playNote('square',noteFreq(arp[i][0],arp[i][1]),now+i*half,half*0.4,0.03);}
        const loopDur=melody.length*half;
        musicTimers.push(setTimeout(()=>playMusicLoop(),loopDur*1000-100));
    }
    else if(style==='lofi'){
        // Lo-fi chill beats - sine waves, slow, jazzy
        const melody=[['E',4],['G',4],['A',4],['G',4],['E',4],['D',4],['C',4],['D',4],['E',4],['A',4],['G',4],['E',4],['D',4],['E',4],['G',4],['A',4]];
        const bass=[['C',3],['C',3],['A',2],['A',2],['F',2],['F',2],['G',2],['G',2],['C',3],['C',3],['A',2],['A',2],['F',2],['F',2],['G',2],['G',2]];
        const pad=[['E',4],['E',4],['C',4],['C',4],['A',3],['A',3],['B',3],['B',3],['E',4],['E',4],['C',4],['C',4],['A',3],['A',3],['B',3],['B',3]];
        for(let i=0;i<melody.length;i++){playNote('sine',noteFreq(melody[i][0],melody[i][1]),now+i*beat,beat*0.7,0.1);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*beat,beat*0.9,0.1);}
        for(let i=0;i<pad.length;i++){playNote('sine',noteFreq(pad[i][0],pad[i][1]),now+i*beat,beat*1.2,0.04);}
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*beat*1000-100));
    }
    else if(style==='battle'){
        // Epic boss battle - fast, intense, sawtooth
        const melody=[['E',5],['E',5],['F',5],['G',5],['G',5],['F',5],['E',5],['D',5],['C',5],['C',5],['D',5],['E',5],['E',5],['D',5],['D',5],['D',5],['E',5],['E',5],['F',5],['G',5],['G',5],['F',5],['E',5],['D',5],['C',5],['C',5],['D',5],['E',5],['D',5],['C',5],['C',5],['C',5]];
        const bass=[['C',2],['C',2],['C',2],['C',2],['A',2],['A',2],['A',2],['A',2],['F',2],['F',2],['F',2],['F',2],['G',2],['G',2],['G',2],['G',2],['C',2],['C',2],['C',2],['C',2],['A',2],['A',2],['A',2],['A',2],['F',2],['F',2],['F',2],['F',2],['G',2],['G',2],['G',2],['G',2]];
        for(let i=0;i<melody.length;i++){playNote('sawtooth',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.8,0.06);}
        for(let i=0;i<bass.length;i++){playNote('square',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.1);}
        // Drum-like percussion with noise
        for(let i=0;i<32;i+=2){playNote('square',noteFreq('C',1),now+i*half,half*0.15,0.15);}
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='reggaeton'){
        // Reggaet√≥n dembow rhythm
        const melody=[['A',4],['C',5],['D',5],['E',5],['D',5],['C',5],['A',4],['G',4],['A',4],['C',5],['D',5],['E',5],['G',5],['E',5],['D',5],['C',5]];
        const bass=[['A',2],['A',2],['A',2],['A',2],['D',3],['D',3],['D',3],['D',3],['F',2],['F',2],['G',2],['G',2],['A',2],['A',2],['A',2],['A',2]];
        for(let i=0;i<melody.length;i++){playNote('triangle',noteFreq(melody[i][0],melody[i][1]),now+i*beat,beat*0.6,0.09);}
        for(let i=0;i<bass.length;i++){playNote('sine',noteFreq(bass[i][0],bass[i][1]),now+i*beat,beat*0.8,0.14);}
        // Dembow kick pattern
        for(let i=0;i<16;i++){
            const isKick=(i%4===0||i%4===3);
            if(isKick)playNote('sine',noteFreq('C',2),now+i*beat,beat*0.2,0.18);
            else playNote('square',noteFreq('C',1),now+i*beat,beat*0.08,0.06);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*beat*1000-100));
    }
    else if(style==='jazz'){
        // Smooth jazz - walking bass, cool chords
        const melody=[['G',4],['A',4],['B',4],['D',5],['E',5],['D',5],['B',4],['A',4],['G',4],['F',4],['E',4],['D',4],['E',4],['G',4],['A',4],['B',4]];
        const bass=[['G',2],['B',2],['D',3],['G',2],['C',3],['E',3],['G',3],['C',3],['A',2],['C',3],['E',3],['A',2],['D',3],['F',3],['A',3],['D',3]];
        const pad=[['B',3],['D',4],['G',3],['B',3],['E',4],['G',4],['C',4],['E',4],['C',4],['E',4],['A',3],['C',4],['F',3],['A',3],['D',4],['F',3]];
        for(let i=0;i<melody.length;i++){playNote('sine',noteFreq(melody[i][0],melody[i][1]),now+i*beat,beat*0.75,0.08);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*beat,beat*0.85,0.1);}
        for(let i=0;i<pad.length;i++){playNote('sine',noteFreq(pad[i][0],pad[i][1]),now+i*beat,beat*1.5,0.03);}
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*beat*1000-100));
    }
    else if(style==='tropical'){
        // Tropical cumbia - bright, rhythmic
        const melody=[['C',5],['E',5],['G',5],['E',5],['C',5],['D',5],['F',5],['A',5],['G',5],['F',5],['E',5],['D',5],['C',5],['E',5],['G',5],['C',6]];
        const bass=[['C',3],['C',3],['G',2],['G',2],['F',2],['F',2],['G',2],['G',2],['C',3],['C',3],['A',2],['A',2],['F',2],['F',2],['G',2],['G',2]];
        for(let i=0;i<melody.length;i++){playNote('triangle',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.7,0.09);}
        for(let i=0;i<bass.length;i++){playNote('sine',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.85,0.12);}
        // Guiro/shaker pattern
        for(let i=0;i<16;i++){
            if(i%2===0)playNote('square',noteFreq('C',7),now+i*half,half*0.05,0.04);
            if(i%4===0)playNote('sine',noteFreq('G',2),now+i*half,half*0.15,0.15);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='rock8bit'){
        // 8-bit rock - power chords, driving rhythm
        const melody=[['E',5],['E',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['D',5],['D',5],['E',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['E',5],['G',5],['A',5],['C',6],['B',5],['A',5],['G',5],['E',5],['D',5],['E',5],['G',5],['A',5],['G',5],['E',5],['E',5]];
        const bass=[['E',2],['E',2],['E',2],['E',2],['G',2],['G',2],['G',2],['G',2],['A',2],['A',2],['A',2],['A',2],['B',2],['B',2],['B',2],['B',2],['E',2],['E',2],['E',2],['E',2],['C',3],['C',3],['C',3],['C',3],['A',2],['A',2],['A',2],['A',2],['B',2],['B',2],['B',2],['B',2]];
        for(let i=0;i<melody.length;i++){playNote('square',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.8,0.07);}
        for(let i=0;i<bass.length;i++){playNote('sawtooth',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.09);}
        // Power drum beat
        for(let i=0;i<32;i++){
            if(i%4===0)playNote('square',noteFreq('C',1),now+i*half,half*0.12,0.16);
            if(i%4===2)playNote('square',noteFreq('G',6),now+i*half,half*0.06,0.05);
            if(i%2===1)playNote('square',noteFreq('D',7),now+i*half,half*0.04,0.03);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='ambient'){
        // Ambient night - slow pads, ethereal
        const pad1=[['C',4],['E',4],['G',4],['E',4],['A',3],['C',4],['E',4],['C',4]];
        const pad2=[['G',3],['B',3],['D',4],['B',3],['F',3],['A',3],['C',4],['A',3]];
        const bell=[['G',5],['E',5],['C',5],['G',5],['A',5],['F',5],['D',5],['A',5]];
        const longBeat=beat*2;
        for(let i=0;i<pad1.length;i++){playNote('sine',noteFreq(pad1[i][0],pad1[i][1]),now+i*longBeat,longBeat*1.2,0.07);}
        for(let i=0;i<pad2.length;i++){playNote('sine',noteFreq(pad2[i][0],pad2[i][1]),now+i*longBeat,longBeat*1.2,0.05);}
        for(let i=0;i<bell.length;i++){playNote('sine',noteFreq(bell[i][0],bell[i][1]),now+i*longBeat,longBeat*0.4,0.04);}
        // Deep bass drone
        playNote('sine',noteFreq('C',2),now,pad1.length*longBeat,0.06);
        musicTimers.push(setTimeout(()=>playMusicLoop(),pad1.length*longBeat*1000-100));
    }
    else if(style==='mariachi'){
        // Mariachi digital - trumpets and strumming
        const trumpet=[['G',5],['A',5],['B',5],['D',6],['B',5],['A',5],['G',5],['G',5],['A',5],['B',5],['G',5],['E',5],['D',5],['E',5],['G',5],['A',5],['B',5],['D',6],['E',6],['D',6],['B',5],['A',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['D',5],['G',5],['G',5],['G',5]];
        const bass=[['G',2],['G',2],['D',3],['D',3],['G',2],['G',2],['D',3],['D',3],['E',2],['E',2],['B',2],['B',2],['C',3],['C',3],['D',3],['D',3],['G',2],['G',2],['D',3],['D',3],['E',2],['E',2],['B',2],['B',2],['C',3],['C',3],['D',3],['D',3],['G',2],['G',2],['G',2],['G',2]];
        for(let i=0;i<trumpet.length;i++){playNote('sawtooth',noteFreq(trumpet[i][0],trumpet[i][1]),now+i*half,half*0.75,0.06);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.85,0.1);}
        // Guitarr√≥n rhythm
        for(let i=0;i<32;i++){
            if(i%4===0||i%4===3)playNote('triangle',noteFreq('G',3),now+i*half,half*0.3,0.08);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),trumpet.length*half*1000-100));
    }
}

function toggleMusicPanel(e){
    if(e)e.preventDefault();
    musicPanelOpen=!musicPanelOpen;
    const panel=document.getElementById('musicPanel');
    panel.classList.toggle('open',musicPanelOpen);
    if(musicPanelOpen)renderMusicOptions();
}

function renderMusicOptions(){
    document.getElementById('musicOptions').innerHTML=MUSIC_STYLES.map(s=>
        '<div class="music-option'+(currentMusicStyle===s.id?' selected':'')+'" onclick="switchMusic(\''+s.id+'\')">'+
        '<div class="music-option-icon">'+s.icon+'</div>'+
        '<div class="music-option-info"><div class="music-option-name">'+s.name+'</div><div class="music-option-desc">'+s.desc+'</div></div>'+
        '</div>'
    ).join('');
    // Show custom music option if loaded
    if(customAudio){
        const el=document.querySelector('.music-upload');
        if(el)el.querySelector('.music-option')?.classList.toggle('selected',currentMusicStyle==='custom');
    }
}

function switchMusic(styleId){
    // Stop current
    if(customAudio){customAudio.pause();customAudio.currentTime=0;}
    stopMusicOsc();
    
    currentMusicStyle=styleId;
    
    if(styleId==='silent'){
        musicPlaying=false;
        document.getElementById('musicBtn').textContent='üîá';
    }else if(styleId==='custom'&&customAudio){
        musicPlaying=true;
        customAudio.volume=musicMuted?0:Math.min(musicVolume*2,1);
        customAudio.loop=true;
        customAudio.play().catch(()=>{});
        document.getElementById('musicBtn').textContent='üéµ';
    }else{
        if(!musicCtx||musicCtx.state==='closed'){
            musicCtx=new(window.AudioContext||window.webkitAudioContext)();
            musicGain=musicCtx.createGain();
            musicGain.gain.setValueAtTime(musicMuted?0:musicVolume,musicCtx.currentTime);
            musicGain.connect(musicCtx.destination);
        }
        musicPlaying=true;
        document.getElementById('musicBtn').textContent='üéµ';
        playMusicLoop();
    }
    
    renderMusicOptions();
    try{localStorage.setItem('maestro_music_style',styleId);}catch(e){}
}

function stopMusicOsc(){
    musicTimers.forEach(t=>clearTimeout(t));
    musicTimers=[];
    if(musicCtx&&musicCtx.state!=='closed'){musicCtx.close();musicCtx=null;}
}

function loadCustomMusic(input){
    if(!input.files||!input.files[0])return;
    const file=input.files[0];
    const url=URL.createObjectURL(file);
    customAudio=new Audio(url);
    customAudio.loop=true;
    document.getElementById('musicFileName').textContent='‚ô´ '+file.name;
    document.getElementById('musicFileName').style.display='block';
    switchMusic('custom');
    toggleMusicPanel();
}

function startMusic(){
    if(musicPlaying)return;
    // Load saved style
    try{const saved=localStorage.getItem('maestro_music_style');if(saved)currentMusicStyle=saved;}catch(e){}
    
    if(currentMusicStyle==='silent')return;
    if(currentMusicStyle==='custom'&&customAudio){
        musicPlaying=true;
        customAudio.volume=0.5;
        customAudio.loop=true;
        customAudio.play().catch(()=>{});
        document.getElementById('musicBtn').classList.add('active');
        document.getElementById('musicBtn').textContent='üéµ';
        return;
    }
    musicCtx=new(window.AudioContext||window.webkitAudioContext)();
    musicGain=musicCtx.createGain();
    musicGain.gain.setValueAtTime(0.5,musicCtx.currentTime);
    musicGain.connect(musicCtx.destination);
    musicPlaying=true;
    musicMuted=false;
    document.getElementById('musicBtn').classList.add('active');
    document.getElementById('musicBtn').textContent='üéµ';
    playMusicLoop();
}

function stopMusic(){
    musicPlaying=false;
    if(customAudio){customAudio.pause();}
    stopMusicOsc();
}

function toggleMusic(){
    const btn=document.getElementById('musicBtn');
    if(musicMuted){
        musicMuted=false;
        musicVolume=musicMode==='studying'?0.25:0.5;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=Math.min(musicVolume*2,1);
        btn.textContent='üéµ';
        btn.classList.remove('muted');
    }else if(musicVolume>=0.4){
        musicVolume=musicMode==='studying'?0.15:0.25;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=Math.min(musicVolume*2,1);
        btn.textContent='üîâ';
    }else if(musicVolume>=0.15){
        musicVolume=musicMode==='studying'?0.06:0.1;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=Math.min(musicVolume*2,1);
        btn.textContent='üîà';
    }else{
        musicMuted=true;
        musicVolume=0;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(0,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=0;
        btn.textContent='üîá';
        btn.classList.add('muted');
    }
}

function setMusicVolume(vol){
    musicVolume=vol;
    if(musicGain&&musicCtx&&!musicMuted)musicGain.gain.linearRampToValueAtTime(vol,musicCtx.currentTime+0.3);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(vol*2,1);
}

function lowerMusicForSpeech(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(Math.min(musicVolume*0.2,0.05),musicCtx.currentTime+0.3);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*0.4,0.15);
}

function restoreMusicAfterSpeech(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(musicVolume,musicCtx.currentTime+0.3);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*2,1);
}

function lowerMusicForVideo(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(Math.min(musicVolume*0.3,0.08),musicCtx.currentTime+0.5);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*0.5,0.2);
}

function restoreMusicAfterVideo(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(musicVolume,musicCtx.currentTime+0.5);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*2,1);
}

function enterStudyMode(){
    musicMode='studying';
    setMusicVolume(0.25);
    document.getElementById('musicBtn').textContent='üîâ';
}

const SUPABASE_URL='https://htklsowiyjwsjnacnvnr.supabase.co/functions/v1';

const VIDEOS={
    bienvenida:'bienvenida.mp4.mp4',
    correcto:'correcto.mp4.mp4',
    incorrecto:'incorrecto.mp4.mp4',
    medalla:'medalla.mp4.mp4'
};

// ========== VIDEO FUNCTIONS ==========
let videoClosing=false;

function showVideo(type,cb){
    if(videoPlaying||videoClosing)return;
    videoPlaying=true;
    videoClosing=false;
    lowerMusicForVideo();
    currentVideoCallback=cb;
    const vf=document.getElementById('videoFloat');
    const v=document.getElementById('marioVideo');
    const videoSrc=VIDEOS[type]||VIDEOS.bienvenida;
    console.log('Loading video:',videoSrc);
    
    // Limpiar handlers anteriores
    v.onended=null;
    v.onerror=null;
    
    v.src=videoSrc;
    v.load();
    vf.classList.remove('hiding');
    vf.classList.add('active');
    v.play().then(()=>{
        console.log('Video playing');
    }).catch(e=>{
        console.log('Video play error:',e);
        closeVideo();
    });
    v.onended=function(){
        console.log('Video ended');
        closeVideo();
    };
    v.onerror=function(e){
        console.log('Video error:',e);
        if(videoPlaying&&!videoClosing)closeVideo();
    };
}

function closeVideo(){
    if(videoClosing)return;
    videoClosing=true;
    const vf=document.getElementById('videoFloat');
    const v=document.getElementById('marioVideo');
    
    // Limpiar handlers ANTES de tocar el src
    v.onended=null;
    v.onerror=null;
    
    vf.classList.add('hiding');
    vf.classList.remove('active');
    restoreMusicAfterVideo();
    setTimeout(()=>{
        v.pause();
        v.removeAttribute('src');
        v.load();
        videoPlaying=false;
        videoClosing=false;
        if(currentVideoCallback){
            const cb=currentVideoCallback;
            currentVideoCallback=null;
            cb();
        }
    },600);
}

function startWithVideo(){
    startMusic();
    showVideo('bienvenida',()=>{
        go('s1');
    });
}

// ========== AI CHAT FUNCTIONS ==========
const MARIO_SYSTEM="Eres el Maestro Mario Flores Corona, instructor de HVAC/Refrigeracion/Electricidad con 25+ a√±os de experiencia. Tu escuela es ACVOLT Tech School en San Bernardino, California. Tu frase: Si no mides, est√°s adivinando. Responde en 2-3 oraciones MAX. S√© personal y motivador. Usa frases como √≥rale, vamos con todo, as√≠ se hace. NO uses markdown ni emojis.";

async function getAIResponse(msg){
    try{
        const r=await fetch(SUPABASE_URL+'/tutor-ia-chat',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                messages:[{role:'user',content:msg}],
                system:MARIO_SYSTEM,
                max_tokens:150
            })
        });
        if(!r.ok)throw new Error('Chat API error');
        const d=await r.json();
        return d.content&&d.content[0]?d.content[0].text:'¬°√ìrale t√©cnico! Hubo un problema, intenta de nuevo.';
    }catch(e){
        console.error('AI Chat Error:',e);
        return '¬°√ìrale! Problema de conexi√≥n. Intenta de nuevo.';
    }
}

let speechAbort=null;

async function speakText(text){
    // Cancel any ongoing speech
    if(speechAbort)speechAbort.cancelled=true;
    const thisAbort={cancelled:false};
    speechAbort=thisAbort;
    
    try{
        isSpeaking=true;
        lowerMusicForSpeech();
        document.getElementById('speakingIndicator').classList.add('active');
        
        // Split into chunks at sentence boundaries
        const chunks=splitTextChunks(text,500);
        
        // Pre-fetch first chunk
        let nextBlob=await fetchVoiceChunk(chunks[0]);
        if(thisAbort.cancelled)return cleanupSpeech();
        
        for(let i=0;i<chunks.length;i++){
            if(thisAbort.cancelled)return cleanupSpeech();
            
            const currentBlob=nextBlob;
            if(!currentBlob)continue;
            
            // Start pre-fetching NEXT chunk while current plays
            const fetchNext=(i+1<chunks.length)?fetchVoiceChunk(chunks[i+1]):Promise.resolve(null);
            
            // Play current chunk
            const audioUrl=URL.createObjectURL(currentBlob);
            const audio=document.getElementById('aiAudio');
            audio.src=audioUrl;
            
            await new Promise(resolve=>{
                audio.onended=()=>{URL.revokeObjectURL(audioUrl);resolve();};
                audio.onerror=()=>{URL.revokeObjectURL(audioUrl);resolve();};
                audio.play().catch(()=>resolve());
            });
            
            if(thisAbort.cancelled)return cleanupSpeech();
            
            // Next chunk should already be fetched
            nextBlob=await fetchNext;
        }
        
        cleanupSpeech();
    }catch(e){
        console.error('Voice Error:',e);
        cleanupSpeech();
    }
}

async function fetchVoiceChunk(text){
    try{
        const r=await fetch(SUPABASE_URL+'/tutor-ia-voice',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({text:text.trim()})
        });
        if(!r.ok)return null;
        return await r.blob();
    }catch(e){return null;}
}

function cleanupSpeech(){
    isSpeaking=false;
    document.getElementById('speakingIndicator').classList.remove('active');
    restoreMusicAfterSpeech();
}

function stopSpeech(){
    if(speechAbort)speechAbort.cancelled=true;
    const audio=document.getElementById('aiAudio');
    audio.pause();
    audio.removeAttribute('src');
    cleanupSpeech();
}

function splitTextChunks(text,maxLen){
    if(text.length<=maxLen)return[text];
    const chunks=[];
    let remaining=text;
    while(remaining.length>0){
        if(remaining.length<=maxLen){chunks.push(remaining);break;}
        let splitAt=-1;
        for(let i=Math.min(maxLen,remaining.length)-1;i>=maxLen*0.4;i--){
            if('.!?'.includes(remaining[i])){splitAt=i+1;break;}
        }
        if(splitAt===-1){
            for(let i=Math.min(maxLen,remaining.length)-1;i>=maxLen*0.4;i--){
                if(',;:'.includes(remaining[i])){splitAt=i+1;break;}
            }
        }
        if(splitAt===-1){
            for(let i=Math.min(maxLen,remaining.length)-1;i>=maxLen*0.4;i--){
                if(remaining[i]===' '){splitAt=i+1;break;}
            }
        }
        if(splitAt===-1)splitAt=maxLen;
        chunks.push(remaining.substring(0,splitAt));
        remaining=remaining.substring(splitAt);
    }
    return chunks;
}

function openAIChat(){
    document.getElementById('aiModal').classList.add('active');
}

function closeAIChat(){
    document.getElementById('aiModal').classList.remove('active');
    const audio=document.getElementById('aiAudio');
    audio.pause();
    isSpeaking=false;
    document.getElementById('speakingIndicator').classList.remove('active');
}

async function sendAIMessage(){
    const input=document.getElementById('aiInput');
    const msgs=document.getElementById('aiMessages');
    const sendBtn=document.getElementById('sendBtn');
    const txt=input.value.trim();
    if(!txt||isSpeaking)return;
    
    // Desbloquear audio en el click
    unlockAudio();
    
    // Disable input while processing
    input.disabled=true;
    sendBtn.disabled=true;
    
    // Show user message
    msgs.innerHTML+='<div class="ai-msg user">'+txt+'</div>';
    input.value='';
    
    // Show typing indicator
    msgs.innerHTML+='<div class="ai-msg mario" id="typing"><div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>';
    msgs.scrollTop=msgs.scrollHeight;
    
    // Get AI text response
    const response=await getAIResponse(txt);
    
    // Remove typing indicator and show response
    const typing=document.getElementById('typing');
    if(typing)typing.remove();
    msgs.innerHTML+='<div class="ai-msg mario">'+response+'</div>';
    msgs.scrollTop=msgs.scrollHeight;
    
    // Re-enable input
    input.disabled=false;
    sendBtn.disabled=false;
    input.focus();
    
    // Speak the response
    await speakText(response);
}

// ========== CONFETTI ==========
function cft(){
    const c=document.getElementById('conf');
    c.innerHTML='';
    const cols=['#ff6b2b','#00d4ff','#f1c40f','#2ecc71','#e74c3c','#9b59b6'];
    for(let i=0;i<25;i++){
        const p=document.createElement('div');
        p.className='cf';
        p.style.left=Math.random()*100+'%';
        p.style.background=cols[Math.floor(Math.random()*cols.length)];
        p.style.animationDelay=Math.random()*1.5+'s';
        p.style.animationDuration=(2+Math.random()*1.5)+'s';
        p.style.width=(6+Math.random()*6)+'px';
        p.style.height=p.style.width;
        p.style.borderRadius=Math.random()>.5?'50%':'2px';
        c.appendChild(p);
    }
    setTimeout(()=>c.innerHTML='',3500);
}

// ========== TRANSLATIONS ==========
const T={
es:{step_1:'Paso 1 de 5',step_2:'Paso 2 de 5',step_3:'Paso 3 de 5',step_4:'Paso 4 de 5',step_5:'Paso 5 de 5',welcome_speech:'¬°Bienvenido t√©cnico! Soy el Maestro Mario y voy a ser tu gu√≠a. ¬øC√≥mo te llamas?',name_ph:'Escribe tu nombre aqu√≠...',continue:'Continuar ‚Üí',level_speech:'¬°Mucho gusto, {name}! ¬øEn qu√© nivel t√©cnico te encuentras?',spec_speech:'¬°Excelente, {name}! ¬øEn qu√© √°reas te sientes m√°s fuerte?',multi_hint:'Selecciona una o m√°s opciones',school_speech:'¬°Vas muy bien, {name}! ¬øD√≥nde est√°s estudiando?',goals_speech:'¬°√öltima pregunta, {name}! ¬øQu√© quieres lograr?',route_speech:'¬°Perfecto, {name}! He creado tu ruta personalizada. ¬°Vamos con todo!',start_btn:'üöÄ ¬°Empezar a Aprender!',lv1:'Estudiante',lv1d:'Estoy aprendiendo lo b√°sico',lv2:'Ayudante',lv2d:'Ya ando en el campo con un t√©cnico',lv3:'T√©cnico',lv3d:'Ya trabajo solo pero quiero mejorar',lv4:'Avanzado',lv4d:'Quiero dominar el oficio',lv5:'Maestro',lv5d:'Quiero ser l√≠der / abrir mi empresa',sp_e:'Electricidad',sp_ed:'Circuitos, controles, cableado',sp_a:'Aire Acondicionado',sp_ad:'Splits, centrales, mini splits',sp_r:'Refrigeraci√≥n',sp_rd:'C√°maras fr√≠as, refrigeradores comerciales',sp_h:'Calefacci√≥n',sp_hd:'Furnaces, bombas de calor',sp_x:'Estoy empezando en todo',sp_xd:'Quiero aprender de todo',sc_ac:'ACVOLT Tech School',sc_acd:'Estudiante actual de ACVOLT',sc_ot:'Otra escuela',sc_otd:'Estoy en otra instituci√≥n',sc_sf:'Aprendo por mi cuenta',sc_sfd:'YouTube, libros, campo',sc_dn:'Ya termin√© mis estudios',sc_dnd:'Tengo certificaci√≥n/diploma',gl_c:'Pasar mis certificaciones',gl_cd:'EPA, NATE, OSHA, NCCER',gl_d:'Mejorar mis diagn√≥sticos',gl_dd:'Ser m√°s preciso en el campo',gl_b:'Abrir mi propio negocio',gl_bd:'De t√©cnico a empresario',gl_m:'Ganar m√°s dinero',gl_md:'Subir mi valor como t√©cnico',r_elec:'Fundamentos El√©ctricos',r_elecd:'Circuitos, Ley de Ohm, diagramas',r_ac:'Aire Acondicionado',r_acd:'Presiones, carga de refrigerante',r_ref:'Refrigeraci√≥n Comercial',r_refd:'C√°maras fr√≠as, controles, defrost',r_heat:'Calefacci√≥n',r_heatd:'Furnaces, bombas de calor, gas',r_cert:'Preparaci√≥n para Certificaciones',r_certd:'EPA 608 ‚Ä¢ NATE ‚Ä¢ OSHA ‚Ä¢ NCCER',r_biz:'De T√©cnico a Empresario',r_bizd:'Licencias, estimados, clientes'},
en:{step_1:'Step 1 of 5',step_2:'Step 2 of 5',step_3:'Step 3 of 5',step_4:'Step 4 of 5',step_5:'Step 5 of 5',welcome_speech:"Welcome technician! I'm Maestro Mario and I'll be your guide. What's your name?",name_ph:'Type your name here...',continue:'Continue ‚Üí',level_speech:"Nice to meet you, {name}! What's your technical level?",spec_speech:'Excellent, {name}! What areas are you strongest in?',multi_hint:'Select one or more options',school_speech:'Great progress, {name}! Where are you studying?',goals_speech:'Last question, {name}! What do you want to achieve?',route_speech:"Perfect, {name}! I've created your personalized path. Let's go!",start_btn:'üöÄ Start Learning!',lv1:'Student',lv1d:"I'm learning the basics",lv2:'Helper',lv2d:"I'm in the field with a technician",lv3:'Technician',lv3d:'I work solo but want to improve',lv4:'Advanced',lv4d:'I want to master the trade',lv5:'Master',lv5d:'I want to lead / start my business',sp_e:'Electrical',sp_ed:'Circuits, controls, wiring',sp_a:'Air Conditioning',sp_ad:'Splits, central, mini splits',sp_r:'Refrigeration',sp_rd:'Walk-in coolers, commercial',sp_h:'Heating',sp_hd:'Furnaces, heat pumps',sp_x:'Starting in everything',sp_xd:'I want to learn it all',sc_ac:'ACVOLT Tech School',sc_acd:'Current ACVOLT student',sc_ot:'Another school',sc_otd:"I'm at another institution",sc_sf:'Self-taught',sc_sfd:'YouTube, books, field',sc_dn:'Completed studies',sc_dnd:'I have certification/diploma',gl_c:'Pass certifications',gl_cd:'EPA, NATE, OSHA, NCCER',gl_d:'Improve diagnostics',gl_dd:'Be more precise in the field',gl_b:'Start my business',gl_bd:'From tech to owner',gl_m:'Earn more money',gl_md:'Increase my value',r_elec:'Electrical Fundamentals',r_elecd:"Circuits, Ohm's law, diagrams",r_ac:'Air Conditioning',r_acd:'Pressure diagnostics, charging',r_ref:'Commercial Refrigeration',r_refd:'Walk-in coolers, controls, defrost',r_heat:'Heating Systems',r_heatd:'Furnaces, heat pumps, gas',r_cert:'Certification Prep',r_certd:'EPA 608 ‚Ä¢ NATE ‚Ä¢ OSHA ‚Ä¢ NCCER',r_biz:'Tech to Business Owner',r_bizd:'Licensing, estimates, clients'}
};

const t=k=>(T[D.lang][k]||k).replace('{name}',D.name);
const u=()=>{document.querySelectorAll('[data-t]').forEach(e=>e.textContent=t(e.getAttribute('data-t')));document.querySelectorAll('[data-tp]').forEach(e=>e.placeholder=t(e.getAttribute('data-tp')));};
const go=id=>{document.querySelectorAll('.s').forEach(s=>s.classList.remove('on'));document.getElementById(id).classList.add('on');window.scrollTo(0,0);};
const rx=(id,c)=>{const e=document.getElementById(id);if(e){e.classList.add(c);setTimeout(()=>e.classList.remove(c),1500);}};

function setLang(l){D.lang=l;unlockAudio();u();go('s2');document.getElementById('nm').placeholder=t('name_ph');speakText(t('welcome_speech'));}
function sName(){D.name=document.getElementById('nm').value.trim();u();bLvl();go('s3');rx('a3','nod');speakText(t('level_speech'));document.getElementById('profileBtn').classList.add('active');}
function pLvl(e,v){document.querySelectorAll('#lo .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.level=v;document.getElementById('b3').disabled=false;rx('a3','nod');}
function sLvl(){u();bSpc();go('s4');speakText(t('spec_speech'));}
function tSpc(e,k){if(k==='all'){document.querySelectorAll('#so .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.specs=['all'];}else{document.querySelector('#so .oc:last-child').classList.remove('sel');D.specs=D.specs.filter(s=>s!=='all');e.classList.toggle('sel');if(e.classList.contains('sel'))D.specs.push(k);else D.specs=D.specs.filter(s=>s!==k);}document.getElementById('b4').disabled=D.specs.length===0;rx('a4','nod');}
function sSpc(){u();bSch();go('s5');speakText(t('school_speech'));}
function pSch(e,v){document.querySelectorAll('#sco .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.school=v;document.getElementById('b5').disabled=false;rx('a5','nod');}
function sSch(){u();bGol();go('s6');speakText(t('goals_speech'));}
function tGol(e,k){e.classList.toggle('sel');if(e.classList.contains('sel'))D.goals.push(k);else D.goals=D.goals.filter(g=>g!==k);document.getElementById('b6').disabled=D.goals.length===0;rx('a6','nod');}
function sGol(){u();bRt();go('s7');cft();rx('a7','cel');speakText(t('route_speech'));}

function bLvl(){document.getElementById('lo').innerHTML=[{k:1,i:'üìö',t:'lv1',d:'lv1d'},{k:2,i:'üîß',t:'lv2',d:'lv2d'},{k:3,i:'‚öôÔ∏è',t:'lv3',d:'lv3d'},{k:4,i:'üéØ',t:'lv4',d:'lv4d'},{k:5,i:'üëë',t:'lv5',d:'lv5d'}].map(x=>'<div class="oc" onclick="pLvl(this,'+x.k+')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div></div>').join('');}
function bSpc(){document.getElementById('so').innerHTML=[{k:'electrical',i:'‚ö°',t:'sp_e',d:'sp_ed'},{k:'ac',i:'‚ùÑÔ∏è',t:'sp_a',d:'sp_ad'},{k:'refrigeration',i:'üßä',t:'sp_r',d:'sp_rd'},{k:'heating',i:'üî•',t:'sp_h',d:'sp_hd'},{k:'all',i:'üåü',t:'sp_x',d:'sp_xd'}].map(x=>'<div class="oc" onclick="tSpc(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div><div class="ck"></div></div>').join('');}
function bSch(){document.getElementById('sco').innerHTML=[{k:'acvolt',i:'üéì',t:'sc_ac',d:'sc_acd'},{k:'other',i:'üè´',t:'sc_ot',d:'sc_otd'},{k:'self',i:'üí™',t:'sc_sf',d:'sc_sfd'},{k:'done',i:'‚úÖ',t:'sc_dn',d:'sc_dnd'}].map(x=>'<div class="oc" onclick="pSch(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div></div>').join('');}
function bGol(){document.getElementById('go2').innerHTML=[{k:'certs',i:'üìã',t:'gl_c',d:'gl_cd'},{k:'diag',i:'üîç',t:'gl_d',d:'gl_dd'},{k:'biz',i:'üè¢',t:'gl_b',d:'gl_bd'},{k:'money',i:'üí∞',t:'gl_m',d:'gl_md'}].map(x=>'<div class="oc" onclick="tGol(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div><div class="ck"></div></div>').join('');}
function bRt(){var r=[];if(D.specs.includes('all')||D.specs.includes('electrical'))r.push({i:'‚ö°',t:'r_elec',d:'r_elecd'});if(D.specs.includes('all')||D.specs.includes('ac'))r.push({i:'‚ùÑÔ∏è',t:'r_ac',d:'r_acd'});if(D.specs.includes('all')||D.specs.includes('refrigeration'))r.push({i:'üßä',t:'r_ref',d:'r_refd'});if(D.specs.includes('all')||D.specs.includes('heating'))r.push({i:'üî•',t:'r_heat',d:'r_heatd'});if(D.goals.includes('certs'))r.push({i:'üìã',t:'r_cert',d:'r_certd'});if(D.goals.includes('biz'))r.push({i:'üè¢',t:'r_biz',d:'r_bizd'});document.getElementById('rl').innerHTML=r.map((x,i)=>'<div class="rt"><div class="rn">'+(i+1)+'</div><div><div class="rtt">'+x.i+' '+t(x.t)+'</div><div class="rd">'+t(x.d)+'</div></div></div>'+(i<r.length-1?'<div class="rl"></div>':'')).join('');}

function startApp(){
    enterStudyMode();
    updateHub();
    go('s-hub');
    speakText(D.lang==='es'?'¬°'+D.name+'! Bienvenido a tu centro de entrenamiento. Elige qu√© quieres hacer: tomar un quiz, repasar lo que fallaste, o ver videos.':'Welcome '+D.name+'! Choose what you want to do: take a quiz, study what you missed, or watch videos.');
}

const QUIZ_LIST=[
    {id:'principiante',icon:'üìö',title:'Principiante HVAC',desc:'50 preguntas de electricidad b√°sica, refrigeraci√≥n, AC, herramientas y seguridad',count:50,data:'QUIZ_PRINCIPIANTE',color:'#00d4ff'},
    {id:'electricidad',icon:'‚ö°',title:'Electricidad Avanzada',desc:'117 preguntas: Ley de Ohm, NEC, motores, VFD, GFCI, AFCI, circuitos, contactores',count:117,data:'QUIZ_ELECTRICIDAD',color:'#ffd700'}
];

function renderQuizSelector(){
    const el=document.getElementById('quizSelList');
    const scores=JSON.parse(localStorage.getItem('maestro_quiz_scores')||'{}');
    el.innerHTML=QUIZ_LIST.map(q=>{
        const best=scores[q.id];
        const badge=best?'<span class="qs-badge done">‚úÖ '+best+'%</span>':'<span class="qs-badge new">Nuevo</span>';
        const stars=best?'<div class="qs-stars">'+getStarsHTML(best)+'</div>':'';
        return '<div class="quiz-sel-card" onclick="selectQuiz(\''+q.id+'\')" style="border-color:'+q.color+'22">'+
            '<div class="qs-icon" style="background:'+q.color+'15;color:'+q.color+'">'+q.icon+'</div>'+
            '<div class="qs-info"><div class="qs-title" style="color:'+q.color+'">'+q.title+'</div>'+
            '<div class="qs-desc">'+q.desc+'</div>'+
            '<div class="qs-count">üìù '+q.count+' preguntas</div>'+stars+'</div>'+badge+'</div>';
    }).join('');
}

function getStarsHTML(pct){
    const filled=pct>=90?5:pct>=80?4:pct>=70?3:pct>=50?2:1;
    return Array(5).fill(0).map((_,i)=>i<filled?'‚≠ê':'‚òÜ').join('');
}

let currentQuizId='principiante';

function selectQuiz(id){
    currentQuizId=id;
    const q=QUIZ_LIST.find(x=>x.id===id);
    startQuiz(id);
    const intro=D.lang==='es'?'¬°Vamos con '+q.title+', '+D.name+'! '+q.count+' preguntas bien capciositas. Demuestra lo que sabes.':'Let\'s go with '+q.title+', '+D.name+'! '+q.count+' tricky questions.';
    speakText(intro);
}

// ========== QUIZ SYSTEM ==========
const QUIZ_PRINCIPIANTE=[
// ELECTRICIDAD B√ÅSICA (13)
{cat:'‚ö° Electricidad B√°sica',q:'El voltaje en un circuito se puede comparar mejor con:',o:['La cantidad de agua en un tanque','La presi√≥n que empuja el agua por la tuber√≠a','El di√°metro de la tuber√≠a','La velocidad del agua al salir'],c:1,e:'El voltaje es la diferencia de potencial que empuja los electrones, similar a la presi√≥n del agua.',a:'Imagina una manguera de jard√≠n: el voltaje es como la presi√≥n del agua. Sin presi√≥n no sale nada. Los voltios son esa fuerza que empuja la electricidad por los cables.'},
{cat:'‚ö° Electricidad B√°sica',q:'Si un circuito tiene 240V y 20A de corriente, ¬øcu√°l es la resistencia seg√∫n Ohm?',o:['4,800 ohms','260 ohms','12 ohms','220 ohms'],c:2,e:'V = I √ó R, entonces R = V/I = 240/20 = 12 ohms.',a:'Es como dividir galletas entre ni√±os. 240 galletas (voltios) entre 20 ni√±os (amperios) = 12 galletas cada uno (ohms). R = V √∑ I.'},
{cat:'‚ö° Electricidad B√°sica',q:'Est√°s midiendo voltaje en un tomacorriente y el mult√≠metro marca 0V. ¬øCu√°l es la causa M√ÅS probable?',o:['El tomacorriente est√° da√±ado','El breaker est√° apagado o disparado','El mult√≠metro est√° en la escala de amperios','Las tres podr√≠an causar la lectura de 0V'],c:3,e:'Las tres situaciones pueden dar lectura de 0V. Un buen t√©cnico verifica cada posibilidad.',a:'Es como cuando no sale agua de la llave: puede ser que cerraron la v√°lvula, que no hay agua en la calle, o que la llave est√° rota. No asumas, verifica cada cosa.'},
{cat:'‚ö° Electricidad B√°sica',q:'En un circuito en paralelo, si se quema una carga, las dem√°s:',o:['Se apagan todas inmediatamente','Siguen funcionando pero con m√°s voltaje','Siguen funcionando normalmente','Funcionan pero m√°s lento'],c:2,e:'En paralelo cada carga tiene su propio camino. Si una falla, las dem√°s no se afectan.',a:'Piensa en las casas de tu cuadra: si tu vecino apaga sus luces, las tuyas siguen prendidas. Cada casa tiene su propia conexi√≥n. Eso es paralelo.'},
{cat:'‚ö° Electricidad B√°sica',q:'Un fusible de 15A se quema repetidamente. La acci√≥n correcta es:',o:['Poner uno de 20A para que aguante m√°s','Poner uno de 30A y resolver despu√©s','Buscar la causa del exceso de corriente','Puentear el fusible temporalmente'],c:2,e:'NUNCA pongas un fusible m√°s grande. Hay que encontrar por qu√© est√° jalando m√°s corriente de lo normal.',a:'El fusible es como la alarma de incendios. Si se activa, no le quitas las pilas ‚Äî buscas el fuego. Poner uno m√°s grande es como quitar la alarma: la casa se va a quemar.'},
{cat:'‚ö° Electricidad B√°sica',q:'Un equipo residencial de AC necesita 240V. Al medir entre las dos l√≠neas (hot) obtienes 208V. Esto indica:',o:['El equipo est√° da√±ado','Es alimentaci√≥n trif√°sica, no monof√°sica','El mult√≠metro necesita calibraci√≥n','El voltaje est√° bajo y hay que llamar a la compa√±√≠a el√©ctrica'],c:1,e:'208V entre fases indica alimentaci√≥n trif√°sica (com√∫n en comercial). Residencial monof√°sico da 240V.',a:'Es como pedir una pizza familiar y te traen una mediana. No est√° mal, pero no es lo que pediste. 208V funciona diferente que 240V y puede afectar el rendimiento del equipo.'},
{cat:'‚ö° Electricidad B√°sica',q:'El cable verde con franja amarilla en un circuito SIEMPRE debe ir a:',o:['La l√≠nea caliente (hot)','El neutro','El ground (tierra)','Depende del circuito'],c:2,e:'Verde o verde/amarillo es SIEMPRE tierra. Nunca se usa para otra cosa, es una regla de seguridad absoluta.',a:'Verde = pasto = tierra. As√≠ como el pasto siempre est√° abajo, el cable verde siempre va a tierra. Si alguien lo us√≥ para otra cosa, ese electricista hizo una chambonada peligrosa.'},
{cat:'‚ö° Electricidad B√°sica',q:'Un motor monof√°sico no arranca pero zumba. El componente M√ÅS probable que fall√≥ es:',o:['El contactor','El capacitor de arranque','El termostato','El breaker'],c:1,e:'Un motor que zumba pero no gira casi siempre indica capacitor de arranque da√±ado.',a:'El capacitor es como el empuj√≥n que le das a un columpio. El motor necesita ese empuj√≥n inicial. Si el capacitor falla, el motor quiere girar pero no puede, por eso zumba.'},
{cat:'‚ö° Electricidad B√°sica',q:'Un cortocircuito se diferencia de una sobrecarga porque:',o:['La sobrecarga es m√°s peligrosa','El cortocircuito genera corriente muy alta instant√°neamente','La sobrecarga dispara el breaker m√°s r√°pido','No hay diferencia real entre ambos'],c:1,e:'El cortocircuito genera corriente masiva instant√°nea. La sobrecarga es un exceso gradual.',a:'Un cortocircuito es como una presa que se revienta: el agua sale toda de golpe. La sobrecarga es como dejar todas las llaves abiertas poco a poco. Ambos son problemas, pero el cortocircuito es m√°s violento.'},
{cat:'‚ö° Electricidad B√°sica',q:'La corriente AC a 60Hz en USA cambia de direcci√≥n:',o:['60 veces por segundo','120 veces por segundo','60 veces por minuto','Una vez cada 60 segundos'],c:1,e:'60Hz = 60 ciclos, pero cada ciclo tiene dos cambios de direcci√≥n, entonces son 120 cambios por segundo.',a:'Un ciclo es como un columpio: va y viene, eso son DOS movimientos. Entonces 60 ciclos = 120 cambios de direcci√≥n. Esta es una pregunta capciosa que muchos t√©cnicos fallan.'},
{cat:'‚ö° Electricidad B√°sica',q:'Un equipo etiquetado como 1500W a 120V, ¬øcu√°ntos amperios consume?',o:['12.5A','180,000A','15A','1,380A'],c:0,e:'I = W/V = 1500/120 = 12.5A.',a:'Watts √∑ Voltios = Amperios. Es como repartir: 1500 entre 120 = 12.5. Este c√°lculo lo vas a hacer TODOS los d√≠as en el campo.'},
{cat:'‚ö° Electricidad B√°sica',q:'El contactor del compresor se cierra pero el compresor no arranca. ¬øQu√© revisas PRIMERO?',o:['El termostato','El voltaje que llega al compresor','El nivel de refrigerante','La presi√≥n del sistema'],c:1,e:'Si el contactor cierra, la se√±al de control est√° bien. Hay que verificar que el voltaje llega al compresor.',a:'Es como cuando enciendes el switch de la luz pero el foco no prende. El switch funciona, entonces el problema est√° del switch al foco. Mide voltaje en los terminales del compresor.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øCu√°l es la diferencia principal entre un capacitor de arranque (start) y uno de marcha (run)?',o:['El de arranque tiene m√°s microfaradios y se desconecta al arrancar','El de marcha tiene m√°s microfaradios','Son intercambiables','El de arranque es m√°s peque√±o f√≠sicamente'],c:0,e:'El start cap tiene m√°s MFD, da el empuj√≥n inicial y se desconecta. El run cap queda conectado siempre.',a:'El capacitor de arranque es como el turbo de un carro: te da un empuj√≥n fuerte al inicio y luego se apaga. El de marcha es como el motor regular que trabaja todo el tiempo.'},

// REFRIGERACI√ìN B√ÅSICA (13)
{cat:'üßä Refrigeraci√≥n B√°sica',q:'En el ciclo de refrigeraci√≥n, el componente que ABSORBE calor del espacio es:',o:['El condensador, porque ah√≠ se condensa el gas','El evaporador, porque ah√≠ se evapora el refrigerante','El compresor, porque genera presi√≥n','La v√°lvula TXV, porque reduce la temperatura'],c:1,e:'El evaporador absorbe calor al evaporar el refrigerante. El nombre lo dice: evapora.',a:'El evaporador es como un vaso con hielo: cuando pones el vaso en la mesa, el hielo absorbe el calor del ambiente y se derrite. El refrigerante hace lo mismo, absorbe calor y se evapora.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'El compresor de un sistema de AC est√° caliente al tacto y hace ruido. ¬øEs normal?',o:['No, un compresor siempre debe estar fr√≠o','S√≠, comprimir gas genera calor y vibraci√≥n','Solo si es un compresor scroll','Depende de la marca'],c:1,e:'Comprimir gas siempre genera calor. Un compresor caliente que funciona bien es completamente normal.',a:'Infla un globo y siente la boquilla: est√° caliente. Comprimir aire genera calor. El compresor hace lo mismo pero con refrigerante. Caliente = trabajando. Pero OJO: demasiado caliente = problema.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'Un sistema con R-410A tiene presi√≥n de succi√≥n de 118 PSI. Esto corresponde a una temperatura de evaporaci√≥n de aproximadamente:',o:['32¬∞F','40¬∞F','50¬∞F','25¬∞F'],c:1,e:'R-410A a 118 PSI en succi√≥n = aproximadamente 40¬∞F de temperatura de evaporaci√≥n.',a:'Cada refrigerante tiene su tabla de presi√≥n-temperatura. Es como un diccionario: 118 PSI en R-410A siempre = 40¬∞F. Memoriza los valores comunes o lleva tu tabla siempre.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© pasa si cargas refrigerante l√≠quido por el lado de succi√≥n (baja)?',o:['Enfr√≠a m√°s r√°pido el sistema','Puede da√±ar el compresor por golpe de l√≠quido','No pasa nada diferente','El refrigerante se evapora autom√°ticamente'],c:1,e:'L√≠quido en succi√≥n puede causar slugging y da√±ar las v√°lvulas del compresor.',a:'Es como tragar un cubo de hielo entero: te puedes ahogar. El compresor est√° dise√±ado para gas, no l√≠quido. El l√≠quido no se comprime y rompe las v√°lvulas. Siempre carga en vapor por el lado de baja.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'El superheat se mide restando:',o:['Temperatura de succi√≥n menos temperatura ambiente','Temperatura de l√≠nea de succi√≥n menos temperatura de saturaci√≥n a la presi√≥n de succi√≥n','Temperatura del evaporador menos temperatura del condensador','Temperatura del aire de retorno menos la del supply'],c:1,e:'Superheat = Temp real de la l√≠nea de succi√≥n - Temp de saturaci√≥n seg√∫n la presi√≥n de succi√≥n.',a:'Es como medir fiebre: la temperatura normal es 98.6¬∞F (saturaci√≥n). Si tienes 101¬∞F, tu superheat es 2.4¬∞F. Mides cu√°nto m√°s caliente est√° el gas comparado con lo que deber√≠a estar.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'Los manifold gauges muestran azul 65 PSI y rojo 250 PSI en un sistema R-22. Esto sugiere:',o:['Presiones normales de operaci√≥n','Sistema sobrecargado','Posible restricci√≥n o bajo flujo de aire','Fuga de refrigerante'],c:0,e:'Para R-22, succi√≥n ~65 PSI y descarga ~250 PSI son presiones normales en d√≠a caluroso.',a:'Es como cuando el doctor te toma la presi√≥n: 120/80 es normal. En R-22, 65/250 es saludable. Aprende a leer los gauges como el doctor lee tu presi√≥n.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'Si el superheat es demasiado alto, ¬øqu√© indica generalmente?',o:['Hay mucho refrigerante en el sistema','Hay poco refrigerante o flujo de aire excesivo','El compresor est√° fallando','La v√°lvula TXV est√° abierta de m√°s'],c:1,e:'Superheat alto = poco refrigerante llegando al evaporador, o demasiado aire pasando por el evaporador.',a:'Superheat alto es como una olla con poca agua en la estufa: se seca r√°pido y se sobrecalienta. El evaporador necesita suficiente refrigerante para absorber calor.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'La manguera AMARILLA del manifold se conecta normalmente a:',o:['El lado de baja presi√≥n','El lado de alta presi√≥n','El tanque de refrigerante o bomba de vac√≠o','El compresor directamente'],c:2,e:'Azul = baja (succi√≥n), Roja = alta (descarga), Amarilla = centro (tanque, vac√≠o, o recuperaci√≥n).',a:'Piensa en un sem√°foro: azul fr√≠o (baja), rojo caliente (alta), y amarillo en medio. La manguera amarilla es tu puente al tanque.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'La v√°lvula TXV regula el flujo de refrigerante bas√°ndose en:',o:['La presi√≥n de descarga del compresor','La temperatura y presi√≥n del evaporador (superheat)','La temperatura ambiente exterior','El voltaje del sistema'],c:1,e:'La TXV sensa el superheat para modular cu√°nto refrigerante entra al evaporador.',a:'La TXV es como la llave del agua: si el evaporador necesita m√°s refrigerante (superheat alto), abre m√°s. Si tiene mucho (superheat bajo), cierra. Es autom√°tica e inteligente.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'Un filter drier saturado puede causar:',o:['Mayor eficiencia del sistema','Una restricci√≥n que se ve como un evaporador parcialmente congelado','Mejor lubricaci√≥n del compresor','Aumento de refrigerante'],c:1,e:'Un filter drier tapado restringe el flujo, causando ca√≠da de presi√≥n y congelamiento parcial.',a:'Es como un filtro de caf√© tapado: si est√° sucio, el caf√© pasa poquito. Si el drier est√° saturado, el refrigerante no pasa bien y el evaporador se congela de un solo lado.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'Para comprar y manejar refrigerantes en USA necesitas certificaci√≥n:',o:['NATE tipo I','OSHA 30 horas','EPA 608','HVAC Excellence'],c:2,e:'La certificaci√≥n EPA 608 es OBLIGATORIA por ley federal. Sin ella, no puedes comprar refrigerante.',a:'EPA 608 es tu licencia de manejar del HVAC. Sin ella no compras refrigerante, no trabajas legalmente. Es como manejar sin licencia: te pueden multar miles de d√≥lares.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'El subcooling se mide en:',o:['La l√≠nea de succi√≥n, restando temperaturas','La l√≠nea de l√≠quido, restando la temp real de la temp de saturaci√≥n a presi√≥n de descarga','El evaporador, midiendo la temperatura del aire','El compresor, midiendo su amperaje'],c:1,e:'Subcooling = Temp de saturaci√≥n a presi√≥n de alta - Temp real de la l√≠nea de l√≠quido.',a:'Si el superheat es la fiebre del gas, el subcooling es lo fr√≠o del l√≠quido. Mides cu√°nto m√°s fr√≠o est√° el l√≠quido comparado con su punto de condensaci√≥n. Normal es 10-15¬∞F.'},

{cat:'üßä Refrigeraci√≥n B√°sica',q:'El subcooling se mide en:',o:['La l√≠nea de succi√≥n, restando temperaturas','La l√≠nea de l√≠quido, restando la temp real de la temp de saturaci√≥n a presi√≥n de descarga','El evaporador, midiendo la temperatura del aire','El compresor, midiendo su amperaje'],c:1,e:'Subcooling = Temp de saturaci√≥n a presi√≥n de alta - Temp real de la l√≠nea de l√≠quido.',a:'Si el superheat es la fiebre del gas, el subcooling es lo fr√≠o del l√≠quido. Mides cu√°nto m√°s fr√≠o est√° el l√≠quido comparado con su punto de condensaci√≥n. Normal es 10-15¬∞F.'},

// HERRAMIENTAS Y SEGURIDAD (12)
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'PPE en HVAC incluye lentes de seguridad, guantes y zapatos. ¬øCu√°ndo es aceptable NO usar PPE?',o:['Cuando el trabajo es r√°pido y sencillo','Cuando hace mucho calor','Nunca ‚Äî PPE es obligatorio en TODO momento','Cuando el supervisor no est√° viendo'],c:2,e:'PPE es obligatorio SIEMPRE. No hay excusa. Un accidente toma solo un segundo.',a:'Los accidentes no avisan. No dicen: oye, ponte los lentes que te va a saltar algo. Pasan en un parpadeo. PPE siempre, sin excepci√≥n, aunque sea un trabajo de 5 minutos.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Hiciste Lockout/Tagout en el panel. Antes de tocar los cables, debes:',o:['Empezar a trabajar, ya desconectaste','Verificar ausencia de voltaje con tu mult√≠metro','Preguntarle al cliente si ya apag√≥ todo','Revisar visualmente que no hay chispas'],c:1,e:'SIEMPRE verifica con tu mult√≠metro despu√©s de LOTO. Puede haber fuentes de energ√≠a m√∫ltiples.',a:'Lockout es como ponerle seguro a una pistola. Pero un profesional SIEMPRE verifica que la c√°mara est√° vac√≠a. Desconectar y NO verificar es como jugar ruleta rusa.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Tu detector de fugas electr√≥nico no encuentra la fuga pero sospechas que existe. ¬øQu√© otro m√©todo usas?',o:['Agregar m√°s refrigerante y ver si se mantiene','Presurizar con nitr√≥geno y usar agua jabonosa','Presurizar con ox√≠geno para mejor detecci√≥n','Usar una vela para ver si la llama se mueve'],c:1,e:'Nitr√≥geno + agua jabonosa es el m√©todo secundario m√°s confiable para encontrar fugas.',a:'Las burbujas no mienten. Presuriza con nitr√≥geno y ponte agua jabonosa en las conexiones. Donde haga burbujas, ah√≠ est√° la fuga. Nunca uses ox√≠geno: puede explotar con aceite.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Despu√©s de hacer vac√≠o, tu micron gauge marca 500 micrones. Cierras la v√°lvula y esperas 10 minutos. Sube a 1500. Esto indica:',o:['Vac√≠o exitoso, puedes cargar','Hay humedad en el sistema que se evapora','Hay una fuga en el sistema','Puede ser fuga O humedad, necesitas m√°s pruebas'],c:3,e:'Un rise de 500 a 1500 puede ser humedad o fuga. Necesitas m√°s tiempo o pruebas adicionales.',a:'Es como inflar una llanta y ver si baja: si baja r√°pido = fuga. Si baja poquito = puede ser la temperatura. A 1500 micrones despu√©s de 10 min, no sabes seguro. Haz m√°s vac√≠o y espera m√°s.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Al soldar tuber√≠a de cobre con un tanque de refrigerante conectado, debes:',o:['No hay problema, el refrigerante no es inflamable','Fluir nitr√≥geno por la tuber√≠a mientras sueldas','Solo alejar el tanque un poco','Usar el tanque como soporte ya que es pesado'],c:1,e:'SIEMPRE fluye nitr√≥geno al soldar. Previene oxidaci√≥n interna y es un requisito de seguridad.',a:'Al soldar sin nitr√≥geno, el interior del cobre se oxida y esos pedacitos sueltos van a tapar la TXV o el drier. El nitr√≥geno es como poner un escudo invisible dentro del tubo.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øQu√© haces si hueles refrigerante fuerte en un cuarto mec√°nico cerrado?',o:['Es normal, los cuartos mec√°nicos huelen as√≠','Abrir ventilaci√≥n y salir si es necesario, puede desplazar ox√≠geno','Ignorarlo si no te mareas','Prender un ventilador el√©ctrico dentro del cuarto'],c:1,e:'Los refrigerantes desplazan ox√≠geno en espacios cerrados. La asfixia puede ocurrir sin que te des cuenta.',a:'Los refrigerantes son invisibles y sin olor fuerte. Si ya hueles algo, hay MUCHO gas. Es como el mon√≥xido de carbono: no lo ves pero te mata. Ventila y sal primero, investiga despu√©s.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Aprietas una conexi√≥n flare con torque wrench. ¬øPor qu√© no debes apretarla m√°s de lo especificado?',o:['Gasta m√°s tiempo','Puedes rajar el flare y crear una fuga','No pasa nada, m√°s apretado es mejor','Solo importa con tuber√≠a de aluminio'],c:1,e:'Apretar de m√°s raja el cobre y crea fugas que no ver√°s hasta que el sistema est√© cargado.',a:'Es como apretar la tapa de un frasco de vidrio: si le pasas, la quiebras. El cobre es suave, si aprietas de m√°s se raja y boom, tienes una fuga que te va a dar dolores de cabeza.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Tu mult√≠metro marca voltaje inconsistente que sube y baja. ¬øQu√© puede estar pasando?',o:['Voltaje normal de AC','Conexi√≥n suelta o puntas de prueba da√±adas','El equipo est√° modulando normalmente','El mult√≠metro es demasiado preciso'],c:1,e:'Lecturas inestables casi siempre indican una conexi√≥n suelta, ya sea en el circuito o en tus puntas.',a:'Si el radio suena entrecortado, lo m√°s probable es que la antena est√° floja. Igual con el mult√≠metro: lecturas locas = conexi√≥n floja. Revisa tus puntas primero.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'OSHA puede multar a un t√©cnico individual que no use PPE hasta:',o:['No pueden multar al trabajador, solo a la empresa','$1,000 por la primera vez','Hasta $15,625 por violaci√≥n seria','Solo dan advertencia verbal'],c:2,e:'OSHA puede multar tanto a la empresa como al individuo. Las multas serias llegan hasta $15,625.',a:'No es juego. OSHA tiene poder de ley. Una multa de $15,000 es m√°s que tu sueldo de un mes. Y si alguien se lastima, pueden ser cargos criminales. PPE siempre.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Necesitas presurizar un sistema para buscar fugas. ¬øQu√© gas usas?',o:['Refrigerante R-22 porque es barato','Ox√≠geno porque es f√°cil de conseguir','Nitr√≥geno seco','Aire comprimido de la van'],c:2,e:'Nitr√≥geno seco es el √öNICO gas aceptable para presurizar. Ox√≠geno explota con aceite.',a:'Ox√≠geno + aceite = bomba. Aire comprimido tiene humedad. Refrigerante contamina. Nitr√≥geno es inerte, seco y seguro. Es el √öNICO que debes usar.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Un capacitor que mediste se ve hinchado en la parte superior. Tu acci√≥n:',o:['Medir microfaradios para ver si est√° bien','Reemplazarlo inmediatamente, un cap hinchado es defectuoso','Dejarlo si a√∫n funciona','Descargarlo y volver a instalarlo'],c:1,e:'Un capacitor hinchado es defectuoso aunque todav√≠a mida bien. Reemplaza siempre.',a:'Un capacitor hinchado es como una llanta ponchada: aunque todav√≠a ruede, est√° a punto de reventar. C√°mbialo ahora antes de que da√±e el motor o el compresor.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Tu bomba de vac√≠o logra 200 micrones pero al cerrar la v√°lvula sube a 800 en 5 minutos y se detiene. Esto indica:',o:['Fuga grande en el sistema','Humedad residual que se est√° evaporando','La bomba est√° da√±ada','El sistema est√° listo para cargar'],c:1,e:'Si sube y se detiene (no sigue subiendo), generalmente es humedad evapor√°ndose, no una fuga.',a:'Una fuga es como un globo con hueco: la presi√≥n sube y sube sin parar. La humedad es como un charquito que se seca: sube un poco y se estabiliza. Si se detiene, es humedad. Si sigue subiendo, es fuga.'},

// AIRE ACONDICIONADO B√ÅSICO (12)
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'Un mini split es diferente de un split convencional porque:',o:['Usa menos refrigerante','No necesita ductos','Enfr√≠a m√°s eficientemente','Trabaja solo con 110V'],c:1,e:'La principal diferencia del mini split es que no requiere ductos. Cada unidad interior enfr√≠a su zona.',a:'Un split convencional es como un sistema de riego con mangueras (ductos) que van a cada cuarto. El mini split es como tener una regadera individual en cada cuarto, sin mangueras. M√°s f√°cil de instalar.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'Un equipo con SEER de 20 comparado con uno de SEER 14:',o:['Enfr√≠a m√°s r√°pido','Enfr√≠a a menor temperatura','Usa menos electricidad para dar el mismo enfriamiento','Necesita menos refrigerante'],c:2,e:'SEER m√°s alto = misma capacidad pero menos consumo el√©ctrico. No enfr√≠a m√°s ni menos.',a:'Es como comparar un carro que da 30 millas por gal√≥n con uno de 20. Los dos te llevan al mismo lugar, pero el de 30 gasta menos gasolina. SEER alto = menos factura de luz.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'Tu cliente tiene una casa de 2,000 sq ft. Seg√∫n regla general, ¬øcu√°ntas toneladas de AC necesita?',o:['2 toneladas','3 a 4 toneladas dependiendo de factores','Siempre 5 toneladas para que sobre','1 tonelada es suficiente'],c:1,e:'Regla general: 400-500 sq ft por tonelada, pero aislamiento, ventanas y clima afectan el c√°lculo.',a:'La regla del pulgar es 1 tonelada por cada 400-500 pies cuadrados. Pero es como la ropa: no es solo la talla, importa si hace calor, si la casa tiene buen aislamiento, cu√°ntas ventanas. Siempre haz Manual J.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'El filtro de aire debe cambiarse cada:',o:['6 meses a 1 a√±o','1-3 meses dependiendo del tipo y uso','Solo cuando el equipo no enfr√≠a','Cada 5 a√±os con el mantenimiento'],c:1,e:'Filtros est√°ndar de 1 pulgada: cada 1-3 meses. Filtros de 4 pulgadas: cada 6-12 meses.',a:'El filtro es como el cubrebocas del sistema. Si no lo cambias, se tapa y el equipo no puede respirar. Un filtro sucio es la causa #1 de llamadas de servicio innecesarias.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'El evaporador est√° congelado. Tu PRIMER paso es:',o:['Agregar m√°s refrigerante inmediatamente','Apagar el equipo y dejar que se descongele antes de diagnosticar','Raspar el hielo con un destornillador','Subir el termostato a calefacci√≥n'],c:1,e:'Primero deja que se descongele completamente. No puedes diagnosticar con hielo encima.',a:'Es como cuando se te empa√±a el parabrisas: primero limpia para poder ver, luego maneja. No diagnostiques con hielo ‚Äî no puedes ver presiones reales ni medir flujo de aire correcto.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'El condensador est√° en el sol directo y obstruido con plantas. Las presiones de alta van a estar:',o:['M√°s bajas de lo normal','M√°s altas de lo normal','Igual que siempre','Intermitentes'],c:1,e:'Condensador obstruido = no puede liberar calor = presi√≥n de alta se eleva.',a:'Es como taparte la boca mientras exhalas: la presi√≥n sube porque el aire no puede salir. El condensador necesita exhalar el calor. Si est√° tapado con plantas o basura, la presi√≥n sube.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'El mantenimiento preventivo de AC se recomienda:',o:['Solo cuando algo falla','Una vez al a√±o en primavera','Dos veces al a√±o: primavera para AC y oto√±o para calefacci√≥n','Cada mes sin excepci√≥n'],c:2,e:'Dos visitas anuales: antes del verano para AC y antes del invierno para calefacci√≥n.',a:'Es como el dentista: vas dos veces al a√±o aunque no te duela nada. Si esperas a que duela, el tratamiento es caro. Mantenimiento preventivo ahorra dinero y extiende la vida del equipo.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'El return air en una casa est√° ubicado t√≠picamente:',o:['En el techo cerca del AC','En una pared interior, generalmente bajo o central','Afuera de la casa','En el ba√±o siempre'],c:1,e:'Los returns est√°n en paredes interiores, centrales, para recircular el aire de la casa.',a:'El return es la boca del sistema que traga el aire de la casa para reciclarlo. Generalmente est√° abajo en la pared de un pasillo. Si lo tapas con un mueble, el sistema se ahoga.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'El termostato llama por cooling pero el equipo no enciende. Mides 24V entre R y Y en el termostato. Esto indica:',o:['El termostato est√° malo','La se√±al sale bien del termostato, el problema est√° despu√©s','No hay voltaje suficiente','El compresor est√° en delay'],c:1,e:'24V entre R y Y = el termostato est√° mandando la se√±al correctamente. El problema est√° en otro lado.',a:'Es como cuando mandas un mensaje de texto y te dice enviado: tu tel√©fono hizo su trabajo. Si la otra persona no responde, el problema no es tu tel√©fono. 24V en el termostato = √©l est√° haciendo su trabajo.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'Un condensador sucio puede causar TODO lo siguiente EXCEPTO:',o:['Presiones de descarga altas','Mayor consumo de energ√≠a','Menor superheat en el evaporador','Posible da√±o al compresor'],c:2,e:'Condensador sucio causa presiones altas, m√°s consumo y posible da√±o. El superheat tiende a SUBIR, no bajar.',a:'Condensador sucio es como una persona acalorada que no puede sudar: la temperatura sube, gasta m√°s energ√≠a, y eventualmente colapsa. Pero el superheat no baja, sube porque el sistema pierde eficiencia.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'BTU significa British Thermal Unit. Un BTU es la energ√≠a necesaria para:',o:['Enfriar 1 libra de aire en 1¬∞F','Subir 1 libra de agua en 1¬∞F','Derretir 1 libra de hielo','Evaporar 1 libra de refrigerante'],c:1,e:'1 BTU = energ√≠a para subir 1¬∞F a 1 libra de agua. Es la unidad base de calor en HVAC.',a:'Imagina una libra de agua (como una botellita). Un BTU es lo que necesitas para calentarla UN gradito. 12,000 BTU (1 tonelada) = calentar 12,000 botellitas un grado cada hora.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'Mides la temperatura del supply a 58¬∞F y el return a 75¬∞F. El delta T es:',o:['133¬∞F','58¬∞F','17¬∞F ‚Äî est√° en rango normal','75¬∞F'],c:2,e:'Delta T = Return - Supply = 75 - 58 = 17¬∞F. Normal es 15-20¬∞F.',a:'Delta T es la diferencia entre lo que entra y lo que sale. Como medir cu√°nto baj√≥ la temperatura del agua despu√©s de ponerle hielo. 17¬∞F de diferencia = tu equipo est√° trabajando bien.'}
];

const QUIZ_ELECTRICIDAD=[
// ===== SEGURIDAD (10) =====
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'Seg√∫n OSHA, el voltaje m√≠nimo que se considera PELIGROSO para el cuerpo humano es:',o:['120V ‚Äî por eso las casas son peligrosas','50V ‚Äî la piel mojada baja la resistencia','220V ‚Äî solo el alto voltaje mata','12V ‚Äî cualquier voltaje es mortal'],c:1,e:'OSHA considera 50V como umbral peligroso. Con piel mojada, incluso menos puede ser letal.',a:'Tu cuerpo es como una esponja: seco resiste m√°s, mojado conduce f√°cil. Por eso 50V con manos sudadas puede matarte, y 12V en la tina de ba√±o tambi√©n.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'Antes de trabajar en un circuito energizado, la PRIMERA acci√≥n seg√∫n NFPA 70E es:',o:['Ponerte guantes diel√©ctricos','Verificar con el mult√≠metro que hay voltaje','Intentar des-energizar el circuito','Avisar a tu compa√±ero que vas a trabajar'],c:2,e:'NFPA 70E requiere PRIMERO intentar des-energizar. Solo si es imposible se trabaja energizado con PPE.',a:'Es como cruzar la calle: primero intentas usar el sem√°foro. Solo si no hay sem√°foro cruzas con precauci√≥n. Nunca te avientas directo al tr√°fico.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'El procedimiento de Lockout/Tagout requiere que despu√©s de bloquear el breaker, el t√©cnico debe:',o:['Poner el candado y empezar a trabajar','Poner el candado, verificar ausencia de voltaje, y luego trabajar','Poner la etiqueta es suficiente sin candado','Solo apagar el breaker ya es suficiente'],c:1,e:'LOTO requiere: bloquear + candado + verificar con mult√≠metro que hay 0V. Las tres cosas.',a:'Es como descargar un arma: le quitas el cargador, la aseguras, Y verificas que la rec√°mara est√© vac√≠a. No te conf√≠as solo con una cosa.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'Un t√©cnico recibe una descarga de 120V y cae al piso. ¬øQu√© haces PRIMERO?',o:['Jalarle la mano para separarlo del circuito','Buscar el breaker y desconectar la corriente','Echarle agua para que reaccione','Gritarle que suelte el cable'],c:1,e:'PRIMERO corta la energ√≠a. Si tocas a la v√≠ctima mientras est√° energizada, t√∫ tambi√©n recibes la descarga.',a:'Si alguien se est√° ahogando en un r√≠o con corriente, primero paras el agua, no te avientas t√∫ tambi√©n. Corta la energ√≠a PRIMERO, luego ayudas.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'El NEC Art√≠culo 110.26 requiere un espacio libre de trabajo frente a un panel el√©ctrico de al menos:',o:['24 pulgadas de ancho y 30 de profundo','30 pulgadas de ancho y 36 de profundo','36 pulgadas de ancho y 48 de profundo','El NEC no especifica distancias exactas'],c:1,e:'NEC 110.26 requiere m√≠nimo 30" de ancho y 36" de profundidad frente a paneles el√©ctricos.',a:'Imagina que necesitas salir corriendo del panel si hay un arco el√©ctrico. Necesitas espacio para moverte. 30 pulgadas de ancho y 3 pies de profundidad es lo m√≠nimo.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'Los guantes diel√©ctricos Clase 00 protegen hasta un m√°ximo de:',o:['500V ‚Äî solo para bajo voltaje','1000V ‚Äî pero deben probarse cada 6 meses','5000V ‚Äî son los m√°s comunes en HVAC','120V ‚Äî solo protegen de corriente residencial'],c:0,e:'Clase 00 = m√°ximo 500V AC. Para m√°s voltaje necesitas Clase 0 (1000V) o superiores.',a:'Los guantes son como cascos: un casco de bicicleta no te protege de un accidente de moto. Cada clase de guante tiene su l√≠mite, y usar el incorrecto es tan peligroso como no usar ninguno.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'¬øCu√°l es la corriente m√≠nima que puede causar fibrilaci√≥n ventricular (paro card√≠aco)?',o:['1 amperio','100 miliamperios (0.1A)','10 amperios','500 miliamperios'],c:1,e:'100mA (0.1A) puede causar fibrilaci√≥n ventricular y muerte. 10mA ya causa dolor muscular.',a:'Un foco de 100W a 120V usa menos de 1 amperio. Tu coraz√≥n se para con solo 0.1A. Por eso la electricidad no se ve pero s√≠ mata.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'Est√°s trabajando en un techo met√°lico bajo el sol. Tu riesgo de electrocuci√≥n es MAYOR porque:',o:['El metal refleja la electricidad hacia ti','El metal caliente genera corriente est√°tica','El sudor reduce la resistencia de tu piel dram√°ticamente','La altura aumenta el voltaje'],c:2,e:'El sudor reduce la resistencia de la piel de ~100kŒ© a menos de 1kŒ©, permitiendo mucha m√°s corriente.',a:'Tu piel seca es como un guante de goma. Pero el sudor es como echarle agua al guante: ya no te protege. Por eso los accidentes el√©ctricos pasan m√°s en verano.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'Seg√∫n NEC 240.4(D), un conductor de cobre #14 AWG puede protegerse con un breaker m√°ximo de:',o:['20 amperios ‚Äî es el est√°ndar residencial','15 amperios ‚Äî es la protecci√≥n m√°xima permitida','30 amperios ‚Äî el cobre aguanta mucho','25 amperios ‚Äî con factor de seguridad incluido'],c:1,e:'NEC 240.4(D): #14 AWG = 15A m√°ximo. #12 AWG = 20A. #10 AWG = 30A.',a:'Es como un puente: cada puente tiene su l√≠mite de peso. Si pasas un cami√≥n de 20 toneladas por un puente de 15, se cae. El cable #14 solo aguanta 15A.'},
{cat:'üõ°Ô∏è Seguridad El√©ctrica',q:'Un mult√≠metro categor√≠a CAT III es apropiado para medir en:',o:['Solo tomacorrientes residenciales','Paneles de distribuci√≥n y alimentadores','La acometida del transformador de la calle','Circuitos de bajo voltaje solamente'],c:1,e:'CAT III = distribuci√≥n fija (paneles, alimentadores). CAT IV = origen de servicio. CAT II = tomacorrientes.',a:'Las categor√≠as son como las ligas de f√∫tbol: CAT II es la liguilla local, CAT III es primera divisi√≥n, CAT IV es el mundial. Cada nivel tiene m√°s energ√≠a y necesita equipo m√°s fuerte.'},

// ===== INSTRUMENTOS DE MEDICI√ìN (8) =====
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Para medir amperaje en un circuito SIN interrumpirlo, usas:',o:['Un mult√≠metro en serie con el circuito','Una pinza amperim√©trica alrededor del conductor','Un meg√≥hmetro de alta impedancia','Un osciloscopio conectado en paralelo'],c:1,e:'La pinza amperim√©trica mide por inducci√≥n electromagn√©tica sin abrir el circuito.',a:'La pinza es como un radar de velocidad: mide sin tocar ni detener el tr√°fico. Abraza el cable y te da la lectura. Si pones el mult√≠metro en serie, tienes que cortar el cable como una caseta de peaje.'},
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Al medir continuidad, el mult√≠metro debe estar configurado en:',o:['La escala de voltaje AC m√°s alta por seguridad','La escala de ohmios/continuidad con el circuito DESENERGIZADO','La escala de amperios para detectar flujo','La escala de voltaje DC para circuitos apagados'],c:1,e:'Continuidad se mide en ohmios con circuito SIN energ√≠a. Medir continuidad con voltaje presente da√±a el metro.',a:'Medir continuidad es como soplar por una manguera para ver si pasa aire ‚Äî pero primero cierras la llave del agua. Si no la cierras, te llega un chorro a la cara. Sin desconectar, da√±as el metro.'},
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Un meg√≥hmetro (Megger) se usa principalmente para:',o:['Medir voltaje en alta tensi√≥n','Medir la resistencia del aislamiento de cables y motores','Medir la corriente de fuga en circuitos','Calibrar otros instrumentos de medici√≥n'],c:1,e:'El meg√≥hmetro aplica alto voltaje DC para probar que el aislamiento no tenga fugas.',a:'El Megger es como una prueba de presi√≥n de agua a una tuber√≠a: le metes presi√≥n alta para ver si hay fugas. Si el aislamiento est√° da√±ado, la corriente se escapa y el Megger lo detecta.'},
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Tu mult√≠metro digital muestra "OL" al medir resistencia. Esto significa:',o:['El componente tiene sobrecarga (overload)','El circuito est√° abierto ‚Äî no hay continuidad','El mult√≠metro est√° da√±ado o necesita pilas','La resistencia es exactamente 0 ohms'],c:1,e:'OL = Over Limit. Resistencia infinita = circuito abierto. No hay camino para la corriente.',a:'OL es como un camino cortado: no hay paso. Si mides un cable roto, el metro dice OL porque los electrones no pueden pasar. Es un circuito abierto.'},
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Al medir voltaje AC en un circuito de 240V, tus puntas del mult√≠metro deben ir:',o:['Ambas en la l√≠nea caliente (hot)','En paralelo: una en cada l√≠nea caliente (L1 y L2)','En serie: cortando un cable e insertando el metro','Una en hot y otra en tierra para mayor seguridad'],c:1,e:'Para medir 240V, las puntas van en paralelo entre las dos l√≠neas calientes L1 y L2.',a:'Medir voltaje es como tomar la temperatura del agua: metes el term√≥metro SIN cortar la tuber√≠a. Las puntas tocan los dos puntos y el metro te dice la diferencia de presi√≥n (voltaje) entre ellos.'},
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Una pinza amperim√©trica muestra lectura cuando abrazas DOS conductores juntos (hot + neutro). La lectura indica:',o:['La corriente total del circuito','Cero amperios si el circuito est√° balanceado','El doble de la corriente real','La potencia en watts del circuito'],c:1,e:'Hot y neutro llevan corriente igual y opuesta. Se cancelan. Si marca algo, hay fuga de corriente.',a:'Es como dos personas jalando una cuerda en direcciones opuestas con la misma fuerza: se anulan. Si la pinza marca algo, hay corriente que se est√° escapando por otro lado ‚Äî posible fuga a tierra.'},
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Para verificar que un capacitor est√° descargado antes de tocarlo, debes:',o:['Esperar 5 minutos despu√©s de apagar el equipo','Medir voltaje DC entre sus terminales','Cortocircuitar los terminales con un desarmador','Medir resistencia con el mult√≠metro'],c:1,e:'SIEMPRE mide voltaje DC en las terminales. Un capacitor puede retener carga letal por horas.',a:'Un capacitor es como un tanque de agua presurizado: aunque cierres la v√°lvula, el tanque sigue lleno. Puede soltar toda esa energ√≠a en un instante si lo tocas. MIDE ANTES de tocar.'},
{cat:'üî¨ Instrumentos de Medici√≥n',q:'Al usar un mult√≠metro para medir amperaje en serie, si seleccionas la escala de VOLTAJE por error:',o:['El mult√≠metro mostrar√° voltaje en vez de amperaje','Quemar√°s el fusible interno del mult√≠metro','Crear√°s un cortocircuito potencialmente peligroso','El mult√≠metro se auto-protege y cambia de escala'],c:2,e:'En modo voltaje, el mult√≠metro tiene alta impedancia. En serie para medir amperios necesitas baja impedancia. Error de selecci√≥n puede crear cortocircuito.',a:'Es como conectar una manguera de agua al rev√©s: la presi√≥n va al lado equivocado y revienta algo. La escala incorrecta puede fundir el fusible del metro o peor.'},

// ===== TEOR√çA B√ÅSICA / LEY DE OHM (10) =====
{cat:'üìê Ley de Ohm',q:'Si en un circuito la resistencia se DUPLICA y el voltaje permanece igual, la corriente:',o:['Tambi√©n se duplica proporcionalmente','Se reduce a la mitad exactamente','No cambia porque el voltaje es constante','Se cuadruplica por la relaci√≥n exponencial'],c:1,e:'V = IR. Si R se duplica y V es constante: I = V/2R = la mitad de la corriente original.',a:'Imagina que aprietas una manguera con la mano (m√°s resistencia) pero la presi√≥n del agua no cambia. Sale menos agua. M√°s resistencia = menos corriente si el voltaje es igual.'},
{cat:'üìê Ley de Ohm',q:'La f√≥rmula para calcular POTENCIA cuando conoces voltaje y corriente es:',o:['P = V / I (voltaje dividido corriente)','P = I¬≤ √ó R (corriente al cuadrado por resistencia)','P = V √ó I (voltaje por corriente)','Las opciones B y C son ambas correctas'],c:3,e:'P = V√óI y P = I¬≤√óR son ambas correctas. Son derivaciones de la misma ley usando V=IR.',a:'Es como calcular el √°rea de un rect√°ngulo: puedes usar base√óaltura o puedes usar otros m√©todos. Ambas f√≥rmulas te dan watts. P=VI es la m√°s directa, P=I¬≤R es cuando no conoces el voltaje.'},
{cat:'üìê Ley de Ohm',q:'Un calentador el√©ctrico de 5000W a 240V. ¬øCu√°l es la resistencia del elemento calefactor?',o:['1,200,000 ohms','20.83 ohms','48 ohms','11.52 ohms'],c:3,e:'R = V¬≤/P = 240¬≤/5000 = 57600/5000 = 11.52Œ©. Tambi√©n: I = P/V = 20.83A, R = V/I = 240/20.83 = 11.52Œ©.',a:'Dos caminos llegan al mismo resultado: R = V¬≤√∑P o primero sacas los amperios y luego divides. Es como ir al trabajo por la autopista o por la calle ‚Äî llegas al mismo lugar.'},
{cat:'üìê Ley de Ohm',q:'Un circuito de 120V tiene un consumo de 1440W. El breaker de 15A:',o:['Es suficiente ‚Äî 1440W a 120V = 12A','Va a disparar porque el circuito consume exactamente 15A','Es suficiente pero est√° al 80% de su capacidad ‚Äî hay que considerar NEC 210.20','Se disparar√° porque excede el 80% continuo permitido por NEC'],c:2,e:'1440/120 = 12A. NEC 210.20 dice que cargas continuas no deben exceder 80% del breaker (15√ó0.8=12A). Est√° justo al l√≠mite.',a:'Un breaker de 15A puede aguantar 15A, pero el NEC dice que para cargas continuas solo puedes usar el 80%, o sea 12A. Es como un carro que llega a 200 km/h pero no debes manejarlo as√≠ todo el d√≠a.'},
{cat:'üìê Ley de Ohm',q:'Si un motor consume 30A a 240V, ¬øcu√°ntos watts de potencia est√° usando?',o:['7,200 watts','270 watts','8 watts','7.2 kilowatts ambas A y D son correctas'],c:3,e:'P = V √ó I = 240 √ó 30 = 7,200W = 7.2kW. Las respuestas A y D expresan lo mismo.',a:'Watts es voltaje √ó amperaje. 240 √ó 30 = 7,200. Si alguien te dice 7.2 kilowatts es exactamente lo mismo. Kilo = mil. 7,200W = 7.2kW. Ojo con las unidades.'},
{cat:'üìê Ley de Ohm',q:'En un circuito con tres resistencias de 10Œ© cada una en SERIE, la resistencia total es:',o:['3.33 ohms ‚Äî se dividen','30 ohms ‚Äî se suman','10 ohms ‚Äî queda igual que una sola','100 ohms ‚Äî se multiplican'],c:1,e:'En serie: RT = R1 + R2 + R3 = 10 + 10 + 10 = 30Œ©. Las resistencias se SUMAN.',a:'Resistencias en serie son como casetas de peaje en la carretera: cada una te frena. Tres casetas = tres veces m√°s lento. La resistencia total SUBE.'},
{cat:'üìê Ley de Ohm',q:'Esas mismas tres resistencias de 10Œ© ahora en PARALELO, la resistencia total es:',o:['30 ohms ‚Äî se suman igual que en serie','3.33 ohms ‚Äî se divide entre el n√∫mero','10 ohms ‚Äî la m√°s peque√±a domina','0.3 ohms ‚Äî se multiplican los rec√≠procos'],c:1,e:'En paralelo: 1/RT = 1/10 + 1/10 + 1/10 = 3/10. RT = 10/3 = 3.33Œ©. Siempre menor que la menor.',a:'En paralelo es como abrir tres carriles en la autopista: el tr√°fico fluye m√°s r√°pido. Tres caminos de 10Œ© = resistencia total de solo 3.33Œ©. M√°s caminos = menos resistencia.'},
{cat:'üìê Ley de Ohm',q:'Un circuito tiene 120V y una resistencia de 0 ohms. ¬øQu√© sucede?',o:['La corriente es 0 porque no hay resistencia','La corriente es infinita ‚Äî es un cortocircuito','El voltaje se cae a 0V autom√°ticamente','No pasa nada porque 0 ohms no existe en la pr√°ctica'],c:1,e:'V/R = 120/0 = infinito. Corriente infinita = cortocircuito. Por eso se disparan los breakers.',a:'Si quitas toda la resistencia de un circuito, es como quitar la presa de un r√≠o: el agua se desborda sin control. 0 ohms = camino libre = toda la corriente disponible pasa de golpe.'},
{cat:'üìê Ley de Ohm',q:'La ley de Kirchhoff de voltajes dice que en un circuito cerrado, la suma de todos los voltajes es:',o:['Igual al voltaje de la fuente','Proporcional a la corriente total','Igual a cero ‚Äî las ca√≠das = la fuente','Igual a la suma de las resistencias'],c:2,e:'KVL: La suma algebraica de voltajes en un lazo cerrado = 0. Las ca√≠das de voltaje igualan al voltaje de la fuente.',a:'Es como un viaje redondo en carro: subes una monta√±a (fuente de voltaje) y luego bajas por diferentes pendientes (ca√≠das). Al final est√°s al mismo nivel donde empezaste. La suma es cero.'},
{cat:'üìê Ley de Ohm',q:'Un t√©cnico mide 13.5 amperios en una de las fases de un compresor trif√°sico. Las otras dos miden 12.8A y 14.1A. El porcentaje de desbalance de amperaje es:',o:['Aproximadamente 4.4% ‚Äî dentro de lo normal','Aproximadamente 9.6% ‚Äî hay que investigar','Aproximadamente 1.3% ‚Äî perfecto','No se puede calcular sin saber el voltaje'],c:0,e:'Promedio = (13.5+12.8+14.1)/3 = 13.47A. Mayor desviaci√≥n = 14.1-13.47 = 0.63. Desbalance = 0.63/13.47 √ó 100 = 4.7%. Cercano a 4.4%.',a:'Es como tres caballos jalando una carreta: si uno jala mucho m√°s que los otros, la carreta se va chueca. 5% o m√°s ya es preocupante. Aqu√≠ estamos en el l√≠mite.'},

// ===== MAGNETISMO (5) =====
{cat:'üß≤ Magnetismo',q:'Un electroim√°n se diferencia de un im√°n permanente porque:',o:['El electroim√°n es m√°s fuerte siempre','El electroim√°n pierde magnetismo cuando se corta la corriente','El im√°n permanente genera m√°s calor','No hay diferencia funcional entre ambos'],c:1,e:'Un electroim√°n funciona solo con corriente. Sin electricidad, no hay campo magn√©tico.',a:'Un electroim√°n es como una linterna: funciona solo cuando est√° encendida. Un im√°n permanente es como una pintura: siempre est√° ah√≠. Los contactores y rel√©s usan electroimanes porque necesitas poder encender y apagar el magnetismo.'},
{cat:'üß≤ Magnetismo',q:'La bobina de un contactor crea un campo magn√©tico para:',o:['Generar calor y proteger contra sobrecargas','Atraer la armadura y cerrar los contactos principales','Medir el voltaje del circuito de control','Reducir el voltaje al nivel del circuito de control'],c:1,e:'La bobina energizada crea campo magn√©tico que atrae la armadura, cerrando los contactos de potencia.',a:'Piensa en un timbre de puerta: cuando oprimes el bot√≥n, la electricidad magnetiza una bobinita que jala un martillito. El contactor es igual: la bobina jala los contactos y cierra el circuito de potencia.'},
{cat:'üß≤ Magnetismo',q:'En un motor el√©ctrico, la interacci√≥n entre el campo magn√©tico del estator y el del rotor produce:',o:['Calor para calentar los rodamientos','Torque ‚Äî la fuerza giratoria que hace rotar el eje','Voltaje que alimenta el propio motor','Resistencia que protege contra sobrecarga'],c:1,e:'La interacci√≥n de campos magn√©ticos opuestos genera torque (par motor) que hace girar el rotor.',a:'Es como dos imanes enfrentados: se empujan o se atraen. En un motor, los campos magn√©ticos empujan al rotor constantemente, haci√©ndolo girar como un carrusel magn√©tico.'},
{cat:'üß≤ Magnetismo',q:'La inductancia de una bobina se mide en:',o:['Faradios ‚Äî igual que los capacitores','Henrios ‚Äî proporcional a las vueltas de alambre','Ohmios ‚Äî porque se opone a la corriente','Watts ‚Äî porque almacena energ√≠a'],c:1,e:'La inductancia se mide en Henrios (H). Depende del n√∫mero de espiras, material del n√∫cleo y geometr√≠a.',a:'Los Henrios son como la inercia de un trompo: m√°s pesado y m√°s vueltas de cuerda = m√°s dif√≠cil pararlo una vez girando. Una bobina con m√°s vueltas tiene m√°s Henrios y se resiste m√°s a los cambios de corriente.'},
{cat:'üß≤ Magnetismo',q:'Un transformador funciona basado en el principio de:',o:['Resistencia variable entre dos bobinas','Inducci√≥n electromagn√©tica mutua entre bobinas','Conducci√≥n directa de corriente entre enrollados','Magnetismo permanente con n√∫cleo de acero'],c:1,e:'El transformador usa inducci√≥n mutua: la corriente AC en el primario crea campo magn√©tico variable que induce voltaje en el secundario.',a:'El transformador es como dos personas hablando a trav√©s de una pared: la primera persona (primario) habla, las vibraciones pasan por la pared (n√∫cleo), y la segunda persona (secundario) escucha. La energ√≠a se transfiere sin contacto directo.'},

// ===== CORRIENTE ALTERNA AC (7) =====
{cat:'‚ö° Corriente Alterna',q:'El valor RMS de 120VAC significa que entrega la misma potencia que:',o:['120V de pico AC','120V de corriente directa DC','169.7V de pico AC','85V de corriente directa DC'],c:1,e:'RMS (Root Mean Square) es el valor equivalente de DC. 120VAC RMS = misma potencia que 120VDC.',a:'RMS es como el promedio efectivo. Si AC fuera una monta√±a rusa subiendo y bajando, RMS es la altura promedio que realmente trabaja. 120V RMS trabaja igual que 120V DC constante.'},
{cat:'‚ö° Corriente Alterna',q:'El voltaje PICO de una se√±al de 120VAC RMS es:',o:['120V ‚Äî pico y RMS son iguales','240V ‚Äî el pico es el doble','169.7V ‚Äî se multiplica por ‚àö2 (1.414)','84.85V ‚Äî se divide por ‚àö2'],c:2,e:'Vpico = VRMS √ó ‚àö2 = 120 √ó 1.414 = 169.7V. El pico siempre es mayor que el RMS.',a:'Imagina una ola del mar: el RMS es como la altura promedio del agua, pero la cresta de la ola (pico) llega m√°s arriba. En AC, el voltaje sube hasta 169.7V aunque decimos que son 120V.'},
{cat:'‚ö° Corriente Alterna',q:'En un sistema trif√°sico 208/120V, los 208V se obtienen midiendo entre:',o:['L√≠nea y neutro','L√≠nea y tierra','Dos l√≠neas cualesquiera (fase a fase)','Las tres l√≠neas juntas'],c:2,e:'208V = voltaje l√≠nea a l√≠nea en trif√°sico. L√≠nea a neutro = 120V. 120 √ó ‚àö3 = 208V.',a:'Es como tres caballos en un carrusel: cada caballo est√° a 120V del centro (neutro), pero entre un caballo y otro hay 208V. Es geometr√≠a, no magia. 120 √ó 1.732 = 208.'},
{cat:'‚ö° Corriente Alterna',q:'Un motor trif√°sico gira al rev√©s de lo deseado. Para corregirlo debes:',o:['Cambiar las tres fases de posici√≥n','Intercambiar DOS de las tres fases cualesquiera','Invertir la polaridad del capacitor','Cambiar la frecuencia de 60Hz a 50Hz'],c:1,e:'Para invertir rotaci√≥n en trif√°sico, solo intercambias dos fases cualquiera. No las tres.',a:'Es como cambiar la direcci√≥n de un ventilador de techo: no cambias todo, solo inviertes dos cables. En trif√°sico, intercambiar dos fases cambia la secuencia de rotaci√≥n del campo magn√©tico.'},
{cat:'‚ö° Corriente Alterna',q:'El factor de potencia de 0.85 en un motor significa que:',o:['Solo usa el 85% de la electricidad que paga','El 85% de la potencia es √∫til, el 15% es reactiva','El motor est√° al 85% de su capacidad','La eficiencia del motor es 85%'],c:1,e:'Factor de potencia = potencia real / potencia aparente. 0.85 significa que 15% es potencia reactiva (no trabaja).',a:'Es como un vaso de cerveza con espuma: el 85% es cerveza (potencia √∫til) y el 15% es espuma (potencia reactiva). Pagas por el vaso lleno pero solo disfrutas la cerveza.'},
{cat:'‚ö° Corriente Alterna',q:'La frecuencia de 60Hz significa que la corriente completa:',o:['60 ciclos completos por minuto','60 ciclos completos por segundo','60 cambios de direcci√≥n por segundo','60,000 oscilaciones por segundo'],c:1,e:'Hertz = ciclos por segundo. 60Hz = 60 ciclos completos cada segundo.',a:'Hz es como el ritmo de un coraz√≥n: 60 latidos por minuto es lo normal del coraz√≥n, 60 ciclos por SEGUNDO es lo normal de la electricidad AC en USA.'},
{cat:'‚ö° Corriente Alterna',q:'En un circuito puramente capacitivo, la corriente:',o:['Est√° en fase con el voltaje','Adelanta al voltaje por 90 grados','Atrasa al voltaje por 90 grados','Se opone completamente al voltaje'],c:1,e:'En capacitores, la corriente ADELANTA al voltaje por 90¬∞. Mnem√≥nico: "ELI the ICE man" ‚Äî en C, I adelanta a E.',a:'ELI el hombre de ICE: En un Inductor (L), el voltaje (E) adelanta a la corriente (I). En un Capacitor (C), la corriente (I) adelanta al voltaje (E). I-C-E.'},

// ===== CORRIENTE DIRECTA DC (5) =====
{cat:'üîã Corriente Directa',q:'En un circuito DC, los electrones fluyen del terminal:',o:['Positivo al negativo ‚Äî siguiendo la convenci√≥n','Negativo al positivo ‚Äî flujo real de electrones','En ambas direcciones simult√°neamente','La direcci√≥n depende del tipo de carga'],c:1,e:'El flujo REAL de electrones va de negativo a positivo. La convenci√≥n dice al rev√©s por razones hist√≥ricas.',a:'Benjamin Franklin se equivoc√≥ hace 200 a√±os y dijo que la corriente iba de + a -. En realidad los electrones viajan de - a +. Pero como todos ya lo aprend ieron al rev√©s, usamos ambas convenciones.'},
{cat:'üîã Corriente Directa',q:'Un circuito de control de 24VDC requiere un fusible de protecci√≥n. Si la carga consume 2A, el fusible debe ser:',o:['24V/2A = 12A ‚Äî seg√∫n Ohm','Un fusible de 3A ‚Äî ligeramente arriba del consumo','Un fusible de 2A exacto ‚Äî para que proteja al 100%','Un fusible de 10A ‚Äî para dejar margen amplio'],c:1,e:'El fusible debe ser ligeramente superior al consumo normal. 3A protege sin disparar en operaci√≥n normal.',a:'El fusible es como el cintur√≥n de seguridad: no debe estar tan apretado que te asfixie (2A = se dispara por nada), ni tan flojo que no te proteja (10A = no protege nada). 3A es el punto justo.'},
{cat:'üîã Corriente Directa',q:'La diferencia entre un circuito de control de 24VAC y 24VDC es que:',o:['Son intercambiables ‚Äî 24V es 24V','El AC puede alimentar bobinas de rel√©s convencionales, el DC necesita rel√©s especiales o diodos','El DC es m√°s peligroso que el AC al mismo voltaje','No existe control a 24VDC en HVAC'],c:1,e:'Los rel√©s AC y DC funcionan diferente. Un rel√© dise√±ado para AC puede no liberar con DC por el magnetismo residual.',a:'AC y DC son como agua de r√≠o (fluye ida y vuelta) y agua de canal (fluye en una direcci√≥n). Ambos mojan, pero las turbinas de r√≠o no funcionan en el canal. Rel√©s AC y DC no son intercambiables.'},
{cat:'üîã Corriente Directa',q:'Un termostato digital moderno usa internamente:',o:['240VAC para mayor potencia de procesamiento','24VAC convertido a DC bajo voltaje para el microprocesador','Corriente directa de la l√≠nea de 120V','Energ√≠a solar exclusivamente'],c:1,e:'Los termostatos digitales reciben 24VAC y lo rectifican internamente a DC bajo voltaje (3.3V o 5V) para alimentar el microprocesador.',a:'El termostato es como tu celular con cargador: la pared tiene AC, pero tu celular usa DC. El termostato recibe 24VAC y lo convierte a DC bajito para que funcione su cerebrito digital.'},
{cat:'üîã Corriente Directa',q:'Un diodo en un circuito DC permite que la corriente fluya:',o:['En ambas direcciones libremente','Solo en una direcci√≥n ‚Äî del √°nodo al c√°todo','Solo cuando hay sobrecarga','En direcci√≥n opuesta a la convenci√≥n'],c:1,e:'El diodo es una v√°lvula unidireccional: solo deja pasar corriente del √°nodo (+) al c√°todo (-).',a:'Un diodo es como una puerta de metro que solo abre hacia un lado: puedes salir pero no puedes entrar por esa puerta. La corriente pasa en una direcci√≥n y se bloquea en la otra.'},

// ===== CONDUCTORES (6) =====
{cat:'üîå Conductores',q:'Al AUMENTAR el n√∫mero AWG de un conductor (ej: de #10 a #14), el cable es:',o:['M√°s grueso y aguanta m√°s corriente','M√°s delgado y aguanta MENOS corriente','Del mismo grosor pero diferente material','M√°s largo pero con la misma capacidad'],c:1,e:'En AWG, n√∫mero MAYOR = cable M√ÅS delgado. #14 es m√°s delgado que #10. #10 > #12 > #14.',a:'AWG es al rev√©s de lo que piensas: n√∫mero grande = cable chico. Es como las tallas de ropa en Jap√≥n: una talla 14 es m√°s chica que una talla 10. #14 es flaquito, #10 es gordito.'},
{cat:'üîå Conductores',q:'Seg√∫n NEC Table 310.16, un conductor de cobre #10 AWG tipo THHN en tubo conduit puede llevar hasta:',o:['20 amperios continuos','30 amperios continuos','40 amperios continuos','50 amperios continuos'],c:1,e:'NEC 310.16: #10 THHN a 90¬∞C = 40A, pero con factor de correcci√≥n en conduit a 75¬∞C = 35A. Com√∫nmente se usa 30A.',a:'La tabla 310.16 del NEC es la biblia de los conductores. Memoriza los m√°s comunes: #14=15A, #12=20A, #10=30A, #8=40A, #6=55A. Estos n√∫meros los vas a usar TODOS los d√≠as.'},
{cat:'üîå Conductores',q:'Un cable THHN vs un cable THWN. La "W" significa:',o:['Watts ‚Äî aguanta m√°s potencia','Wet ‚Äî resistente a humedad y puede ir en lugares mojados','Wide ‚Äî es de mayor di√°metro','Wired ‚Äî viene pre-cableado de f√°brica'],c:1,e:'W = Wet locations (lugares h√∫medos). THWN puede instalarse en conduit enterrado o expuesto a humedad.',a:'La W es de Water. THHN es para lugares secos como dentro de paredes. THWN puede mojarse. Es como la diferencia entre zapatos de vestir (THHN) y botas de lluvia (THWN).'},
{cat:'üîå Conductores',q:'La ca√≠da de voltaje m√°xima recomendada por NEC para un circuito de alimentaci√≥n es:',o:['10% ‚Äî solo para circuitos industriales','3% para el alimentador, 5% total incluyendo rama','5% para alimentador, 10% total','No hay l√≠mite ‚Äî el NEC no regula ca√≠da de voltaje'],c:1,e:'NEC recomienda 3% m√°ximo en alimentador y 5% total (alimentador + circuito rama). No es obligatorio pero s√≠ recomendado.',a:'La ca√≠da de voltaje es como la presi√≥n del agua que se pierde en tuber√≠a muy larga. Si empiezas con 120V y pierdes m√°s del 5%, el equipo al final no funciona bien. Es como regar con manguera de 500 pies ‚Äî casi no sale agua al final.'},
{cat:'üîå Conductores',q:'¬øPor qu√© el aluminio requiere un conductor de mayor calibre que el cobre para la misma corriente?',o:['El aluminio pesa m√°s y se calienta m√°s f√°cil','El aluminio tiene mayor resistencia que el cobre ‚Äî conduce peor','El aluminio es m√°s peligroso por ser inflamable','No es cierto ‚Äî ambos metales son equivalentes'],c:1,e:'El aluminio tiene aproximadamente 61% de la conductividad del cobre. Para llevar la misma corriente necesitas cable m√°s grueso.',a:'Si el cobre es una autopista de 4 carriles, el aluminio es de 2.5 carriles. Para mover el mismo tr√°fico, necesitas la autopista de aluminio m√°s ancha. Por eso el cable de aluminio es m√°s gordo.'},
{cat:'üîå Conductores',q:'Al hacer una conexi√≥n de aluminio con cobre (bimet√°lica), es OBLIGATORIO usar:',o:['Cinta aislante de alta calidad','Conectores aprobados anti-oxidante y marcados AL/CU','Soldadura de plata para uni√≥n permanente','No se permite nunca conectar aluminio con cobre'],c:1,e:'Las uniones bimet√°licas requieren conectores marcados AL/CU y pasta anti-oxidante para prevenir corrosi√≥n galv√°nica.',a:'Aluminio y cobre son como perros y gatos: si los juntas sin cuidado, hay problemas. La corrosi√≥n galv√°nica afloja la conexi√≥n y puede causar incendio. Los conectores AL/CU son como el mediador que los mantiene en paz.'},

// ===== INTERRUPTORES / BREAKERS (5) =====
{cat:'üî≤ Interruptores',q:'Un breaker de 20A se dispara instant√°neamente. La causa M√ÅS probable es:',o:['Sobrecarga gradual en el circuito','Cortocircuito en alg√∫n punto del circuito','El breaker est√° viejo y necesita reemplazo','La temperatura ambiente es muy alta'],c:1,e:'Disparo instant√°neo = cortocircuito. La sobrecarga causa disparo retardado (tardado). Son mecanismos diferentes.',a:'Un breaker tiene dos cerebros: uno lento para sobrecargas (se calienta gradualmente) y uno r√°pido para cortocircuitos (dispara de golpe). Si dispar√≥ instant√°neamente, hay un cortocircuito.'},
{cat:'üî≤ Interruptores',q:'Un breaker se siente caliente al tacto comparado con los dem√°s. Esto puede indicar:',o:['Es normal ‚Äî todos los breakers generan calor','Conexi√≥n floja que genera resistencia y calor','El circuito est√° sub-cargado','El breaker es de mayor capacidad que los otros'],c:1,e:'Un breaker m√°s caliente que sus vecinos indica conexi√≥n floja, mala terminal, o sobrecarga en ese circuito.',a:'Si una llanta de tu carro est√° m√°s caliente que las otras, hay un problema: freno pegado, baja presi√≥n, etc. Un breaker caliente es lo mismo ‚Äî algo est√° mal en esa conexi√≥n.'},
{cat:'üî≤ Interruptores',q:'Seg√∫n NEC 210.12, los breakers AFCI (Arc-Fault) son requeridos en:',o:['Solo en ba√±os y cocinas','Dormitorios, salas, comedores y la mayor√≠a de √°reas habituales','Solo en circuitos de 240V','Exclusivamente en instalaciones comerciales'],c:1,e:'NEC 210.12 requiere AFCI en dormitorios, salas, comedores, pasillos, closets y la mayor√≠a de √°reas habituales residenciales.',a:'AFCI protege contra arcos el√©ctricos que causan incendios ‚Äî como un cable da√±ado dentro de la pared chispeando. Los cuartos donde duermes son los m√°s peligrosos por eso se requieren ah√≠.'},
{cat:'üî≤ Interruptores',q:'La diferencia principal entre un breaker de 1 polo y uno de 2 polos es:',o:['El de 2 polos protege el doble de circuitos','El de 1 polo protege 120V, el de 2 polos protege 240V interrumpiendo ambas l√≠neas','El de 2 polos es m√°s seguro para cocinas','Solo es diferencia de tama√±o f√≠sico'],c:1,e:'Un breaker de 2 polos desconecta las dos l√≠neas calientes simult√°neamente para circuitos de 240V.',a:'Un breaker de 1 polo es como una puerta sencilla. Uno de 2 polos es como una puerta doble que se abre junta: desconecta las dos l√≠neas al mismo tiempo. Para 240V necesitas cortar ambas l√≠neas.'},
{cat:'üî≤ Interruptores',q:'Un breaker que se puede resetear pero se vuelve a disparar inmediatamente indica:',o:['El breaker necesita reemplazo urgente','El cortocircuito o falla sigue presente en el circuito','Se necesita un breaker de mayor amperaje','Hay que esperar 5 minutos entre cada reset'],c:1,e:'Si se re-dispara inmediatamente, la falla persiste. Hay que encontrar y reparar la falla ANTES de resetear.',a:'Es como una alarma de humo que suena otra vez cuando la reseteas: el fuego sigue ah√≠. No pongas cinta a la alarma ‚Äî apaga el fuego primero.'},

// ===== FUSIBLES (4) =====
{cat:'üî• Fusibles',q:'Un fusible tipo "dual-element" o de retardo se usa para proteger:',o:['Solo circuitos de iluminaci√≥n','Circuitos con motores que tienen alta corriente de arranque','Circuitos de control de bajo voltaje exclusivamente','Paneles principales de alta potencia'],c:1,e:'Los fusibles de retardo aguantan el pico de arranque de motores sin disparar, pero protegen contra cortocircuitos.',a:'Un motor al arrancar consume 5-7 veces su corriente normal por unos segundos. Un fusible normal se volar√≠a. El de retardo es como un padre paciente: aguanta un berrinche corto pero act√∫a si el problema dura.'},
{cat:'üî• Fusibles',q:'¬øCu√°l es la diferencia entre un fusible de acci√≥n r√°pida y uno de retardo?',o:['El de acci√≥n r√°pida es para AC, el de retardo para DC','El de acci√≥n r√°pida protege componentes electr√≥nicos sensibles, el de retardo tolera picos de arranque','El de retardo es m√°s barato y menos preciso','No hay diferencia real ‚Äî solo son de diferentes fabricantes'],c:1,e:'Acci√≥n r√°pida dispara ante cualquier sobrecorriente. Retardo tolera picos breves (arranque de motores).',a:'Fusible r√°pido es como un guardaespaldas nervioso: al primer movimiento extra√±o, act√∫a. El de retardo es como un guardaespaldas experimentado: sabe que un empuj√≥n accidental no es un ataque. Ambos protegen, pero de diferente manera.'},
{cat:'üî• Fusibles',q:'Un fusible se quem√≥ y solo tienes uno de voltaje MAYOR pero mismo amperaje. ¬øPuedes usarlo?',o:['S√≠ ‚Äî el voltaje del fusible solo indica su capacidad m√°xima de interrupci√≥n','No ‚Äî mayor voltaje significa que dejar√° pasar m√°s corriente','No ‚Äî los fusibles de diferente voltaje tienen diferente tama√±o','S√≠ pero solo temporalmente por 24 horas'],c:0,e:'El voltaje del fusible indica hasta qu√© voltaje puede interrumpir con seguridad. Uno de mayor voltaje funciona en un circuito de menor voltaje.',a:'Un fusible de 600V en un circuito de 240V es como un puente dise√±ado para 40 toneladas cargando solo 15. Est√° sobrado, no hay problema. Pero NUNCA al rev√©s: un fusible de 250V en un circuito de 480V es peligroso.'},
{cat:'üî• Fusibles',q:'Para verificar si un fusible est√° quemado SIN sacarlo del circuito, puedes:',o:['Medir voltaje a trav√©s del fusible ‚Äî si marca voltaje est√° abierto','Medir resistencia con el circuito energizado','Observar visualmente si el alambre est√° roto','Solo se puede verificar sac√°ndolo del circuito'],c:0,e:'Un fusible bueno tiene 0V entre sus terminales. Si mides voltaje significa que est√° abierto (quemado).',a:'Un fusible bueno es como un puente: no hay diferencia de nivel entre un lado y otro. Si mides voltaje entre ambos lados, es como una cascada ‚Äî hay un desnivel porque el puente se cay√≥. Voltaje = fusible quemado.'},

// ===== GFCI (5) =====
{cat:'‚ö° GFCI',q:'Un GFCI (Ground Fault Circuit Interrupter) se dispara cuando detecta una diferencia de corriente de:',o:['15 amperios entre hot y neutro','100 miliamperios de fuga','4-6 miliamperios entre hot y neutro','1 amperio de corriente a tierra'],c:2,e:'GFCI dispara con diferencia de 4-6mA entre hot y neutro, indicando que corriente se est√° escapando por otro camino (posiblemente a trav√©s de una persona).',a:'El GFCI es como un contador de ovejas: si salen 100 ovejas y solo regresan 96, cuatro se perdieron. Si salen 10A por el hot y solo regresan 9.995A por el neutro, 5mA se escaparon ‚Äî posiblemente por una persona. ¬°TRIP!'},
{cat:'‚ö° GFCI',q:'Seg√∫n NEC 210.8, los tomacorrientes GFCI son requeridos en:',o:['Todos los circuitos de una casa sin excepci√≥n','Ba√±os, cocinas, garajes, exteriores, s√≥tanos y cerca de fuentes de agua','Solo en cuartos de ba√±o y ning√∫n otro lugar','Solo en circuitos de 20 amperios o m√°s'],c:1,e:'NEC 210.8 requiere GFCI en ba√±os, cocinas (cerca del lavabo), garajes, exteriores, s√≥tanos sin terminar, lavander√≠as, y m√°s.',a:'Donde hay agua hay peligro. El NEC pone GFCI en todos los lugares donde podr√≠as estar mojado: ba√±o, cocina, garage, afuera. El agua y la electricidad no se llevan.'},
{cat:'‚ö° GFCI',q:'Un GFCI protege contra:',o:['Sobrecarga del circuito','Cortocircuitos','Fugas de corriente a tierra que podr√≠an electrocutar a una persona','Las tres anteriores'],c:2,e:'GFCI solo protege contra fugas a tierra. NO protege contra sobrecargas ni cortocircuitos ‚Äî para eso est√° el breaker.',a:'El GFCI es un especialista: solo detecta si la corriente se est√° escapando del circuito por donde no debe (como a trav√©s de tu cuerpo). El breaker es el que cuida sobrecargas y cortocircuitos. Cada uno tiene su trabajo.'},
{cat:'‚ö° GFCI',q:'Un GFCI se dispara repetidamente en un circuito de exteriores. La causa M√ÅS probable es:',o:['El GFCI es de mala calidad y necesita uno mejor','Hay humedad en las cajas el√©ctricas o cables da√±ados permitiendo fuga','El circuito est√° sobrecargado con demasiados equipos','La tierra f√≠sica est√° desconectada'],c:1,e:'En exteriores, la humedad en conexiones o cables da√±ados es la causa m√°s com√∫n de disparos repetitivos de GFCI.',a:'El GFCI en exteriores es como un perro guardi√°n que ladra por todo: rata, gato, sombra. Pero si ladra mucho, hay algo real. La humedad crea caminos de fuga que el GFCI detecta correctamente.'},
{cat:'‚ö° GFCI',q:'Puedes instalar un GFCI en el primer tomacorriente de un circuito para proteger todos los dem√°s. Esto se llama:',o:['Protecci√≥n maestra ‚Äî pero no cumple c√≥digo','Protecci√≥n en cascada ‚Äî conectando los dem√°s al terminal LOAD','Protecci√≥n dedicada ‚Äî cada tomacorriente necesita su propio GFCI','Protecci√≥n simple ‚Äî solo protege ese tomacorriente'],c:1,e:'Conectando los dem√°s tomacorrientes al terminal LOAD del primer GFCI, todos quedan protegidos. Se etiquetan "GFCI Protected".',a:'El GFCI tiene dos lados: LINE (entrada) y LOAD (salida). Todo lo que conectes al LOAD queda protegido. Es como poner un guardia en la entrada del edificio: protege a todos los que est√°n adentro.'},

// ===== ARC FAULT BREAKERS (4) =====
{cat:'üî• Arc Fault (AFCI)',q:'Un AFCI detecta algo que un breaker normal y un GFCI NO pueden detectar:',o:['Sobrecarga por exceso de equipos conectados','Arcos el√©ctricos peligrosos como cables da√±ados chispeando','Voltaje incorrecto en el circuito','Corriente DC en un circuito de AC'],c:1,e:'AFCI detecta patrones de arco (chispeo) que pueden iniciar incendios. Ni el breaker normal ni el GFCI detectan esto.',a:'Un cable pelado dentro de la pared puede chispear sin causar cortocircuito ni fuga a tierra. El breaker normal no lo ve, el GFCI tampoco. Pero el AFCI escucha ese chisporroteo el√©ctrico y desconecta antes del incendio.'},
{cat:'üî• Arc Fault (AFCI)',q:'¬øPuede un AFCI causar disparos en falso (nuisance tripping)?',o:['No ‚Äî los AFCI modernos son 100% precisos','S√≠ ‚Äî ciertos equipos con motores de escobillas o arcos normales pueden dispararlo','Solo si est√° mal instalado','Solo con equipos de m√°s de 15 amperios'],c:1,e:'Aspiradoras, taladros, y otros equipos con motores de escobillas generan peque√±os arcos normales que pueden confundir al AFCI.',a:'Un AFCI es como un detector de humo ultra sensible: a veces se activa con el vapor de la ducha o el humo de cocinar. No es falla, es que es muy sensible. Los motores de escobillas generan chispitas normales que el AFCI a veces confunde.'},
{cat:'üî• Arc Fault (AFCI)',q:'Un breaker Dual-Function (AFCI/GFCI) combina protecci√≥n contra:',o:['Sobrecarga y cortocircuito solamente','Arcos el√©ctricos Y fugas de corriente a tierra en un solo breaker','Solo arcos en circuitos de 240V','Solo protecci√≥n GFCI con etiqueta AFCI'],c:1,e:'Dual-Function = AFCI + GFCI en un solo breaker. Protege contra arcos peligrosos y fugas a tierra simult√°neamente.',a:'Es como tener guardia de seguridad y detector de incendios en uno solo. El AFCI cuida contra chispas peligrosas y el GFCI contra fugas que te pueden electrocutar. Dos protecciones, un solo breaker.'},
{cat:'üî• Arc Fault (AFCI)',q:'NEC 2020 requiere AFCI en circuitos de 120V en:',o:['Solo dormitorios de casas nuevas','Pr√°cticamente todas las √°reas habitables: dormitorios, salas, comedores, cocinas, lavander√≠as','Solo √°reas h√∫medas como ba√±os y cocinas','Circuitos comerciales de 20A o m√°s'],c:1,e:'NEC 2020 expandi√≥ AFCI a casi toda la residencia excepto ba√±os y garajes.',a:'El NEC cada versi√≥n exige m√°s AFCI porque los incendios el√©ctricos por arcos son la causa #1 de incendios residenciales. Es como el cintur√≥n de seguridad: antes era opcional, ahora es obligatorio en casi todo.'},

// ===== CIRCUITOS EN SERIE (4) =====
{cat:'üîó Circuitos en Serie',q:'En un circuito en serie con tres cargas, la CORRIENTE en cada carga es:',o:['Diferente en cada una ‚Äî se divide proporcionalmente','Igual en todas ‚Äî solo hay un camino para la corriente','Mayor en la primera carga porque llega primero','Depende del voltaje de cada carga'],c:1,e:'En serie hay un solo camino. La misma corriente pasa por todas las cargas. Lo que cambia es el voltaje.',a:'Un circuito en serie es como un r√≠o sin ramificaciones: toda el agua pasa por cada punto. 10A entran, 10A pasan por cada carga, 10A salen. Lo que se divide es el voltaje, no la corriente.'},
{cat:'üîó Circuitos en Serie',q:'Si una de tres luces en serie se quema:',o:['Las otras dos siguen brillando igual','Las otras dos brillan m√°s fuerte','Las tres se apagan ‚Äî el circuito se abre','Las otras dos brillan m√°s d√©bil'],c:2,e:'En serie, si una carga se abre, se rompe el √∫nico camino de corriente y TODAS se apagan.',a:'Luces de navidad viejas: se quema un foquito y se apagan TODOS. Eso es serie. Por eso ahora las hacen en paralelo ‚Äî se quema una y las dem√°s siguen.'},
{cat:'üîó Circuitos en Serie',q:'Un circuito en serie con una fuente de 120V y tres resistencias de 10Œ©, 20Œ© y 30Œ©. ¬øCu√°l tiene la mayor ca√≠da de voltaje?',o:['La de 10Œ© porque la corriente llega primero con m√°s fuerza','La de 20Œ© porque est√° en el medio','La de 30Œ© porque la resistencia m√°s grande consume m√°s voltaje','Las tres tienen la misma ca√≠da de voltaje'],c:2,e:'En serie, V = IR. La corriente es igual para todas: I = 120/60 = 2A. V30 = 2√ó30 = 60V (la mayor).',a:'Es como tres peajes en la carretera: el m√°s caro te quita m√°s dinero. La resistencia de 30Œ© se queda con 60V de los 120V disponibles. M√°s resistencia = m√°s ca√≠da de voltaje.'},
{cat:'üîó Circuitos en Serie',q:'Los safety switches (interruptores de seguridad) en HVAC est√°n conectados en SERIE porque:',o:['En serie usan menos cable y es m√°s econ√≥mico','Cualquier switch abierto interrumpe TODO el circuito de control','En serie cada switch controla una funci√≥n diferente','No est√°n en serie ‚Äî est√°n en paralelo'],c:1,e:'Los safeties en serie significan que SI CUALQUIERA detecta un problema, TODO el circuito de control se desconecta.',a:'Los safeties en serie son como los candados de una cadena: si uno se abre, la cadena se rompe. High pressure, low pressure, flow switch ‚Äî si CUALQUIERA detecta problema, el compresor se apaga. Eso es seguridad.'},

// ===== CIRCUITOS EN PARALELO (4) =====
{cat:'üîÄ Circuitos en Paralelo',q:'En un circuito en paralelo, el VOLTAJE en cada rama es:',o:['Diferente en cada rama ‚Äî se divide','Igual en todas las ramas ‚Äî comparten la misma fuente','Mayor en la rama con menos resistencia','Cero en las ramas sin carga'],c:1,e:'En paralelo, todas las ramas est√°n conectadas directamente a la fuente. El voltaje es IGUAL en cada rama.',a:'Las casas en tu calle est√°n en paralelo: todas reciben 120V de la compa√±√≠a el√©ctrica. Si tu vecino prende 10 focos, tu voltaje no baja. Todas las ramas ven el mismo voltaje.'},
{cat:'üîÄ Circuitos en Paralelo',q:'Al AGREGAR una carga m√°s en paralelo a un circuito, la corriente total:',o:['Disminuye porque hay m√°s resistencia','Aumenta ‚Äî cada rama adicional consume m√°s corriente de la fuente','No cambia porque el voltaje es constante','Se divide entre m√°s cargas y cada una recibe menos'],c:1,e:'M√°s ramas en paralelo = m√°s caminos para la corriente = m√°s corriente total de la fuente.',a:'Es como abrir m√°s llaves de agua en tu casa: cada llave jala agua de la calle. M√°s llaves abiertas = m√°s agua total consumida. M√°s cargas en paralelo = m√°s amperios totales.'},
{cat:'üîÄ Circuitos en Paralelo',q:'Dos resistencias de 100Œ© en paralelo dan una resistencia total de:',o:['200 ohms ‚Äî se suman como en serie','100 ohms ‚Äî quedan igual','50 ohms ‚Äî se divide entre dos','10,000 ohms ‚Äî se multiplican'],c:2,e:'Resistencias iguales en paralelo: RT = R/n = 100/2 = 50Œ©. Siempre es MENOR que la menor individual.',a:'Dos puertas abiertas dejan pasar m√°s gente que una sola. La resistencia total en paralelo SIEMPRE es menor que cualquier resistencia individual. Es el atajo: m√°s caminos = menos resistencia total.'},
{cat:'üîÄ Circuitos en Paralelo',q:'En un panel el√©ctrico residencial, los circuitos de la casa est√°n conectados en:',o:['Serie ‚Äî todos salen del mismo breaker principal','Paralelo ‚Äî cada circuito tiene su propio breaker','Mixto ‚Äî algunos en serie y otros en paralelo','Depende del dise√±o del electricista'],c:1,e:'Cada circuito de la casa est√° en paralelo con los dem√°s, con su propio breaker. Por eso apagar uno no apaga los dem√°s.',a:'Tu casa es como un centro comercial: cada tienda tiene su propia puerta (breaker). Si una tienda cierra, las dem√°s siguen abiertas. Eso es paralelo. Si fuera serie, apagar la cocina apagar√≠a toda la casa.'},

// ===== CIRCUITO MIXTO (3) =====
{cat:'üîÑ Circuito Mixto',q:'Un circuito mixto tiene dos resistencias en serie (R1=10Œ©, R2=20Œ©) seguidas de una resistencia en paralelo (R3=30Œ©) con R2. La resistencia total es:',o:['60 ohms ‚Äî suma de las tres','22 ohms ‚Äî R1 en serie con el paralelo de R2 y R3','10 ohms ‚Äî solo cuenta la primera','40 ohms ‚Äî promedio de las tres'],c:1,e:'Primero: R2||R3 = (20√ó30)/(20+30) = 600/50 = 12Œ©. Luego: RT = R1 + 12 = 10 + 12 = 22Œ©.',a:'Resuelve de adentro hacia afuera, como las matem√°ticas con par√©ntesis. Primero resuelves el paralelo: R2 y R3 = 12Œ©. Luego sumas lo que est√° en serie: 10 + 12 = 22Œ©.'},
{cat:'üîÑ Circuito Mixto',q:'En un circuito mixto, para encontrar la corriente total PRIMERO debes:',o:['Medir con la pinza amperim√©trica directamente','Calcular la resistencia total equivalente del circuito','Sumar todos los voltajes de cada componente','Dividir el voltaje entre el n√∫mero de componentes'],c:1,e:'Paso 1: Simplifica el circuito calculando RT. Paso 2: I = V/RT. Sin RT no puedes calcular nada.',a:'Es como armar un rompecabezas: primero necesitas la imagen completa (RT), luego puedes ver cada pieza. Simplifica el circuito primero, luego aplica Ohm.'},
{cat:'üîÑ Circuito Mixto',q:'Un circuito de control de HVAC t√≠picamente tiene los safeties en serie y las cargas de se√±alizaci√≥n en:',o:['Tambi√©n en serie ‚Äî todo debe estar en serie','Paralelo ‚Äî las luces indicadoras no deben afectar el circuito de control','Mixto pero al azar seg√∫n el instalador','En un circuito completamente separado sin relaci√≥n'],c:1,e:'Safeties en serie para que cualquiera pueda interrumpir. Indicadores en paralelo para que no afecten la operaci√≥n.',a:'Los safeties son como guardias en la puerta: si uno dice no, nadie pasa (serie). Las luces indicadoras son como c√°maras de seguridad: observan sin bloquear el paso (paralelo). Cada uno tiene su funci√≥n.'},

// ===== CONTACTORES (5) =====
{cat:'üì¶ Contactores',q:'Un contactor tiene terminales marcados L1, L2, T1, T2. Los cables de alimentaci√≥n van en:',o:['T1 y T2 ‚Äî porque T es de transformador (fuente)','L1 y L2 ‚Äî l√≠nea de alimentaci√≥n entra por L','No importa ‚Äî es reversible','L1 y T1 del mismo lado'],c:1,e:'L = Line (l√≠nea de entrada). T = Terminal/Load (carga/motor). La alimentaci√≥n SIEMPRE entra por L.',a:'L de L√≠nea = de donde viene la energ√≠a. T de Terminal = a donde va la energ√≠a. Es como la entrada y salida de una autopista: L es la entrada, T es la salida hacia el motor.'},
{cat:'üì¶ Contactores',q:'La bobina de un contactor de 24VAC mide 20 ohms de resistencia. Si le aplicas 240VAC por error:',o:['Funciona normal ‚Äî los contactores tienen protecci√≥n interna','La bobina se quemar√° por exceso de corriente','El contactor trabaja mejor con m√°s voltaje','Solo consume m√°s corriente pero no se da√±a'],c:1,e:'I = V/R = 240/20 = 12A. La bobina dise√±ada para 24V/20Œ© consume solo 1.2A. Con 240V consume 10 veces m√°s y se destruye.',a:'Es como meter 240V a un foco de 24V: explota instant√°neamente. La bobina de 24V espera 1.2A. Si le metes 240V consume 12A y se convierte en humo en segundos.'},
{cat:'üì¶ Contactores',q:'Los contactos de un contactor est√°n picados y quemados. La consecuencia M√ÅS peligrosa es:',o:['Mayor consumo de energ√≠a solamente','Ca√≠da de voltaje en los contactos que puede da√±ar el motor','El contactor hace m√°s ruido al cerrar','La bobina del contactor se sobrecalienta'],c:1,e:'Contactos quemados = mayor resistencia = ca√≠da de voltaje = motor recibe menos voltaje = se sobrecalienta y puede quemarse.',a:'Contactos picados son como un camino lleno de baches: el tr√°fico (corriente) pasa pero con dificultad. Esa dificultad es resistencia extra que roba voltaje al motor. Un motor con bajo voltaje se calienta y muere.'},
{cat:'üì¶ Contactores',q:'Un contactor zumba fuertemente cuando est√° energizado. La causa M√ÅS probable es:',o:['Es normal ‚Äî todos los contactores zumban','La bobina tiene un cortocircuito entre espiras','Las espiras de sombra (shading coils) est√°n rotas','El voltaje de la bobina es muy alto'],c:2,e:'Las shading coils suavizan la vibraci√≥n AC. Si se rompen, la armadura vibra a 120Hz causando zumbido excesivo.',a:'Las shading coils son como los amortiguadores de un carro: sin ellos, sientes cada bache. En AC, la magnetizaci√≥n sube y baja 120 veces por segundo. Sin shading coils, la armadura vibra y zumba como loca.'},
{cat:'üì¶ Contactores',q:'Para verificar si un contactor est√° cerrando correctamente, mides voltaje entre L1 y T1 con el contactor energizado. Si mides voltaje significativo:',o:['Es normal ‚Äî siempre hay voltaje entre L y T','Los contactos NO est√°n haciendo buen contacto ‚Äî hay resistencia','El motor est√° desconectado del lado T','La bobina no tiene suficiente voltaje'],c:1,e:'Con el contactor cerrado, L1 y T1 son el mismo punto. Si mides voltaje entre ellos, hay ca√≠da = contactos malos.',a:'Es como medir la temperatura del agua antes y despu√©s de un tubo: si hay diferencia, el tubo tiene una obstrucci√≥n. Con el contactor cerrado, L1 y T1 deber√≠an ser el mismo punto. Voltaje entre ellos = contactos resistivos.'},

// ===== CONTROLADORES EL√âCTRICOS HVAC (4) =====
{cat:'üéõÔ∏è Controles HVAC',q:'Un relay de retardo de tiempo (time delay relay) en un sistema de AC se usa para:',o:['Apagar el sistema si la temperatura es muy alta','Evitar que el compresor arranque inmediatamente despu√©s de apagarse','Controlar la velocidad del ventilador','Medir el consumo el√©ctrico del sistema'],c:1,e:'El time delay protege el compresor esperando 5 minutos antes de permitir re-arranque, dejando que las presiones se igualen.',a:'El compresor necesita descanso entre arranques, como un corredor entre sprints. Arrancarlo contra presi√≥n alta es como arrancar tu carro sin soltar el freno. El time delay le da 5 minutos para que las presiones se igualen.'},
{cat:'üéõÔ∏è Controles HVAC',q:'El transformer de un sistema HVAC convierte:',o:['240VAC a 24VDC para el termostato','240VAC a 24VAC para el circuito de control','24VAC a 240VAC para alimentar el compresor','120VDC a 24VDC para los sensores'],c:1,e:'El transformador baja 240VAC (o 120VAC) a 24VAC para alimentar el circuito de control (termostato, rel√©s, v√°lvulas).',a:'El transformer es como un traductor: convierte voltaje alto (240V) a voltaje bajo (24V) para que el termostato y los controles puedan hablar con seguridad. Sin √©l, el termostato necesitar√≠a manejar 240V peligrosos.'},
{cat:'üéõÔ∏è Controles HVAC',q:'En un diagrama de cableado HVAC, la letra "Y" t√≠picamente representa:',o:['El cable amarillo que va al ventilador','La se√±al de demanda de enfriamiento (compressor contactor)','La se√±al de respaldo (Y de Yield)','El sensor de temperatura del aire'],c:1,e:'Y = compressor/cooling contactor. R = power. W = heat. G = fan. O/B = reversing valve.',a:'Memoriza el c√≥digo de colores HVAC: R=Rojo=Power, Y=Amarillo=Cooling, W=Blanco=Heat, G=Verde=Fan. La Y activa el contactor del compresor cuando el termostato pide fr√≠o.'},
{cat:'üéõÔ∏è Controles HVAC',q:'Si el fusible del circuito de control de 24V se quema repetidamente, la causa M√ÅS probable es:',o:['El transformer es de mala calidad','Hay un cortocircuito en el circuito de 24V ‚Äî cable pelado o componente da√±ado','El termostato consume demasiada corriente','El fusible es de amperaje muy bajo para el sistema'],c:1,e:'Fusible de control que se quema repetidamente = cortocircuito en el circuito de 24V. Busca cables pelados, rozando metal.',a:'Un fusible que se quema es un s√≠ntoma, no la enfermedad. Es como un doctor que solo te da aspirina sin buscarte la causa de la fiebre. Busca el cable pelado, la bobina quemada, o el corto en el termostato.'},

// ===== MOTORES (6) =====
{cat:'‚öôÔ∏è Motores',q:'Un motor monof√°sico PSC (Permanent Split Capacitor) usa:',o:['Solo capacitor de arranque que se desconecta','Solo capacitor de marcha (run) que queda conectado permanentemente','Ambos: arranque y marcha','Ning√∫n capacitor ‚Äî usa polos sombreados'],c:1,e:'PSC = Permanent Split Capacitor. Solo usa capacitor de RUN permanentemente conectado. No tiene start cap ni relay.',a:'PSC es el motor m√°s simple con capacitor: un solo capacitor de marcha conectado siempre. No necesita relay ni switch centr√≠fugo porque el capacitor nunca se desconecta. Es como un carro autom√°tico ‚Äî simple y confiable.'},
{cat:'‚öôÔ∏è Motores',q:'La placa de datos de un motor dice FLA 12A y LRA 72A. LRA significa:',o:['Low Running Amperage ‚Äî la corriente m√≠nima de operaci√≥n','Locked Rotor Amperage ‚Äî corriente m√°xima al arrancar','Line Regulated Amperage ‚Äî la corriente con voltaje estable','Load Rated Amperage ‚Äî la capacidad m√°xima continua'],c:1,e:'LRA = Locked Rotor Amps. Es la corriente m√°xima al arrancar cuando el rotor a√∫n no gira. Puede ser 5-7x el FLA.',a:'Cuando arrancas un motor es como empujar un carro estacionado: necesitas MUCHA fuerza al principio. LRA es esa fuerza m√°xima inicial. Una vez que el motor gira, baja a FLA ‚Äî como cuando el carro ya se mueve solo.'},
{cat:'‚öôÔ∏è Motores',q:'Un motor de 5HP trif√°sico tiene FLA de 15A por fase. El breaker seg√∫n NEC 430.52 debe ser m√°ximo:',o:['15A ‚Äî exacto al FLA','20A ‚Äî 125% del FLA como dice NEC 210.20','40A ‚Äî 250% del FLA para arranque','60A ‚Äî 400% del FLA para motores trif√°sicos'],c:2,e:'NEC 430.52 permite breaker de hasta 250% del FLA para motores con protecci√≥n est√°ndar. 15 √ó 2.5 = 37.5, sube al siguiente est√°ndar = 40A.',a:'Los motores necesitan breakers m√°s grandes que su FLA por la corriente de arranque (LRA). Si pones un breaker de 15A, se dispara cada vez que arranca. 250% del FLA da espacio para el arranque sin dejar el cable desprotegido.'},
{cat:'‚öôÔ∏è Motores',q:'Un motor trif√°sico funciona pero una de las tres fases se cae (single phasing). ¬øQu√© le pasa al motor?',o:['Se detiene inmediatamente y el breaker se dispara','Sigue funcionando pero consume M√ÅS corriente en las dos fases restantes y se sobrecalienta','Funciona normal con dos fases ‚Äî la tercera es de respaldo','Se invierte la rotaci√≥n autom√°ticamente'],c:1,e:'Single phasing es peligroso: el motor sigue pero las fases restantes cargan la corriente extra, sobrecalent√°ndose r√°pidamente.',a:'Es como un equipo de tres personas cargando un piano: si una se cae, las otras dos cargan el peso extra. No se caen inmediatamente, pero se cansan MUCHO m√°s r√°pido. El motor se quema si no lo proteges.'},
{cat:'‚öôÔ∏è Motores',q:'Un motor ECM (Electronically Commutated Motor) es m√°s eficiente porque:',o:['Usa corriente directa DC y controla la velocidad electr√≥nicamente','Es m√°s grande y tiene m√°s cobre','Opera a velocidad fija optimizada de f√°brica','No usa capacitores y eso reduce p√©rdidas'],c:0,e:'ECM convierte AC a DC internamente y usa electr√≥nica para controlar velocidad, alcanzando eficiencias sobre 80%.',a:'Un ECM es como un carro h√≠brido: usa tecnolog√≠a inteligente para ser m√°s eficiente. En vez de desperdiciar energ√≠a como un motor PSC (que es como un carro viejo), el ECM ajusta su velocidad exactamente a lo que necesita.'},
{cat:'‚öôÔ∏è Motores',q:'Las tres terminales de un compresor herm√©tico monof√°sico se identifican como C, S y R. La resistencia MAYOR se mide entre:',o:['C y R ‚Äî Common a Run','C y S ‚Äî Common a Start','S y R ‚Äî Start a Run','Todas las mediciones deben ser iguales'],c:2,e:'S a R = mayor resistencia (es la suma de los dos devanados en serie). C a S > C a R. Run = menor resistencia.',a:'C es el punto medio (Common). S es Start, R es Run. De S a R pasas por ambos devanados sumados = mayor resistencia. Es como ir de tu casa al trabajo por el camino largo: pasas por ambos barrios.'},

// ===== ARRANCADORES (4) =====
{cat:'üöÄ Arrancadores',q:'Un arrancador magn√©tico se diferencia de un contactor porque incluye:',o:['Una bobina m√°s grande para mayor magnetismo','Protecci√≥n de sobrecarga (overload relay) integrada','Un capacitor de arranque interno','Protecci√≥n de bajo voltaje autom√°tica'],c:1,e:'Arrancador = Contactor + Overload relay. El contactor solo cierra contactos; el arrancador adem√°s protege contra sobrecarga.',a:'Un contactor es como un switch gigante. Un arrancador es ese switch gigante CON guardia de seguridad (overload). El guardia vigila que el motor no se sobrecargue y lo desconecta si consume demasiada corriente.'},
{cat:'üöÄ Arrancadores',q:'Un arrancador estrella-delta (star-delta) se usa para:',o:['Invertir la rotaci√≥n del motor','Reducir la corriente de arranque conectando primero en estrella y luego en delta','Aumentar la velocidad del motor gradualmente','Proteger contra ca√≠da de voltaje en el arranque'],c:1,e:'En estrella, el motor ve voltaje/‚àö3 = menos corriente de arranque. Al alcanzar velocidad, cambia a delta para potencia total.',a:'Estrella-delta es como arrancar un carro en primera velocidad: arrancas suave (estrella = menos voltaje), y cuando agarras velocidad, cambias a segunda (delta = potencia completa). Reduces el jal√≥n inicial.'},
{cat:'üöÄ Arrancadores',q:'El overload relay de un arrancador se dispar√≥. Para resetear PRIMERO debes:',o:['Presionar el bot√≥n de reset inmediatamente','Investigar POR QU√â se dispar√≥ antes de resetear','Reemplazar el elemento t√©rmico del overload','Subir el ajuste del overload al siguiente nivel'],c:1,e:'Un overload que dispara tiene una raz√≥n. Resetearlo sin investigar puede causar da√±o permanente al motor.',a:'El overload es como el m√©dico que te dice "algo anda mal". Si ignoras al doctor y sigues trabajando, te pones peor. Investiga la causa: motor trabado, rodamiento da√±ado, baja tensi√≥n, sobrecarga mec√°nica.'},
{cat:'üöÄ Arrancadores',q:'Un soft starter electr√≥nico reduce la corriente de arranque:',o:['Bajando la frecuencia gradualmente','Reduciendo el voltaje gradualmente con SCRs/tiristores','Conectando resistencias en serie temporalmente','Desconectando una fase durante el arranque'],c:1,e:'El soft starter usa SCRs para incrementar gradualmente el voltaje al motor, limitando la corriente de arranque.',a:'Un soft starter es como un dimmer de luz para el motor: empieza bajito y va subiendo gradualmente hasta potencia total. Eso evita el golpe de arranque que estresa cables, contactos y el motor mismo.'},

// ===== VFD (4) =====
{cat:'üéöÔ∏è VFD',q:'Un VFD (Variable Frequency Drive) controla la velocidad del motor cambiando:',o:['Solo el voltaje ‚Äî la frecuencia se mantiene fija','Solo la frecuencia ‚Äî el voltaje se mantiene fijo','Voltaje Y frecuencia proporcionalmente','La resistencia del circuito del motor'],c:2,e:'VFD cambia V y f juntos manteniendo la relaci√≥n V/f constante para mantener el torque del motor.',a:'V/f es como las marchas de una bicicleta: cambias pi√±√≥n Y pedales juntos. Si solo cambias uno, pierdes fuerza o control. El VFD mantiene esa relaci√≥n para que el motor tenga buena fuerza a cualquier velocidad.'},
{cat:'üéöÔ∏è VFD',q:'Un VFD NUNCA debe alimentar a un motor monof√°sico est√°ndar porque:',o:['La frecuencia variable da√±a los capacitores del motor monof√°sico','El motor monof√°sico no puede usar la salida trif√°sica del VFD correctamente','El VFD no puede generar suficiente potencia para un motor monof√°sico','Los motores monof√°sicos no tienen rodamientos para velocidad variable'],c:1,e:'VFDs producen salida trif√°sica. Un motor monof√°sico no puede convertir esa se√±al trif√°sica en rotaci√≥n adecuada.',a:'Es como tratar de escuchar una estaci√≥n de FM en un radio de AM: la se√±al est√° ah√≠ pero el radio no la puede procesar. El motor monof√°sico necesita se√±al monof√°sica, no la trif√°sica que produce el VFD.'},
{cat:'üéöÔ∏è VFD',q:'Al instalar un VFD, es CR√çTICO usar cable blindado (shielded) al motor porque:',o:['El cable blindado es m√°s grueso y aguanta m√°s corriente','El VFD genera arm√≥nicos y ruido el√©ctrico que interfiere con otros equipos','El blindaje protege contra sobrevoltaje del VFD','Es requerimiento est√©tico del fabricante'],c:1,e:'La onda PWM del VFD crea interferencia electromagn√©tica (EMI) que puede afectar controles, radios y equipos cercanos.',a:'La salida del VFD no es una onda limpia como la de la compa√±√≠a el√©ctrica ‚Äî es una onda cortada que genera "ruido" el√©ctrico. El cable blindado es como los aud√≠fonos con cancelaci√≥n de ruido: contiene ese ruido para que no moleste a los dem√°s.'},
{cat:'üéöÔ∏è VFD',q:'Si un VFD muestra error de "ground fault" o "falla a tierra", ¬øcu√°l es la acci√≥n correcta?',o:['Resetear el error y reiniciar ‚Äî probablemente fue una falsa alarma','Revisar el aislamiento del motor y cables con un meg√≥hmetro','Subir el par√°metro de sensibilidad de tierra en el VFD','Desconectar la tierra del motor para eliminar el error'],c:1,e:'Falla a tierra = corriente escapando del motor o cables. Hay que probar aislamiento con meg√≥hmetro ANTES de re-energizar.',a:'Un error de tierra es como una fuga de agua: no la ignoras, no subes el termostato del calentador para compensar, y definitivamente no cierras el detector de fugas. Buscas D√ìNDE se est√° escapando la corriente.'},

// ===== TOMACORRIENTES / ILUMINACI√ìN (4) =====
{cat:'üí° Tomacorrientes',q:'Un tomacorriente NEMA 5-15R tiene tres ranuras. La ranura m√°s larga es:',o:['La l√≠nea caliente (hot) para mayor contacto','El neutro ‚Äî es m√°s grande por seguridad','La tierra ‚Äî para hacer mejor conexi√≥n','La fase B en circuitos de 240V'],c:1,e:'La ranura larga es el neutro, la corta es el hot, y la redonda es tierra. Dise√±ado as√≠ para que los enchufes polarizados solo entren de una manera.',a:'Ranura larga = neutro, ranura corta = hot, hoyo redondo = tierra. La ranura larga es como la puerta grande del garaje: est√° dise√±ada as√≠ para que no metas el carro (enchufe) al rev√©s.'},
{cat:'üí° Tomacorrientes',q:'Un circuito de iluminaci√≥n tiene 10 focos de 100W cada uno a 120V. La corriente total del circuito es:',o:['1,000A ‚Äî 10 focos √ó 100A','8.33A ‚Äî 1000W √∑ 120V','12A ‚Äî se necesita factor de seguridad','100A ‚Äî cada foco consume 100A'],c:1,e:'Potencia total = 10 √ó 100 = 1000W. I = P/V = 1000/120 = 8.33A.',a:'Watts totales dividido voltaje = amperios. 10 focos de 100W = 1000W totales. 1000 √∑ 120 = 8.33A. Este circuito cabe en un breaker de 15A. Pero recuerda el 80% continuo: 15 √ó 0.8 = 12A m√°ximo continuo.'},
{cat:'üí° Tomacorrientes',q:'Seg√∫n NEC, el n√∫mero M√ÅXIMO de tomacorrientes en un circuito residencial de 15A es:',o:['Exactamente 8 ‚Äî no m√°s no menos','No hay un n√∫mero m√°ximo espec√≠fico en el NEC residencial','M√°ximo 10 tomacorrientes por circuito','Depende del calibre del cable solamente'],c:1,e:'El NEC residencial no especifica un m√°ximo de tomacorrientes por circuito. Es la carga conectada la que determina si el circuito est√° sobrecargado.',a:'Sorpresa: el NEC no dice cu√°ntos tomacorrientes puedes poner en un circuito de casa. Pero el sentido com√∫n y las reglas de carga dicen que no abuses. En comercial S√ç hay reglas espec√≠ficas: 180VA por tomacorriente.'},
{cat:'üí° Tomacorrientes',q:'Un lumen mide:',o:['La potencia el√©ctrica consumida por un foco','La cantidad de luz visible producida por una fuente','La temperatura del color de la luz','La vida √∫til del foco en horas'],c:1,e:'Lumen = cantidad de luz visible. Watts = energ√≠a consumida. Lumen/watt = eficiencia lum√≠nica.',a:'Antes comprabas focos por watts (60W, 100W). Ahora con LED, los watts no te dicen qu√© tan brillante es. 800 l√∫menes = equivalente a un foco viejo de 60W. L√∫menes miden LUZ, watts miden CONSUMO.'},

// ===== CA√çDA DE VOLTAJE / DESBALANCE (5) =====
{cat:'üìâ Ca√≠da de Voltaje',q:'La f√≥rmula para calcular ca√≠da de voltaje en un circuito monof√°sico es:',o:['Vd = IR (ley de Ohm simple)','Vd = 2 √ó K √ó I √ó D / CM (ida y vuelta del conductor)','Vd = V √ó I √ó cosœÜ','Vd = P / I (potencia sobre corriente)'],c:1,e:'Vd = 2KILD/CM donde K=resistividad, I=corriente, D=distancia, CM=circular mils. El 2 es porque la corriente va y regresa.',a:'La corriente viaja por DOS cables: va por el hot y regresa por el neutro. Por eso el 2 en la f√≥rmula: la distancia real que recorre la electricidad es el DOBLE de la distancia del panel al equipo.'},
{cat:'üìâ Ca√≠da de Voltaje',q:'Un compresor de 240V muestra 218V en sus terminales. El porcentaje de ca√≠da de voltaje es:',o:['9.2% ‚Äî esto es EXCESIVO y causar√° problemas','22V de ca√≠da ‚Äî necesitas medir en porcentaje','218% ‚Äî el voltaje es casi normal','Imposible calcular sin conocer la resistencia'],c:0,e:'Ca√≠da = (240-218)/240 √ó 100 = 9.17%. M√°s del 5% total es excesivo seg√∫n NEC.',a:'Si te prometen 240V y solo llegan 218V, perdiste 22V en el camino. Eso es 9.2% de p√©rdida. El NEC dice m√°ximo 5%. Tu compresor est√° recibiendo voltaje bajo y puede sobrecalentarse y quemarse.'},
{cat:'üìâ Ca√≠da de Voltaje',q:'El desbalance de voltaje en un sistema trif√°sico se calcula como:',o:['El voltaje m√°s alto menos el m√°s bajo, dividido entre tres','La mayor desviaci√≥n del promedio, dividida entre el promedio, multiplicada por 100','La suma de los tres voltajes dividida entre tres','El voltaje entre la fase m√°s alta y tierra'],c:1,e:'%Desbalance = (Mayor desviaci√≥n del promedio / Voltaje promedio) √ó 100. M√°ximo aceptable: 2% seg√∫n NEMA.',a:'Es como una mesa con tres patas: si una es m√°s corta, la mesa cojea. Mides las tres patas, sacas el promedio, y ves cu√°nto se desv√≠a la peor. M√°s de 2% de diferencia y el motor sufre.'},
{cat:'üìâ Ca√≠da de Voltaje',q:'Un desbalance de voltaje del 3% en un motor trif√°sico causa un desbalance de corriente de aproximadamente:',o:['3% ‚Äî igual que el voltaje','6-9% ‚Äî el desbalance de corriente es 2-3 veces el de voltaje','18-27% ‚Äî se multiplica por 6-9 veces','0% ‚Äî la corriente se auto-balancea'],c:2,e:'El desbalance de corriente es 6-10 veces el desbalance de voltaje. 3% voltaje = 18-30% corriente. ¬°Extremadamente peligroso!',a:'Un peque√±o desbalance de voltaje causa un ENORME desbalance de corriente. Es como un columpio: un empujoncito chueco al inicio se amplifica mucho al final. 3% de voltaje puede causar 27% de corriente desbalanceada. El motor se quema r√°pido.'},
{cat:'üìâ Ca√≠da de Voltaje',q:'Para REDUCIR la ca√≠da de voltaje en un circuito largo, la soluci√≥n m√°s efectiva es:',o:['Aumentar el voltaje de la fuente','Usar un conductor de mayor calibre (m√°s grueso)','Reducir el n√∫mero de cargas en el circuito','Agregar un capacitor al final del circuito'],c:1,e:'Cable m√°s grueso = menor resistencia = menor ca√≠da. Es la soluci√≥n m√°s pr√°ctica y efectiva.',a:'Un cable delgado para una distancia larga es como una pajita para tomar refresco: mucha distancia y poco di√°metro = poca presi√≥n al final. Un cable m√°s gordo es como una manguera: la presi√≥n (voltaje) llega mejor.'},

// ===== NEC C√ìDIGO (5) =====
{cat:'üìñ NEC C√≥digo',q:'El NEC (National Electrical Code) se actualiza cada:',o:['5 a√±os ‚Äî siguiendo el ciclo de construcci√≥n','3 a√±os ‚Äî la NFPA lo revisa cada ciclo trienal','10 a√±os ‚Äî los c√≥digos el√©ctricos cambian poco','Anualmente ‚Äî por la rapidez de cambios tecnol√≥gicos'],c:1,e:'El NEC se actualiza cada 3 a√±os por la NFPA. La edici√≥n actual es NEC 2023 (publicada 2022).',a:'Cada 3 a√±os sale un NEC nuevo con reglas actualizadas: 2014, 2017, 2020, 2023. Es como los iPhones pero para electricistas. Cada versi√≥n agrega m√°s protecciones y requisitos. Tu jurisdicci√≥n puede adoptar versiones anteriores.'},
{cat:'üìñ NEC C√≥digo',q:'Seg√∫n NEC 210.52, en √°reas de cocina, los tomacorrientes deben estar a no m√°s de:',o:['6 pies de distancia entre cada uno','4 pies de distancia a lo largo del counter','2 pies del borde del fregadero','8 pies de distancia m√°xima'],c:1,e:'NEC 210.52(C) requiere que ning√∫n punto del counter est√© a m√°s de 24 pulgadas (2 pies) de un tomacorriente, lo que equivale a m√°ximo 4 pies entre tomacorrientes.',a:'La regla es que no tengas que usar extensi√≥n en la cocina: cada 4 pies de counter necesita un tomacorriente. Imagina que cada aparato de cocina tiene cable de 2 pies ‚Äî necesitas un enchufe a esa distancia m√°xima.'},
{cat:'üìñ NEC C√≥digo',q:'NEC Art√≠culo 250 cubre:',o:['Protecci√≥n contra sobrecorriente','Puesta a tierra y uniones (grounding and bonding)','Instalaci√≥n de conductos y canalizaciones','Requisitos para motores y sus circuitos'],c:1,e:'NEC 250 es el art√≠culo dedicado a grounding y bonding. Es uno de los m√°s extensos e importantes del c√≥digo.',a:'El Art√≠culo 250 es la biblia de la tierra: c√≥mo conectar todo al planeta para que si algo falla, la corriente tenga un camino seguro. Grounding protege a las personas, bonding conecta todo el metal junto.'},
{cat:'üìñ NEC C√≥digo',q:'Un circuito de 20A seg√∫n NEC 210.3 requiere conductor m√≠nimo de:',o:['#14 AWG ‚Äî el est√°ndar para circuitos de rama','#12 AWG ‚Äî NEC 210.3 requiere conductor adecuado para la protecci√≥n','#10 AWG ‚Äî por seguridad en circuitos de 20A','#8 AWG ‚Äî para cumplir con la ca√≠da de voltaje'],c:1,e:'NEC 240.4(D): Circuito de 20A = m√≠nimo #12 AWG. Circuito de 15A = m√≠nimo #14 AWG. Circuito de 30A = m√≠nimo #10 AWG.',a:'Cada breaker tiene su cable m√≠nimo: 15A=#14, 20A=#12, 30A=#10. Es como zapatos y pies: si usas zapatos chicos para un pie grande, te aprieta y te lastima. El cable debe ser del tama√±o correcto para la corriente.'},
{cat:'üìñ NEC C√≥digo',q:'Seg√∫n NEC 310.15(B)(3)(a), cuando tienes m√°s de 3 conductores portando corriente en un mismo conduit, debes:',o:['No hay ajuste necesario ‚Äî el conduit protege los cables','Aplicar factor de reducci√≥n de amperaje (derating) a los conductores','Solo agregar un conductor de tierra extra','Cambiar a un conduit de mayor tama√±o solamente'],c:1,e:'Con 4-6 conductores: 80% de capacidad. 7-9: 70%. 10-20: 50%. El calor se acumula y los cables deben reducir su carga.',a:'Imagina un autob√∫s lleno: entre m√°s gente, m√°s calor genera cada persona. Los cables en un tubo son igual: m√°s cables = m√°s calor = cada cable puede llevar MENOS corriente. El NEC te dice cu√°nto reducir.'}
];


let quizData=[];
let quizIdx=0;
let quizRight=0;
let quizWrong=0;
let quizAnswered=false;
let quizAnswers=[];

function shuffleArray(arr){
    const a=[...arr];
    for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
    return a;
}

function startQuiz(id){
    const qId=id||currentQuizId||'principiante';
    currentQuizId=qId;
    if(qId==='electricidad')quizData=shuffleArray(QUIZ_ELECTRICIDAD);
    else quizData=shuffleArray(QUIZ_PRINCIPIANTE);
    quizIdx=0;quizRight=0;quizWrong=0;quizStreak=0;
    quizAnswers=new Array(quizData.length).fill(-1);
    document.getElementById('qRight').textContent='0';
    document.getElementById('qWrong').textContent='0';
    go('s8');
    showQuestion();
}

function retryQuiz(){
    startQuiz(currentQuizId);
    const q=QUIZ_LIST.find(x=>x.id===currentQuizId);
    speakText(D.lang==='es'?'¬°Otra vez '+q.title+'! Vamos con todo.':'Let\'s try '+q.title+' again!');
}

function showQuestion(){
    if(quizIdx>=quizData.length){showResult();return;}
    const q=quizData[quizIdx];
    const alreadyAnswered=quizAnswers[quizIdx]>=0;
    quizAnswered=alreadyAnswered;
    const pct=Math.round((quizIdx/quizData.length)*100);
    document.getElementById('qBar').style.width=pct+'%';
    document.getElementById('qNum').textContent=(D.lang==='es'?'Pregunta ':'Question ')+(quizIdx+1)+' / '+quizData.length;
    document.getElementById('qCat').textContent=q.cat;
    
    // Back button
    const prevBtn=document.getElementById('qPrev');
    if(quizIdx>0){prevBtn.classList.add('show');}else{prevBtn.classList.remove('show');}
    
    if(alreadyAnswered){
        // Revisiting a question already answered
        const userAnswer=quizAnswers[quizIdx];
        const correct=userAnswer===q.c;
        document.getElementById('qBubble').textContent=correct?(D.lang==='es'?'‚úÖ Ya contestaste bien esta pregunta.':'‚úÖ You already got this right.'):(D.lang==='es'?'‚ùå Aqu√≠ fallaste. La correcta es la '+['A','B','C','D'][q.c]+'.':'‚ùå You missed this one. Correct: '+['A','B','C','D'][q.c]+'.');
        document.getElementById('qText').textContent=q.q;
        const letters=['A','B','C','D'];
        document.getElementById('qOpts').innerHTML=q.o.map((o,i)=>{
            let cls='quiz-opt disabled';
            if(i===q.c)cls+=' correct';
            if(i===userAnswer&&!correct)cls+=' wrong';
            return '<div class="'+cls+'"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>';
        }).join('');
        document.getElementById('qExplain').innerHTML=correct?('<b>'+(D.lang==='es'?'Explicaci√≥n:':'Explanation:')+'</b> '+q.e):('<b style="color:#ff6b2b">'+(D.lang==='es'?'üìñ Con peras y manzanas:':'üìñ Simply put:')+'</b><br>'+q.a+'<br><br><b>'+(D.lang==='es'?'T√©cnico:':'Technical:')+'</b> '+q.e);
        document.getElementById('qExplain').classList.add('show');
        const nextBtn=document.getElementById('qNext');
        nextBtn.textContent=(quizIdx<quizData.length-1)?(D.lang==='es'?'Siguiente ‚Üí':'Next ‚Üí'):(D.lang==='es'?'Ver Resultado üèÜ':'See Result üèÜ');
        nextBtn.classList.add('show');
    }else{
        // New unanswered question
        document.getElementById('qBubble').textContent=quizIdx===0?(D.lang==='es'?'¬°Dale, t√∫ puedes!':'You got this!'):(D.lang==='es'?'¬øQu√© piensas, '+D.name+'?':'What do you think, '+D.name+'?');
        document.getElementById('qText').textContent=q.q;
        document.getElementById('qExplain').classList.remove('show');
        document.getElementById('qNext').classList.remove('show');
        const letters=['A','B','C','D'];
        document.getElementById('qOpts').innerHTML=q.o.map((o,i)=>'<div class="quiz-opt" onclick="answerQuiz('+i+',this)"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>').join('');
    }
    window.scrollTo(0,0);
}

let quizStreak=0;

const CHEERS_ES=[
    ['¬°Correcto!','¬°Bien hecho!','¬°As√≠ se hace!','¬°Muy bien, '+'{name}'+'!','¬°Buena elecci√≥n!'],
    ['¬°Divino!','¬°Perfecto!','¬°Excelente!','¬°Maravilloso!','¬°√ìrale, '+'{name}'+'!'],
    ['¬°Espectacular!','¬°Eres crack!','¬°Incre√≠ble, '+'{name}'+'!','¬°Qu√© m√°quina!'],
    ['üî• ¬°IMPARABLE! üî•','‚ö° ¬°NO TE PARA NADIE! ‚ö°','üí™ ¬°ERES UNA BESTIA! üí™','üèÜ ¬°VAS CON TODO! üèÜ']
];
const CHEERS_EN=[
    ['Correct!','Well done!','Nice job!','Good pick, '+'{name}'+'!','That\'s right!'],
    ['Perfect!','Excellent!','Brilliant!','Amazing!','Great work, '+'{name}'+'!'],
    ['Spectacular!','You\'re on fire!','Incredible, '+'{name}'+'!','Crushing it!'],
    ['üî• UNSTOPPABLE! üî•','‚ö° NOBODY STOPS YOU! ‚ö°','üí™ YOU\'RE A BEAST! üí™','üèÜ ALL THE WAY! üèÜ']
];
const MISS_ES=[
    '¬°No te preocupes, {name}! Todos fallamos al principio. As√≠ se aprende, ech√°ndole ganas.',
    '¬°Ey {name}, tranquilo! Los mejores t√©cnicos tambi√©n empezaron equivoc√°ndose. ¬°T√∫ puedes!',
    '¬°{name}, ya eres ganador solo por intentarlo! No te desanimes, vamos campe√≥n.',
    '¬°√ìrale {name}, casi le atinas! Eres una estrella en entrenamiento. Mira la explicaci√≥n.',
    '¬°{name}, no pasa nada! Hasta Mario se equivocaba al principio. Lo importante es aprender.',
    '¬°√Ånimo {name}! Cada error te acerca m√°s a ser un crack del HVAC. ¬°T√∫ puedes con esto!',
    '¬°Hey {name}! Esta estaba dif√≠cil. Pero t√∫ eres ching√≥n, vas a dominar este tema.',
    '¬°{name}, respira! Los grandes se hacen a base de pr√°ctica. Mira la explicaci√≥n y vas a ver qu√© f√°cil es.'
];
const MISS_EN=[
    'Don\'t worry {name}! Everyone struggles at first. That\'s how you learn!',
    'Hey {name}, take it easy! The best techs started by making mistakes too. You got this!',
    '{name}, you\'re already a winner just for trying! Don\'t give up, champ.',
    'Almost {name}! You\'re a star in training. Check out the explanation.',
    '{name}, no big deal! Even Mario made mistakes starting out. What matters is learning.',
    'Keep going {name}! Every mistake brings you closer to being an HVAC pro!',
    'Hey {name}! That was a tough one. But you\'re awesome, you\'ll master this.',
    '{name}, take a breath! Greatness comes from practice. Check the explanation and you\'ll get it.'
];

function pickCheer(streak){
    const cheers=D.lang==='es'?CHEERS_ES:CHEERS_EN;
    let tier=0;
    if(streak>=8)tier=3;
    else if(streak>=5)tier=2;
    else if(streak>=3)tier=1;
    const list=cheers[tier];
    return list[Math.floor(Math.random()*list.length)].replace('{name}',D.name);
}

function pickMiss(){
    const list=D.lang==='es'?MISS_ES:MISS_EN;
    const msg=list[Math.floor(Math.random()*list.length)].replace(/\{name\}/g,D.name);
    const letter=' '+(D.lang==='es'?'La correcta es la ':'Correct answer is ')+['A','B','C','D'][quizData[quizIdx].c]+'.';
    return msg+letter;
}

function celebrate(streak){
    const el=document.getElementById('s8');
    // Vibrate phone
    if(navigator.vibrate){
        if(streak>=5)navigator.vibrate([100,50,100,50,200]);
        else navigator.vibrate(80);
    }
    // Screen shake
    if(streak>=5){
        el.classList.add('big-shake');
        setTimeout(()=>el.classList.remove('big-shake'),600);
    }else if(streak>=2){
        el.classList.add('shake');
        setTimeout(()=>el.classList.remove('shake'),400);
    }
    // Lightning flash at 5+ streak
    if(streak>=5){
        const flash=document.createElement('div');
        flash.className='lightning-flash';
        document.body.appendChild(flash);
        setTimeout(()=>flash.remove(),400);
    }
    // Fire emojis at 3+ streak (reduced for performance)
    if(streak>=3){
        const emojis=streak>=8?['üî•','‚ö°','üí•','üåü']:streak>=5?['üî•','‚ö°','üí•']:['üî•','‚ú®'];
        const count=streak>=8?6:streak>=5?4:2;
        for(let i=0;i<count;i++){
            setTimeout(()=>{
                const fire=document.createElement('div');
                fire.className='fire-emoji';
                fire.textContent=emojis[Math.floor(Math.random()*emojis.length)];
                fire.style.left=Math.random()*80+10+'%';
                fire.style.bottom='10%';
                document.body.appendChild(fire);
                setTimeout(()=>fire.remove(),1200);
            },i*150);
        }
    }
    // Streak badge at 5+ 
    if(streak>=5){
        const badge=document.createElement('div');
        badge.className='streak-badge';
        badge.textContent=streak>=10?'üèÜ '+streak+'x COMBO! üèÜ':streak>=8?'‚ö° '+streak+'x RACHA! ‚ö°':'üî• '+streak+'x STREAK! üî•';
        document.body.appendChild(badge);
        setTimeout(()=>badge.remove(),1500);
    }
    // Confetti at 5+
    if(streak>=5)cft();
}

function answerQuiz(idx,el){
    if(quizAnswered)return;
    quizAnswered=true;
    quizAnswers[quizIdx]=idx;
    const q=quizData[quizIdx];
    const correct=idx===q.c;
    const opts=document.querySelectorAll('.quiz-opt');
    
    opts.forEach((o,i)=>{
        if(i===q.c)o.classList.add('correct');
        if(i===idx&&!correct)o.classList.add('wrong');
        if(i!==q.c&&i!==idx)o.classList.add('disabled');
    });
    
    if(correct){
        quizRight++;
        quizStreak++;
        if(quizStreak>bestStreak)bestStreak=quizStreak;
        document.getElementById('qRight').textContent=quizRight;
        const cheer=pickCheer(quizStreak);
        document.getElementById('qBubble').textContent=cheer;
        celebrate(quizStreak);
        document.getElementById('qExplain').innerHTML='<b>'+(D.lang==='es'?'Explicaci√≥n:':'Explanation:')+'</b> '+q.e;
        speakText(cheer+' '+q.e);
        // Track correct in study tracker (reduce fail count)
        trackAnswer(q,true);
    }else{
        quizWrong++;
        quizStreak=0;
        document.getElementById('qWrong').textContent=quizWrong;
        const motivation=pickMiss();
        const bubble=document.getElementById('qBubble');
        bubble.textContent=motivation;
        // After 4 seconds, update bubble with the simple analogy
        setTimeout(()=>{
            bubble.innerHTML='<span style="color:#ff6b2b">üìñ</span> '+q.a;
        },4000);
        // Show deep explanation with analogy
        let explain='<b style="color:#ff6b2b">'+(D.lang==='es'?'üìñ Te lo explico con peras y manzanas:':'üìñ Let me break it down simply:')+'</b><br>'+q.a+'<br><br><b>'+(D.lang==='es'?'Explicaci√≥n t√©cnica:':'Technical explanation:')+'</b> '+q.e;
        document.getElementById('qExplain').innerHTML=explain;
        // Mario speaks EVERYTHING: motivation + analogy + technical explanation
        speakText(motivation+' '+(D.lang==='es'?'Te lo explico f√°cil: ':'Let me explain simply: ')+q.a+' '+(D.lang==='es'?'En t√©rminos t√©cnicos: ':'Technically speaking: ')+q.e);
        // Track wrong in study tracker
        trackAnswer(q,false);
    }
    
    document.getElementById('qExplain').classList.add('show');
    document.getElementById('qNext').textContent=(quizIdx<quizData.length-1)?(D.lang==='es'?'Siguiente ‚Üí':'Next ‚Üí'):(D.lang==='es'?'Ver Resultado üèÜ':'See Result üèÜ');
    document.getElementById('qNext').classList.add('show');
}

function nextQuestion(){
    stopSpeech();
    quizIdx++;
    showQuestion();
}

function prevQuestion(){
    stopSpeech();
    if(quizIdx>0){quizIdx--;showQuestion();}
}

function showResult(){
    go('s9');
    const pct=Math.round((quizRight/quizData.length)*100);
    document.getElementById('rScore').textContent=pct+'%';
    document.getElementById('rLabel').textContent=quizRight+' / '+quizData.length+(D.lang==='es'?' correctas':' correct');
    
    // Award XP: 10 per correct, bonus for streaks
    const xpEarned=quizRight*10+(bestStreak>=10?50:bestStreak>=5?25:0);
    profile.xp+=xpEarned;
    profile.totalCorrect+=quizRight;
    profile.totalAnswered+=quizData.length;
    profile.quizzesTaken++;
    if(bestStreak>profile.bestStreak)profile.bestStreak=bestStreak;
    
    // Level up check
    while(profile.xp>=profile.xpNeeded){
        profile.xp-=profile.xpNeeded;
        profile.level++;
        profile.xpNeeded=Math.floor(profile.xpNeeded*1.4);
    }
    
    let medal,msg,stars;
    const medalEarned=document.getElementById('rMedalEarned');
    medalEarned.style.display='none';
    
    if(pct===100){
        medal='üèÜ';stars=5;
        msg=D.lang==='es'?'¬°¬°PERFECTO, '+D.name+'!! 100% sin fallar. ¬°Eres leyenda! Te ganaste tu medalla de Bronce ü•â':'PERFECT, '+D.name+'!! 100% flawless. You earned your Bronze Medal ü•â';
        if(!profile.medals.includes('bronze_principiante')){
            profile.medals.push('bronze_principiante');
            medalEarned.style.display='block';
            document.getElementById('rNewMedal').textContent='ü•â';
            document.getElementById('rMedalName').textContent=D.lang==='es'?'¬°MEDALLA DE BRONCE DESBLOQUEADA!\nPrincipiante Perfecto':'BRONZE MEDAL UNLOCKED!\nPerfect Beginner';
        }
    }else if(pct>=90){
        medal='üèÜ';stars=5;
        msg=D.lang==='es'?'¬°Incre√≠ble, '+D.name+'! Casi perfecto. El Maestro Mario est√° orgulloso. ¬°Intenta el 100% para tu medalla!':'Incredible, '+D.name+'! Almost perfect. Try for 100% to earn your medal!';
    }else if(pct>=80){
        medal='ü•á';stars=4;
        msg=D.lang==='es'?'¬°Excelente, '+D.name+'! Tienes muy buena base. Repasa lo que fallaste y ve por el 100%.':'Excellent, '+D.name+'! Great foundation. Review mistakes and go for 100%!';
    }else if(pct>=70){
        medal='ü•à';stars=3;
        msg=D.lang==='es'?'¬°Bien, '+D.name+'! Vas por buen camino. No te rindas, cada error es una lecci√≥n.':'Good job, '+D.name+'! On the right track. Every mistake is a lesson.';
    }else if(pct>=60){
        medal='ü•â';stars=2;
        msg=D.lang==='es'?'¬°No te desanimes, '+D.name+'! Ya eres ganador por intentarlo. Repasa y vuelve m√°s fuerte.':'Don\'t get discouraged, '+D.name+'! You\'re a winner for trying. Review and come back stronger.';
    }else{
        medal='üí™';stars=1;
        msg=D.lang==='es'?'¬°'+D.name+', vamos campe√≥n! Todos fallamos al principio. T√∫ puedes, eres una estrella. ¬°Estudia y regresa con todo!':D.name+', let\'s go champ! Everyone struggles at first. You\'re a star. Study and come back strong!';
    }
    
    document.getElementById('rMedal').textContent=medal;
    document.getElementById('rMsg').textContent=msg;
    
    const starEls=document.querySelectorAll('#rStars span');
    starEls.forEach((s,i)=>{s.classList.remove('lit');});
    starEls.forEach((s,i)=>{
        setTimeout(()=>{if(i<stars)s.classList.add('lit');},i*300);
    });
    
    saveProfile();
    
    // Save best quiz score
    const scores=JSON.parse(localStorage.getItem('maestro_quiz_scores')||'{}');
    if(!scores[currentQuizId]||pct>scores[currentQuizId])scores[currentQuizId]=pct;
    localStorage.setItem('maestro_quiz_scores',JSON.stringify(scores));
    
    // Electricity-specific medal
    if(currentQuizId==='electricidad'&&pct===100&&!profile.medals.includes('bronze_electricidad')){
        profile.medals.push('bronze_electricidad');
        medalEarned.style.display='block';
        document.getElementById('rNewMedal').textContent='‚ö°';
        document.getElementById('rMedalName').textContent='¬°MEDALLA EL√âCTRICA DESBLOQUEADA!\nMaestro de Electricidad';
        saveProfile();
    }
    
    cft();
    speakText(msg);
    
    // Show study zone redirect if score < 70%
    const studyRedirect=document.getElementById('rStudyRedirect');
    const wrongCount=getStudyQuestions().length;
    if(pct<70&&wrongCount>0){
        studyRedirect.style.display='block';
        document.getElementById('rStudyDesc').textContent=D.lang==='es'?
            'Tienes '+wrongCount+' preguntas que necesitas reforzar. El Maestro Mario te recomienda ir a la Study Zone para dominarlas.':
            'You have '+wrongCount+' questions to review. Maestro Mario recommends the Study Zone to master them.';
    }else{
        studyRedirect.style.display='none';
    }
}

// ========== PROFILE & MEDAL SYSTEM ==========
const MEDALS_DEF=[
    {id:'bronze_principiante',icon:'ü•â',name:'Bronce Principiante',desc:'100% en quiz principiante'},
    {id:'silver_principiante',icon:'ü•à',name:'Plata Principiante',desc:'100% dos veces seguidas'},
    {id:'gold_principiante',icon:'ü•á',name:'Oro Principiante',desc:'100% tres veces seguidas'},
    {id:'bronze_electricidad',icon:'‚ö°',name:'Maestro El√©ctrico',desc:'100% en quiz de electricidad'},
    {id:'streak_5',icon:'üî•',name:'En Llamas',desc:'Racha de 5 correctas'},
    {id:'streak_10',icon:'‚ö°',name:'Imparable',desc:'Racha de 10 correctas'},
    {id:'streak_20',icon:'üí•',name:'Leyenda',desc:'Racha de 20 correctas'},
    {id:'quiz_5',icon:'üìù',name:'Estudiante',desc:'Completar 5 quizzes'},
    {id:'quiz_15',icon:'üìö',name:'Estudioso',desc:'Completar 15 quizzes'},
    {id:'correct_100',icon:'üíØ',name:'Centuri√≥n',desc:'100 respuestas correctas'},
    {id:'correct_500',icon:'üåü',name:'Maestro en Entrenamiento',desc:'500 respuestas correctas'},
    {id:'level_5',icon:'‚≠ê',name:'Nivel 5',desc:'Alcanzar nivel 5'},
    {id:'level_10',icon:'üëë',name:'Nivel 10',desc:'Alcanzar nivel 10'}
];

const LEVEL_TITLES={
    1:'Aprendiz Novato',2:'Aprendiz',3:'Ayudante',4:'T√©cnico Jr.',5:'T√©cnico',
    6:'T√©cnico Senior',7:'Especialista',8:'Experto',9:'Maestro',10:'Gran Maestro',
    11:'Leyenda HVAC',12:'Maestro Supremo',15:'Dios del HVAC'
};

let profile={level:1,xp:0,xpNeeded:100,totalCorrect:0,totalAnswered:0,quizzesTaken:0,bestStreak:0,medals:[],perfectStreakCount:0,avatar:'üë§'};
let bestStreak=0;

const AVATARS=[
    'üë§','üßë‚Äçüîß','üë∑','ü¶∏‚Äç‚ôÇÔ∏è','ü¶∏‚Äç‚ôÄÔ∏è','üßë‚Äçüè´',
    'üê∫','ü¶Ö','üêÜ','ü¶Å','üêª','ü¶ä',
    'üî•','‚ö°','‚ùÑÔ∏è','üåü','üíé','üèÜ',
    'ü§ñ','üëæ','üéÆ','üïπÔ∏è','üõ°Ô∏è','‚öîÔ∏è',
    'üßä','üîß','‚öôÔ∏è','üåÄ','üí™','üëë'
];

function toggleAvatarPicker(){
    const picker=document.getElementById('avatarPicker');
    picker.classList.toggle('open');
    if(picker.classList.contains('open')){
        document.getElementById('avatarGrid').innerHTML=AVATARS.map(a=>'<div class="avatar-option'+(a===profile.avatar?' selected':'')+'" onclick="selectAvatar(\''+a+'\')">'+a+'</div>').join('');
    }
}

function selectAvatar(emoji){
    profile.avatar=emoji;
    saveProfile();
    document.getElementById('profAvatar').innerHTML=emoji+'<div class="prof-avatar-edit">‚úèÔ∏è</div>';
    document.getElementById('profileBtn').textContent=emoji;
    document.getElementById('avatarPicker').classList.remove('open');
    // Update selected state
    document.querySelectorAll('.avatar-option').forEach(el=>{
        el.classList.toggle('selected',el.textContent===emoji);
    });
}

function getTitle(lvl){
    let title='Aprendiz';
    for(let l of Object.keys(LEVEL_TITLES).map(Number).sort((a,b)=>b-a)){
        if(lvl>=l){title=LEVEL_TITLES[l];break;}
    }
    return title;
}

function checkAutoMedals(){
    if(bestStreak>=5&&!profile.medals.includes('streak_5'))profile.medals.push('streak_5');
    if(bestStreak>=10&&!profile.medals.includes('streak_10'))profile.medals.push('streak_10');
    if(bestStreak>=20&&!profile.medals.includes('streak_20'))profile.medals.push('streak_20');
    if(profile.quizzesTaken>=5&&!profile.medals.includes('quiz_5'))profile.medals.push('quiz_5');
    if(profile.quizzesTaken>=15&&!profile.medals.includes('quiz_15'))profile.medals.push('quiz_15');
    if(profile.totalCorrect>=100&&!profile.medals.includes('correct_100'))profile.medals.push('correct_100');
    if(profile.totalCorrect>=500&&!profile.medals.includes('correct_500'))profile.medals.push('correct_500');
    if(profile.level>=5&&!profile.medals.includes('level_5'))profile.medals.push('level_5');
    if(profile.level>=10&&!profile.medals.includes('level_10'))profile.medals.push('level_10');
}

function saveProfile(){
    checkAutoMedals();
    try{localStorage.setItem('maestro_profile',JSON.stringify(profile));}catch(e){}
}

function loadProfile(){
    try{
        const saved=localStorage.getItem('maestro_profile');
        if(saved){
            const p=JSON.parse(saved);
            Object.assign(profile,p);
            document.getElementById('profileBtn').classList.add('active');
            document.getElementById('profileBtn').textContent=profile.avatar||'üë§';
        }
    }catch(e){}
}

function renderProfile(){
    document.getElementById('profAvatar').innerHTML=profile.avatar+'<div class="prof-avatar-edit">‚úèÔ∏è</div>';
    document.getElementById('profileBtn').textContent=profile.avatar;
    document.getElementById('profName').textContent=D.name||'T√©cnico';
    document.getElementById('profTitle').textContent=getTitle(profile.level);
    document.getElementById('profLevel').textContent=profile.level;
    const xpPct=Math.round((profile.xp/profile.xpNeeded)*100);
    document.getElementById('profXpBar').style.width=xpPct+'%';
    document.getElementById('profXpTxt').textContent=profile.xp+' / '+profile.xpNeeded+' XP';
    document.getElementById('profPts').textContent=profile.totalCorrect*10;
    const acc=profile.totalAnswered>0?Math.round((profile.totalCorrect/profile.totalAnswered)*100):0;
    document.getElementById('profAcc').textContent=acc+'%';
    document.getElementById('profStrk').textContent=profile.bestStreak;
    
    // Medals grid
    document.getElementById('medalsGrid').innerHTML=MEDALS_DEF.map(m=>{
        const earned=profile.medals.includes(m.id);
        return '<div class="medal-slot'+(earned?' earned':'')+'"><div class="medal-icon">'+(earned?m.icon:'üîí')+'</div><div class="medal-name">'+m.name+'</div><div style="font-size:10px;color:var(--muted);margin-top:2px">'+m.desc+'</div></div>';
    }).join('');
}

// Load profile on start
loadProfile();

// Close music panel on outside click
document.addEventListener('click',e=>{
    const panel=document.getElementById('musicPanel');
    const btn=document.getElementById('musicBtn');
    const setBtn=document.querySelector('.music-settings');
    if(musicPanelOpen&&!panel.contains(e.target)&&e.target!==btn&&e.target!==setBtn){
        musicPanelOpen=false;
        panel.classList.remove('open');
    }
});

document.getElementById('nm').addEventListener('keydown',e=>{if(e.key==='Enter'&&e.target.value.trim().length>=2)sName();});

// ========== 3-ZONE SYSTEM ==========

// === WRONG ANSWER TRACKER ===
// Stores: { "questionHash": { q, cat, fails, lastFail, masteredAt, quizId } }
function getTracker(){
    try{return JSON.parse(localStorage.getItem('maestro_study_tracker')||'{}');}catch(e){return{};}
}
function saveTracker(t){
    try{localStorage.setItem('maestro_study_tracker',JSON.stringify(t));}catch(e){}
}

function questionHash(q){
    // Simple hash from question text
    return q.q.substring(0,60).replace(/[^a-zA-Z0-9√°√©√≠√≥√∫√±]/g,'').toLowerCase();
}

function trackAnswer(q,correct){
    const tracker=getTracker();
    const hash=questionHash(q);
    if(!tracker[hash]){
        tracker[hash]={q:q.q,cat:q.cat,fails:0,correct:0,lastFail:null,masteredAt:null,quizId:currentQuizId,
            // Store full question for study mode
            fullQ:{cat:q.cat,q:q.q,o:[...q.o],c:q.c,e:q.e,a:q.a}
        };
    }
    if(correct){
        tracker[hash].correct++;
        // If they get it right 2 times after failing, mark as mastered
        if(tracker[hash].fails>0&&tracker[hash].correct>=2){
            tracker[hash].masteredAt=Date.now();
        }
    }else{
        tracker[hash].fails++;
        tracker[hash].lastFail=Date.now();
        tracker[hash].masteredAt=null; // Reset mastery if they fail again
        tracker[hash].correct=0; // Reset correct streak
    }
    saveTracker(tracker);
}

function getStudyQuestions(catFilter){
    const tracker=getTracker();
    const questions=[];
    for(const hash in tracker){
        const t=tracker[hash];
        // Include if: failed at least 1 time AND not mastered yet
        if(t.fails>=1&&!t.masteredAt&&t.fullQ){
            if(!catFilter||t.cat===catFilter){
                questions.push({...t.fullQ,_hash:hash,_fails:t.fails});
            }
        }
    }
    // Sort by most fails first
    questions.sort((a,b)=>b._fails-a._fails);
    return questions;
}

function getStudyCategories(){
    const questions=getStudyQuestions();
    const cats={};
    questions.forEach(q=>{
        if(!cats[q.cat])cats[q.cat]={count:0,icon:q.cat.split(' ')[0]};
        cats[q.cat].count++;
    });
    return cats;
}

// === HUB FUNCTIONS ===
function updateHub(){
    // Quiz zone stats
    const totalQuizzes=QUIZ_LIST.length;
    const totalQs=QUIZ_LIST.reduce((s,q)=>s+q.count,0);
    document.getElementById('hubQuizCount').textContent='üìã '+totalQuizzes+' quizzes';
    document.getElementById('hubQuizTotal').textContent='üìä '+totalQs+' preguntas';
    
    // Study zone stats
    const studyQs=getStudyQuestions();
    document.getElementById('hubStudyCount').textContent='üîÑ '+studyQs.length+' por repasar';
    const studyBadge=document.getElementById('hubStudyBadge');
    if(studyQs.length>0){
        studyBadge.style.display='block';
        studyBadge.textContent=studyQs.length>=10?'üî• '+studyQs.length:studyQs.length>=5?'‚ö†Ô∏è '+studyQs.length:'üìñ '+studyQs.length;
    }else{
        studyBadge.style.display='none';
    }
    
    // Hub bubble message
    const bubble=document.getElementById('hubBubble');
    if(studyQs.length>=10){
        bubble.textContent=D.lang==='es'?'¬°'+D.name+'! Tienes '+studyQs.length+' preguntas por repasar. ¬°Ve a la Study Zone!':''+D.name+'! You have '+studyQs.length+' questions to review. Hit the Study Zone!';
    }else if(studyQs.length>0){
        bubble.textContent=D.lang==='es'?'¬øQu√© quieres hacer hoy, '+D.name+'? Tienes '+studyQs.length+' preguntas pendientes de repaso.':'What do you want to do, '+D.name+'? You have '+studyQs.length+' questions to review.';
    }else{
        bubble.textContent=D.lang==='es'?'¬°'+D.name+'! ¬øListo para aprender? Elige tu zona.':''+D.name+'! Ready to learn? Pick your zone.';
    }
}

function goQuizZone(){
    renderQuizSelector();
    go('s7b');
    speakText(D.lang==='es'?'¬°Vamos con los quizzes, '+D.name+'! Elige cu√°l quieres tomar.':'Let\'s do quizzes, '+D.name+'! Pick which one you want.');
}

function goStudyZone(){
    renderStudyZone();
    go('s-study');
    const count=getStudyQuestions().length;
    if(count>0){
        speakText(D.lang==='es'?'Zona de estudio, '+D.name+'. Tienes '+count+' preguntas para repasar. ¬°Vamos a dominarlas!':'Study zone, '+D.name+'. You have '+count+' questions to review. Let\'s master them!');
    }else{
        speakText(D.lang==='es'?'¬°'+D.name+', tu zona de estudio est√° limpia! Ve a tomar quizzes para practicar.':''+D.name+', your study zone is clean! Go take quizzes to practice.');
    }
}

function goVideoZone(){
    renderVideoZone();
    go('s-videos');
    speakText(D.lang==='es'?'Zona de videos. Pronto tendr√°s videos del Maestro Mario aqu√≠.':'Video zone. Maestro Mario videos coming soon.');
}

// === STUDY ZONE RENDER ===
function renderStudyZone(){
    const container=document.getElementById('studyContent');
    const questions=getStudyQuestions();
    const cats=getStudyCategories();
    const bubble=document.getElementById('studyBubble');
    
    if(questions.length===0){
        bubble.textContent=D.lang==='es'?'¬°Felicidades '+D.name+'! No tienes preguntas pendientes. Ve a tomar quizzes.':'Congrats '+D.name+'! No pending questions. Go take quizzes.';
        container.innerHTML='<div class="study-empty">'+
            '<div class="study-empty-icon">üéâ</div>'+
            '<div class="study-empty-title">'+(D.lang==='es'?'¬°Todo limpio!':'All clean!')+'</div>'+
            '<div class="study-empty-desc">'+(D.lang==='es'?'No tienes preguntas por repasar. ¬°Sigue tomando quizzes para seguir aprendiendo!':'No questions to review. Keep taking quizzes to keep learning!')+'</div>'+
            '</div>'+
            '<button class="bt" onclick="goQuizZone()" style="margin-top:16px">üìù Ir a Quiz Zone</button>';
        return;
    }
    
    bubble.textContent=D.lang==='es'?D.name+', tienes '+questions.length+' preguntas que necesitas reforzar. ¬°T√∫ puedes!':D.name+', you have '+questions.length+' questions to strengthen. You got this!';
    
    let html='<div class="study-alert">üìö '+(D.lang==='es'?'Tienes <b>'+questions.length+' preguntas</b> que fallaste en los quizzes. Rep√°salas aqu√≠ hasta dominarlas.':'You have <b>'+questions.length+' questions</b> you missed in quizzes. Review them here until you master them.')+'</div>';
    
    // Show "Review All" button
    html+='<button class="bt" onclick="startStudyQuiz(\'all\')" style="margin-bottom:16px">üî• '+(D.lang==='es'?'Repasar Todas ('+questions.length+')':'Review All ('+questions.length+')')+'</button>';
    
    // Show by category
    for(const cat in cats){
        html+='<div class="study-topic" onclick="startStudyQuiz(\''+cat.replace(/'/g,"\\'")+'\')">';
        html+='<div class="study-topic-icon">'+cats[cat].icon+'</div>';
        html+='<div class="study-topic-info">';
        html+='<div class="study-topic-name">'+cat+'</div>';
        html+='<div class="study-topic-count">'+cats[cat].count+(D.lang==='es'?' preguntas por repasar':' questions to review')+'</div>';
        html+='</div></div>';
    }
    
    // Show mastered count
    const tracker=getTracker();
    const mastered=Object.values(tracker).filter(t=>t.masteredAt).length;
    if(mastered>0){
        html+='<div style="text-align:center;margin-top:20px;font-size:13px;color:var(--electric)">‚úÖ '+(D.lang==='es'?mastered+' preguntas dominadas':mastered+' questions mastered')+'</div>';
    }
    
    container.innerHTML=html;
}

// === STUDY QUIZ MODE ===
let studyData=[];
let studyIdx=0;
let studyRight=0;
let studyWrong=0;
let studyAnswered=false;
let studyAnswers=[];
let lastStudyCat='all';

function startStudyQuiz(catFilter){
    lastStudyCat=catFilter;
    const questions=catFilter==='all'?getStudyQuestions():getStudyQuestions(catFilter);
    if(questions.length===0){
        goStudyZone();
        return;
    }
    studyData=shuffleArray(questions);
    studyIdx=0;studyRight=0;studyWrong=0;
    studyAnswers=new Array(studyData.length).fill(-1);
    document.getElementById('sqRight').textContent='0';
    document.getElementById('sqWrong').textContent='0';
    go('s-study-quiz');
    showStudyQuestion();
}

function showStudyQuestion(){
    if(studyIdx>=studyData.length){showStudyResult();return;}
    const q=studyData[studyIdx];
    const alreadyAnswered=studyAnswers[studyIdx]>=0;
    studyAnswered=alreadyAnswered;
    const pct=Math.round((studyIdx/studyData.length)*100);
    document.getElementById('sqBar').style.width=pct+'%';
    document.getElementById('sqNum').textContent='üìö '+(D.lang==='es'?'Repaso ':'Review ')+(studyIdx+1)+' / '+studyData.length;
    document.getElementById('sqCat').textContent=q.cat;
    
    const prevBtn=document.getElementById('sqPrev');
    if(studyIdx>0){prevBtn.classList.add('show');}else{prevBtn.classList.remove('show');}
    
    if(alreadyAnswered){
        const userAnswer=studyAnswers[studyIdx];
        const correct=userAnswer===q.c;
        document.getElementById('sqBubble').textContent=correct?'‚úÖ ¬°Bien! Ya la dominas.':'‚ùå Sigue intentando. La correcta es la '+['A','B','C','D'][q.c]+'.';
        document.getElementById('sqText').textContent=q.q;
        const letters=['A','B','C','D'];
        document.getElementById('sqOpts').innerHTML=q.o.map((o,i)=>{
            let cls='quiz-opt disabled';
            if(i===q.c)cls+=' correct';
            if(i===userAnswer&&!correct)cls+=' wrong';
            return '<div class="'+cls+'"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>';
        }).join('');
        document.getElementById('sqExplain').innerHTML='<b style="color:#ff6b2b">üìñ</b> '+q.a+'<br><br><b>T√©cnico:</b> '+q.e;
        document.getElementById('sqExplain').classList.add('show');
        const nextBtn=document.getElementById('sqNext');
        nextBtn.textContent=(studyIdx<studyData.length-1)?'Siguiente ‚Üí':'Ver Resultado üèÜ';
        nextBtn.classList.add('show');
    }else{
        document.getElementById('sqBubble').textContent=D.lang==='es'?'Esta la fallaste antes. ¬°Pi√©nsale bien, '+D.name+'!':'You missed this before. Think carefully, '+D.name+'!';
        document.getElementById('sqText').textContent=q.q;
        document.getElementById('sqExplain').classList.remove('show');
        document.getElementById('sqNext').classList.remove('show');
        const letters=['A','B','C','D'];
        document.getElementById('sqOpts').innerHTML=q.o.map((o,i)=>'<div class="quiz-opt" onclick="answerStudy('+i+',this)"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>').join('');
    }
    window.scrollTo(0,0);
}

function answerStudy(idx,el){
    if(studyAnswered)return;
    studyAnswered=true;
    studyAnswers[studyIdx]=idx;
    const q=studyData[studyIdx];
    const correct=idx===q.c;
    const opts=document.querySelectorAll('#s-study-quiz .quiz-opt');
    
    opts.forEach((o,i)=>{
        if(i===q.c)o.classList.add('correct');
        if(i===idx&&!correct)o.classList.add('wrong');
        if(i!==q.c&&i!==idx)o.classList.add('disabled');
    });
    
    // Track in study tracker
    trackAnswer(q,correct);
    
    if(correct){
        studyRight++;
        document.getElementById('sqRight').textContent=studyRight;
        document.getElementById('sqBubble').textContent=D.lang==='es'?'‚úÖ ¬°Muy bien, '+D.name+'! ¬°Ya le est√°s agarrando!':'‚úÖ Great job, '+D.name+'! You\'re getting it!';
        document.getElementById('sqExplain').innerHTML='<b>Explicaci√≥n:</b> '+q.e;
        celebrate(1);
        speakText(D.lang==='es'?'¬°Correcto! Ya le agarraste. ':'Correct! You got it. '+q.e);
    }else{
        studyWrong++;
        document.getElementById('sqWrong').textContent=studyWrong;
        document.getElementById('sqBubble').textContent=D.lang==='es'?'‚ùå A√∫n no, '+D.name+'. La correcta es la '+['A','B','C','D'][q.c]+'. Lee bien la explicaci√≥n.':'‚ùå Not yet, '+D.name+'. Correct: '+['A','B','C','D'][q.c]+'. Read the explanation.';
        document.getElementById('sqExplain').innerHTML='<b style="color:#ff6b2b">üìñ Con peras y manzanas:</b><br>'+q.a+'<br><br><b>T√©cnico:</b> '+q.e;
        speakText(D.lang==='es'?'A√∫n no, pero no te rindas. Te lo explico: ':' Not yet, but don\'t give up. Let me explain: '+q.a+' '+q.e);
    }
    
    document.getElementById('sqExplain').classList.add('show');
    document.getElementById('sqNext').textContent=(studyIdx<studyData.length-1)?'Siguiente ‚Üí':'Ver Resultado üèÜ';
    document.getElementById('sqNext').classList.add('show');
}

function studyNext(){
    stopSpeech();
    studyIdx++;
    showStudyQuestion();
}

function studyPrev(){
    stopSpeech();
    if(studyIdx>0){studyIdx--;showStudyQuestion();}
}

function showStudyResult(){
    go('s-study-result');
    const pct=studyData.length>0?Math.round((studyRight/studyData.length)*100):0;
    document.getElementById('srScore').textContent=pct+'%';
    document.getElementById('srLabel').textContent=studyRight+' / '+studyData.length+(D.lang==='es'?' correctas en repaso':' correct in review');
    
    let medal,msg;
    if(pct>=90){
        medal='üèÜ';
        msg=D.lang==='es'?'¬°Incre√≠ble, '+D.name+'! ¬°Ya dominas estas preguntas! Las que sacaste bien se van de tu zona de estudio.':'Amazing, '+D.name+'! You\'ve mastered these! Correct ones leave your study zone.';
    }else if(pct>=70){
        medal='ü•á';
        msg=D.lang==='es'?'¬°Muy bien, '+D.name+'! Vas mejorando. Sigue repasando las que fallaste.':'Great job, '+D.name+'! You\'re improving. Keep reviewing the ones you missed.';
    }else if(pct>=50){
        medal='ü•à';
        msg=D.lang==='es'?'¬°Vas progresando, '+D.name+'! Repasa las explicaciones y vuelve a intentar.':'Making progress, '+D.name+'! Review explanations and try again.';
    }else{
        medal='üí™';
        msg=D.lang==='es'?'¬°No te rindas, '+D.name+'! La pr√°ctica hace al maestro. Lee las explicaciones con calma.':'Don\'t give up, '+D.name+'! Practice makes perfect. Read explanations carefully.';
    }
    
    document.getElementById('srMedal').textContent=medal;
    document.getElementById('srMsg').textContent=msg;
    
    // Award XP for study
    const xpEarned=studyRight*5;
    profile.xp+=xpEarned;
    while(profile.xp>=profile.xpNeeded){
        profile.xp-=profile.xpNeeded;
        profile.level++;
        profile.xpNeeded=Math.floor(profile.xpNeeded*1.4);
    }
    saveProfile();
    
    cft();
    speakText(msg);
}

// === VIDEO ZONE ===
const VIDEO_TOPICS=[
    {cat:'‚ö° Electricidad',videos:[
        {title:'Ley de Ohm Explicada',desc:'Voltaje, corriente y resistencia con ejemplos reales',icon:'‚ö°',dur:'Pr√≥ximamente'},
        {title:'C√≥mo Usar el Mult√≠metro',desc:'Medir voltaje, amperaje, resistencia y continuidad',icon:'üî¨',dur:'Pr√≥ximamente'},
        {title:'Circuitos Serie vs Paralelo',desc:'Diferencias y c√≥mo diagnosticar cada uno',icon:'üîå',dur:'Pr√≥ximamente'},
        {title:'GFCI y AFCI Explicados',desc:'Protecciones el√©ctricas y cu√°ndo se requieren',icon:'üõ°Ô∏è',dur:'Pr√≥ximamente'}
    ]},
    {cat:'‚ùÑÔ∏è Aire Acondicionado',videos:[
        {title:'Ciclo de Refrigeraci√≥n',desc:'Los 4 componentes y c√≥mo funciona el sistema',icon:'üîÑ',dur:'Pr√≥ximamente'},
        {title:'Superheat y Subcooling',desc:'Qu√© son, c√≥mo medirlos y valores normales',icon:'üå°Ô∏è',dur:'Pr√≥ximamente'},
        {title:'Diagn√≥stico con Manifold',desc:'Leer presiones y diagnosticar problemas',icon:'üìä',dur:'Pr√≥ximamente'},
        {title:'Mantenimiento Preventivo',desc:'Checklist completo para servicio de AC',icon:'üîß',dur:'Pr√≥ximamente'}
    ]},
    {cat:'üßä Refrigeraci√≥n',videos:[
        {title:'Walk-in Coolers 101',desc:'Componentes y troubleshooting b√°sico',icon:'üßä',dur:'Pr√≥ximamente'},
        {title:'V√°lvula TXV',desc:'C√≥mo funciona y c√≥mo diagnosticar problemas',icon:'‚öôÔ∏è',dur:'Pr√≥ximamente'},
        {title:'EPA 608 Prep',desc:'Todo lo que necesitas para pasar el examen',icon:'üìã',dur:'Pr√≥ximamente'}
    ]},
    {cat:'üõ°Ô∏è Seguridad',videos:[
        {title:'Lockout/Tagout (LOTO)',desc:'Procedimiento correcto paso a paso',icon:'üîí',dur:'Pr√≥ximamente'},
        {title:'PPE para HVAC',desc:'Equipo de protecci√≥n personal obligatorio',icon:'ü•Ω',dur:'Pr√≥ximamente'}
    ]}
];

function renderVideoZone(){
    const container=document.getElementById('videoContent');
    let html='';
    
    VIDEO_TOPICS.forEach(topic=>{
        html+='<div class="video-section-title">'+topic.cat+'</div>';
        topic.videos.forEach(v=>{
            html+='<div class="video-card" onclick="alert(\''+(D.lang==='es'?'Pr√≥ximamente ‚Äî estamos grabando los videos del Maestro Mario':'Coming soon ‚Äî we are recording Maestro Mario videos')+'\')">';
            html+='<div class="video-card-thumb">'+v.icon+'</div>';
            html+='<div class="video-card-info">';
            html+='<div class="video-card-title">'+v.title+'</div>';
            html+='<div class="video-card-desc">'+v.desc+'</div>';
            html+='<div class="video-card-dur">üé¨ '+v.dur+'</div>';
            html+='</div></div>';
        });
    });
    
    container.innerHTML=html;
}
</script>
</body>
</html>
