<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maestro Mario - HVAC Training App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{--accent:#ff6b2b;--electric:#00d4ff;--gold:#f1c40f;--dark:#0a1628;--card:#111d33;--card2:#162440;--txt:#e8f0ff;--muted:#7a93b8;--r:16px}

        /* FLOATING HOME BUTTON */
        .home-fab{position:fixed;bottom:20px;left:20px;z-index:800;width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--dark),var(--card));border:2px solid rgba(0,212,255,0.4);color:var(--electric);font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(0,0,0,0.3);transition:all 0.3s}
        .home-fab:hover{transform:scale(1.1);border-color:var(--electric);box-shadow:0 4px 20px rgba(0,212,255,0.3)}

        /* AI PAYWALL MODAL */
        .paywall-overlay{position:fixed;inset:0;z-index:10000;background:rgba(10,22,40,0.95);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);display:none;align-items:flex-start;justify-content:center;padding:20px;overflow-y:auto;-webkit-overflow-scrolling:touch}
        .paywall-overlay.active{display:flex}
        .paywall-card{background:var(--card);border:1px solid rgba(0,212,255,0.2);border-radius:20px;max-width:400px;width:100%;padding:20px 18px;text-align:center;position:relative;overflow:hidden;animation:pwSlide 0.4s ease;margin:auto 0;flex-shrink:0}
        @keyframes pwSlide{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
        .paywall-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--accent),var(--electric),var(--gold))}
        .pw-icon{font-size:50px;margin-bottom:8px}
        .pw-title{font-size:18px;font-weight:800;color:var(--txt);margin-bottom:4px;font-family:'Fredoka',sans-serif}
        .pw-subtitle{font-size:13px;color:var(--muted);margin-bottom:12px}
        .pw-features{text-align:left;margin-bottom:16px}
        .pw-feature{display:flex;align-items:center;gap:8px;padding:4px 0;font-size:13px;color:var(--txt)}
        .pw-feature span{color:#2ecc71;font-size:15px}
        .pw-price{font-size:28px;font-weight:800;color:var(--accent);margin-bottom:2px;font-family:'Fredoka',sans-serif}
        .pw-period{font-size:12px;color:var(--muted);margin-bottom:12px}
        .pw-btn{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--accent),#e84500);color:#fff;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.2s;font-family:'Fredoka',sans-serif}
        .pw-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,107,43,0.3)}
        .pw-close{margin-top:14px;background:none;border:none;color:var(--muted);font-size:14px;cursor:pointer;padding:8px}
        .pw-close:hover{color:var(--txt)}

        /* AI CHARACTER COUNTER */
        .ai-chars-banner{position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:799;background:rgba(17,29,51,0.95);border:1px solid rgba(0,212,255,0.3);border-radius:50px;padding:6px 16px;font-size:12px;color:var(--electric);font-weight:600;display:none;align-items:center;gap:6px;box-shadow:0 4px 15px rgba(0,0,0,0.3);white-space:nowrap}
        .ai-chars-banner.show{display:inline-flex}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Nunito',sans-serif;background:var(--dark);color:var(--txt);min-height:100vh;min-height:100dvh;overflow-x:hidden}
        .bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
        .bg .o{position:absolute;border-radius:50%;filter:blur(90px);opacity:.12;animation:d 22s ease-in-out infinite}
        .bg .o:nth-child(1){width:420px;height:420px;background:var(--accent);top:-120px;left:-120px}
        .bg .o:nth-child(2){width:360px;height:360px;background:var(--electric);bottom:-100px;right:-100px;animation-delay:-8s}
        .bg .o:nth-child(3){width:280px;height:280px;background:#6366f1;top:40%;left:40%;animation-delay:-15s}
        @keyframes d{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(30px,-30px) scale(1.08)}66%{transform:translate(-20px,20px) scale(.92)}}
        .gr{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,212,255,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,.025) 1px,transparent 1px);background-size:44px 44px}
        .app{position:relative;z-index:1;max-width:460px;margin:0 auto;min-height:100vh;min-height:100dvh;padding:16px 18px;display:flex;flex-direction:column}
        .s{display:none;flex-direction:column;align-items:center;flex:1;animation:si .55s cubic-bezier(.16,1,.3,1)}
        .s.on{display:flex}
        @keyframes si{from{opacity:0;transform:translateY(36px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
        
        /* VIDEO FLOTANTE DESDE LA DERECHA */
        .video-float{position:fixed;bottom:100px;right:-320px;z-index:900;width:300px;transition:right 0.6s cubic-bezier(.34,1.56,.64,1);pointer-events:none}
        .video-float.active{right:20px;pointer-events:auto}
        .video-float.hiding{right:-320px}
        .video-float-inner{position:relative;border-radius:20px;overflow:hidden;box-shadow:0 15px 50px rgba(255,107,43,0.6),0 0 0 3px var(--accent);background:#000}
        .video-float video{width:100%;display:block;border-radius:17px}
        .video-float-label{position:absolute;top:12px;left:12px;background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:12px;font-weight:700;padding:6px 14px;border-radius:20px;display:flex;align-items:center;gap:8px;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .video-float-label::before{content:'';width:10px;height:10px;border-radius:50%;background:#00ff00;animation:blink 1s infinite;box-shadow:0 0 10px #00ff00}
        @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
        .video-float-close{position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,0.7);border:2px solid rgba(255,255,255,0.3);color:white;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s}
        .video-float-close:hover{background:var(--accent);border-color:var(--accent);transform:scale(1.1)}
        .video-float-glow{position:absolute;inset:-4px;border-radius:24px;background:conic-gradient(var(--accent),var(--electric),var(--gold),var(--accent));z-index:-1;animation:sp 3s linear infinite}
        
        /* MODAL AI CHAT */
        .ai-modal{position:fixed;inset:0;z-index:600;background:rgba(10,22,40,0.95);display:flex;align-items:flex-end;justify-content:center;opacity:0;visibility:hidden;transition:all 0.3s}
        .ai-modal.active{opacity:1;visibility:visible}
        .ai-chat{width:100%;max-width:460px;height:75vh;background:var(--card);border-radius:24px 24px 0 0;display:flex;flex-direction:column;transform:translateY(100%);transition:transform 0.4s cubic-bezier(.16,1,.3,1)}
        .ai-modal.active .ai-chat{transform:translateY(0)}
        .ai-chat-header{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:12px}
        .ai-chat-avatar{width:48px;height:48px;border-radius:50%;overflow:hidden;border:2px solid var(--accent)}
        .ai-chat-avatar img{width:100%;height:100%;object-fit:cover}
        .ai-chat-title{flex:1}
        .ai-chat-title h3{font-family:'Fredoka',sans-serif;font-size:17px;color:var(--txt)}
        .ai-chat-title span{font-size:12px;color:var(--electric)}
        .ai-chat-close{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.1);border:none;color:var(--txt);font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .ai-chat-close:hover{background:var(--accent)}
        .ai-chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}
        .ai-msg{max-width:85%;padding:14px 18px;border-radius:18px;font-size:15px;line-height:1.5}
        .ai-msg.mario{background:linear-gradient(135deg,rgba(255,107,43,0.2),rgba(0,212,255,0.1));border:1px solid rgba(255,107,43,0.3);align-self:flex-start;border-bottom-left-radius:4px}
        .ai-msg.user{background:var(--card2);align-self:flex-end;border-bottom-right-radius:4px}
        .ai-chat-input{padding:16px;border-top:1px solid rgba(255,255,255,0.1);display:flex;gap:12px}
        .ai-chat-input input{flex:1;padding:14px 18px;border-radius:25px;border:2px solid rgba(255,255,255,0.1);background:var(--dark);color:var(--txt);font-size:15px;outline:none}
        .ai-chat-input input:focus{border-color:var(--accent)}
        .ai-chat-input button{width:50px;height:50px;border-radius:50%;background:var(--accent);border:none;color:white;font-size:22px;cursor:pointer}
        .ai-chat-input button:disabled{opacity:0.5;cursor:not-allowed}
        
        /* SPEAKING INDICATOR */
        .speaking-indicator{display:none;align-items:center;gap:8px;padding:10px 16px;background:rgba(255,107,43,0.2);border-radius:12px;margin-top:8px}
        .speaking-indicator.active{display:flex}
        .speaking-indicator .waves{display:flex;gap:3px;align-items:center}
        .speaking-indicator .wave{width:4px;height:16px;background:var(--accent);border-radius:2px;animation:wave 0.8s ease-in-out infinite}
        .speaking-indicator .wave:nth-child(2){animation-delay:0.1s}
        .speaking-indicator .wave:nth-child(3){animation-delay:0.2s}
        .speaking-indicator .wave:nth-child(4){animation-delay:0.3s}
        @keyframes wave{0%,100%{height:8px}50%{height:20px}}
        .speaking-indicator span{font-size:13px;color:var(--accent);font-weight:600}
        
        /* CONFETTI */
        .cw{position:fixed;inset:0;pointer-events:none;z-index:100}.cf{position:absolute;top:-16px;animation:cff 2.8s ease-out forwards}
        @keyframes cff{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
        
        /* AVATAR - CLICKEABLE PARA ABRIR AI */
        .aw{position:relative;margin:16px auto 12px;cursor:pointer;transition:transform 0.3s}
        .aw:hover{transform:scale(1.05)}
        .aw.lg{width:190px;height:190px}.aw.md{width:140px;height:140px}.aw.sm{width:120px;height:120px}
        .ar{position:absolute;inset:-6px;border-radius:50%;background:conic-gradient(var(--accent),var(--electric),var(--accent));animation:sp 4s linear infinite}
        @keyframes sp{to{transform:rotate(360deg)}}
        .ag{position:absolute;inset:-20px;border-radius:50%;background:radial-gradient(circle,var(--accent) 0%,transparent 70%);opacity:.25;animation:pu 3s ease-in-out infinite}
        @keyframes pu{0%,100%{transform:scale(1);opacity:.25}50%{transform:scale(1.12);opacity:.4}}
        .ai{position:relative;width:100%;height:100%;border-radius:50%;overflow:hidden;border:4px solid var(--dark);animation:fl 4.5s ease-in-out infinite}
        .ai img{width:100%;height:100%;object-fit:cover}
        @keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        
        /* BADGE DE AI EN AVATAR */
        .aw .ai-badge{position:absolute;bottom:5px;right:5px;background:var(--accent);color:white;font-family:'Fredoka',sans-serif;font-size:10px;font-weight:700;padding:4px 8px;border-radius:10px;border:2px solid var(--dark)}
        
        /* BURBUJA */
        .bb{background:var(--card);border:1.5px solid rgba(0,212,255,.15);border-radius:var(--r);padding:18px 22px;margin:0 6px 20px;position:relative;box-shadow:0 6px 28px rgba(0,0,0,.25);text-align:center;font-size:16.5px;line-height:1.55;font-weight:600;min-height:60px}
        .bb::before{content:'';position:absolute;top:-10px;left:50%;transform:translateX(-50%);border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid rgba(0,212,255,.15)}
        .bb::after{content:'';position:absolute;top:-8px;left:50%;transform:translateX(-50%);border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--card)}
        
        /* OTROS ESTILOS */
        .lo{text-align:center;padding:4px 60px}.lo-t{font-family:'Fredoka',sans-serif;font-size:26px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.lo-s{font-size:12px;color:var(--muted);letter-spacing:2.5px;text-transform:uppercase;margin-top:2px}
        .pb{width:100%;height:5px;background:rgba(255,255,255,.06);border-radius:3px;margin:12px 0 6px;overflow:hidden}.pbf{height:100%;background:linear-gradient(90deg,var(--accent),var(--electric));border-radius:3px;transition:width .6s}
        .ps{font-size:12px;color:var(--muted);margin-bottom:12px;text-align:center}.ps b{color:var(--accent)}
        .os{width:100%;display:flex;flex-direction:column;gap:10px}
        .oc{background:var(--card);border:2px solid rgba(255,255,255,.06);border-radius:var(--r);padding:16px 18px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px}
        .oc:hover{border-color:rgba(255,107,43,.4);background:var(--card2);transform:translateY(-1px)}
        .oc.sel{border-color:var(--accent);background:linear-gradient(135deg,rgba(255,107,43,.12),rgba(0,212,255,.06))}
        .oi{width:44px;height:44px;border-radius:12px;background:rgba(255,255,255,.05);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;transition:all .25s}
        .oc.sel .oi{background:var(--accent);transform:scale(1.08)}
        .ot{font-family:'Fredoka',sans-serif;font-size:15px;font-weight:600}.od{font-size:12.5px;color:var(--muted);margin-top:1px}
        .ck{width:22px;height:22px;border-radius:7px;border:2px solid rgba(255,255,255,.12);margin-left:auto;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;color:white}
        .oc.sel .ck{background:var(--accent);border-color:var(--accent)}.oc.sel .ck::after{content:'âœ“'}
        .mh{font-size:12.5px;color:var(--muted);text-align:center;margin-bottom:8px}
        .fl{display:flex;gap:18px;justify-content:center;margin-top:16px}
        .fc{width:135px;height:155px;background:var(--card);border:2.5px solid rgba(255,255,255,.06);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;cursor:pointer;transition:all .3s}
        .fc:hover{border-color:var(--accent);transform:translateY(-3px);box-shadow:0 10px 28px rgba(255,107,43,.18)}
        .fe{font-size:42px;line-height:1}.fn{font-family:'Fredoka',sans-serif;font-size:17px;font-weight:600}
        .bt{width:100%;padding:16px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:17px;font-weight:700;cursor:pointer;margin-top:20px;transition:all .25s;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .bt:hover{transform:translateY(-2px);box-shadow:0 7px 24px rgba(255,107,43,.35)}.bt:disabled{opacity:.35;cursor:not-allowed;transform:none}
        .ip{width:100%;padding:16px 18px;border:2px solid rgba(255,255,255,.06);border-radius:var(--r);background:var(--card);color:var(--txt);font-size:16px;font-weight:600;outline:none}.ip:focus{border-color:var(--accent)}.ip::placeholder{color:var(--muted)}
        .sp{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;text-align:center}
        .sp-t{font-family:'Fredoka',sans-serif;font-size:40px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.15}
        .sp-s{font-size:17px;color:var(--muted);max-width:280px}
        .badge{display:inline-flex;align-items:center;gap:7px;background:rgba(255,107,43,.1);border:1px solid rgba(255,107,43,.25);border-radius:28px;padding:5px 14px;font-family:'Fredoka',sans-serif;font-size:13px;color:var(--accent)}
        .rt{background:var(--card);border:1.5px solid rgba(0,212,255,.12);border-radius:var(--r);padding:16px 18px;margin-bottom:10px;display:flex;align-items:center;gap:14px;animation:ri .5s ease-out backwards}
        @keyframes ri{from{opacity:0;transform:translateX(-24px)}to{opacity:1;transform:translateX(0)}}
        .rn{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--electric));display:flex;align-items:center;justify-content:center;font-family:'Fredoka',sans-serif;font-weight:700;font-size:16px;flex-shrink:0}
        .rtt{font-family:'Fredoka',sans-serif;font-size:14.5px;font-weight:600}.rd{font-size:12px;color:var(--muted)}
        .rl{width:2px;height:16px;background:linear-gradient(var(--accent),var(--electric));margin-left:35px;border-radius:2px}
        .typing{display:inline-flex;gap:4px;align-items:center;padding:4px 0}
        .typing .dot{width:8px;height:8px;border-radius:50%;background:var(--electric);animation:tblink 1.4s infinite both}
        .typing .dot:nth-child(2){animation-delay:.2s}.typing .dot:nth-child(3){animation-delay:.4s}
        @keyframes tblink{0%,80%,100%{opacity:.3;transform:scale(.8)}40%{opacity:1;transform:scale(1)}}
        
        /* MUSIC BUTTON */
        .music-btn{position:fixed;top:60px;right:76px;z-index:800;width:44px;height:44px;border-radius:50%;background:var(--card);border:2px solid rgba(0,212,255,0.3);color:var(--electric);font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .music-btn:hover{background:var(--card2);border-color:var(--electric);transform:scale(1.1)}
        .music-btn.muted{color:var(--muted);border-color:rgba(255,255,255,0.1)}
        .music-settings{position:fixed;top:60px;right:128px;z-index:800;width:44px;height:44px;border-radius:50%;background:var(--card);border:2px solid rgba(0,212,255,0.15);color:var(--electric);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.3)}
        .music-settings:hover{transform:scale(1.15);border-color:var(--electric)}
        
        /* QUIZ SELECTOR */
        .quiz-sel-card{background:var(--card);border:2px solid rgba(255,255,255,0.06);border-radius:16px;padding:18px 16px;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:14px;position:relative;overflow:hidden}
        .quiz-sel-card:hover{border-color:var(--electric);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,212,255,0.15)}
        .quiz-sel-card.locked{opacity:0.5;cursor:not-allowed}
        .quiz-sel-card .qs-icon{font-size:40px;width:56px;height:56px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.04);border-radius:14px;flex-shrink:0}
        .quiz-sel-card .qs-info{flex:1}
        .quiz-sel-card .qs-title{font-family:'Fredoka',sans-serif;font-size:17px;font-weight:700;margin-bottom:2px}
        .quiz-sel-card .qs-desc{font-size:12px;color:var(--muted);line-height:1.3}
        .quiz-sel-card .qs-badge{position:absolute;top:8px;right:10px;font-size:10px;padding:2px 8px;border-radius:8px;font-weight:700;text-transform:uppercase}
        .quiz-sel-card .qs-badge.new{background:var(--electric);color:var(--bg)}
        .quiz-sel-card .qs-badge.done{background:rgba(76,175,80,0.2);color:#4caf50}
        .quiz-sel-card .qs-count{font-size:11px;color:var(--electric);font-weight:600;margin-top:4px}
        .quiz-sel-card .qs-stars{margin-top:4px;font-size:12px}

        /* QUIZ STYLES */
        .quiz-header{width:100%;display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
        .quiz-cat{font-size:11px;color:var(--electric);text-transform:uppercase;letter-spacing:1.5px;font-weight:700}
        .quiz-score{display:flex;align-items:center;gap:8px;font-family:'Fredoka',sans-serif;font-size:14px}
        .quiz-score .correct{color:#2ecc71}.quiz-score .wrong{color:#e74c3c}
        .quiz-num{font-family:'Fredoka',sans-serif;font-size:15px;color:var(--txt);text-align:center;margin:4px 0}
        .quiz-q{background:var(--card);border:1.5px solid rgba(0,212,255,.15);border-radius:var(--r);padding:20px;margin:12px 0;text-align:center;font-size:17px;font-weight:700;line-height:1.5}
        .quiz-opts{width:100%;display:flex;flex-direction:column;gap:10px}
        .quiz-opt{background:var(--card);border:2px solid rgba(255,255,255,.08);border-radius:var(--r);padding:16px 18px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px;font-size:15px;font-weight:600}
        .quiz-opt:hover{border-color:rgba(255,107,43,.4);background:var(--card2);transform:translateY(-1px)}
        .quiz-opt.correct{border-color:#2ecc71;background:rgba(46,204,113,0.15)}
        .quiz-opt.correct .quiz-letter{background:#2ecc71}
        .quiz-opt.wrong{border-color:#e74c3c;background:rgba(231,76,60,0.15)}
        .quiz-opt.wrong .quiz-letter{background:#e74c3c}
        .quiz-opt.disabled{pointer-events:none;opacity:0.6}
        .quiz-opt.disabled.correct{opacity:1}
        .quiz-letter{width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center;font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;flex-shrink:0;transition:all .3s}
        .quiz-explain{background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:var(--r);padding:14px 18px;margin-top:12px;font-size:14px;line-height:1.5;display:none}
        .quiz-explain.show{display:block}
        .quiz-explain b{color:var(--electric)}
        .quiz-next{width:100%;padding:14px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;cursor:pointer;margin-top:14px;display:none;transition:all .25s;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .quiz-next:hover{transform:translateY(-2px)}
        .quiz-next.show{display:block}
        .quiz-nav{display:flex;gap:10px;width:100%;margin-top:14px}
        .quiz-nav button{flex:1;padding:14px;border:none;border-radius:var(--r);font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:all .25s;display:none}
        .quiz-nav button.show{display:block}
        .quiz-prev{background:var(--card);border:2px solid rgba(0,212,255,0.3) !important;color:var(--electric)}
        .quiz-prev:hover{border-color:var(--electric) !important;transform:translateY(-2px)}
        .quiz-fwd{background:linear-gradient(135deg,var(--accent),#e84500);color:white;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .quiz-fwd:hover{transform:translateY(-2px)}
        .quiz-result{text-align:center;width:100%}
        .quiz-result-score{font-family:'Fredoka',sans-serif;font-size:64px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .quiz-result-label{font-size:18px;color:var(--muted);margin-top:4px}
        .quiz-result-msg{font-size:16px;margin-top:16px;line-height:1.5}
        .quiz-medal{font-size:80px;margin:16px 0}
        .quiz-stars{display:flex;justify-content:center;gap:6px;margin:12px 0}
        .quiz-stars span{font-size:32px;opacity:0.2;transition:all 0.5s}
        .quiz-stars span.lit{opacity:1;animation:starPop 0.5s ease-out}
        @keyframes starPop{0%{transform:scale(0)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
        
        /* CELEBRATION EFFECTS */
        @keyframes screenShake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-4px)}30%,70%{transform:translateX(4px)}}
        @keyframes bigShake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-8px) rotate(-1deg)}30%,70%{transform:translateX(8px) rotate(1deg)}}
        @keyframes lightning{0%{opacity:0}5%{opacity:0.8}10%{opacity:0}15%{opacity:1}20%{opacity:0}100%{opacity:0}}
        @keyframes streakPulse{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
        @keyframes fireFloat{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-120px) scale(0.3);opacity:0}}
        .shake{animation:screenShake 0.4s ease}
        .big-shake{animation:bigShake 0.6s ease}
        .streak-badge{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:900;font-size:48px;font-family:'Fredoka',sans-serif;font-weight:700;color:white;text-shadow:0 0 30px rgba(255,107,43,0.8),0 0 60px rgba(255,107,43,0.4);animation:streakPulse 0.6s ease;pointer-events:none;white-space:nowrap}
        .lightning-flash{position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:850;pointer-events:none;animation:lightning 0.4s ease}
        .fire-emoji{position:fixed;z-index:850;font-size:36px;pointer-events:none;animation:fireFloat 1.2s ease-out forwards}
        
        /* PROFILE SYSTEM */
        .profile-btn{position:fixed;top:60px;right:20px;z-index:800;width:48px;height:48px;border-radius:50%;background:var(--card);border:2px solid rgba(255,215,0,0.4);color:var(--gold);font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .profile-btn:hover{transform:scale(1.1);border-color:var(--gold)}
        .prof-card{background:var(--card);border:2px solid rgba(255,215,0,0.2);border-radius:16px;padding:20px;text-align:center;width:100%}
        .prof-name{font-family:'Fredoka',sans-serif;font-size:24px;font-weight:700;margin-top:8px}
        .prof-title{color:var(--electric);font-size:13px;text-transform:uppercase;letter-spacing:1.5px;margin-top:4px}
        .prof-level{display:flex;align-items:center;justify-content:center;gap:12px;margin:16px 0}
        .prof-lvl-num{font-family:'Fredoka',sans-serif;font-size:48px;font-weight:700;background:linear-gradient(135deg,var(--gold),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .prof-xp{width:100%;margin-top:8px}
        .prof-xp-bar{width:100%;height:12px;background:rgba(255,255,255,0.08);border-radius:6px;overflow:hidden}
        .prof-xp-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--accent));border-radius:6px;transition:width 0.5s}
        .prof-xp-txt{font-size:12px;color:var(--muted);margin-top:4px}
        .prof-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:16px}
        .prof-stat{background:rgba(255,255,255,0.04);border-radius:12px;padding:12px 8px;text-align:center}
        .prof-stat-num{font-family:'Fredoka',sans-serif;font-size:22px;font-weight:700;color:var(--electric)}
        .prof-stat-label{font-size:11px;color:var(--muted);margin-top:2px}
        .medals-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:16px;width:100%}
        .medal-slot{background:var(--card);border:2px solid rgba(255,255,255,0.06);border-radius:14px;padding:16px 10px;text-align:center;transition:all 0.3s}
        .medal-slot.earned{border-color:rgba(255,215,0,0.3);background:rgba(255,215,0,0.05)}
        .medal-slot .medal-icon{font-size:36px;opacity:0.2}
        .medal-slot.earned .medal-icon{opacity:1}
        .medal-slot .medal-name{font-size:11px;margin-top:6px;color:var(--muted);font-weight:600}
        .medal-slot.earned .medal-name{color:var(--gold)}
        
        /* AVATAR PICKER - INDUSTRY THEMED */
        .prof-avatar{font-size:64px;cursor:pointer;transition:transform 0.3s;position:relative;display:flex;align-items:center;justify-content:center}
        .prof-avatar:hover{transform:scale(1.1)}
        .prof-avatar-edit{position:absolute;bottom:-4px;right:-4px;background:var(--accent);color:white;border-radius:50%;width:24px;height:24px;font-size:12px;display:flex;align-items:center;justify-content:center}
        .avatar-picker{display:none;background:var(--card);border:2px solid rgba(0,212,255,0.2);border-radius:16px;padding:16px;margin:12px auto 0;width:100%;max-width:400px}
        .avatar-picker.open{display:block}
        .avatar-picker-title{font-family:'Fredoka',sans-serif;font-size:15px;font-weight:700;color:var(--electric);margin-bottom:6px;text-align:center}
        .avatar-picker-sub{font-size:11px;color:var(--muted);text-align:center;margin-bottom:12px}
        .avatar-section{margin-bottom:14px}
        .avatar-section-title{font-family:'Fredoka',sans-serif;font-size:12px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px;padding-left:4px;display:flex;align-items:center;gap:6px}
        .avatar-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
        .avatar-option{padding:8px 4px;text-align:center;border-radius:12px;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:center;gap:4px}
        .avatar-option:hover{background:rgba(0,212,255,0.1);transform:scale(1.05)}
        .avatar-option.selected{border-color:var(--gold);background:rgba(255,215,0,0.1)}
        .avatar-option .av-icon{font-size:32px;line-height:1.2}
        .avatar-option .av-name{font-size:9px;color:var(--muted);font-weight:600;line-height:1.2;max-width:70px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .avatar-option.selected .av-name{color:var(--gold)}
        .avatar-option.locked{opacity:0.35;cursor:not-allowed;position:relative}
        .avatar-option.locked:hover{transform:none;background:rgba(255,255,255,0.03)}
        .avatar-option.locked .av-icon{filter:grayscale(1)}
        .avatar-option .av-lock{font-size:10px;color:var(--accent);font-weight:700;line-height:1}
        
        /* MUSIC PICKER */
        .music-panel{position:fixed;top:72px;right:12px;z-index:810;background:var(--card);border:2px solid rgba(0,212,255,0.2);border-radius:16px;padding:16px;width:290px;display:none;box-shadow:0 8px 32px rgba(0,0,0,0.5);max-height:80vh;overflow-y:auto}
        .music-panel.open{display:block;animation:fadeIn 0.3s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .music-panel-title{font-family:'Fredoka',sans-serif;font-size:14px;font-weight:700;color:var(--electric);margin-bottom:12px;text-align:center}
        .music-option{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;transition:all 0.2s;border:2px solid transparent;margin-bottom:6px;background:rgba(255,255,255,0.03)}
        .music-option:hover{background:rgba(0,212,255,0.08)}
        .music-option.selected{border-color:var(--electric);background:rgba(0,212,255,0.1)}
        .music-option-icon{font-size:24px;width:36px;text-align:center}
        .music-option-info{flex:1}
        .music-option-name{font-family:'Fredoka',sans-serif;font-size:14px;font-weight:600}
        .music-option-desc{font-size:11px;color:var(--muted)}
        .music-upload{margin-top:8px;padding:10px;border:2px dashed rgba(255,255,255,0.15);border-radius:10px;text-align:center;cursor:pointer;transition:all 0.2s}
        .music-upload:hover{border-color:var(--electric);background:rgba(0,212,255,0.05)}
        .music-upload-label{font-size:12px;color:var(--muted)}
        .music-upload-name{font-size:12px;color:var(--electric);margin-top:4px;font-weight:600;display:none}
        
        /* ========== 3-ZONE HUB ========== */
        .hub-title{font-family:'Fredoka',sans-serif;font-size:22px;font-weight:700;text-align:center;margin:8px 0 4px;color:var(--txt)}
        .hub-sub{font-size:13px;color:var(--muted);text-align:center;margin-bottom:16px}
        .zone-cards{width:100%;display:flex;flex-direction:column;gap:14px}
        .zone-card{background:var(--card);border:2.5px solid rgba(255,255,255,0.06);border-radius:20px;padding:20px 18px;cursor:pointer;transition:all 0.35s;display:flex;align-items:center;gap:16px;position:relative;overflow:hidden}
        .zone-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--zone-color,transparent) 0%,transparent 60%);opacity:0.06;transition:opacity 0.3s}
        .zone-card:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,0,0,0.3)}
        .zone-card:hover::before{opacity:0.12}
        .zone-card:active{transform:scale(0.98)}
        .zone-icon{width:64px;height:64px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:32px;flex-shrink:0;transition:all 0.3s}
        .zone-card:hover .zone-icon{transform:scale(1.08)}
        .zone-info{flex:1}
        .zone-name{font-family:'Fredoka',sans-serif;font-size:18px;font-weight:700;margin-bottom:2px}
        .zone-desc{font-size:12.5px;color:var(--muted);line-height:1.4}
        .zone-badge{position:absolute;top:12px;right:12px;font-size:10px;padding:3px 10px;border-radius:10px;font-weight:700;text-transform:uppercase;font-family:'Fredoka',sans-serif}
        .zone-stat{display:flex;gap:8px;margin-top:6px}
        .zone-stat-item{font-size:11px;color:var(--electric);font-weight:600;display:flex;align-items:center;gap:4px}
        .zone-card.quiz-zone{border-color:rgba(0,212,255,0.2);--zone-color:#00d4ff}
        .zone-card.quiz-zone .zone-icon{background:rgba(0,212,255,0.12);color:#00d4ff}
        .zone-card.quiz-zone .zone-name{color:#00d4ff}
        .zone-card.quiz-zone:hover{border-color:rgba(0,212,255,0.5)}
        .zone-card.study-zone{border-color:rgba(255,107,43,0.2);--zone-color:#ff6b2b}
        .zone-card.study-zone .zone-icon{background:rgba(255,107,43,0.12);color:#ff6b2b}
        .zone-card.study-zone .zone-name{color:#ff6b2b}
        .zone-card.study-zone:hover{border-color:rgba(255,107,43,0.5)}
        .zone-card.video-zone{border-color:rgba(155,89,182,0.2);--zone-color:#9b59b6}
        .zone-card.video-zone .zone-icon{background:rgba(155,89,182,0.12);color:#9b59b6}
        .zone-card.video-zone .zone-name{color:#9b59b6}
        .zone-card.video-zone:hover{border-color:rgba(155,89,182,0.5)}
        .zone-card.newbie-zone{border-color:rgba(52,152,219,0.2);--zone-color:#3498db}
        .zone-card.newbie-zone .zone-icon{background:rgba(52,152,219,0.12);color:#3498db}
        .zone-card.newbie-zone .zone-name{color:#3498db}
        .zone-card.newbie-zone:hover{border-color:rgba(52,152,219,0.5)}
        .zone-count{background:rgba(255,255,255,0.06);border-radius:8px;padding:2px 8px;font-size:11px;color:var(--muted);font-weight:600}
        
        /* STUDY ZONE */
        .study-empty{text-align:center;padding:40px 20px}
        .study-empty-icon{font-size:72px;margin-bottom:16px}
        .study-empty-title{font-family:'Fredoka',sans-serif;font-size:20px;font-weight:700;color:var(--electric);margin-bottom:8px}
        .study-empty-desc{font-size:14px;color:var(--muted);line-height:1.5;max-width:300px;margin:0 auto}
        .study-topic{background:var(--card);border:2px solid rgba(255,107,43,0.15);border-radius:14px;padding:14px 16px;margin-bottom:10px;cursor:pointer;transition:all 0.25s;display:flex;align-items:center;gap:12px}
        .study-topic:hover{border-color:var(--accent);transform:translateY(-2px)}
        .study-topic-icon{font-size:28px;width:44px;text-align:center}
        .study-topic-info{flex:1}
        .study-topic-name{font-family:'Fredoka',sans-serif;font-size:15px;font-weight:700}
        .study-topic-count{font-size:12px;color:var(--accent);font-weight:600;margin-top:2px}
        .study-alert{background:linear-gradient(135deg,rgba(255,107,43,0.12),rgba(231,76,60,0.08));border:1.5px solid rgba(255,107,43,0.25);border-radius:14px;padding:14px 16px;margin-bottom:16px;text-align:center;font-size:13px;color:var(--accent);line-height:1.5}
        .study-alert b{color:var(--txt)}
        
        /* VIDEO ZONE */
        .video-card{background:var(--card);border:2px solid rgba(155,89,182,0.15);border-radius:16px;padding:16px;margin-bottom:12px;cursor:pointer;transition:all 0.25s;display:flex;align-items:center;gap:14px}
        .video-card:hover{border-color:rgba(155,89,182,0.4);transform:translateY(-2px)}
        .video-card-thumb{width:72px;height:50px;border-radius:10px;background:rgba(155,89,182,0.15);display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
        .video-card-info{flex:1}
        .video-card-title{font-family:'Fredoka',sans-serif;font-size:14px;font-weight:700}
        .video-card-desc{font-size:11px;color:var(--muted);margin-top:2px}
        .video-card-dur{font-size:11px;color:#9b59b6;font-weight:600;margin-top:4px}
        .video-section-title{font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;color:var(--txt);margin:16px 0 10px;display:flex;align-items:center;gap:8px}
        
        /* FLOATING NAV FOR LIBRARY */
        .lib-float-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:460px;display:flex;gap:8px;padding:12px 18px;background:linear-gradient(to top,var(--dark) 70%,transparent);z-index:50;pointer-events:none}
        .lib-float-nav .bt{pointer-events:auto;box-shadow:0 -4px 20px rgba(0,0,0,0.5)}
        
        /* STUDY LIBRARY STYLES */
        .zone-card.library-zone{border-color:rgba(46,204,113,0.2);--zone-color:#2ecc71}
        .zone-card.library-zone .zone-icon{background:rgba(46,204,113,0.12);color:#2ecc71}
        .zone-card.library-zone .zone-name{color:#2ecc71}
        
        /* STUDY REDIRECT BANNER */
        .study-redirect{background:linear-gradient(135deg,rgba(255,107,43,0.15),rgba(231,76,60,0.1));border:2px solid rgba(255,107,43,0.3);border-radius:16px;padding:18px;margin-top:14px;text-align:center;animation:pulse-border 2s infinite}
        @keyframes pulse-border{0%,100%{border-color:rgba(255,107,43,0.3)}50%{border-color:rgba(255,107,43,0.7)}}
        .study-redirect-icon{font-size:40px;margin-bottom:8px}
        .study-redirect-title{font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;color:var(--accent)}
        .study-redirect-desc{font-size:13px;color:var(--muted);margin:6px 0 12px;line-height:1.4}
        
        /* ========== FORMULA HELPER ========== */
        .formula-helper{display:none;width:100%;margin:8px 0;animation:si .4s ease}
        .formula-helper.show{display:block}
        .formula-hint{background:linear-gradient(135deg,rgba(0,212,255,0.08),rgba(99,102,241,0.06));border:1.5px solid rgba(0,212,255,0.2);border-radius:14px;padding:12px 16px;margin-bottom:8px}
        .formula-hint-title{font-family:'Fredoka',sans-serif;font-size:13px;font-weight:700;color:var(--electric);display:flex;align-items:center;gap:8px;margin-bottom:6px}
        .formula-hint-text{font-size:14px;color:var(--txt);line-height:1.4}
        .formula-hint-text .formula-big{font-family:'Fredoka',sans-serif;font-size:22px;font-weight:700;color:var(--gold);display:block;text-align:center;margin:8px 0;letter-spacing:1px}
        .formula-hint-text .formula-vars{font-size:12px;color:var(--muted);text-align:center;display:block;margin-top:2px}
        .formula-toggle{background:var(--card);border:2px solid rgba(0,212,255,0.2);border-radius:12px;padding:10px 16px;cursor:pointer;transition:all 0.25s;display:flex;align-items:center;justify-content:center;gap:8px;font-family:'Fredoka',sans-serif;font-size:14px;font-weight:600;color:var(--electric);margin-bottom:8px}
        .formula-toggle:hover{border-color:var(--electric);background:rgba(0,212,255,0.05)}
        .formula-toggle.open{border-color:var(--electric);background:rgba(0,212,255,0.08)}
        
        /* POWER WHEEL */
        .power-wheel{display:none;margin:10px auto;text-align:center}
        .power-wheel.show{display:block}
        .pw-container{position:relative;width:220px;height:220px;margin:0 auto}
        .pw-svg{width:100%;height:100%}
        .pw-label{font-size:11px;color:var(--muted);text-align:center;margin-top:6px}
        
        /* MOTIVATIONAL QUOTE */
        .motive-bar{display:none;width:100%;background:linear-gradient(135deg,rgba(255,107,43,0.06),rgba(241,196,15,0.04));border:1px solid rgba(241,196,15,0.15);border-radius:12px;padding:10px 14px;margin:6px 0;text-align:center}
        .motive-bar.show{display:block}
        .motive-text{font-size:12.5px;color:var(--gold);font-style:italic;line-height:1.4}
        .motive-author{font-size:10px;color:var(--muted);margin-top:3px;font-weight:600}
    </style>
</head>
<body>
<div class="bg"><div class="o"></div><div class="o"></div><div class="o"></div></div>
<div class="gr"></div>

<!-- VIDEO FLOTANTE DESDE LA DERECHA -->
<div class="video-float" id="videoFloat">
    <div class="video-float-glow"></div>
    <div class="video-float-inner">
        <div class="video-float-label" id="videoLabel">ðŸ”´ EN VIVO</div>
        <button class="video-float-close" onclick="closeVideo()">âœ•</button>
        <video id="marioVideo" playsinline webkit-playsinline></video>
        <div id="videoSubtitle" style="position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,0.85));padding:16px 12px 10px;text-align:center;font-family:'Fredoka',sans-serif;pointer-events:none">
            <div style="color:#ffd700;font-size:11px;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.8)">âš¡ Si no mides, estÃ¡s adivinando</div>
            <div style="color:rgba(255,255,255,0.7);font-size:9px;font-style:italic;margin-top:2px;text-shadow:0 1px 3px rgba(0,0,0,0.8)">If you don't measure, you're guessing</div>
        </div>
    </div>
</div>

<!-- MODAL AI CHAT -->
<div class="ai-modal" id="aiModal">
    <div class="ai-chat">
        <div class="ai-chat-header">
            <div class="ai-chat-avatar"><img src="mario.jpg" alt="Mario"></div>
            <div class="ai-chat-title"><h3>Maestro Mario AI</h3><span id="aiChatStatus">ðŸŸ¢ Disponible para ayudarte</span></div>
            <button class="ai-chat-close" onclick="closeAIChat()">âœ•</button>
        </div>
        <div class="ai-chat-messages" id="aiMessages">
            <div class="ai-msg mario" id="aiChatWelcome">Â¡Ã“rale! Soy el Maestro Mario con inteligencia artificial. Â¿En quÃ© te puedo ayudar? PregÃºntame lo que quieras sobre HVAC, refrigeraciÃ³n, o electricidad. ðŸ”§</div>
        </div>
        <div class="speaking-indicator" id="speakingIndicator">
            <div class="waves"><div class="wave"></div><div class="wave"></div><div class="wave"></div><div class="wave"></div></div>
            <span id="aiChatTyping">Maestro Mario estÃ¡ hablando...</span>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiInput" placeholder="Escribe tu pregunta..." onkeydown="if(event.key==='Enter'&&!event.shiftKey)sendAIMessage()">
            <button id="sendBtn" onclick="sendAIMessage()">âž¤</button>
        </div>
    </div>
</div>

<!-- AUDIO PLAYER PARA VOZ DE AI -->
<audio id="aiAudio" style="display:none"></audio>

<div class="app">
<!-- PANTALLA INICIO -->
<div class="s on" id="s0"><div class="sp">
    <div class="aw lg" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="Maestro Mario"></div><span class="ai-badge">AI</span></div>
    <div><div class="sp-t">MAESTRO<br>MARIO</div><div class="badge">âš¡ NIVEL 33</div></div>
    <div class="sp-s">Si no mides, estÃ¡s adivinando<br><span style="font-size:12px;opacity:0.7;font-style:italic">If you don't measure, you're guessing</span></div>
    <button class="bt" onclick="startWithVideo()" style="max-width:260px">Comenzar / Start</button>
    <div style="margin-top:24px;text-align:center">
      <div style="font-family:'Fredoka',sans-serif;font-size:14px;font-weight:700;color:#ffffff;letter-spacing:3px;text-transform:uppercase;text-shadow:0 0 15px rgba(37,99,235,0.4)">A.C. VOLT TECHNICAL SCHOOLâ„¢</div>
      <div style="font-size:9px;color:rgba(255,255,255,0.5);margin-top:6px;letter-spacing:1px">Â© 2026 A.C. VOLT TECH SCHOOL, INC. All Rights Reserved.</div>
    </div>
</div></div>

<!-- IDIOMA -->
<div class="s" id="s1">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div><div class="lo-s">HVAC â€¢ ELECTRICAL â€¢ TRAINING</div></div>
    <div class="aw md" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb">Â¡Hola! Choose your language<br>Elige tu idioma</div>
    <div class="fl"><div class="fc" onclick="setLang('es')"><span class="fe" style="font-size:28px;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-family:'Fredoka',sans-serif;font-weight:700">ES</span><span class="fn">EspaÃ±ol</span></div><div class="fc" onclick="setLang('en')"><span class="fe" style="font-size:28px;background:linear-gradient(135deg,var(--electric),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-family:'Fredoka',sans-serif;font-weight:700">EN</span><span class="fn">English</span></div></div>
</div>

<!-- NOMBRE -->
<div class="s" id="s2">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:20%"></div></div><div class="ps"><b data-t="step_1"></b></div>
    <div class="aw md" id="a2" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb2"><span data-t="welcome_speech"></span></div>
    <div style="width:100%"><input class="ip" id="nm" data-tp="name_ph" oninput="document.getElementById('b2').disabled=this.value.trim().length<2"><button class="bt" id="b2" disabled onclick="sName()" data-t="continue"></button></div>
</div>

<!-- NIVEL -->
<div class="s" id="s3">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:40%"></div></div><div class="ps"><b data-t="step_2"></b></div>
    <div class="aw sm" id="a3" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb3"><span data-t="level_speech"></span></div>
    <div class="os" id="lo"></div>
    <button class="bt" id="b3" disabled onclick="sLvl()" data-t="continue"></button>
</div>

<!-- ESPECIALIDADES -->
<div class="s" id="s4">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:60%"></div></div><div class="ps"><b data-t="step_3"></b></div>
    <div class="aw sm" id="a4" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb4"><span data-t="spec_speech"></span></div>
    <p class="mh" data-t="multi_hint"></p>
    <div class="os" id="so"></div>
    <button class="bt" id="b4" disabled onclick="sSpc()" data-t="continue"></button>
</div>

<!-- ESCUELA -->
<div class="s" id="s5">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:80%"></div></div><div class="ps"><b data-t="step_4"></b></div>
    <div class="aw sm" id="a5" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb5"><span data-t="school_speech"></span></div>
    <div class="os" id="sco"></div>
    <button class="bt" id="b5" disabled onclick="sSch()" data-t="continue"></button>
</div>

<!-- METAS -->
<div class="s" id="s6">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:90%"></div></div><div class="ps"><b data-t="step_5"></b></div>
    <div class="aw sm" id="a6" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb6"><span data-t="goals_speech"></span></div>
    <p class="mh" data-t="multi_hint"></p>
    <div class="os" id="go2"></div>
    <button class="bt" id="b6" disabled onclick="sGol()" data-t="continue"></button>
</div>

<!-- RUTA FINAL -->
<div class="s" id="s7">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:100%"></div></div>
    <div class="aw md" id="a7" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--gold) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb7"><span data-t="route_speech"></span></div>
    <div id="rl" style="width:100%"></div>
    <button class="bt" onclick="startApp()" data-t="start_btn"></button>
</div>

<!-- ========== 3-ZONE HUB ========== -->
<div class="s" id="s-hub">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--electric) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="hubBubble">Â¿QuÃ© quieres hacer hoy?</div>
    
    <div class="zone-cards">
        <!-- I'M NEW TO HVAC ZONE (FIRST - for beginners) -->
        <div class="zone-card newbie-zone" onclick="goNewbieZone()">
            <div class="zone-icon">ðŸ†•</div>
            <div class="zone-info">
                <div class="zone-name" style="color:#3498db" id="hubNewbieName">Soy Nuevo en HVAC</div>
                <div class="zone-desc" id="hubNewbieDesc">IntroducciÃ³n a HVACR: la industria, herramientas, terminologÃ­a, salarios y cÃ³mo empezar tu carrera</div>
                <div class="zone-stat">
                    <span class="zone-stat-item" id="hubNewbieStat">ðŸŽ“ 8 temas + 50 preguntas</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(52,152,219,0.15);color:#3498db" id="hubNewbieBadge">Nivel 1</div>
        </div>
        
        <!-- QUIZ ZONE -->
        <div class="zone-card quiz-zone" onclick="goQuizZone()">
            <div class="zone-icon">ðŸ“</div>
            <div class="zone-info">
                <div class="zone-name" id="hubQuizName">Quiz Zone</div>
                <div class="zone-desc" id="hubQuizDesc">Toma quizzes y demuestra lo que sabes</div>
                <div class="zone-stat">
                    <span class="zone-stat-item" id="hubQuizCount">ðŸ“‹ 0 quizzes</span>
                    <span class="zone-stat-item" id="hubQuizTotal">ðŸ“Š 0 preguntas</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(0,212,255,0.15);color:#00d4ff" id="hubQuizBadge">Â¡Vamos!</div>
        </div>
        
        <!-- ZONA DE REPASO (failed questions) -->
        <div class="zone-card study-zone" onclick="goStudyZone()">
            <div class="zone-icon">ðŸ”„</div>
            <div class="zone-info">
                <div class="zone-name" id="hubRepasoName">Zona de Repaso</div>
                <div class="zone-desc" id="hubRepasoDesc">Repasa solo las preguntas que fallaste en los quizzes</div>
                <div class="zone-stat">
                    <span class="zone-stat-item" id="hubStudyCount">ðŸ”„ 0 por repasar</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(255,107,43,0.15);color:#ff6b2b;display:none" id="hubStudyBadge">âš ï¸ Repasa</div>
        </div>
        
        <!-- ZONA DE ESTUDIO (all questions with explanations) -->
        <div class="zone-card" style="border-color:rgba(46,204,113,0.2)" onclick="goStudyLibrary()">
            <div class="zone-icon" style="background:rgba(46,204,113,0.12);color:#2ecc71">ðŸ“–</div>
            <div class="zone-info">
                <div class="zone-name" style="color:#2ecc71" id="hubEstudioName">Zona de Estudio</div>
                <div class="zone-desc" id="hubEstudioDesc">Todas las preguntas con explicaciones detalladas, fÃ³rmulas y ejemplos de campo</div>
                <div class="zone-stat">
                    <span class="zone-stat-item" id="hubLibraryCount">ðŸ“– 0 temas disponibles</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(46,204,113,0.15);color:#2ecc71">ðŸ“– Estudia</div>
        </div>
        
        <!-- VIDEO ZONE -->
        <div class="zone-card video-zone" onclick="goVideoZone()">
            <div class="zone-icon">ðŸŽ¥</div>
            <div class="zone-info">
                <div class="zone-name" id="hubVideoName">Video Zone</div>
                <div class="zone-desc" id="hubVideoDesc">Videos de Maestro Mario para aprender visualmente</div>
                <div class="zone-stat">
                    <span class="zone-stat-item">ðŸŽ¬ Videos de entrenamiento</span>
                </div>
            </div>
            <div class="zone-badge" style="background:rgba(155,89,182,0.15);color:#9b59b6">Pronto</div>
        </div>
    </div>
    
    <button class="bt" onclick="go('s10');renderProfile()" style="background:var(--card);border:2px solid var(--gold);margin-top:16px" id="hubProfileBtn">ðŸ‘¤ Mi Perfil</button>
    <button class="bt" onclick="go('s7')" style="background:var(--card);border:2px solid var(--accent);margin-top:8px" id="hubRutaBtn">â† Mi Ruta</button>
</div>

<!-- I'M NEW TO HVAC ZONE -->
<div class="s" id="s-newbie">
    <div class="lo"><div class="lo-t" id="newbieTitle">ðŸ†• SOY NUEVO EN HVAC</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,#3498db 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="newbieBubble">Â¡Bienvenido al mundo HVAC! AquÃ­ te explico todo lo que necesitas saber para empezar.</div>
    
    <!-- QUIZ BUTTON -->
    <button class="bt" onclick="startIntroQuiz()" style="background:linear-gradient(135deg,#3498db,#2980b9);margin-bottom:16px;font-size:16px;padding:16px" id="newbieQuizBtn">ðŸ“ Tomar Quiz Intro HVACR (50 preguntas)</button>
    
    <div id="newbieContent" style="width:100%;display:flex;flex-direction:column;gap:14px;margin-top:8px"></div>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid #3498db;margin-top:16px" data-lang="volver-hub">â† Volver al Hub</button>
</div>

<!-- QUIZ ZONE SELECTOR -->
<div class="s" id="s7b">
    <div class="lo"><div class="lo-t">ðŸ“ QUIZ ZONE</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--electric) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="quizSelBubble">Â¿QuÃ© quiz quieres tomar hoy?</div>
    <div id="quizSelList" style="width:100%;display:flex;flex-direction:column;gap:12px;margin-top:16px"></div>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--electric);margin-top:16px" data-lang="volver-hub">â† Volver al Hub</button>
</div>

<!-- STUDY ZONE -->
<div class="s" id="s-study">
    <div class="lo"><div class="lo-t" id="repasoTitle">ðŸ”„ ZONA DE REPASO</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--accent) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="studyBubble"></div>
    <div id="studyContent" style="width:100%;margin-top:16px"></div>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);margin-top:16px" data-lang="volver-hub">â† Volver al Hub</button>
</div>

<!-- STUDY QUIZ (reuses quiz UI but in study mode) -->
<div class="s" id="s-study-quiz">
    <div class="quiz-header">
        <div class="quiz-cat" id="sqCat">ðŸ“š REPASO</div>
        <div class="quiz-score">âœ… <span class="correct" id="sqRight">0</span> | âŒ <span class="wrong" id="sqWrong">0</span></div>
    </div>
    <div class="pb"><div class="pbf" id="sqBar" style="width:0%"></div></div>
    <div class="quiz-num" id="sqNum"></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="sqBubble"></div>
    <div class="quiz-q" id="sqText"></div>
    <div class="quiz-opts" id="sqOpts"></div>
    <div class="quiz-explain" id="sqExplain"></div>
    <div class="quiz-nav">
        <button class="quiz-prev" id="sqPrev" onclick="studyPrev()"></button>
        <button class="quiz-fwd" id="sqNext" onclick="studyNext()"></button>
    </div>
</div>

<!-- STUDY RESULT -->
<div class="s" id="s-study-result">
    <div class="aw md" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--accent) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="quiz-result">
        <div class="quiz-medal" id="srMedal"></div>
        <div class="quiz-result-score" id="srScore"></div>
        <div class="quiz-result-label" id="srLabel"></div>
        <div class="bb quiz-result-msg" id="srMsg"></div>
    </div>
    <button class="bt" onclick="startStudyQuiz(lastStudyCat)" id="studyRetryBtn">ðŸ”„ Repasar de Nuevo</button>
    <button class="bt" onclick="go('s-study');renderStudyZone()" style="background:var(--card);border:2px solid var(--accent);margin-top:10px" id="studyZoneRepasoBtn">ðŸ”„ Zona de Repaso</button>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--electric);margin-top:10px" data-lang="volver-hub">â† Volver al Hub</button>
</div>

<!-- ZONA DE ESTUDIO - ALL QUESTIONS WITH EXPLANATIONS -->
<div class="s" id="s-library">
    <div class="lo"><div class="lo-t" id="estudioTitle">ðŸ“– ZONA DE ESTUDIO</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,#2ecc71 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="libraryBubble"></div>
    <div id="libraryContent" style="width:100%;margin-top:16px;padding-bottom:80px"></div>
    <!-- FLOATING NAV -->
    <div class="lib-float-nav">
        <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);flex:1;margin:0;font-size:14px;padding:12px" data-lang="volver-hub">â† Volver al Hub</button>
    </div>
</div>

<!-- STUDY LIBRARY DETAIL VIEW -->
<div class="s" id="s-library-detail">
    <div class="lo"><div class="lo-t" id="libDetailTitle">ðŸ“– TEMA</div></div>
    <div id="libDetailContent" style="width:100%;margin-top:12px;padding-bottom:120px"></div>
    <!-- FLOATING NAV BUTTONS -->
    <div class="lib-float-nav">
        <button class="bt" onclick="go('s-library');renderStudyLibrary()" style="background:linear-gradient(135deg,#2ecc71,#1a9955);flex:1;margin:0;font-size:13px;padding:12px 8px"><span id="floatLibBtn">ðŸ“– Zona de Estudio</span></button>
        <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);flex:1;margin:0;font-size:13px;padding:12px 8px">â† Hub</button>
    </div>
</div>

<!-- VIDEO ZONE -->
<div class="s" id="s-videos">
    <div class="lo"><div class="lo-t">ðŸŽ¥ VIDEO ZONE</div></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,#9b59b6 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="videoBubble">Videos del Maestro Mario para que aprendas viendo.</div>
    <div id="videoContent" style="width:100%;margin-top:16px"></div>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid rgba(155,89,182,0.3);margin-top:16px" data-lang="volver-hub">â† Volver al Hub</button>
</div>

<!-- QUIZ -->
<div class="s" id="s8">
    <div class="quiz-header">
        <div class="quiz-cat" id="qCat"></div>
        <div class="quiz-score">âœ… <span class="correct" id="qRight">0</span> | âŒ <span class="wrong" id="qWrong">0</span></div>
    </div>
    <div class="pb"><div class="pbf" id="qBar" style="width:0%"></div></div>
    <div class="quiz-num" id="qNum"></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="qBubble"></div>
    <div class="motive-bar" id="qMotive"><div class="motive-text" id="qMotiveText"></div><div class="motive-author" id="qMotiveAuthor"></div></div>
    <div class="formula-helper" id="qFormula">
        <div class="formula-toggle" id="qFormToggle" onclick="toggleFormulaDetail()">ðŸ“ <span id="qFormToggleText"></span></div>
        <div class="formula-hint" id="qFormDetail" style="display:none">
            <div class="formula-hint-title" id="qFormTitle">ðŸ“ FÃ³rmula Necesaria</div>
            <div class="formula-hint-text" id="qFormText"></div>
        </div>
        <div class="power-wheel" id="qPowerWheel">
            <div class="pw-container">
                <svg class="pw-svg" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg">
                    <!-- Outer circle -->
                    <circle cx="150" cy="150" r="145" fill="none" stroke="rgba(0,212,255,0.25)" stroke-width="2"/>
                    <!-- Inner circle (center) -->
                    <circle cx="150" cy="150" r="42" fill="rgba(255,255,255,0.04)" stroke="rgba(255,255,255,0.15)" stroke-width="1.5"/>
                    <!-- Cross dividers -->
                    <line x1="150" y1="5" x2="150" y2="295" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                    <line x1="5" y1="150" x2="295" y2="150" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                    
                    <!-- TOP QUADRANT: POWER (P/W) â€” yellow -->
                    <text x="150" y="32" text-anchor="middle" fill="#f1c40f" font-family="Fredoka" font-size="20" font-weight="700">P (Watts)</text>
                    <text x="150" y="58" text-anchor="middle" fill="#f1c40f" font-size="11" font-weight="600">V Ã— I</text>
                    <text x="150" y="74" text-anchor="middle" fill="#daa520" font-size="10">IÂ² Ã— R</text>
                    <text x="150" y="89" text-anchor="middle" fill="#daa520" font-size="10">VÂ² Ã· R</text>
                    
                    <!-- LEFT QUADRANT: VOLTAGE (V/E) â€” cyan -->
                    <text x="54" y="140" text-anchor="middle" fill="#00d4ff" font-family="Fredoka" font-size="20" font-weight="700">V (Volts)</text>
                    <text x="54" y="162" text-anchor="middle" fill="#00d4ff" font-size="11" font-weight="600">I Ã— R</text>
                    <text x="54" y="178" text-anchor="middle" fill="#0099bb" font-size="10">P Ã· I</text>
                    <text x="54" y="193" text-anchor="middle" fill="#0099bb" font-size="10">âˆš(P Ã— R)</text>
                    
                    <!-- RIGHT QUADRANT: CURRENT (I/A) â€” orange -->
                    <text x="246" y="140" text-anchor="middle" fill="#ff6b2b" font-family="Fredoka" font-size="20" font-weight="700">I (Amps)</text>
                    <text x="246" y="162" text-anchor="middle" fill="#ff6b2b" font-size="11" font-weight="600">V Ã· R</text>
                    <text x="246" y="178" text-anchor="middle" fill="#cc4400" font-size="10">P Ã· V</text>
                    <text x="246" y="193" text-anchor="middle" fill="#cc4400" font-size="10">âˆš(P Ã· R)</text>
                    
                    <!-- BOTTOM QUADRANT: RESISTANCE (R/Î©) â€” green -->
                    <text x="150" y="222" text-anchor="middle" fill="#2ecc71" font-family="Fredoka" font-size="20" font-weight="700">R (Ohms)</text>
                    <text x="150" y="244" text-anchor="middle" fill="#2ecc71" font-size="11" font-weight="600">V Ã· I</text>
                    <text x="150" y="260" text-anchor="middle" fill="#1a9955" font-size="10">VÂ² Ã· P</text>
                    <text x="150" y="275" text-anchor="middle" fill="#1a9955" font-size="10">P Ã· IÂ²</text>
                    
                    <!-- Center labels -->
                    <text x="150" y="145" text-anchor="middle" fill="white" font-family="Fredoka" font-size="13" font-weight="700">OHM</text>
                    <text x="150" y="161" text-anchor="middle" fill="var(--muted)" font-size="10">+ WATT</text>
                </svg>
            </div>
            <div class="pw-label">âš¡ Power Wheel â€” 12 FÃ³rmulas: Ley de Ohm + Ley de Watt</div>
        </div>
    </div>
    <div class="quiz-q" id="qText"></div>
    <div class="quiz-opts" id="qOpts"></div>
    <div class="quiz-explain" id="qExplain"></div>
    <div class="quiz-nav">
        <button class="quiz-prev" id="qPrev" onclick="prevQuestion()"></button>
        <button class="quiz-fwd" id="qNext" onclick="nextQuestion()"></button>
    </div>
</div>

<!-- QUIZ RESULT -->
<div class="s" id="s9">
    <div class="aw md" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--gold) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="quiz-result">
        <div class="quiz-medal" id="rMedal"></div>
        <div class="quiz-result-score" id="rScore"></div>
        <div class="quiz-result-label" id="rLabel"></div>
        <div class="quiz-stars" id="rStars"><span>â­</span><span>â­</span><span>â­</span><span>â­</span><span>â­</span></div>
        <div class="bb quiz-result-msg" id="rMsg"></div>
        <div id="rMedalEarned" style="display:none;margin-top:16px;padding:16px;background:rgba(255,215,0,0.1);border:2px solid var(--gold);border-radius:14px;text-align:center">
            <div style="font-size:48px" id="rNewMedal"></div>
            <div style="font-family:'Fredoka',sans-serif;font-size:18px;font-weight:700;color:var(--gold);margin-top:8px" id="rMedalName"></div>
        </div>
        <!-- STUDY ZONE REDIRECT (shown when score < 70%) -->
        <div class="study-redirect" id="rStudyRedirect" style="display:none">
            <div class="study-redirect-icon">ðŸ“š</div>
            <div class="study-redirect-title" id="studyRedirectTitle">Â¡El Maestro Mario te recomienda repasar!</div>
            <div class="study-redirect-desc" id="rStudyDesc">Tienes preguntas que necesitas reforzar. Ve a la Study Zone para dominarlas.</div>
            <button class="bt" onclick="go('s-study');renderStudyZone()" style="background:var(--accent);margin-top:8px;padding:12px"><span class='lang-repaso-btn'>ðŸ”„ Ir a Zona de Repaso â†’</span></button>
        </div>
    </div>
    <button class="bt" onclick="retryQuiz()" id="retryBtn">ðŸ”„ Intentar de Nuevo</button>
    <button class="bt" onclick="renderQuizSelector();go('s7b')" style="background:var(--card);border:2px solid var(--electric);margin-top:10px" id="otherQuizBtn">ðŸ“ Otro Quiz</button>
    <button class="bt" onclick="go('s10');renderProfile()" style="background:var(--card);border:2px solid var(--gold);margin-top:10px" id="viewProfileBtn">ðŸ‘¤ Ver Mi Perfil</button>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);margin-top:10px" data-lang="volver-hub">â† Volver al Hub</button>
</div>

<!-- PROFILE -->
<div class="s" id="s10">
    <div class="prof-card">
        <div class="prof-avatar" id="profAvatar" onclick="toggleAvatarPicker()">ðŸ‘¤<div class="prof-avatar-edit">âœï¸</div></div>
        <div class="avatar-picker" id="avatarPicker">
            <div class="avatar-picker-title" id="avatarPickerTitle">ðŸ”§ Elige tu Avatar</div>
            <div class="avatar-picker-sub" id="avatarPickerSub">Desbloquea avatares dominando quizzes y subiendo de nivel</div>
            <div id="avatarGrid"></div>
        </div>
        <div class="prof-name" id="profName"></div>
        <div class="prof-title" id="profTitle"></div>
        <div class="prof-level">
            <div>
                <div style="font-size:12px;color:var(--muted)" id="profLevelLabel">NIVEL</div>
                <div class="prof-lvl-num" id="profLevel">1</div>
            </div>
        </div>
        <div class="prof-xp">
            <div class="prof-xp-bar"><div class="prof-xp-fill" id="profXpBar" style="width:0%"></div></div>
            <div class="prof-xp-txt" id="profXpTxt">0 / 100 XP</div>
        </div>
    </div>
    <div class="prof-stats">
        <div class="prof-stat"><div class="prof-stat-num" id="profPts">0</div><div class="prof-stat-label" id="profPtsLabel">Puntos</div></div>
        <div class="prof-stat"><div class="prof-stat-num" id="profAcc">0%</div><div class="prof-stat-label" id="profAccLabel">PrecisiÃ³n</div></div>
        <div class="prof-stat"><div class="prof-stat-num" id="profStrk">0</div><div class="prof-stat-label" id="profStrkLabel">Mejor Racha</div></div>
    </div>
    <div style="width:100%;margin-top:20px;font-family:'Fredoka',sans-serif;font-size:18px;font-weight:700;text-align:center" id="profMedalsTitle">ðŸ… Medallas</div>
    <div class="medals-grid" id="medalsGrid"></div>
    <div id="crossAppSection" style="display:none;width:100%;margin-top:20px">
      <div style="font-family:'Fredoka',sans-serif;font-size:18px;font-weight:700;text-align:center;margin-bottom:12px">ðŸ“Š <span id="crossAppTitle">Progreso Total</span></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div style="background:var(--card2);border-radius:12px;padding:12px;text-align:center;border:1px solid rgba(0,212,255,0.15)">
          <div style="font-size:11px;color:var(--muted)">Maestro Mario AI</div>
          <div style="font-size:24px;font-weight:700;color:var(--electric)" id="crossV2Quizzes">0</div>
          <div style="font-size:11px;color:var(--muted)">quizzes</div>
        </div>
        <div style="background:var(--card2);border-radius:12px;padding:12px;text-align:center;border:1px solid rgba(255,107,43,0.15)">
          <div style="font-size:11px;color:var(--muted)">Maestro ACVOLT</div>
          <div style="font-size:24px;font-weight:700;color:var(--accent)" id="crossV1Quizzes">0</div>
          <div style="font-size:11px;color:var(--muted)">quizzes</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:10px">
        <div style="background:var(--card2);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:700;color:var(--gold)" id="crossTotalQuizzes">0</div>
          <div style="font-size:10px;color:var(--muted)" id="crossTotalLabel">Total Quizzes</div>
        </div>
        <div style="background:var(--card2);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:700;color:#2ecc71" id="crossAvgScore">0%</div>
          <div style="font-size:10px;color:var(--muted)" id="crossAvgLabel">Promedio</div>
        </div>
        <div style="background:var(--card2);border-radius:10px;padding:10px;text-align:center">
          <div style="font-size:20px;font-weight:700;color:#9b59b6" id="crossCerts">0</div>
          <div style="font-size:10px;color:var(--muted)" id="crossCertsLabel">Certificados</div>
        </div>
      </div>
    </div>
    <button class="bt" onclick="renderQuizSelector();go('s7b')" style="margin-top:20px" id="profQuizBtn">ðŸ“ Tomar un Quiz</button>
    <button class="bt" onclick="toggleMusicPanel()" style="background:var(--card);border:2px solid rgba(0,212,255,0.3);margin-top:10px" id="profMusicBtn">ðŸŽ¶ Cambiar MÃºsica</button>
    <button class="bt" onclick="go('s-hub');updateHub()" style="background:var(--card);border:2px solid var(--accent);margin-top:10px" data-lang="volver-hub">â† Volver al Hub</button>
    <button class="bt" onclick="exitApp()" style="background:rgba(255,60,60,0.15);border:2px solid rgba(255,60,60,0.4);color:#ff4444;margin-top:20px" id="exitAppBtn">ðŸšª Salir del App</button>
</div>
</div>
<div class="cw" id="conf"></div>
<button class="music-btn" id="musicBtn" onclick="toggleMusic()">ðŸŽµ</button>
<button class="music-settings" onclick="toggleMusicPanel()">ðŸŽ¶</button>
<div class="music-panel" id="musicPanel">
    <div class="music-panel-title" id="musicPanelTitle">ðŸŽ¶ Elige tu mÃºsica</div>
    <div id="musicOptions"></div>
    <div class="music-upload" onclick="document.getElementById('musicFile').click()">
        <div>ðŸ“ <b>Mi MÃºsica</b></div>
        <div class="music-upload-label">Sube tu MP3, WAV o audio favorito</div>
        <div class="music-upload-name" id="musicFileName"></div>
    </div>
    <input type="file" id="musicFile" accept="audio/*" style="display:none" onchange="loadCustomMusic(this)">
</div>
<button class="profile-btn" id="profileBtn" onclick="go('s10');renderProfile()">ðŸ‘¤</button>

<script src="quiz-refrigeracion-200.js"></script>
<script src="quiz-intro.js"></script>
<script>
const D={lang:'es',name:'',level:null,specs:[],school:null,goals:[],gender:'m'};

// Female name detection for inclusive language
const FEMALE_NAMES=new Set(['maria','maria','ana','andrea','adriana','alejandra','alicia','amanda','amelia','angela','angelica','angie','anna','beatriz','belen','bianca','blanca','brenda','camila','carla','carmen','carolina','catalina','cecilia','celia','claudia','cristina','daniela','danna','diana','elena','elisa','elizabeth','erika','esmeralda','esperanza','estela','esther','eva','fatima','fernanda','flora','francisca','gabriela','genesis','giselle','gladys','gloria','grace','graciela','guadalupe','heidi','ingrid','irene','iris','isabel','isabella','ivana','ivonne','jacqueline','janet','jasmin','jazmin','jennifer','jessica','jimena','joana','josefina','juana','julia','juliana','julieta','karen','karla','karina','katherine','katia','keyla','laura','leonor','leticia','lilia','liliana','linda','lisa','lorena','lucia','luciana','luisa','lupita','luz','magaly','magda','magdalena','maira','manuela','marcela','margarita','mariana','maribel','marisol','marlene','marta','martha','mayra','melanie','melissa','mercedes','michelle','miriam','monica','nadia','nancy','natalia','natasha','nicole','nidia','noemi','nora','norma','olga','paola','patricia','paula','perla','pilar','priscila','raquel','rebeca','regina','renata','rocio','rosa','rosalba','rosario','roxana','ruth','sabrina','samantha','sandra','sara','selena','silvia','sofia','soledad','sonia','stefania','stephanie','susana','tamara','tatiana','teresa','valentina','valeria','vanessa','veronica','victoria','violeta','virginia','viviana','wendy','ximena','yesenia','yolanda','yuri','zoe','zoila']);

function detectGender(name){
    const first=name.trim().split(/\s+/)[0].toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
    return FEMALE_NAMES.has(first)?'f':'m';
}

// Gender-aware helper: returns male or female form
function gn(m,f){return D.gender==='f'?f:m;}
let videoPlaying=false;
let currentVideoCallback=null;
let isSpeaking=false;
let audioUnlocked=false;

function unlockAudio(){
    if(audioUnlocked)return;
    const audio=document.getElementById('aiAudio');
    audio.src='data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYoRwAAAAAAAAAAAAAAAAAAAAAAAA==';
    audio.play().then(()=>{audio.pause();audioUnlocked=true;}).catch(()=>{});
}

// ========== CHIPTUNE MUSIC ENGINE ==========
let musicCtx=null;
let musicPlaying=false;
let musicMuted=false;
let musicGain=null;
let musicTimers=[];
let musicVolume=0.5;
let musicMode='onboarding';
let currentMusicStyle='pokemon';
let customAudio=null;
let musicPanelOpen=false;

const MUSIC_STYLES=[
    {id:'pokemon',icon:'ðŸŽ®',name:'PokÃ©mon Adventure',desc:'8-bit clÃ¡sico',desc_en:'8-bit classic'},
    {id:'lofi',icon:'ðŸŽ§',name:'Lo-Fi Chill',desc:'Relajado para estudiar',desc_en:'Relaxed for studying'},
    {id:'battle',icon:'âš”ï¸',name:'Boss Battle',desc:'Ã‰pico e intenso',desc_en:'Epic and intense'},
    {id:'reggaeton',icon:'ðŸŽº',name:'ReggaetÃ³n Study',desc:'Ritmo latino',desc_en:'Latin rhythm'},
    {id:'jazz',icon:'ðŸŽ·',name:'Jazz Smooth',desc:'Suave y elegante',desc_en:'Smooth and elegant'},
    {id:'tropical',icon:'ðŸŒ´',name:'Tropical Vibes',desc:'Cumbia y playa',desc_en:'Cumbia and beach'},
    {id:'rock8bit',icon:'ðŸŽ¸',name:'Rock 8-Bit',desc:'Rock clÃ¡sico pixelado',desc_en:'Classic pixel rock'},
    {id:'ambient',icon:'ðŸŒ™',name:'Ambient Night',desc:'Calmado nocturno',desc_en:'Calm nighttime'},
    {id:'mariachi',icon:'ðŸª—',name:'Mariachi Digital',desc:'Trompetas y guitarrÃ³n',desc_en:'Trumpets and guitarrÃ³n'},
    {id:'hiphop',icon:'ðŸŽ¤',name:'Hip-Hop Study',desc:'Boom bap para enfocarte',desc_en:'Boom bap to focus'},
    {id:'edm',icon:'ðŸ”Š',name:'EDM Energy',desc:'ElectrÃ³nica motivadora',desc_en:'Motivating electronic'},
    {id:'corrido',icon:'ðŸ¤ ',name:'Corrido Tumbado',desc:'Estilo norteÃ±o digital',desc_en:'Digital norteÃ±o style'},
    {id:'classical',icon:'ðŸŽ»',name:'ClÃ¡sica Ã‰pica',desc:'Orquesta inspiradora',desc_en:'Inspiring orchestra'},
    {id:'synthwave',icon:'ðŸŒ†',name:'Synthwave 80s',desc:'Retro futurista',desc_en:'Retro futuristic'},
    {id:'salsa',icon:'ðŸ’ƒ',name:'Salsa Digital',desc:'Sabor caribeÃ±o',desc_en:'Caribbean flavor'},
    {id:'silent',icon:'ðŸ”‡',name:'Sin MÃºsica',desc:'Solo silencio',desc_en:'Just silence'}
];

function noteFreq(note,octave){
    const notes={C:261.63,D:293.66,E:329.63,F:349.23,G:392.00,A:440.00,B:493.88};
    const base=notes[note]||261.63;
    return base*Math.pow(2,octave-4);
}

function playNote(type,freq,start,dur,vol){
    if(!musicCtx)return;
    const osc=musicCtx.createOscillator();
    const gain=musicCtx.createGain();
    osc.type=type;
    osc.frequency.setValueAtTime(freq,start);
    gain.gain.setValueAtTime(vol,start);
    gain.gain.setValueAtTime(vol,start+dur*0.8);
    gain.gain.linearRampToValueAtTime(0,start+dur);
    osc.connect(gain);
    gain.connect(musicGain);
    osc.start(start);
    osc.stop(start+dur);
}

function playMusicLoop(){
    if(!musicCtx||!musicPlaying||currentMusicStyle==='custom'||currentMusicStyle==='silent')return;
    const style=currentMusicStyle;
    const bpm=style==='battle'?160:style==='reggaeton'?95:style==='lofi'?75:130;
    const beat=60/bpm;
    const half=beat/2;
    const now=musicCtx.currentTime+0.05;
    
    if(style==='pokemon'){
        const melody=[['E',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['D',5],['C',5],['D',5],['E',5],['G',5],['A',5],['G',5],['E',5],['G',5],['A',5],['B',5],['C',6],['B',5],['A',5],['G',5],['A',5],['B',5],['G',5],['E',5],['D',5],['E',5],['C',5],['D',5],['E',5],['E',5]];
        const bass=[['C',3],['C',3],['G',3],['G',3],['A',3],['A',3],['E',3],['E',3],['F',3],['F',3],['C',3],['C',3],['G',3],['G',3],['G',3],['G',3],['A',3],['A',3],['F',3],['F',3],['C',3],['C',3],['G',3],['G',3],['F',3],['F',3],['G',3],['G',3],['C',3],['C',3],['C',3],['C',3]];
        const arp=[['C',4],['E',4],['G',4],['E',4],['A',4],['C',5],['E',5],['C',5],['F',4],['A',4],['C',5],['A',4],['G',4],['B',4],['D',5],['B',4],['A',4],['C',5],['E',5],['C',5],['F',4],['A',4],['C',5],['A',4],['G',4],['B',4],['D',5],['B',4],['C',4],['E',4],['G',4],['E',4]];
        for(let i=0;i<melody.length;i++){playNote('square',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.85,0.08);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.12);}
        for(let i=0;i<arp.length;i++){playNote('square',noteFreq(arp[i][0],arp[i][1]),now+i*half,half*0.4,0.03);}
        const loopDur=melody.length*half;
        musicTimers.push(setTimeout(()=>playMusicLoop(),loopDur*1000-100));
    }
    else if(style==='lofi'){
        // Lo-fi chill beats - sine waves, slow, jazzy
        const melody=[['E',4],['G',4],['A',4],['G',4],['E',4],['D',4],['C',4],['D',4],['E',4],['A',4],['G',4],['E',4],['D',4],['E',4],['G',4],['A',4]];
        const bass=[['C',3],['C',3],['A',2],['A',2],['F',2],['F',2],['G',2],['G',2],['C',3],['C',3],['A',2],['A',2],['F',2],['F',2],['G',2],['G',2]];
        const pad=[['E',4],['E',4],['C',4],['C',4],['A',3],['A',3],['B',3],['B',3],['E',4],['E',4],['C',4],['C',4],['A',3],['A',3],['B',3],['B',3]];
        for(let i=0;i<melody.length;i++){playNote('sine',noteFreq(melody[i][0],melody[i][1]),now+i*beat,beat*0.7,0.1);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*beat,beat*0.9,0.1);}
        for(let i=0;i<pad.length;i++){playNote('sine',noteFreq(pad[i][0],pad[i][1]),now+i*beat,beat*1.2,0.04);}
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*beat*1000-100));
    }
    else if(style==='battle'){
        // Epic boss battle - fast, intense, sawtooth
        const melody=[['E',5],['E',5],['F',5],['G',5],['G',5],['F',5],['E',5],['D',5],['C',5],['C',5],['D',5],['E',5],['E',5],['D',5],['D',5],['D',5],['E',5],['E',5],['F',5],['G',5],['G',5],['F',5],['E',5],['D',5],['C',5],['C',5],['D',5],['E',5],['D',5],['C',5],['C',5],['C',5]];
        const bass=[['C',2],['C',2],['C',2],['C',2],['A',2],['A',2],['A',2],['A',2],['F',2],['F',2],['F',2],['F',2],['G',2],['G',2],['G',2],['G',2],['C',2],['C',2],['C',2],['C',2],['A',2],['A',2],['A',2],['A',2],['F',2],['F',2],['F',2],['F',2],['G',2],['G',2],['G',2],['G',2]];
        for(let i=0;i<melody.length;i++){playNote('sawtooth',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.8,0.06);}
        for(let i=0;i<bass.length;i++){playNote('square',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.1);}
        // Drum-like percussion with noise
        for(let i=0;i<32;i+=2){playNote('square',noteFreq('C',1),now+i*half,half*0.15,0.15);}
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='reggaeton'){
        // ReggaetÃ³n dembow rhythm
        const melody=[['A',4],['C',5],['D',5],['E',5],['D',5],['C',5],['A',4],['G',4],['A',4],['C',5],['D',5],['E',5],['G',5],['E',5],['D',5],['C',5]];
        const bass=[['A',2],['A',2],['A',2],['A',2],['D',3],['D',3],['D',3],['D',3],['F',2],['F',2],['G',2],['G',2],['A',2],['A',2],['A',2],['A',2]];
        for(let i=0;i<melody.length;i++){playNote('triangle',noteFreq(melody[i][0],melody[i][1]),now+i*beat,beat*0.6,0.09);}
        for(let i=0;i<bass.length;i++){playNote('sine',noteFreq(bass[i][0],bass[i][1]),now+i*beat,beat*0.8,0.14);}
        // Dembow kick pattern
        for(let i=0;i<16;i++){
            const isKick=(i%4===0||i%4===3);
            if(isKick)playNote('sine',noteFreq('C',2),now+i*beat,beat*0.2,0.18);
            else playNote('square',noteFreq('C',1),now+i*beat,beat*0.08,0.06);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*beat*1000-100));
    }
    else if(style==='jazz'){
        // Smooth jazz - walking bass, cool chords
        const melody=[['G',4],['A',4],['B',4],['D',5],['E',5],['D',5],['B',4],['A',4],['G',4],['F',4],['E',4],['D',4],['E',4],['G',4],['A',4],['B',4]];
        const bass=[['G',2],['B',2],['D',3],['G',2],['C',3],['E',3],['G',3],['C',3],['A',2],['C',3],['E',3],['A',2],['D',3],['F',3],['A',3],['D',3]];
        const pad=[['B',3],['D',4],['G',3],['B',3],['E',4],['G',4],['C',4],['E',4],['C',4],['E',4],['A',3],['C',4],['F',3],['A',3],['D',4],['F',3]];
        for(let i=0;i<melody.length;i++){playNote('sine',noteFreq(melody[i][0],melody[i][1]),now+i*beat,beat*0.75,0.08);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*beat,beat*0.85,0.1);}
        for(let i=0;i<pad.length;i++){playNote('sine',noteFreq(pad[i][0],pad[i][1]),now+i*beat,beat*1.5,0.03);}
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*beat*1000-100));
    }
    else if(style==='tropical'){
        // Tropical cumbia - bright, rhythmic
        const melody=[['C',5],['E',5],['G',5],['E',5],['C',5],['D',5],['F',5],['A',5],['G',5],['F',5],['E',5],['D',5],['C',5],['E',5],['G',5],['C',6]];
        const bass=[['C',3],['C',3],['G',2],['G',2],['F',2],['F',2],['G',2],['G',2],['C',3],['C',3],['A',2],['A',2],['F',2],['F',2],['G',2],['G',2]];
        for(let i=0;i<melody.length;i++){playNote('triangle',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.7,0.09);}
        for(let i=0;i<bass.length;i++){playNote('sine',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.85,0.12);}
        // Guiro/shaker pattern
        for(let i=0;i<16;i++){
            if(i%2===0)playNote('square',noteFreq('C',7),now+i*half,half*0.05,0.04);
            if(i%4===0)playNote('sine',noteFreq('G',2),now+i*half,half*0.15,0.15);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='rock8bit'){
        // 8-bit rock - power chords, driving rhythm
        const melody=[['E',5],['E',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['D',5],['D',5],['E',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['E',5],['G',5],['A',5],['C',6],['B',5],['A',5],['G',5],['E',5],['D',5],['E',5],['G',5],['A',5],['G',5],['E',5],['E',5]];
        const bass=[['E',2],['E',2],['E',2],['E',2],['G',2],['G',2],['G',2],['G',2],['A',2],['A',2],['A',2],['A',2],['B',2],['B',2],['B',2],['B',2],['E',2],['E',2],['E',2],['E',2],['C',3],['C',3],['C',3],['C',3],['A',2],['A',2],['A',2],['A',2],['B',2],['B',2],['B',2],['B',2]];
        for(let i=0;i<melody.length;i++){playNote('square',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.8,0.07);}
        for(let i=0;i<bass.length;i++){playNote('sawtooth',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.09);}
        // Power drum beat
        for(let i=0;i<32;i++){
            if(i%4===0)playNote('square',noteFreq('C',1),now+i*half,half*0.12,0.16);
            if(i%4===2)playNote('square',noteFreq('G',6),now+i*half,half*0.06,0.05);
            if(i%2===1)playNote('square',noteFreq('D',7),now+i*half,half*0.04,0.03);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='ambient'){
        // Ambient night - slow pads, ethereal
        const pad1=[['C',4],['E',4],['G',4],['E',4],['A',3],['C',4],['E',4],['C',4]];
        const pad2=[['G',3],['B',3],['D',4],['B',3],['F',3],['A',3],['C',4],['A',3]];
        const bell=[['G',5],['E',5],['C',5],['G',5],['A',5],['F',5],['D',5],['A',5]];
        const longBeat=beat*2;
        for(let i=0;i<pad1.length;i++){playNote('sine',noteFreq(pad1[i][0],pad1[i][1]),now+i*longBeat,longBeat*1.2,0.07);}
        for(let i=0;i<pad2.length;i++){playNote('sine',noteFreq(pad2[i][0],pad2[i][1]),now+i*longBeat,longBeat*1.2,0.05);}
        for(let i=0;i<bell.length;i++){playNote('sine',noteFreq(bell[i][0],bell[i][1]),now+i*longBeat,longBeat*0.4,0.04);}
        // Deep bass drone
        playNote('sine',noteFreq('C',2),now,pad1.length*longBeat,0.06);
        musicTimers.push(setTimeout(()=>playMusicLoop(),pad1.length*longBeat*1000-100));
    }
    else if(style==='mariachi'){
        // Mariachi digital - trumpets and strumming
        const trumpet=[['G',5],['A',5],['B',5],['D',6],['B',5],['A',5],['G',5],['G',5],['A',5],['B',5],['G',5],['E',5],['D',5],['E',5],['G',5],['A',5],['B',5],['D',6],['E',6],['D',6],['B',5],['A',5],['G',5],['A',5],['B',5],['A',5],['G',5],['E',5],['D',5],['G',5],['G',5],['G',5]];
        const bass=[['G',2],['G',2],['D',3],['D',3],['G',2],['G',2],['D',3],['D',3],['E',2],['E',2],['B',2],['B',2],['C',3],['C',3],['D',3],['D',3],['G',2],['G',2],['D',3],['D',3],['E',2],['E',2],['B',2],['B',2],['C',3],['C',3],['D',3],['D',3],['G',2],['G',2],['G',2],['G',2]];
        for(let i=0;i<trumpet.length;i++){playNote('sawtooth',noteFreq(trumpet[i][0],trumpet[i][1]),now+i*half,half*0.75,0.06);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.85,0.1);}
        // GuitarrÃ³n rhythm
        for(let i=0;i<32;i++){
            if(i%4===0||i%4===3)playNote('triangle',noteFreq('G',3),now+i*half,half*0.3,0.08);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),trumpet.length*half*1000-100));
    }
    else if(style==='hiphop'){
        // Hip-Hop boom bap - punchy drums, deep bass, Rhodes keys
        const melody=[['C',4],['E',4],['G',4],['A',4],['G',4],['E',4],['C',4],['D',4],['F',4],['A',4],['G',4],['F',4],['E',4],['D',4],['C',4],['C',4]];
        const bass=[['C',2],['C',2],['C',2],['E',2],['F',2],['F',2],['G',2],['G',2],['A',2],['A',2],['G',2],['G',2],['F',2],['E',2],['C',2],['C',2]];
        for(let i=0;i<melody.length;i++){playNote('sine',noteFreq(melody[i][0],melody[i][1]),now+i*beat,beat*0.5,0.09);}
        for(let i=0;i<bass.length;i++){playNote('triangle',noteFreq(bass[i][0],bass[i][1]),now+i*beat,beat*0.8,0.14);}
        // Boom bap drums
        for(let i=0;i<16;i++){
            if(i%4===0)playNote('sine',noteFreq('C',2),now+i*beat,beat*0.2,0.2);
            if(i%4===2)playNote('square',noteFreq('C',7),now+i*beat,beat*0.06,0.05);
            if(i%2===1)playNote('square',noteFreq('D',6),now+i*beat,beat*0.04,0.04);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*beat*1000-100));
    }
    else if(style==='edm'){
        // EDM Energy - building synth, four on the floor
        const melody=[['E',5],['E',5],['G',5],['A',5],['B',5],['B',5],['A',5],['G',5],['E',5],['G',5],['B',5],['E',6],['D',6],['B',5],['A',5],['G',5],['A',5],['A',5],['B',5],['D',6],['E',6],['E',6],['D',6],['B',5],['A',5],['B',5],['D',6],['E',6],['B',5],['G',5],['E',5],['E',5]];
        const bass=[['E',2],['E',2],['E',2],['E',2],['A',2],['A',2],['A',2],['A',2],['C',3],['C',3],['C',3],['C',3],['B',2],['B',2],['B',2],['B',2],['A',2],['A',2],['A',2],['A',2],['C',3],['C',3],['C',3],['C',3],['D',3],['D',3],['D',3],['D',3],['B',2],['B',2],['B',2],['B',2]];
        for(let i=0;i<melody.length;i++){playNote('sawtooth',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.7,0.05);}
        for(let i=0;i<bass.length;i++){playNote('sine',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.13);}
        // Four on the floor kick + hi-hat
        for(let i=0;i<32;i++){
            if(i%4===0)playNote('sine',noteFreq('C',1),now+i*half,half*0.2,0.18);
            playNote('square',noteFreq('C',8),now+i*half,half*0.03,0.025);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='corrido'){
        // Corrido tumbado - tuba bass, guitarrÃ³n, accordion feel
        const melody=[['D',5],['F',5],['A',5],['D',6],['A',5],['F',5],['D',5],['E',5],['G',5],['B',5],['A',5],['G',5],['F',5],['E',5],['D',5],['D',5],['F',5],['A',5],['D',6],['C',6],['A',5],['F',5],['E',5],['D',5],['E',5],['F',5],['A',5],['G',5],['F',5],['E',5],['D',5],['D',5]];
        const tuba=[['D',2],['D',2],['A',2],['A',2],['D',2],['D',2],['A',2],['A',2],['G',2],['G',2],['D',3],['D',3],['A',2],['A',2],['D',2],['D',2],['D',2],['D',2],['F',2],['F',2],['A',2],['A',2],['G',2],['G',2],['F',2],['F',2],['E',2],['E',2],['D',2],['D',2],['A',2],['A',2]];
        for(let i=0;i<melody.length;i++){playNote('sawtooth',noteFreq(melody[i][0],melody[i][1]),now+i*half,half*0.65,0.06);}
        for(let i=0;i<tuba.length;i++){playNote('triangle',noteFreq(tuba[i][0],tuba[i][1]),now+i*half,half*0.8,0.12);}
        // Tumbado rhythm
        for(let i=0;i<32;i++){
            if(i%4===0||i%4===3)playNote('sine',noteFreq('D',2),now+i*half,half*0.15,0.16);
            if(i%2===1)playNote('square',noteFreq('A',6),now+i*half,half*0.04,0.04);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),melody.length*half*1000-100));
    }
    else if(style==='classical'){
        // Classical epic - strings, French horns feel
        const strings=[['C',5],['E',5],['G',5],['C',6],['B',5],['G',5],['E',5],['C',5],['D',5],['F',5],['A',5],['D',6],['C',6],['A',5],['F',5],['D',5],['E',5],['G',5],['B',5],['E',6],['D',6],['B',5],['G',5],['E',5],['C',5],['E',5],['G',5],['C',6],['G',5],['E',5],['C',5],['C',5]];
        const cello=[['C',3],['C',3],['G',2],['G',2],['C',3],['C',3],['E',3],['E',3],['D',3],['D',3],['A',2],['A',2],['D',3],['D',3],['F',3],['F',3],['E',3],['E',3],['B',2],['B',2],['E',3],['E',3],['G',3],['G',3],['C',3],['C',3],['G',2],['G',2],['C',3],['C',3],['C',3],['C',3]];
        const horn=[['E',4],['G',4],['C',5],['G',4],['F',4],['A',4],['D',5],['A',4],['G',4],['B',4],['E',5],['B',4],['E',4],['G',4],['C',5],['C',5]];
        for(let i=0;i<strings.length;i++){playNote('sine',noteFreq(strings[i][0],strings[i][1]),now+i*half,half*0.9,0.07);}
        for(let i=0;i<cello.length;i++){playNote('triangle',noteFreq(cello[i][0],cello[i][1]),now+i*half,half*1.0,0.09);}
        for(let i=0;i<horn.length;i++){playNote('sawtooth',noteFreq(horn[i][0],horn[i][1]),now+i*beat,beat*0.8,0.035);}
        musicTimers.push(setTimeout(()=>playMusicLoop(),strings.length*half*1000-100));
    }
    else if(style==='synthwave'){
        // Synthwave 80s - arpeggiated synths, driving bass
        const arp=[['E',5],['G',5],['B',5],['E',6],['B',5],['G',5],['E',5],['D',5],['F',5],['A',5],['D',6],['A',5],['F',5],['D',5],['E',5],['G',5],['B',5],['E',6],['G',6],['E',6],['B',5],['G',5],['A',5],['C',6],['E',6],['C',6],['A',5],['E',5],['G',5],['B',5],['E',5],['E',5]];
        const bass=[['E',2],['E',2],['E',2],['E',2],['D',2],['D',2],['D',2],['D',2],['E',2],['E',2],['E',2],['E',2],['A',2],['A',2],['A',2],['A',2],['E',2],['E',2],['E',2],['E',2],['D',2],['D',2],['D',2],['D',2],['A',2],['A',2],['A',2],['A',2],['B',2],['B',2],['B',2],['B',2]];
        for(let i=0;i<arp.length;i++){playNote('square',noteFreq(arp[i][0],arp[i][1]),now+i*half,half*0.5,0.05);}
        for(let i=0;i<bass.length;i++){playNote('sawtooth',noteFreq(bass[i][0],bass[i][1]),now+i*half,half*0.9,0.1);}
        // Snare on 2 and 4, kick on 1 and 3
        for(let i=0;i<32;i++){
            if(i%8===0||i%8===4)playNote('sine',noteFreq('C',2),now+i*half,half*0.15,0.15);
            if(i%8===2||i%8===6)playNote('square',noteFreq('C',7),now+i*half,half*0.05,0.06);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),arp.length*half*1000-100));
    }
    else if(style==='salsa'){
        // Salsa digital - piano montuno, conga feel, bright brass
        const piano=[['C',5],['E',5],['G',5],['C',5],['E',5],['G',5],['A',4],['C',5],['F',5],['A',4],['C',5],['F',5],['G',4],['B',4],['D',5],['G',4],['B',4],['D',5],['C',5],['E',5],['G',5],['C',5],['E',5],['G',5]];
        const bass=[['C',3],['C',3],['G',2],['C',3],['F',2],['F',2],['C',3],['F',2],['G',2],['G',2],['D',3],['G',2],['C',3],['C',3],['G',2],['C',3],['F',2],['F',2],['C',3],['F',2],['G',2],['G',2],['D',3],['G',2]];
        const bpm2=180;const sbeat=60/bpm2;const shalf=sbeat/2;
        for(let i=0;i<piano.length;i++){playNote('triangle',noteFreq(piano[i][0],piano[i][1]),now+i*shalf,shalf*0.6,0.08);}
        for(let i=0;i<bass.length;i++){playNote('sine',noteFreq(bass[i][0],bass[i][1]),now+i*shalf,shalf*0.8,0.12);}
        // Conga/timbale pattern
        for(let i=0;i<24;i++){
            if(i%3===0)playNote('square',noteFreq('A',6),now+i*shalf,shalf*0.08,0.06);
            if(i%6===2)playNote('sine',noteFreq('E',2),now+i*shalf,shalf*0.12,0.14);
        }
        musicTimers.push(setTimeout(()=>playMusicLoop(),piano.length*shalf*1000-100));
    }
}

function exitApp(){
    const msg=D.lang==='es'?'Â¿Seguro que quieres salir? Tu progreso estÃ¡ guardado.':'Are you sure you want to exit? Your progress is saved.';
    if(confirm(msg)){
        stopMusic();
        if(window.speechSynthesis)window.speechSynthesis.cancel();
        document.body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#0a0e1a;color:white;font-family:Fredoka,sans-serif;text-align:center;padding:20px"><div style="font-size:80px;margin-bottom:20px">ðŸ‘‹</div><div style="font-size:28px;font-weight:700;margin-bottom:10px">'+(D.lang==='es'?'Â¡Hasta luego, '+D.name+'!':'See you later, '+D.name+'!')+'</div><div style="font-size:16px;color:#8899aa;margin-bottom:30px">'+(D.lang==='es'?'Tu progreso estÃ¡ guardado. Â¡Regresa pronto, '+gn('campeÃ³n','campeona')+'!':'Your progress is saved. Come back soon, champ!')+'</div><button onclick="location.reload()" style="padding:14px 32px;border-radius:12px;border:2px solid #00d4ff;background:rgba(0,212,255,0.1);color:#00d4ff;font-size:16px;font-family:Fredoka,sans-serif;font-weight:600;cursor:pointer">'+(D.lang==='es'?'ðŸ”„ Volver a Entrar':'ðŸ”„ Re-enter App')+'</button></div>';
    }
}

function toggleMusicPanel(e){
    if(e)e.preventDefault();
    musicPanelOpen=!musicPanelOpen;
    const panel=document.getElementById('musicPanel');
    panel.classList.toggle('open',musicPanelOpen);
    if(musicPanelOpen)renderMusicOptions();
}

function renderMusicOptions(){
    document.getElementById('musicOptions').innerHTML=MUSIC_STYLES.map(s=>
        '<div class="music-option'+(currentMusicStyle===s.id?' selected':'')+'" onclick="switchMusic(\''+s.id+'\')">'+
        '<div class="music-option-icon">'+s.icon+'</div>'+
        '<div class="music-option-info"><div class="music-option-name">'+s.name+'</div><div class="music-option-desc">'+(D.lang==="es"?s.desc:(s.desc_en||s.desc))+'</div></div>'+
        '</div>'
    ).join('');
    // Show custom music option if loaded
    if(customAudio){
        const el=document.querySelector('.music-upload');
        if(el)el.querySelector('.music-option')?.classList.toggle('selected',currentMusicStyle==='custom');
    }
}

function switchMusic(styleId){
    // Stop current
    if(customAudio){customAudio.pause();customAudio.currentTime=0;}
    stopMusicOsc();
    
    currentMusicStyle=styleId;
    
    if(styleId==='silent'){
        musicPlaying=false;
        document.getElementById('musicBtn').textContent='ðŸ”‡';
    }else if(styleId==='custom'&&customAudio){
        musicPlaying=true;
        customAudio.volume=musicMuted?0:Math.min(musicVolume*2,1);
        customAudio.loop=true;
        customAudio.play().catch(()=>{});
        document.getElementById('musicBtn').textContent='ðŸŽµ';
    }else{
        if(!musicCtx||musicCtx.state==='closed'){
            musicCtx=new(window.AudioContext||window.webkitAudioContext)();
            musicGain=musicCtx.createGain();
            musicGain.gain.setValueAtTime(musicMuted?0:musicVolume,musicCtx.currentTime);
            musicGain.connect(musicCtx.destination);
        }
        musicPlaying=true;
        document.getElementById('musicBtn').textContent='ðŸŽµ';
        playMusicLoop();
    }
    
    renderMusicOptions();
    try{localStorage.setItem('maestro_music_style',styleId);}catch(e){}
}

function stopMusicOsc(){
    musicTimers.forEach(t=>clearTimeout(t));
    musicTimers=[];
    if(musicCtx&&musicCtx.state!=='closed'){musicCtx.close();musicCtx=null;}
}

function loadCustomMusic(input){
    if(!input.files||!input.files[0])return;
    const file=input.files[0];
    const url=URL.createObjectURL(file);
    customAudio=new Audio(url);
    customAudio.loop=true;
    document.getElementById('musicFileName').textContent='â™« '+file.name;
    document.getElementById('musicFileName').style.display='block';
    switchMusic('custom');
    toggleMusicPanel();
}

function startMusic(){
    if(musicPlaying)return;
    // Load saved style
    try{const saved=localStorage.getItem('maestro_music_style');if(saved)currentMusicStyle=saved;}catch(e){}
    
    if(currentMusicStyle==='silent')return;
    if(currentMusicStyle==='custom'&&customAudio){
        musicPlaying=true;
        customAudio.volume=0.5;
        customAudio.loop=true;
        customAudio.play().catch(()=>{});
        document.getElementById('musicBtn').classList.add('active');
        document.getElementById('musicBtn').textContent='ðŸŽµ';
        return;
    }
    musicCtx=new(window.AudioContext||window.webkitAudioContext)();
    musicGain=musicCtx.createGain();
    musicGain.gain.setValueAtTime(0.5,musicCtx.currentTime);
    musicGain.connect(musicCtx.destination);
    musicPlaying=true;
    musicMuted=false;
    document.getElementById('musicBtn').classList.add('active');
    document.getElementById('musicBtn').textContent='ðŸŽµ';
    playMusicLoop();
}

function stopMusic(){
    musicPlaying=false;
    if(customAudio){customAudio.pause();}
    stopMusicOsc();
}

function toggleMusic(){
    const btn=document.getElementById('musicBtn');
    if(musicMuted){
        musicMuted=false;
        musicVolume=musicMode==='studying'?0.25:0.5;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=Math.min(musicVolume*2,1);
        btn.textContent='ðŸŽµ';
        btn.classList.remove('muted');
    }else if(musicVolume>=0.4){
        musicVolume=musicMode==='studying'?0.15:0.25;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=Math.min(musicVolume*2,1);
        btn.textContent='ðŸ”‰';
    }else if(musicVolume>=0.15){
        musicVolume=musicMode==='studying'?0.06:0.1;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=Math.min(musicVolume*2,1);
        btn.textContent='ðŸ”ˆ';
    }else{
        musicMuted=true;
        musicVolume=0;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(0,musicCtx.currentTime);
        if(customAudio&&currentMusicStyle==='custom')customAudio.volume=0;
        btn.textContent='ðŸ”‡';
        btn.classList.add('muted');
    }
}

function setMusicVolume(vol){
    musicVolume=vol;
    if(musicGain&&musicCtx&&!musicMuted)musicGain.gain.linearRampToValueAtTime(vol,musicCtx.currentTime+0.3);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(vol*2,1);
}

function lowerMusicForSpeech(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(Math.min(musicVolume*0.2,0.05),musicCtx.currentTime+0.3);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*0.4,0.15);
}

function restoreMusicAfterSpeech(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(musicVolume,musicCtx.currentTime+0.3);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*2,1);
}

function lowerMusicForVideo(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(Math.min(musicVolume*0.3,0.08),musicCtx.currentTime+0.5);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*0.5,0.2);
}

function restoreMusicAfterVideo(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(musicVolume,musicCtx.currentTime+0.5);
    if(customAudio&&currentMusicStyle==='custom'&&!musicMuted)customAudio.volume=Math.min(musicVolume*2,1);
}

function enterStudyMode(){
    musicMode='studying';
    setMusicVolume(0.25);
    document.getElementById('musicBtn').textContent='ðŸ”‰';
}

const SUPABASE_URL='https://htklsowiyjwsjnacnvnr.supabase.co/functions/v1';
const SUPABASE_REST='https://htklsowiyjwsjnacnvnr.supabase.co/rest/v1';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0a2xzb3dpeWp3c2puYWNudm5yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NjIwMjQsImV4cCI6MjA4NjAzODAyNH0.6A3F7MI4YJEMo98b4Zfzao9p_hMh2T0ha0dRJ4SUhv0';

// === SUPABASE PROGRESS SYNC (V2 â†’ Supabase) ===
function syncV2Profile(){
  try {
    var email = null;
    try { email = D.email || null; } catch(e){}
    if(!email) try { email = JSON.parse(localStorage.getItem('tecnico_user')||'{}').email; } catch(e){}
    if(!email) return;

    var nombre = 'TÃ©cnico';
    try { nombre = D.name || 'TÃ©cnico'; } catch(e){}

    fetch(SUPABASE_REST+'/rpc/sync_v2_profile', {
      method:'POST',
      headers:{'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY},
      body:JSON.stringify({
        p_email: email,
        p_name: nombre,
        p_level: profile.level,
        p_xp: profile.xp,
        p_xp_needed: profile.xpNeeded,
        p_total_correct: profile.totalCorrect,
        p_total_answered: profile.totalAnswered,
        p_quizzes_taken: profile.quizzesTaken,
        p_best_streak: profile.bestStreak,
        p_perfect_streak: profile.perfectStreakCount||0,
        p_medals: profile.medals||[],
        p_avatar: profile.avatar||'novato'
      })
    }).catch(function(e){ console.log('V2 profile sync error:', e); });
  } catch(e){ console.log('syncV2Profile error:', e); }
}

function syncV2QuizAttempt(quizId, totalQ, correct, wrong, pct, tiempoSeg){
  try {
    var email = null;
    try { email = D.email || null; } catch(e){}
    if(!email) try { email = JSON.parse(localStorage.getItem('tecnico_user')||'{}').email; } catch(e){}
    if(!email) return;

    fetch(SUPABASE_REST+'/rpc/save_v2_quiz_attempt', {
      method:'POST',
      headers:{'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY},
      body:JSON.stringify({
        p_email: email,
        p_quiz_id: quizId,
        p_total_questions: totalQ,
        p_correct_answers: correct,
        p_wrong_answers: wrong,
        p_porcentaje: pct,
        p_tiempo_segundos: tiempoSeg||null
      })
    }).catch(function(e){ console.log('V2 quiz sync error:', e); });
  } catch(e){ console.log('syncV2QuizAttempt error:', e); }
}

// === LOAD OTHER APP'S PROGRESS ===
async function loadCrossAppProgress(){
  try {
    var email = null;
    try { email = D.email || null; } catch(e){}
    if(!email) try { email = JSON.parse(localStorage.getItem('tecnico_user')||'{}').email; } catch(e){}
    if(!email) return null;

    // Get V1 stats from admin_combined_progress view
    var res = await fetch(SUPABASE_REST+'/admin_combined_progress?email=eq.'+encodeURIComponent(email)+'&select=*', {
      headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY}
    });
    var data = await res.json();
    return data && data.length > 0 ? data[0] : null;
  } catch(e){ console.log('loadCrossApp error:', e); return null; }
}

const VIDEOS={
    bienvenida:'bienvenida.mp4.mp4',
    bienvenida_en:'bienvenida_en.mp4.mp4.mp4',
    correcto:'correcto.mp4.mp4',
    incorrecto:'incorrecto.mp4.mp4',
    medalla:'medalla.mp4.mp4',
    medalla_en:'medalla_en.mp4.mp4.mp4'
};

// ========== VIDEO FUNCTIONS ==========
let videoClosing=false;

function showVideo(type,cb){
    if(videoPlaying||videoClosing)return;
    videoPlaying=true;
    videoClosing=false;
    lowerMusicForVideo();
    currentVideoCallback=cb;
    const vf=document.getElementById('videoFloat');
    const v=document.getElementById('marioVideo');
    const videoSrc=VIDEOS[type]||VIDEOS.bienvenida;
    // Use English version of video if available and language is English
    let finalVideoSrc=videoSrc;
    if(D.lang==='en'&&VIDEOS[type+'_en']){
        finalVideoSrc=VIDEOS[type+'_en'];
    }
    console.log('Loading video:',finalVideoSrc);
    
    // Update video label and subtitle based on language
    const label=document.getElementById('videoLabel');
    const sub=document.getElementById('videoSubtitle');
    if(label)label.textContent=D.lang==='en'?'ðŸ”´ LIVE':'ðŸ”´ EN VIVO';
    if(sub){
        // Video subtitles based on type and language
        const subtitles={
            bienvenida:{
                both:'<div style="color:#ffd700;font-size:11px;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.8)">âš¡ Si no mides, estÃ¡s adivinando</div><div style="color:rgba(255,255,255,0.7);font-size:9px;font-style:italic;margin-top:2px;text-shadow:0 1px 3px rgba(0,0,0,0.8)">If you don\'t measure, you\'re guessing</div>',
                es:'<div style="color:#ffd700;font-size:12px;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.8)">âš¡ Si no mides, estÃ¡s adivinando</div><div style="color:#ffffff;font-size:10px;margin-top:3px;font-weight:600;letter-spacing:1px">A.C. VOLT TECHNICAL SCHOOLâ„¢</div>',
                en:'<div style="color:#ffd700;font-size:12px;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.8)">âš¡ If you don\'t measure, you\'re guessing</div><div style="color:#ffffff;font-size:10px;margin-top:3px;font-weight:600;letter-spacing:1px">A.C. VOLT TECHNICAL SCHOOLâ„¢</div>'
            },
            correcto:{es:'<div style="color:#2ecc71;font-size:12px;font-weight:700">âœ… Â¡Correcto!</div>',en:'<div style="color:#2ecc71;font-size:12px;font-weight:700">âœ… Correct!</div>'},
            incorrecto:{es:'<div style="color:#ff6b2b;font-size:12px;font-weight:700">âŒ Â¡IntÃ©ntalo de nuevo!</div>',en:'<div style="color:#ff6b2b;font-size:12px;font-weight:700">âŒ Try again!</div>'},
            medalla:{es:'<div style="color:#ffd700;font-size:12px;font-weight:700">ðŸ… Â¡Nueva medalla!</div>',en:'<div style="color:#ffd700;font-size:12px;font-weight:700">ðŸ… New medal!</div>'}
        };
        const st=subtitles[type]||subtitles.bienvenida;
        if(type==='bienvenida'&&!D.lang){
            sub.innerHTML=st.both;
        }else{
            sub.innerHTML=D.lang==='en'?(st.en||st.es):st.es;
        }
        sub.style.display='block';
    }
    
    // Limpiar handlers anteriores
    v.onended=null;
    v.onerror=null;
    
    v.src=finalVideoSrc;
    v.load();
    vf.classList.remove('hiding');
    vf.classList.add('active');
    v.play().then(()=>{
        console.log('Video playing');
    }).catch(e=>{
        console.log('Video play error:',e);
        closeVideo();
    });
    v.onended=function(){
        console.log('Video ended');
        closeVideo();
    };
    v.onerror=function(e){
        console.log('Video error:',e);
        if(videoPlaying&&!videoClosing)closeVideo();
    };
}

function closeVideo(){
    if(videoClosing)return;
    videoClosing=true;
    const vf=document.getElementById('videoFloat');
    const v=document.getElementById('marioVideo');
    
    // Limpiar handlers ANTES de tocar el src
    v.onended=null;
    v.onerror=null;
    
    vf.classList.add('hiding');
    vf.classList.remove('active');
    restoreMusicAfterVideo();
    setTimeout(()=>{
        v.pause();
        v.removeAttribute('src');
        v.load();
        videoPlaying=false;
        videoClosing=false;
        if(currentVideoCallback){
            const cb=currentVideoCallback;
            currentVideoCallback=null;
            cb();
        }
    },600);
}

function startWithVideo(){
    startMusic();
    go('s1');
}

// ========== AI CHAT FUNCTIONS ==========
const MARIO_SYSTEM_ES="Eres el Maestro Mario Flores Corona, instructor de HVAC/Refrigeracion/Electricidad con 25+ aÃ±os de experiencia. Tu escuela es ACVOLT Tech School en San Bernardino, California. Tu frase: Si no mides, estÃ¡s adivinando. Responde en 2-3 oraciones MAX. SÃ© personal y motivador. Usa frases como Ã³rale, vamos con todo, asÃ­ se hace. NO uses markdown ni emojis.";
const MARIO_SYSTEM_EN="You are Maestro Mario Flores Corona, HVAC/Refrigeration/Electrical instructor with 25+ years of experience. Your school is ACVOLT Tech School in San Bernardino, California. Your motto: If you don't measure, you're guessing. Answer in 2-3 sentences MAX. Be personal and motivating. Use phrases like let's go, you got this, that's how it's done. Do NOT use markdown or emojis.";
function getMarioSystem(){return D.lang==='en'?MARIO_SYSTEM_EN:MARIO_SYSTEM_ES;}

async function getAIResponse(msg){
    try{
        const r=await fetch(SUPABASE_URL+'/tutor-ia-chat',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                messages:[{role:'user',content:msg}],
                system:getMarioSystem(),
                max_tokens:150
            })
        });
        if(!r.ok)throw new Error('Chat API error');
        const d=await r.json();
        return d.content&&d.content[0]?d.content[0].text:(D.lang==='es'?'Â¡Ã“rale '+(D.name||gn('tÃ©cnico','tÃ©cnica'))+'! Hubo un problema, intenta de nuevo.':'Hey '+(D.name||'technician')+'! There was a problem, try again.');
    }catch(e){
        console.error('AI Chat Error:',e);
        return D.lang==='es'?'Â¡Ã“rale! Problema de conexiÃ³n. Intenta de nuevo.':'Connection problem. Please try again.';
    }
}

let speechAbort=null;

// ========== SPEECH TEXT PREPROCESSOR ==========
// Converts symbols and abbreviations to spoken Spanish words
function prepareForSpeech(text){
    if(!text)return text;
    let t=text;
    // Use English speech conversions if language is English
    if(D.lang==='en'){
        t=t.replace(/(\d+)\s*Â°F/g,'$1 degrees Fahrenheit');
        t=t.replace(/(\d+)\s*Â°C/g,'$1 degrees Celsius');
        t=t.replace(/(\d+)\s*Â°/g,'$1 degrees');
        t=t.replace(/R-(\d+)([A-Za-z]*)/g,function(m,num,suffix){
            if(!suffix)return 'refrigerant R '+num;
            return 'refrigerant R '+num+' '+suffix;
        });
        t=t.replace(/(\d+)\s*psi/gi,'$1 P S I');
        t=t.replace(/(\d+)\s*kW\b/g,'$1 kilowatts');
        t=t.replace(/(\d+)\s*HP\b/gi,'$1 horsepower');
        t=t.replace(/BTU\/h/gi,'B T U per hour');
        t=t.replace(/BTU/gi,'B T U');
        t=t.replace(/(\d+)\s*V\b(?!olt)/g,'$1 volts');
        t=t.replace(/(\d+)\s*W\b(?!att)/g,'$1 watts');
        t=t.replace(/(\d+)\s*Î©/g,'$1 ohms');
        t=t.replace(/(\d+)\s*A\b(?![\w])/g,'$1 amps');
        t=t.replace(/CFM/g,'C F M');
        t=t.replace(/TXV/g,'thermostatic expansion valve');
        t=t.replace(/EPR/g,'evaporator pressure regulator');
        t=t.replace(/GWP/g,'global warming potential');
        t=t.replace(/ODP/g,'ozone depletion potential');
        t=t.replace(/\s*Ã—\s*/g,' times ');
        t=t.replace(/\s*Ã·\s*/g,' divided by ');
        t=t.replace(/\s*=\s*/g,' equals ');
        t=t.replace(/\s*\+\s*/g,' plus ');
        t=t.replace(/\s*âˆ’\s*/g,' minus ');
        t=t.replace(/âˆš/g,'square root of ');
        t=t.replace(/Â²/g,' squared');
        t=t.replace(/\//g,' over ');
        t=t.replace(/HVAC/g,'H V A C');
        t=t.replace(/NEC/g,'National Electrical Code');
        t=t.replace(/NFPA/g,'N F P A');
        t=t.replace(/OSHA/g,'O S H A');
        t=t.replace(/EPA/g,'E P A');
        t=t.replace(/LOTO/g,'lockout tagout');
        t=t.replace(/AC\b/g,'air conditioning');
        t=t.replace(/GFCI/g,'G F C I');
        t=t.replace(/AFCI/g,'A F C I');
        t=t.replace(/VFD/g,'variable frequency drive');
        t=t.replace(/POE/g,'polyolester oil');
        t=t.replace(/PAG/g,'P A G oil');
        t=t.replace(/CW\b/g,'clockwise');
        t=t.replace(/CCW\b/g,'counter clockwise');
        t=t.replace(/UV\b/g,'ultraviolet');
        t=t.replace(/&/g,' and ');
        t=t.replace(/%/g,' percent');
        t=t.replace(/#/g,'number ');
        t=t.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu,'');
        t=t.replace(/\s{2,}/g,' ').trim();
        return t;
    }
    // === FIRST: Refrigerant names (before unit conversions to avoid R-404A â†’ "404 amperios") ===
    t=t.replace(/R-(\d+)([A-Za-z]*)/g,function(m,num,suffix){
        if(!suffix)return 'refrigerante R '+num;
        // Spell out suffix to avoid conflicts: Aâ†’"a", Bâ†’"be", Câ†’"ce"
        const spelled=suffix.split('').map(c=>({A:'a',B:'be',C:'ce',D:'de'}[c.toUpperCase()]||c)).join(' ');
        return 'refrigerante R '+num+' '+spelled;
    });
    // Temperature symbols
    t=t.replace(/(\d+)\s*Â°F/g,'$1 grados Fahrenheit');
    t=t.replace(/(\d+)\s*Â°C/g,'$1 grados Celsius');
    t=t.replace(/(\d+)\s*Â°/g,'$1 grados');
    // Pressure (before generic units)
    t=t.replace(/(\d+)\s*psi/gi,'$1 P S I');
    t=t.replace(/(\d+)\s*PSI/g,'$1 P S I');
    t=t.replace(/(\d+)\s*kPa/gi,'$1 kilopascales');
    // Multi-char units first
    t=t.replace(/(\d+)\s*kW\b/g,'$1 kilowatts');
    t=t.replace(/(\d+)\s*HP\b/gi,'$1 caballos de fuerza');
    t=t.replace(/BTU\/h/gi,'B T U por hora');
    t=t.replace(/BTU/gi,'B T U');
    // Electrical units (single char - must come AFTER multi-char and refrigerant names)
    t=t.replace(/(\d+)\s*V\b(?!olt)/g,'$1 voltios');
    t=t.replace(/(\d+)\s*W\b(?!att)/g,'$1 watts');
    t=t.replace(/(\d+)\s*Î©/g,'$1 ohms');
    // Amps: only match standalone A after number, not inside words
    t=t.replace(/(\d+)\s*A\b(?![\w])/g,'$1 amperios');
    // Refrigeration abbreviations
    t=t.replace(/CFM/g,'C F M');
    t=t.replace(/TXV/g,'vÃ¡lvula de expansiÃ³n termostÃ¡tica');
    t=t.replace(/EPR/g,'regulador de presiÃ³n del evaporador');
    t=t.replace(/GWP/g,'potencial de calentamiento global');
    t=t.replace(/ODP/g,'potencial de destrucciÃ³n de ozono');
    // Refrigerant names
    t=t.replace(/R-(\d+[A-Za-z]*)/g,'refrigerante R $1');
    // Math operators
    t=t.replace(/\s*Ã—\s*/g,' multiplicado por ');
    t=t.replace(/\s*Ã·\s*/g,' dividido entre ');
    t=t.replace(/\s*=\s*/g,' igual a ');
    t=t.replace(/\s*\+\s*/g,' mÃ¡s ');
    t=t.replace(/\s*âˆ’\s*/g,' menos ');
    t=t.replace(/\s*-\s+/g,' menos ');
    t=t.replace(/âˆš/g,'raÃ­z cuadrada de ');
    t=t.replace(/Â²/g,' al cuadrado');
    t=t.replace(/\//g,' entre ');
    // Common abbreviations
    t=t.replace(/HVAC/g,'H V A C');
    t=t.replace(/NEC/g,'CÃ³digo ElÃ©ctrico Nacional');
    t=t.replace(/NFPA/g,'N F P A');
    t=t.replace(/OSHA/g,'O S H A');
    t=t.replace(/EPA/g,'E P A');
    t=t.replace(/LOTO/g,'bloqueo y etiquetado');
    t=t.replace(/AC\b/g,'aire acondicionado');
    t=t.replace(/GFCI/g,'G F C I');
    t=t.replace(/AFCI/g,'A F C I');
    t=t.replace(/VFD/g,'variador de frecuencia');
    t=t.replace(/POE/g,'aceite poliolÃ©ster');
    t=t.replace(/PAG/g,'aceite P A G');
    t=t.replace(/CW\b/g,'en sentido de las manecillas del reloj');
    t=t.replace(/CCW\b/g,'en contra de las manecillas del reloj');
    t=t.replace(/UV\b/g,'ultravioleta');
    // Other symbols
    t=t.replace(/&/g,' y ');
    t=t.replace(/%/g,' por ciento');
    t=t.replace(/#/g,'nÃºmero ');
    // Clean up emojis for speech
    t=t.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu,'');
    // Clean double spaces
    t=t.replace(/\s{2,}/g,' ').trim();
    return t;
}

async function speakText(text){
    // Cancel any ongoing speech
    if(speechAbort)speechAbort.cancelled=true;
    const thisAbort={cancelled:false};
    speechAbort=thisAbort;
    
    try{
        isSpeaking=true;
        lowerMusicForSpeech();
        document.getElementById('speakingIndicator').classList.add('active');
        
        // Preprocess text for natural speech
        const spokenText=prepareForSpeech(text);
        
        // Split into chunks at sentence boundaries
        const chunks=splitTextChunks(spokenText,500);
        
        // Pre-fetch first chunk
        let nextBlob=await fetchVoiceChunk(chunks[0]);
        if(thisAbort.cancelled)return cleanupSpeech();
        
        for(let i=0;i<chunks.length;i++){
            if(thisAbort.cancelled)return cleanupSpeech();
            
            const currentBlob=nextBlob;
            
            // If API returned null, use browser voice fallback
            if(!currentBlob){
                // Try browser speech for this chunk
                if(window.speechSynthesis){
                    await speakWithBrowser(chunks[i]);
                }
                if(i+1<chunks.length)nextBlob=await fetchVoiceChunk(chunks[i+1]);
                continue;
            }
            
            // Start pre-fetching NEXT chunk while current plays
            const fetchNext=(i+1<chunks.length)?fetchVoiceChunk(chunks[i+1]):Promise.resolve(null);
            
            // Play current chunk
            const audioUrl=URL.createObjectURL(currentBlob);
            const audio=document.getElementById('aiAudio');
            audio.src=audioUrl;
            
            await new Promise(resolve=>{
                audio.onended=()=>{URL.revokeObjectURL(audioUrl);resolve();};
                audio.onerror=()=>{URL.revokeObjectURL(audioUrl);resolve();};
                audio.play().catch(()=>resolve());
            });
            
            if(thisAbort.cancelled)return cleanupSpeech();
            
            // Next chunk should already be fetched
            nextBlob=await fetchNext;
        }
        
        cleanupSpeech();
    }catch(e){
        console.error('Voice Error:',e);
        cleanupSpeech();
    }
}

async function fetchVoiceChunk(text){
    try{
        const r=await fetch(SUPABASE_URL+'/tutor-ia-voice',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                text:text.trim(),
                lang:D.lang||'es',
                voice:D.lang==='en'?'echo':'nova'
            })
        });
        if(!r.ok)return null;
        return await r.blob();
    }catch(e){return null;}
}

// ========== BROWSER VOICE FALLBACK ==========
// If API voice fails, use browser's SpeechSynthesis with proper voice
let browserVoicesLoaded=false;
let preferredVoiceES=null;
let preferredVoiceEN=null;

function loadBrowserVoices(){
    if(browserVoicesLoaded)return;
    const voices=window.speechSynthesis?window.speechSynthesis.getVoices():[];
    if(voices.length===0)return;
    browserVoicesLoaded=true;
    
    // Spanish voice priority: Mexican > Latin American > Spain > any Spanish
    const esVoices=voices.filter(v=>v.lang.startsWith('es'));
    const mxVoice=esVoices.find(v=>v.lang==='es-MX'||v.name.toLowerCase().includes('mexico')||v.name.toLowerCase().includes('mexican'));
    const latamVoice=esVoices.find(v=>v.lang==='es-US'||v.lang==='es-419'||v.name.toLowerCase().includes('latin'));
    const maleES=esVoices.find(v=>v.name.toLowerCase().includes('jorge')||v.name.toLowerCase().includes('carlos')||v.name.toLowerCase().includes('diego')||v.name.toLowerCase().includes('andrÃ©s'));
    preferredVoiceES=mxVoice||latamVoice||maleES||esVoices[0]||null;
    
    // English voice priority: US male
    const enVoices=voices.filter(v=>v.lang.startsWith('en'));
    const usVoice=enVoices.find(v=>v.lang==='en-US');
    const maleEN=enVoices.find(v=>v.name.toLowerCase().includes('daniel')||v.name.toLowerCase().includes('alex')||v.name.toLowerCase().includes('david'));
    preferredVoiceEN=maleEN||usVoice||enVoices[0]||null;
    
    console.log('Browser voices loaded. ES:',preferredVoiceES?.name,'EN:',preferredVoiceEN?.name);
}

// Load voices (some browsers need event listener)
if(window.speechSynthesis){
    loadBrowserVoices();
    window.speechSynthesis.onvoiceschanged=loadBrowserVoices;
}

function speakWithBrowser(text){
    return new Promise((resolve)=>{
        if(!window.speechSynthesis){resolve();return;}
        loadBrowserVoices();
        const utter=new SpeechSynthesisUtterance(text);
        utter.lang=D.lang==='es'?'es-MX':'en-US';
        utter.rate=0.95;
        utter.pitch=1.0;
        const voice=D.lang==='es'?preferredVoiceES:preferredVoiceEN;
        if(voice)utter.voice=voice;
        utter.onend=resolve;
        utter.onerror=resolve;
        window.speechSynthesis.speak(utter);
    });
}

function cleanupSpeech(){
    isSpeaking=false;
    document.getElementById('speakingIndicator').classList.remove('active');
    restoreMusicAfterSpeech();
}

function stopSpeech(){
    if(speechAbort)speechAbort.cancelled=true;
    const audio=document.getElementById('aiAudio');
    audio.pause();
    audio.removeAttribute('src');
    if(window.speechSynthesis)window.speechSynthesis.cancel();
    cleanupSpeech();
}

function splitTextChunks(text,maxLen){
    if(text.length<=maxLen)return[text];
    const chunks=[];
    let remaining=text;
    while(remaining.length>0){
        if(remaining.length<=maxLen){chunks.push(remaining);break;}
        let splitAt=-1;
        for(let i=Math.min(maxLen,remaining.length)-1;i>=maxLen*0.4;i--){
            if('.!?'.includes(remaining[i])){splitAt=i+1;break;}
        }
        if(splitAt===-1){
            for(let i=Math.min(maxLen,remaining.length)-1;i>=maxLen*0.4;i--){
                if(',;:'.includes(remaining[i])){splitAt=i+1;break;}
            }
        }
        if(splitAt===-1){
            for(let i=Math.min(maxLen,remaining.length)-1;i>=maxLen*0.4;i--){
                if(remaining[i]===' '){splitAt=i+1;break;}
            }
        }
        if(splitAt===-1)splitAt=maxLen;
        chunks.push(remaining.substring(0,splitAt));
        remaining=remaining.substring(splitAt);
    }
    return chunks;
}

function openAIChat(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    document.getElementById('aiModal').classList.add('active');
}

function closeAIChat(){
    document.getElementById('aiModal').classList.remove('active');
    const audio=document.getElementById('aiAudio');
    audio.pause();
    isSpeaking=false;
    document.getElementById('speakingIndicator').classList.remove('active');
}

async function sendAIMessage(){
    const input=document.getElementById('aiInput');
    const msgs=document.getElementById('aiMessages');
    const sendBtn=document.getElementById('sendBtn');
    const txt=input.value.trim();
    if(!txt||isSpeaking)return;
    
    // Desbloquear audio en el click
    unlockAudio();
    
    // Disable input while processing
    input.disabled=true;
    sendBtn.disabled=true;
    
    // Show user message
    msgs.innerHTML+='<div class="ai-msg user">'+txt+'</div>';
    input.value='';
    
    // Show typing indicator
    msgs.innerHTML+='<div class="ai-msg mario" id="typing"><div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>';
    msgs.scrollTop=msgs.scrollHeight;
    
    // Get AI text response
    const response=await getAIResponse(txt);
    
    // Track characters used
    if(window.trackAIChars) window.trackAIChars(txt + response);
    
    // Remove typing indicator and show response
    const typing=document.getElementById('typing');
    if(typing)typing.remove();
    msgs.innerHTML+='<div class="ai-msg mario">'+response+'</div>';
    msgs.scrollTop=msgs.scrollHeight;
    
    // Re-enable input
    input.disabled=false;
    sendBtn.disabled=false;
    input.focus();
    
    // Speak the response
    await speakText(response);
}

// ========== CONFETTI ==========
function cft(){
    const c=document.getElementById('conf');
    c.innerHTML='';
    const cols=['#ff6b2b','#00d4ff','#f1c40f','#2ecc71','#e74c3c','#9b59b6'];
    for(let i=0;i<25;i++){
        const p=document.createElement('div');
        p.className='cf';
        p.style.left=Math.random()*100+'%';
        p.style.background=cols[Math.floor(Math.random()*cols.length)];
        p.style.animationDelay=Math.random()*1.5+'s';
        p.style.animationDuration=(2+Math.random()*1.5)+'s';
        p.style.width=(6+Math.random()*6)+'px';
        p.style.height=p.style.width;
        p.style.borderRadius=Math.random()>.5?'50%':'2px';
        c.appendChild(p);
    }
    setTimeout(()=>c.innerHTML='',3500);
}

// ========== TRANSLATIONS ==========
const T={
es:{step_1:'Paso 1 de 5',step_2:'Paso 2 de 5',step_3:'Paso 3 de 5',step_4:'Paso 4 de 5',step_5:'Paso 5 de 5',welcome_speech:'Â¡Bienvenido! Soy el Maestro Mario y voy a ser tu guÃ­a. Â¿CÃ³mo te llamas?',name_ph:'Escribe tu nombre aquÃ­...',continue:'Continuar â†’',level_speech:'Â¡Mucho gusto, {name}! Â¿En quÃ© nivel tÃ©cnico te encuentras?',spec_speech:'Â¡Excelente, {name}! Â¿En quÃ© Ã¡reas te sientes mÃ¡s fuerte?',multi_hint:'Selecciona una o mÃ¡s opciones',school_speech:'Â¡Vas muy bien, {name}! Â¿DÃ³nde estÃ¡s estudiando?',goals_speech:'Â¡Ãšltima pregunta, {name}! Â¿QuÃ© quieres lograr?',route_speech:'Â¡Perfecto, {name}! He creado tu ruta personalizada. Â¡Vamos con todo!',start_btn:'ðŸš€ Â¡Empezar a Aprender!',lv1:'Estudiante',lv1d:'Estoy aprendiendo lo bÃ¡sico',lv2:'Ayudante',lv2d:'Ya ando en el campo con un tÃ©cnico',lv3:'TÃ©cnico',lv3d:'Ya trabajo solo pero quiero mejorar',lv4:'Avanzado',lv4d:'Quiero dominar el oficio',lv5:'Maestro',lv5d:'Quiero ser lÃ­der / abrir mi empresa',sp_e:'Electricidad',sp_ed:'Circuitos, controles, cableado',sp_a:'Aire Acondicionado',sp_ad:'Splits, centrales, mini splits',sp_r:'RefrigeraciÃ³n',sp_rd:'CÃ¡maras frÃ­as, refrigeradores comerciales',sp_h:'CalefacciÃ³n',sp_hd:'Furnaces, bombas de calor',sp_x:'Estoy empezando en todo',sp_xd:'Quiero aprender de todo',sc_ac:'ACVOLT Tech School',sc_acd:'Estudiante actual de ACVOLT',sc_ot:'Otra escuela',sc_otd:'Estoy en otra instituciÃ³n',sc_sf:'Aprendo por mi cuenta',sc_sfd:'YouTube, libros, campo',sc_dn:'Ya terminÃ© mis estudios',sc_dnd:'Tengo certificaciÃ³n/diploma',gl_c:'Pasar mis certificaciones',gl_cd:'EPA, NATE, OSHA, NCCER',gl_d:'Mejorar mis diagnÃ³sticos',gl_dd:'Ser mÃ¡s preciso en el campo',gl_b:'Abrir mi propio negocio',gl_bd:'De tÃ©cnico a empresario',gl_m:'Ganar mÃ¡s dinero',gl_md:'Subir mi valor como tÃ©cnico',r_elec:'Fundamentos ElÃ©ctricos',r_elecd:'Circuitos, Ley de Ohm, diagramas',r_ac:'Aire Acondicionado',r_acd:'Presiones, carga de refrigerante',r_ref:'RefrigeraciÃ³n Comercial',r_refd:'CÃ¡maras frÃ­as, controles, defrost',r_heat:'CalefacciÃ³n',r_heatd:'Furnaces, bombas de calor, gas',r_cert:'PreparaciÃ³n para Certificaciones',r_certd:'EPA 608 â€¢ NATE â€¢ OSHA â€¢ NCCER',r_biz:'De TÃ©cnico a Empresario',r_bizd:'Licencias, estimados, clientes'},
en:{step_1:'Step 1 of 5',step_2:'Step 2 of 5',step_3:'Step 3 of 5',step_4:'Step 4 of 5',step_5:'Step 5 of 5',welcome_speech:"Welcome technician! I'm Maestro Mario and I'll be your guide. What's your name?",name_ph:'Type your name here...',continue:'Continue â†’',level_speech:"Nice to meet you, {name}! What's your technical level?",spec_speech:'Excellent, {name}! What areas are you strongest in?',multi_hint:'Select one or more options',school_speech:'Great progress, {name}! Where are you studying?',goals_speech:'Last question, {name}! What do you want to achieve?',route_speech:"Perfect, {name}! I've created your personalized path. Let's go!",start_btn:'ðŸš€ Start Learning!',lv1:'Student',lv1d:"I'm learning the basics",lv2:'Helper',lv2d:"I'm in the field with a technician",lv3:'Technician',lv3d:'I work solo but want to improve',lv4:'Advanced',lv4d:'I want to master the trade',lv5:'Master',lv5d:'I want to lead / start my business',sp_e:'Electrical',sp_ed:'Circuits, controls, wiring',sp_a:'Air Conditioning',sp_ad:'Splits, central, mini splits',sp_r:'Refrigeration',sp_rd:'Walk-in coolers, commercial',sp_h:'Heating',sp_hd:'Furnaces, heat pumps',sp_x:'Starting in everything',sp_xd:'I want to learn it all',sc_ac:'ACVOLT Tech School',sc_acd:'Current ACVOLT student',sc_ot:'Another school',sc_otd:"I'm at another institution",sc_sf:'Self-taught',sc_sfd:'YouTube, books, field',sc_dn:'Completed studies',sc_dnd:'I have certification/diploma',gl_c:'Pass certifications',gl_cd:'EPA, NATE, OSHA, NCCER',gl_d:'Improve diagnostics',gl_dd:'Be more precise in the field',gl_b:'Start my business',gl_bd:'From tech to owner',gl_m:'Earn more money',gl_md:'Increase my value',r_elec:'Electrical Fundamentals',r_elecd:"Circuits, Ohm's law, diagrams",r_ac:'Air Conditioning',r_acd:'Pressure diagnostics, charging',r_ref:'Commercial Refrigeration',r_refd:'Walk-in coolers, controls, defrost',r_heat:'Heating Systems',r_heatd:'Furnaces, heat pumps, gas',r_cert:'Certification Prep',r_certd:'EPA 608 â€¢ NATE â€¢ OSHA â€¢ NCCER',r_biz:'Tech to Business Owner',r_bizd:'Licensing, estimates, clients'}
};

const t=k=>(T[D.lang][k]||k).replace('{name}',D.name);
const u=()=>{document.querySelectorAll('[data-t]').forEach(e=>e.textContent=t(e.getAttribute('data-t')));document.querySelectorAll('[data-tp]').forEach(e=>e.placeholder=t(e.getAttribute('data-tp')));};
const go=id=>{document.querySelectorAll('.s').forEach(s=>s.classList.remove('on'));document.getElementById(id).classList.add('on');window.scrollTo(0,0);};
const rx=(id,c)=>{const e=document.getElementById(id);if(e){e.classList.add(c);setTimeout(()=>e.classList.remove(c),1500);}};

function setLang(l){D.lang=l;unlockAudio();u();updateLanguageUI();showVideo('bienvenida',()=>{go('s2');document.getElementById('nm').placeholder=t('name_ph');speakText(t('welcome_speech'));});}
function sName(){D.name=document.getElementById('nm').value.trim();D.gender=detectGender(D.name);u();bLvl();go('s3');rx('a3','nod');speakText(t('level_speech'));document.getElementById('profileBtn').classList.add('active');}
function pLvl(e,v){document.querySelectorAll('#lo .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.level=v;document.getElementById('b3').disabled=false;rx('a3','nod');}
function sLvl(){u();bSpc();go('s4');speakText(t('spec_speech'));}
function tSpc(e,k){if(k==='all'){document.querySelectorAll('#so .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.specs=['all'];}else{document.querySelector('#so .oc:last-child').classList.remove('sel');D.specs=D.specs.filter(s=>s!=='all');e.classList.toggle('sel');if(e.classList.contains('sel'))D.specs.push(k);else D.specs=D.specs.filter(s=>s!==k);}document.getElementById('b4').disabled=D.specs.length===0;rx('a4','nod');}
function sSpc(){u();bSch();go('s5');speakText(t('school_speech'));}
function pSch(e,v){document.querySelectorAll('#sco .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.school=v;document.getElementById('b5').disabled=false;rx('a5','nod');}
function sSch(){u();bGol();go('s6');speakText(t('goals_speech'));}
function tGol(e,k){e.classList.toggle('sel');if(e.classList.contains('sel'))D.goals.push(k);else D.goals=D.goals.filter(g=>g!==k);document.getElementById('b6').disabled=D.goals.length===0;rx('a6','nod');}
function sGol(){u();bRt();go('s7');cft();rx('a7','cel');speakText(t('route_speech'));}

function bLvl(){document.getElementById('lo').innerHTML=[{k:1,i:'ðŸ“š',t:'lv1',d:'lv1d'},{k:2,i:'ðŸ”§',t:'lv2',d:'lv2d'},{k:3,i:'âš™ï¸',t:'lv3',d:'lv3d'},{k:4,i:'ðŸŽ¯',t:'lv4',d:'lv4d'},{k:5,i:'ðŸ‘‘',t:'lv5',d:'lv5d'}].map(x=>'<div class="oc" onclick="pLvl(this,'+x.k+')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div></div>').join('');}
function bSpc(){document.getElementById('so').innerHTML=[{k:'electrical',i:'âš¡',t:'sp_e',d:'sp_ed'},{k:'ac',i:'â„ï¸',t:'sp_a',d:'sp_ad'},{k:'refrigeration',i:'ðŸ§Š',t:'sp_r',d:'sp_rd'},{k:'heating',i:'ðŸ”¥',t:'sp_h',d:'sp_hd'},{k:'all',i:'ðŸŒŸ',t:'sp_x',d:'sp_xd'}].map(x=>'<div class="oc" onclick="tSpc(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div><div class="ck"></div></div>').join('');}
function bSch(){document.getElementById('sco').innerHTML=[{k:'acvolt',i:'ðŸŽ“',t:'sc_ac',d:'sc_acd'},{k:'other',i:'ðŸ«',t:'sc_ot',d:'sc_otd'},{k:'self',i:'ðŸ’ª',t:'sc_sf',d:'sc_sfd'},{k:'done',i:'âœ…',t:'sc_dn',d:'sc_dnd'}].map(x=>'<div class="oc" onclick="pSch(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div></div>').join('');}
function bGol(){document.getElementById('go2').innerHTML=[{k:'certs',i:'ðŸ“‹',t:'gl_c',d:'gl_cd'},{k:'diag',i:'ðŸ”',t:'gl_d',d:'gl_dd'},{k:'biz',i:'ðŸ¢',t:'gl_b',d:'gl_bd'},{k:'money',i:'ðŸ’°',t:'gl_m',d:'gl_md'}].map(x=>'<div class="oc" onclick="tGol(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div><div class="ck"></div></div>').join('');}
function bRt(){var r=[];if(D.specs.includes('all')||D.specs.includes('electrical'))r.push({i:'âš¡',t:'r_elec',d:'r_elecd'});if(D.specs.includes('all')||D.specs.includes('ac'))r.push({i:'â„ï¸',t:'r_ac',d:'r_acd'});if(D.specs.includes('all')||D.specs.includes('refrigeration'))r.push({i:'ðŸ§Š',t:'r_ref',d:'r_refd'});if(D.specs.includes('all')||D.specs.includes('heating'))r.push({i:'ðŸ”¥',t:'r_heat',d:'r_heatd'});if(D.goals.includes('certs'))r.push({i:'ðŸ“‹',t:'r_cert',d:'r_certd'});if(D.goals.includes('biz'))r.push({i:'ðŸ¢',t:'r_biz',d:'r_bizd'});document.getElementById('rl').innerHTML=r.map((x,i)=>'<div class="rt"><div class="rn">'+(i+1)+'</div><div><div class="rtt">'+x.i+' '+t(x.t)+'</div><div class="rd">'+t(x.d)+'</div></div></div>'+(i<r.length-1?'<div class="rl"></div>':'')).join('');}

function startApp(){
    enterStudyMode();
    updateHub();
    go('s-hub');
    speakText(D.lang==='es'?'Â¡'+D.name+'! Bienvenid'+gn('o','a')+' a tu centro de entrenamiento. Elige quÃ© quieres hacer: tomar un quiz, repasar lo que fallaste, o ver videos.':'Welcome '+D.name+'! Choose what you want to do: take a quiz, study what you missed, or watch videos.');
}

// ========== QUIZ TRANSLATION HELPER ==========
// Returns the correct language version of a question field
function tq(q,field){
    if(D.lang==='en'&&q[field+'_en'])return q[field+'_en'];
    return q[field];
}

const QUIZ_LIST=[
    {id:'intro',icon:'ðŸ†•',title:'Intro HVACR',title_en:'Intro to HVACR',desc:'50 preguntas: La industria, carrera, salarios, herramientas, seguridad, certificaciones y terminologÃ­a',desc_en:'50 questions: The industry, career, salary, tools, safety, certifications and terminology',count:50,data:'QUIZ_INTRO',color:'#3498db'},
    {id:'principiante',icon:'ðŸ“š',title:'Principiante HVAC',title_en:'HVAC Beginner',desc:'50 preguntas de electricidad bÃ¡sica, refrigeraciÃ³n, AC, herramientas y seguridad',desc_en:'50 questions on basic electrical, refrigeration, AC, tools and safety',count:50,data:'QUIZ_PRINCIPIANTE',color:'#00d4ff'},
    {id:'electricidad',icon:'âš¡',title:'Electricidad Avanzada',title_en:'Advanced Electrical',desc:'117 preguntas: Ley de Ohm, NEC, motores, VFD, GFCI, AFCI, circuitos, contactores',desc_en:'117 questions: Ohm\'s Law, NEC, motors, VFD, GFCI, AFCI, circuits, contactors',count:117,data:'QUIZ_ELECTRICIDAD',color:'#ffd700'},
    {id:'refrigeracion',icon:'â„ï¸',title:'RefrigeraciÃ³n Completa',title_en:'Complete Refrigeration',desc:'200 preguntas: DomÃ©stica, Comercial, Walk-in, EPA 608, Troubleshooting, Refrigerantes, Seguridad',desc_en:'200 questions: Domestic, Commercial, Walk-in, EPA 608, Troubleshooting, Refrigerants, Safety',count:200,data:'QUIZ_REFRIGERACION',color:'#00e5ff'}
];

function renderQuizSelector(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    const el=document.getElementById('quizSelList');
    const scores=JSON.parse(localStorage.getItem('maestro_quiz_scores')||'{}');
    el.innerHTML=QUIZ_LIST.map(q=>{
        const best=scores[q.id];
        const badge=best?'<span class="qs-badge done">âœ… '+best+'%</span>':'<span class="qs-badge new">Nuevo</span>';
        const stars=best?'<div class="qs-stars">'+getStarsHTML(best)+'</div>':'';
        return '<div class="quiz-sel-card" onclick="selectQuiz(\''+q.id+'\')" style="border-color:'+q.color+'22">'+
            '<div class="qs-icon" style="background:'+q.color+'15;color:'+q.color+'">'+q.icon+'</div>'+
            '<div class="qs-info"><div class="qs-title" style="color:'+q.color+'">'+q.title+'</div>'+
            '<div class="qs-desc">'+(D.lang==='es'?q.desc:(q.desc_en||q.desc))+'</div>'+
            '<div class="qs-count">ðŸ“ '+q.count+(D.lang==='es'?' preguntas':' questions')+'</div>'+stars+'</div>'+badge+'</div>';
    }).join('');
}

function getStarsHTML(pct){
    const filled=pct>=90?5:pct>=80?4:pct>=70?3:pct>=50?2:1;
    return Array(5).fill(0).map((_,i)=>i<filled?'â­':'â˜†').join('');
}

let currentQuizId='principiante';

function selectQuiz(id){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    currentQuizId=id;
    const q=QUIZ_LIST.find(x=>x.id===id);
    startQuiz(id);
    const intro=D.lang==='es'?'Â¡Vamos con '+q.title+', '+D.name+'! '+q.count+' preguntas bien capciositas. Demuestra lo que sabes.':'Let\'s go with '+q.title+', '+D.name+'! '+q.count+' tricky questions.';
    speakText(intro);
}

// ========== QUIZ SYSTEM ==========
const QUIZ_PRINCIPIANTE=[
// ELECTRICIDAD BÃSICA (13)
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"El voltaje en un circuito se puede comparar mejor con:",q_en:"Voltage in a circuit can best be compared to:",o:["La cantidad de agua en un tanque","La presiÃ³n que empuja el agua por la tuberÃ­a","El diÃ¡metro de la tuberÃ­a","La velocidad del agua al salir"],o_en:["The amount of water in a tank","The pressure pushing water through the pipe","The diameter of the pipe","The speed of water coming out"],c:1,e:"El voltaje es la diferencia de potencial que empuja los electrones, similar a la presiÃ³n del agua.",e_en:"Voltage is the potential difference that pushes electrons, similar to water pressure.",a:"Imagina una manguera de jardÃ­n: el voltaje es como la presiÃ³n del agua. Sin presiÃ³n no sale nada. Los voltios son esa fuerza que empuja la electricidad por los cables.",a_en:"Imagine a garden hose: voltage is like the water pressure. Without pressure, nothing comes out. Volts are that force pushing electricity through the wires."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"Si un circuito tiene 240V y 20A de corriente, Â¿cuÃ¡l es la resistencia segÃºn Ohm?",q_en:"If a circuit has 240V and 20A of current, what is the resistance according to Ohm's law?",o:["4,800 ohms","260 ohms","12 ohms","220 ohms"],o_en:["4,800 ohms","260 ohms","12 ohms","220 ohms"],c:2,e:"V = I Ã— R, entonces R = V/I = 240/20 = 12 ohms.",e_en:"V = I Ã— R, so R = V/I = 240/20 = 12 ohms.",a:"Es como dividir galletas entre niÃ±os. 240 galletas (voltios) entre 20 niÃ±os (amperios) = 12 galletas cada uno (ohms). R = V Ã· I.",a_en:"It's like dividing cookies among kids. 240 cookies (volts) among 20 kids (amps) = 12 cookies each (ohms). R = V Ã· I."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"EstÃ¡s midiendo voltaje en un tomacorriente y el multÃ­metro marca 0V. Â¿CuÃ¡l es la causa MÃS probable?",q_en:"You're measuring voltage at an outlet and the multimeter reads 0V. What is the MOST probable cause?",o:["El tomacorriente estÃ¡ daÃ±ado","El breaker estÃ¡ apagado o disparado","El multÃ­metro estÃ¡ en la escala de amperios","Las tres podrÃ­an causar la lectura de 0V"],o_en:["The outlet is damaged","The breaker is off or tripped","The multimeter is on the amps scale","All three could cause the 0V reading"],c:3,e:"Las tres situaciones pueden dar lectura de 0V. Un buen tÃ©cnico verifica cada posibilidad.",e_en:"All three situations can give a 0V reading. A good technician checks each possibility.",a:"Es como cuando no sale agua de la llave: puede ser que cerraron la vÃ¡lvula, que no hay agua en la calle, o que la llave estÃ¡ rota. No asumas, verifica cada cosa.",a_en:"It's like when no water comes from the faucet: the valve may be closed, there may be no city water, or the faucet may be broken. Don't assume, verify each one."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"En un circuito en paralelo, si se quema una carga, las demÃ¡s:",q_en:"In a parallel circuit, if one load burns out, the others:",o:["Se apagan todas inmediatamente","Siguen funcionando pero con mÃ¡s voltaje","Siguen funcionando normalmente","Funcionan pero mÃ¡s lento"],o_en:["All shut off immediately","Keep working but with more voltage","Keep working normally","Work but slower"],c:2,e:"En paralelo cada carga tiene su propio camino. Si una falla, las demÃ¡s no se afectan.",e_en:"In parallel each load has its own path. If one fails, the others aren't affected.",a:"Piensa en las casas de tu cuadra: si tu vecino apaga sus luces, las tuyas siguen prendidas. Cada casa tiene su propia conexiÃ³n. Eso es paralelo.",a_en:"Think of the houses on your block: if your neighbor turns off their lights, yours stay on. Each house has its own connection. That's parallel."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"Un fusible de 15A se quema repetidamente. La acciÃ³n correcta es:",q_en:"A 15A fuse blows repeatedly. The correct action is:",o:["Poner uno de 20A para que aguante mÃ¡s","Poner uno de 30A y resolver despuÃ©s","Buscar la causa del exceso de corriente","Puentear el fusible temporalmente"],o_en:["Put a 20A fuse so it can handle more","Put a 30A fuse and fix it later","Find the cause of the excess current","Jumper the fuse temporarily"],c:2,e:"NUNCA pongas un fusible mÃ¡s grande. Hay que encontrar por quÃ© estÃ¡ jalando mÃ¡s corriente de lo normal.",e_en:"NEVER install a bigger fuse. You must find why it's drawing more current than normal.",a:"El fusible es como la alarma de incendios. Si se activa, no le quitas las pilas â€” buscas el fuego. Poner uno mÃ¡s grande es como quitar la alarma: la casa se va a quemar.",a_en:"The fuse is like a fire alarm. If it goes off, you don't remove the batteries â€” you look for the fire. Putting a bigger fuse is like removing the alarm: the house will burn down."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"Un equipo residencial de AC necesita 240V. Al medir entre las dos lÃ­neas (hot) obtienes 208V. Esto indica:",q_en:"A residential AC unit needs 240V. When measuring between the two hot lines you get 208V. This indicates:",o:["El equipo estÃ¡ daÃ±ado","Es alimentaciÃ³n trifÃ¡sica, no monofÃ¡sica","El multÃ­metro necesita calibraciÃ³n","El voltaje estÃ¡ bajo y hay que llamar a la compaÃ±Ã­a elÃ©ctrica"],o_en:["The equipment is damaged","It's three-phase power, not single-phase","The multimeter needs calibration","Voltage is low and you need to call the power company"],c:1,e:"208V entre fases indica alimentaciÃ³n trifÃ¡sica (comÃºn en comercial). Residencial monofÃ¡sico da 240V.",e_en:"208V between phases indicates three-phase power (common in commercial). Residential single-phase gives 240V.",a:"Es como pedir una pizza familiar y te traen una mediana. No estÃ¡ mal, pero no es lo que pediste. 208V funciona diferente que 240V y puede afectar el rendimiento del equipo.",a_en:"It's like ordering a large pizza and they bring you a medium. It's not wrong, but it's not what you ordered. 208V works differently than 240V and can affect equipment performance."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"El cable verde con franja amarilla en un circuito SIEMPRE debe ir a:",q_en:"The green wire with yellow stripe in a circuit ALWAYS goes to:",o:["La lÃ­nea caliente (hot)","El neutro","El ground (tierra)","Depende del circuito"],o_en:["The hot line","The neutral","The ground","Depends on the circuit"],c:2,e:"Verde o verde/amarillo es SIEMPRE tierra. Nunca se usa para otra cosa, es una regla de seguridad absoluta.",e_en:"Green or green/yellow is ALWAYS ground. It's never used for anything else â€” it's an absolute safety rule.",a:"Verde = pasto = tierra. AsÃ­ como el pasto siempre estÃ¡ abajo, el cable verde siempre va a tierra. Si alguien lo usÃ³ para otra cosa, ese electricista hizo una chambonada peligrosa.",a_en:"Green = grass = ground. Just as grass is always on the ground, the green wire always goes to ground. If someone used it for something else, that electrician did a dangerous hack job."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"Un motor monofÃ¡sico no arranca pero zumba. El componente MÃS probable que fallÃ³ es:",q_en:"A single-phase motor won't start but hums. The component MOST likely to have failed is:",o:["El contactor","El capacitor de arranque","El termostato","El breaker"],o_en:["The contactor","The start capacitor","The thermostat","The breaker"],c:1,e:"Un motor que zumba pero no gira casi siempre indica capacitor de arranque daÃ±ado.",e_en:"A motor that hums but won't spin almost always indicates a bad start capacitor.",a:"El capacitor es como el empujÃ³n que le das a un columpio. El motor necesita ese empujÃ³n inicial. Si el capacitor falla, el motor quiere girar pero no puede, por eso zumba.",a_en:"The capacitor is like the push you give a swing. The motor needs that initial push. If the capacitor fails, the motor wants to spin but can't, that's why it hums."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"Un cortocircuito se diferencia de una sobrecarga porque:",q_en:"A short circuit differs from an overload because:",o:["La sobrecarga es mÃ¡s peligrosa","El cortocircuito genera corriente muy alta instantÃ¡neamente","La sobrecarga dispara el breaker mÃ¡s rÃ¡pido","No hay diferencia real entre ambos"],o_en:["An overload is more dangerous","A short circuit generates very high current instantaneously","An overload trips the breaker faster","There's no real difference between them"],c:1,e:"El cortocircuito genera corriente masiva instantÃ¡nea. La sobrecarga es un exceso gradual.",e_en:"A short circuit generates massive current instantly. An overload is a gradual excess.",a:"Un cortocircuito es como una presa que se revienta: el agua sale toda de golpe. La sobrecarga es como dejar todas las llaves abiertas poco a poco. Ambos son problemas, pero el cortocircuito es mÃ¡s violento.",a_en:"A short circuit is like a dam bursting: water rushes out all at once. An overload is like slowly opening all the faucets. Both are problems, but the short circuit is more violent."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"La corriente AC a 60Hz en USA cambia de direcciÃ³n:",q_en:"AC current at 60Hz in the USA changes direction:",o:["60 veces por segundo","120 veces por segundo","60 veces por minuto","Una vez cada 60 segundos"],o_en:["60 times per second","120 times per second","60 times per minute","Once every 60 seconds"],c:1,e:"60Hz = 60 ciclos, pero cada ciclo tiene dos cambios de direcciÃ³n, entonces son 120 cambios por segundo.",e_en:"60Hz = 60 cycles, but each cycle has two direction changes, so it's 120 changes per second.",a:"Un ciclo es como un columpio: va y viene, eso son DOS movimientos. Entonces 60 ciclos = 120 cambios de direcciÃ³n. Esta es una pregunta capciosa que muchos tÃ©cnicos fallan.",a_en:"A cycle is like a swing: it goes and comes back, that's TWO movements. So 60 cycles = 120 direction changes. This is a tricky question that many technicians get wrong."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"Un equipo etiquetado como 1500W a 120V, Â¿cuÃ¡ntos amperios consume?",q_en:"A piece of equipment rated at 1500W at 120V, how many amps does it consume?",o:["12.5A","180,000A","15A","1,380A"],o_en:["12.5A","180,000A","15A","1,380A"],c:0,e:"I = W/V = 1500/120 = 12.5A.",e_en:"I = W/V = 1500/120 = 12.5A.",a:"Watts Ã· Voltios = Amperios. Es como repartir: 1500 entre 120 = 12.5. Este cÃ¡lculo lo vas a hacer TODOS los dÃ­as en el campo.",a_en:"Watts Ã· Volts = Amps. It's like dividing: 1500 by 120 = 12.5. You'll do this calculation EVERY day in the field."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"El contactor del compresor se cierra pero el compresor no arranca. Â¿QuÃ© revisas PRIMERO?",q_en:"The compressor contactor closes but the compressor doesn't start. What do you check FIRST?",o:["El termostato","El voltaje que llega al compresor","El nivel de refrigerante","La presiÃ³n del sistema"],o_en:["The thermostat","The voltage reaching the compressor","The refrigerant level","The system pressure"],c:1,e:"Si el contactor cierra, la seÃ±al de control estÃ¡ bien. Hay que verificar que el voltaje llega al compresor.",e_en:"If the contactor closes, the control signal is fine. You need to verify voltage is reaching the compressor.",a:"Es como cuando enciendes el switch de la luz pero el foco no prende. El switch funciona, entonces el problema estÃ¡ del switch al foco. Mide voltaje en los terminales del compresor.",a_en:"It's like when you flip the light switch but the bulb doesn't turn on. The switch works, so the problem is between the switch and the bulb. Measure voltage at the compressor terminals."},
{cat:"âš¡ Electricidad BÃ¡sica",cat_en:"âš¡ Basic Electrical",q:"Â¿CuÃ¡l es la diferencia principal entre un capacitor de arranque (start) y uno de marcha (run)?",q_en:"What is the main difference between a start capacitor and a run capacitor?",o:["El de arranque tiene mÃ¡s microfaradios y se desconecta al arrancar","El de marcha tiene mÃ¡s microfaradios","Son intercambiables","El de arranque es mÃ¡s pequeÃ±o fÃ­sicamente"],o_en:["The start cap has more microfarads and disconnects after starting","The run cap has more microfarads","They're interchangeable","The start cap is physically smaller"],c:0,e:"El start cap tiene mÃ¡s MFD, da el empujÃ³n inicial y se desconecta. El run cap queda conectado siempre.",e_en:"The start cap has more MFD, gives the initial boost and disconnects. The run cap stays connected at all times.",a:"El capacitor de arranque es como el turbo de un carro: te da un empujÃ³n fuerte al inicio y luego se apaga. El de marcha es como el motor regular que trabaja todo el tiempo.",a_en:"The start capacitor is like a car's turbo: it gives you a strong boost at the beginning then shuts off. The run cap is like the regular engine that runs all the time."},
// REFRIGERACIÃ“N BÃSICA (13)
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"En el ciclo de refrigeraciÃ³n, el componente que ABSORBE calor del espacio es:",q_en:"In the refrigeration cycle, the component that ABSORBS heat from the space is:",o:["El condensador, porque ahÃ­ se condensa el gas","El evaporador, porque ahÃ­ se evapora el refrigerante","El compresor, porque genera presiÃ³n","La vÃ¡lvula TXV, porque reduce la temperatura"],o_en:["The condenser, because that's where gas condenses","The evaporator, because that's where refrigerant evaporates","The compressor, because it generates pressure","The TXV valve, because it reduces temperature"],c:1,e:"El evaporador absorbe calor al evaporar el refrigerante. El nombre lo dice: evapora.",e_en:"The evaporator absorbs heat by evaporating the refrigerant. The name says it: it evaporates.",a:"El evaporador es como un vaso con hielo: cuando pones el vaso en la mesa, el hielo absorbe el calor del ambiente y se derrite. El refrigerante hace lo mismo, absorbe calor y se evapora.",a_en:"The evaporator is like a glass of ice: when you set it on the table, the ice absorbs heat from the surroundings and melts. The refrigerant does the same â€” absorbs heat and evaporates."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"El compresor de un sistema de AC estÃ¡ caliente al tacto y hace ruido. Â¿Es normal?",q_en:"The compressor of an AC system is hot to the touch and making noise but isn't cooling. First thing to check:",o:["No, un compresor siempre debe estar frÃ­o","SÃ­, comprimir gas genera calor y vibraciÃ³n","Solo si es un compresor scroll","Depende de la marca"],o_en:["The thermostat wiring","Refrigerant pressures with manifold gauges","The air filter","The blower motor"],c:1,e:"Comprimir gas siempre genera calor. Un compresor caliente que funciona bien es completamente normal.",e_en:"If the compressor runs but doesn't cool, you need to check system pressures to know if there's charge, restriction, or compressor issues.",a:"Infla un globo y siente la boquilla: estÃ¡ caliente. Comprimir aire genera calor. El compresor hace lo mismo pero con refrigerante. Caliente = trabajando. Pero OJO: demasiado caliente = problema.",a_en:"Pressures are like the vital signs of the system. A doctor checks blood pressure first because it tells everything. Manifolds tell you if there's charge, if the compressor pumps, and where the problem is."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"Un sistema con R-410A tiene presiÃ³n de succiÃ³n de 118 PSI. Esto corresponde a una temperatura de evaporaciÃ³n de aproximadamente:",q_en:"A system with R-410A has suction pressure of 118 PSI. That corresponds to approximately:",o:["32Â°F","40Â°F","50Â°F","25Â°F"],o_en:["32Â°F â€” the system is frozen","40Â°F â€” normal for a cooler","118Â°F â€” one degree per PSI","0Â°F â€” too cold"],c:1,e:"R-410A a 118 PSI en succiÃ³n = aproximadamente 40Â°F de temperatura de evaporaciÃ³n.",e_en:"In the R-410A table, 118 PSI on the low side corresponds to approximately 40Â°F saturation temperature.",a:"Cada refrigerante tiene su tabla de presiÃ³n-temperatura. Es como un diccionario: 118 PSI en R-410A siempre = 40Â°F. Memoriza los valores comunes o lleva tu tabla siempre.",a_en:"The pressure-temperature table is like a dictionary: you look up 118 PSI and it tells you 40Â°F. You MUST memorize or always carry this table. It's the most important tool after your gauges."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"Â¿QuÃ© pasa si cargas refrigerante lÃ­quido por el lado de succiÃ³n (baja)?",q_en:"What happens if you charge liquid refrigerant through the suction side directly?",o:["EnfrÃ­a mÃ¡s rÃ¡pido el sistema","Puede daÃ±ar el compresor por golpe de lÃ­quido","No pasa nada diferente","El refrigerante se evapora automÃ¡ticamente"],o_en:["The system charges faster and better","You can damage the compressor (liquid slugging)","Nothing â€” it's the preferred method","The refrigerant becomes contaminated"],c:1,e:"LÃ­quido en succiÃ³n puede causar slugging y daÃ±ar las vÃ¡lvulas del compresor.",e_en:"Liquid entering the compressor causes liquid slugging â€” it can break valves and connecting rods.",a:"Es como tragar un cubo de hielo entero: te puedes ahogar. El compresor estÃ¡ diseÃ±ado para gas, no lÃ­quido. El lÃ­quido no se comprime y rompe las vÃ¡lvulas. Siempre carga en vapor por el lado de baja.",a_en:"The compressor is designed to compress GAS, not liquid. If you pour water into a running blender, you break it. Liquid in the compressor is the same â€” it breaks the valves and internal parts."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"El superheat se mide restando:",q_en:"Superheat is measured by subtracting:",o:["Temperatura de succiÃ³n menos temperatura ambiente","Temperatura de lÃ­nea de succiÃ³n menos temperatura de saturaciÃ³n a la presiÃ³n de succiÃ³n","Temperatura del evaporador menos temperatura del condensador","Temperatura del aire de retorno menos la del supply"],o_en:["Supply temperature minus return temperature","Condenser temperature minus evaporator temperature","Saturation temperature (from low side pressure) from actual suction line temperature","Liquid line temperature minus ambient temperature"],c:1,e:"Superheat = Temp real de la lÃ­nea de succiÃ³n - Temp de saturaciÃ³n segÃºn la presiÃ³n de succiÃ³n.",e_en:"Superheat = suction line temp - saturation temp at low side pressure. It tells you the evaporator is doing its job.",a:"Es como medir fiebre: la temperatura normal es 98.6Â°F (saturaciÃ³n). Si tienes 101Â°F, tu superheat es 2.4Â°F. Mides cuÃ¡nto mÃ¡s caliente estÃ¡ el gas comparado con lo que deberÃ­a estar.",a_en:"Superheat is like checking if all the ice in a drink has melted: the saturation temp tells you where it SHOULD boil, and the line temp tells you how hot it actually is. The difference = superheat."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"Los manifold gauges muestran azul 65 PSI y rojo 250 PSI en un sistema R-22. Esto sugiere:",q_en:"Manifold gauges show blue 65 PSI and red 250 PSI on an R-22 system. What do the pressures indicate?",o:["Presiones normales de operaciÃ³n","Sistema sobrecargado","Posible restricciÃ³n o bajo flujo de aire","Fuga de refrigerante"],o_en:["System is very overcharged","Pressures are approximately normal for R-22 on a hot day","There's a severe refrigerant leak","The compressor is not working"],c:0,e:"Para R-22, succiÃ³n ~65 PSI y descarga ~250 PSI son presiones normales en dÃ­a caluroso.",e_en:"For R-22, low side 60-70 PSI and high side 225-250 PSI is within normal range on a warm day.",a:"Es como cuando el doctor te toma la presiÃ³n: 120/80 es normal. En R-22, 65/250 es saludable. Aprende a leer los gauges como el doctor lee tu presiÃ³n.",a_en:"Every refrigerant has its normal range. For R-22: blue around 65-70 and red around 225-250 on a hot day is like normal blood pressure. You need to know the 'normal' for each refrigerant."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"Si el superheat es demasiado alto, Â¿quÃ© indica generalmente?",q_en:"If superheat is too high, what does it generally indicate?",o:["Hay mucho refrigerante en el sistema","Hay poco refrigerante o flujo de aire excesivo","El compresor estÃ¡ fallando","La vÃ¡lvula TXV estÃ¡ abierta de mÃ¡s"],o_en:["Too much refrigerant","Not enough refrigerant reaching the evaporator","The compressor is too strong","The condenser is dirty"],c:1,e:"Superheat alto = poco refrigerante llegando al evaporador, o demasiado aire pasando por el evaporador.",e_en:"High superheat = evaporator is not getting enough liquid refrigerant. Could be low charge, restricted TXV, or clogged filter.",a:"Superheat alto es como una olla con poca agua en la estufa: se seca rÃ¡pido y se sobrecalienta. El evaporador necesita suficiente refrigerante para absorber calor.",a_en:"High superheat means the evaporator is hungry â€” like a car running out of gas. There's not enough refrigerant arriving to do the job. Either low charge or something blocking the flow."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"La manguera AMARILLA del manifold se conecta normalmente a:",q_en:"The YELLOW manifold hose normally connects to:",o:["El lado de baja presiÃ³n","El lado de alta presiÃ³n","El tanque de refrigerante o bomba de vacÃ­o","El compresor directamente"],o_en:["The low side always","The high side always","The refrigerant tank, vacuum pump, or recovery machine","The compressor directly"],c:2,e:"Azul = baja (succiÃ³n), Roja = alta (descarga), Amarilla = centro (tanque, vacÃ­o, o recuperaciÃ³n).",e_en:"Yellow = center hose = utility hose. Connects to tank, vacuum pump, or recovery depending on the task.",a:"Piensa en un semÃ¡foro: azul frÃ­o (baja), rojo caliente (alta), y amarillo en medio. La manguera amarilla es tu puente al tanque.",a_en:"Blue = low side. Red = high side. Yellow = middle = whatever you need: refrigerant tank when charging, vacuum pump when evacuating, recovery when recovering. The utility player."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"La vÃ¡lvula TXV regula el flujo de refrigerante basÃ¡ndose en:",q_en:"The TXV valve regulates refrigerant flow based on:",o:["La presiÃ³n de descarga del compresor","La temperatura y presiÃ³n del evaporador (superheat)","La temperatura ambiente exterior","El voltaje del sistema"],o_en:["System pressure only","The superheat at the evaporator outlet","Ambient temperature","Condenser temperature"],c:1,e:"La TXV sensa el superheat para modular cuÃ¡nto refrigerante entra al evaporador.",e_en:"The TXV senses superheat through its bulb and adjusts flow to maintain proper evaporator feeding.",a:"La TXV es como la llave del agua: si el evaporador necesita mÃ¡s refrigerante (superheat alto), abre mÃ¡s. Si tiene mucho (superheat bajo), cierra. Es automÃ¡tica e inteligente.",a_en:"The TXV is like a smart faucet that adjusts water flow based on how hot the pipe is. If the pipe is too hot (high superheat), it opens more. If too cold (low superheat), it closes."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"Un filter drier saturado puede causar:",q_en:"A saturated filter drier can cause:",o:["Mayor eficiencia del sistema","Una restricciÃ³n que se ve como un evaporador parcialmente congelado","Mejor lubricaciÃ³n del compresor","Aumento de refrigerante"],o_en:["The system to cool better","A restriction that lowers suction pressure and starves the evaporator","The compressor to run faster","Higher superheat at the condenser"],c:1,e:"Un filter drier tapado restringe el flujo, causando caÃ­da de presiÃ³n y congelamiento parcial.",e_en:"A clogged filter drier restricts refrigerant flow, lowering suction pressure and starving the evaporator.",a:"Es como un filtro de cafÃ© tapado: si estÃ¡ sucio, el cafÃ© pasa poquito. Si el drier estÃ¡ saturado, el refrigerante no pasa bien y el evaporador se congela de un solo lado.",a_en:"It's like a clogged fuel filter in a car: gas can't get through, the engine starves, and the car loses power. The filter drier does the same to the refrigeration system."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"Para comprar y manejar refrigerantes en USA necesitas certificaciÃ³n:",q_en:"To buy and handle refrigerants in the USA you need EPA certification:",o:["NATE tipo I","OSHA 30 horas","EPA 608","HVAC Excellence"],o_en:["Not required â€” anyone can buy them","Section 608 for stationary and 609 for automotive","Only a state license","Only for R-22 and older refrigerants"],c:2,e:"La certificaciÃ³n EPA 608 es OBLIGATORIA por ley federal. Sin ella, no puedes comprar refrigerante.",e_en:"EPA Section 608 for stationary HVAC/R and Section 609 for automotive AC. Required to buy refrigerant over 20 lbs.",a:"EPA 608 es tu licencia de manejar del HVAC. Sin ella no compras refrigerante, no trabajas legalmente. Es como manejar sin licencia: te pueden multar miles de dÃ³lares.",a_en:"Without your EPA card, you can't buy refrigerant tanks at the supply house. It's like trying to buy beer without ID â€” the law requires certification. 608 for buildings, 609 for cars."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"El subcooling se mide en:",q_en:"Subcooling is measured at:",o:["La lÃ­nea de succiÃ³n, restando temperaturas","La lÃ­nea de lÃ­quido, restando la temp real de la temp de saturaciÃ³n a presiÃ³n de descarga","El evaporador, midiendo la temperatura del aire","El compresor, midiendo su amperaje"],o_en:["The suction line leaving the evaporator","The liquid line leaving the condenser","The discharge line of the compressor","The inlet of the TXV"],c:1,e:"Subcooling = Temp de saturaciÃ³n a presiÃ³n de alta - Temp real de la lÃ­nea de lÃ­quido.",e_en:"Subcooling is measured at the liquid line leaving the condenser. It confirms the refrigerant is 100% liquid.",a:"Si el superheat es la fiebre del gas, el subcooling es lo frÃ­o del lÃ­quido. Mides cuÃ¡nto mÃ¡s frÃ­o estÃ¡ el lÃ­quido comparado con su punto de condensaciÃ³n. Normal es 10-15Â°F.",a_en:"Subcooling tells you the condenser is doing its job: turning all the gas into liquid and then cooling it a bit more. You measure it at the liquid line coming out of the condenser."},
{cat:"ðŸ§Š RefrigeraciÃ³n BÃ¡sica",cat_en:"ðŸ§Š Basic Refrigeration",q:"El subcooling se mide en:",q_en:"Subcooling is measured at:",o:["La lÃ­nea de succiÃ³n, restando temperaturas","La lÃ­nea de lÃ­quido, restando la temp real de la temp de saturaciÃ³n a presiÃ³n de descarga","El evaporador, midiendo la temperatura del aire","El compresor, midiendo su amperaje"],o_en:["The suction line leaving the evaporator","The liquid line leaving the condenser","The discharge line of the compressor","The inlet of the TXV"],c:1,e:"Subcooling = Temp de saturaciÃ³n a presiÃ³n de alta - Temp real de la lÃ­nea de lÃ­quido.",e_en:"Subcooling is measured at the liquid line leaving the condenser. It confirms the refrigerant is 100% liquid.",a:"Si el superheat es la fiebre del gas, el subcooling es lo frÃ­o del lÃ­quido. Mides cuÃ¡nto mÃ¡s frÃ­o estÃ¡ el lÃ­quido comparado con su punto de condensaciÃ³n. Normal es 10-15Â°F.",a_en:"Subcooling tells you the condenser is doing its job: turning all the gas into liquid and then cooling it a bit more. You measure it at the liquid line coming out of the condenser."},
// HERRAMIENTAS Y SEGURIDAD (12)
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"PPE en HVAC incluye lentes de seguridad, guantes y zapatos. Â¿CuÃ¡ndo es aceptable NO usar PPE?",q_en:"PPE in HVAC includes safety glasses, gloves and boots. What else is ESSENTIAL when brazing?",o:["Cuando el trabajo es rÃ¡pido y sencillo","Cuando hace mucho calor","Nunca â€” PPE es obligatorio en TODO momento","Cuando el supervisor no estÃ¡ viendo"],o_en:["Knee pads","A fire extinguisher nearby","Sunglasses to see better","Comfortable sneakers"],c:2,e:"PPE es obligatorio SIEMPRE. No hay excusa. Un accidente toma solo un segundo.",e_en:"A fire extinguisher within reach when brazing is essential. Copper + flux + open flame = fire risk.",a:"Los accidentes no avisan. No dicen: oye, ponte los lentes que te va a saltar algo. Pasan en un parpadeo. PPE siempre, sin excepciÃ³n, aunque sea un trabajo de 5 minutos.",a_en:"You're using a torch that hits 1500Â°F near insulation and wood. A fire extinguisher is like a seatbelt: you hope you don't need it, but when you do, it saves your life."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Hiciste Lockout/Tagout en el panel. Antes de tocar los cables, debes:",q_en:"You did Lockout/Tagout on the panel. Before touching the wires, you MUST:",o:["Empezar a trabajar, ya desconectaste","Verificar ausencia de voltaje con tu multÃ­metro","Preguntarle al cliente si ya apagÃ³ todo","Revisar visualmente que no hay chispas"],o_en:["You can touch them â€” they're already locked out","Verify absence of voltage with YOUR OWN multimeter","Ask your coworker if the breaker is off","Check visually that the breaker is in the off position"],c:1,e:"SIEMPRE verifica con tu multÃ­metro despuÃ©s de LOTO. Puede haber fuentes de energÃ­a mÃºltiples.",e_en:"ALWAYS verify zero voltage with your own meter after LOTO. Breakers can fail, someone could turn it back on, or it could be the wrong breaker.",a:"Lockout es como ponerle seguro a una pistola. Pero un profesional SIEMPRE verifica que la cÃ¡mara estÃ¡ vacÃ­a. Desconectar y NO verificar es como jugar ruleta rusa.",a_en:"Trust but verify. A breaker can be off and still have voltage if someone wired it wrong. YOUR meter is the last line of defense. If you don't measure, you're gambling with your life."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Tu detector de fugas electrÃ³nico no encuentra la fuga pero sospechas que existe. Â¿QuÃ© otro mÃ©todo usas?",q_en:"Your electronic leak detector can't find the leak but you suspect there is one. The next step is:",o:["Agregar mÃ¡s refrigerante y ver si se mantiene","Presurizar con nitrÃ³geno y usar agua jabonosa","Presurizar con oxÃ­geno para mejor detecciÃ³n","Usar una vela para ver si la llama se mueve"],o_en:["Add more refrigerant and watch if pressures drop","Use soapy water or UV dye as a second detection method","Ignore it if the electronic detector says no leak","Replace the entire condenser coil"],c:1,e:"NitrÃ³geno + agua jabonosa es el mÃ©todo secundario mÃ¡s confiable para encontrar fugas.",e_en:"Multiple methods: soap bubbles, UV dye, nitrogen standing test. Don't rely on just one method.",a:"Las burbujas no mienten. Presuriza con nitrÃ³geno y ponte agua jabonosa en las conexiones. Donde haga burbujas, ahÃ­ estÃ¡ la fuga. Nunca uses oxÃ­geno: puede explotar con aceite.",a_en:"It's like when you smell gas in the kitchen but the detector doesn't beep. You don't ignore it â€” you use soap bubbles on the connections. Multiple detection methods catch what one alone misses."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"DespuÃ©s de hacer vacÃ­o, tu micron gauge marca 500 micrones. Cierras la vÃ¡lvula y esperas 10 minutos. Sube a 1500. Esto indica:",q_en:"After pulling vacuum, your micron gauge reads 500 microns. What do you do next?",o:["VacÃ­o exitoso, puedes cargar","Hay humedad en el sistema que se evapora","Hay una fuga en el sistema","Puede ser fuga O humedad, necesitas mÃ¡s pruebas"],o_en:["Charge immediately â€” 500 is good enough","Close the valve and watch if it holds for 10 minutes","Pull deeper vacuum to 100 microns","Call the customer to approve the charge"],c:3,e:"Un rise de 500 a 1500 puede ser humedad o fuga. Necesitas mÃ¡s tiempo o pruebas adicionales.",e_en:"500 microns is the target, but you must verify it HOLDS. If it rises, there's still moisture or a leak.",a:"Es como inflar una llanta y ver si baja: si baja rÃ¡pido = fuga. Si baja poquito = puede ser la temperatura. A 1500 micrones despuÃ©s de 10 min, no sabes seguro. Haz mÃ¡s vacÃ­o y espera mÃ¡s.",a_en:"Getting to 500 microns is like reaching the top of a mountain â€” but you need to STAY there. If the number rises, moisture is still boiling off or you have a leak. Close and watch."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Al soldar tuberÃ­a de cobre con un tanque de refrigerante conectado, debes:",q_en:"When brazing copper pipe with a refrigerant tank connected to the system, you MUST:",o:["No hay problema, el refrigerante no es inflamable","Fluir nitrÃ³geno por la tuberÃ­a mientras sueldas","Solo alejar el tanque un poco","Usar el tanque como soporte ya que es pesado"],o_en:["It's fine â€” the tank handles the heat","DISCONNECT the tank first â€” heat can increase pressure and cause an explosion","Cover the tank with a wet rag","Point the flame away from the tank"],c:1,e:"SIEMPRE fluye nitrÃ³geno al soldar. Previene oxidaciÃ³n interna y es un requisito de seguridad.",e_en:"Heat travels through copper and can overheat the tank, causing dangerous pressure increase or explosion.",a:"Al soldar sin nitrÃ³geno, el interior del cobre se oxida y esos pedacitos sueltos van a tapar la TXV o el drier. El nitrÃ³geno es como poner un escudo invisible dentro del tubo.",a_en:"Copper conducts heat like crazy. The torch heat travels through the pipe to the tank like a hot poker. Disconnect the tank or you'll have a bomb in your hands."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Â¿QuÃ© haces si hueles refrigerante fuerte en un cuarto mecÃ¡nico cerrado?",q_en:"What do you do if you smell strong refrigerant in a mechanical room?",o:["Es normal, los cuartos mecÃ¡nicos huelen asÃ­","Abrir ventilaciÃ³n y salir si es necesario, puede desplazar oxÃ­geno","Ignorarlo si no te mareas","Prender un ventilador elÃ©ctrico dentro del cuarto"],o_en:["Grab your leak detector and start searching","Exit the room immediately, ventilate, then return with PPE","It's normal â€” mechanical rooms always smell like refrigerant","Open the panels to find the leak faster"],c:1,e:"Los refrigerantes desplazan oxÃ­geno en espacios cerrados. La asfixia puede ocurrir sin que te des cuenta.",e_en:"Strong refrigerant smell = possible large leak = oxygen displacement risk. Exit, ventilate, then investigate safely.",a:"Los refrigerantes son invisibles y sin olor fuerte. Si ya hueles algo, hay MUCHO gas. Es como el monÃ³xido de carbono: no lo ves pero te mata. Ventila y sal primero, investiga despuÃ©s.",a_en:"Your nose detected what could kill you. Refrigerant displaces oxygen at floor level. Get out first, let the room air out, THEN go back with protection. Your nose saved your life â€” listen to it."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Aprietas una conexiÃ³n flare con torque wrench. Â¿Por quÃ© no debes apretarla mÃ¡s de lo especificado?",q_en:"You tighten a flare connection with a torque wrench. Why shouldn't you overtighten it?",o:["Gasta mÃ¡s tiempo","Puedes rajar el flare y crear una fuga","No pasa nada, mÃ¡s apretado es mejor","Solo importa con tuberÃ­a de aluminio"],o_en:["It wastes time","Overtightening cracks the flare and creates a WORSE leak than undertightening","It's actually better to overtighten","It only damages the wrench"],c:1,e:"Apretar de mÃ¡s raja el cobre y crea fugas que no verÃ¡s hasta que el sistema estÃ© cargado.",e_en:"Overtightening cracks the copper flare, creating a leak that's hard to find. Torque specs exist for a reason.",a:"Es como apretar la tapa de un frasco de vidrio: si le pasas, la quiebras. El cobre es suave, si aprietas de mÃ¡s se raja y boom, tienes una fuga que te va a dar dolores de cabeza.",a_en:"It's like overtightening a jar lid â€” you strip the threads and it seals WORSE. Copper is soft, if you overtighten the flare it cracks and now you have a permanent leak point."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Tu multÃ­metro marca voltaje inconsistente que sube y baja. Â¿QuÃ© puede estar pasando?",q_en:"Your multimeter shows inconsistent voltage readings that go up and down. What should you check?",o:["Voltaje normal de AC","ConexiÃ³n suelta o puntas de prueba daÃ±adas","El equipo estÃ¡ modulando normalmente","El multÃ­metro es demasiado preciso"],o_en:["The equipment â€” it has a voltage problem","Your multimeter leads and connections â€” bad leads give bad readings","The power company for voltage problems","Nothing â€” all multimeters do this"],c:1,e:"Lecturas inestables casi siempre indican una conexiÃ³n suelta, ya sea en el circuito o en tus puntas.",e_en:"Jumping readings are almost always bad leads, loose probes, or corroded connectors on the meter.",a:"Si el radio suena entrecortado, lo mÃ¡s probable es que la antena estÃ¡ floja. Igual con el multÃ­metro: lecturas locas = conexiÃ³n floja. Revisa tus puntas primero.",a_en:"Garbage in, garbage out. If your stethoscope is broken, you'll hear wrong. Check your leads and connections first. A $200 meter with $2 leads gives $2 readings."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"OSHA puede multar a un tÃ©cnico individual que no use PPE hasta:",q_en:"OSHA can fine an individual technician who doesn't wear PPE up to:",o:["No pueden multar al trabajador, solo a la empresa","$1,000 por la primera vez","Hasta $15,625 por violaciÃ³n seria","Solo dan advertencia verbal"],o_en:["$100 â€” it's a warning","Up to $15,625 per violation","$1,000 maximum","OSHA only fines companies, not individuals"],c:2,e:"OSHA puede multar tanto a la empresa como al individuo. Las multas serias llegan hasta $15,625.",e_en:"OSHA can fine individuals and companies. Per-violation fines can be substantial and willful violations cost even more.",a:"No es juego. OSHA tiene poder de ley. Una multa de $15,000 es mÃ¡s que tu sueldo de un mes. Y si alguien se lastima, pueden ser cargos criminales. PPE siempre.",a_en:"OSHA doesn't play around. A fine of $15K+ hurts your wallet more than any PPE costs. Safety glasses are $5, a fine is $15,000. Do the math."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Necesitas presurizar un sistema para buscar fugas. Â¿QuÃ© gas usas?",q_en:"You need to pressurize a system to search for leaks. What gas do you use?",o:["Refrigerante R-22 porque es barato","OxÃ­geno porque es fÃ¡cil de conseguir","NitrÃ³geno seco","Aire comprimido de la van"],o_en:["Compressed air â€” it's free and available","Dry nitrogen (OFN) with a regulator","Oxygen â€” it's under high pressure","The same refrigerant the system uses"],c:2,e:"NitrÃ³geno seco es el ÃšNICO gas aceptable para presurizar. OxÃ­geno explota con aceite.",e_en:"Dry nitrogen (Oxygen Free Nitrogen) with a pressure regulator. Never oxygen (explosive with oil) or air (contains moisture).",a:"OxÃ­geno + aceite = bomba. Aire comprimido tiene humedad. Refrigerante contamina. NitrÃ³geno es inerte, seco y seguro. Es el ÃšNICO que debes usar.",a_en:"Nitrogen is cheap, dry, and inert. Air has moisture that contaminates the system. Oxygen with oil = bomb. Refrigerant is expensive to waste on leak testing. Nitrogen wins on every count."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Un capacitor que mediste se ve hinchado en la parte superior. Tu acciÃ³n:",q_en:"A capacitor you measured looks swollen on top. This means:",o:["Medir microfaradios para ver si estÃ¡ bien","Reemplazarlo inmediatamente, un cap hinchado es defectuoso","Dejarlo si aÃºn funciona","Descargarlo y volver a instalarlo"],o_en:["It's full of charge â€” that's normal","It's damaged and must be replaced immediately â€” it can explode","It just needs to be discharged and it'll flatten out","Only the plastic is affected, the inside is fine"],c:1,e:"Un capacitor hinchado es defectuoso aunque todavÃ­a mida bien. Reemplaza siempre.",e_en:"A swollen capacitor has internal failure and gas buildup. It can explode. Replace immediately and never install a swollen one.",a:"Un capacitor hinchado es como una llanta ponchada: aunque todavÃ­a ruede, estÃ¡ a punto de reventar. CÃ¡mbialo ahora antes de que daÃ±e el motor o el compresor.",a_en:"A swollen capacitor is like a bloated can of food â€” something went bad inside and gas is building up. Don't touch it carelessly, discharge it safely and replace it. It can literally pop."},
{cat:"ðŸ›¡ï¸ Herramientas y Seguridad",cat_en:"ðŸ›¡ï¸ Tools and Safety",q:"Tu bomba de vacÃ­o logra 200 micrones pero al cerrar la vÃ¡lvula sube a 800 en 5 minutos y se detiene. Esto indica:",q_en:"Your vacuum pump reaches 200 microns but when you close the valve, it rises to 2000 microns. What does this indicate?",o:["Fuga grande en el sistema","Humedad residual que se estÃ¡ evaporando","La bomba estÃ¡ daÃ±ada","El sistema estÃ¡ listo para cargar"],o_en:["The pump is bad â€” it can't hold vacuum","There's a leak in the system or moisture is still evaporating","200 microns is already perfect, the rise doesn't matter","The micron gauge is defective"],c:1,e:"Si sube y se detiene (no sigue subiendo), generalmente es humedad evaporÃ¡ndose, no una fuga.",e_en:"Rising vacuum = leak or moisture. If it rises fast = leak. If it rises slowly = moisture still evaporating. Either way, don't charge yet.",a:"Una fuga es como un globo con hueco: la presiÃ³n sube y sube sin parar. La humedad es como un charquito que se seca: sube un poco y se estabiliza. Si se detiene, es humedad. Si sigue subiendo, es fuga.",a_en:"Fast rise = leak somewhere. Slow rise = moisture still boiling off inside the system. Either way, DON'T charge yet. Fix the leak or keep pulling vacuum until it holds steady."},
// AIRE ACONDICIONADO BÃSICO (12)
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"Un mini split es diferente de un split convencional porque:",q_en:"A mini split differs from a conventional split because:",o:["Usa menos refrigerante","No necesita ductos","EnfrÃ­a mÃ¡s eficientemente","Trabaja solo con 110V"],o_en:["The mini split is always less powerful","The mini split doesn't use a duct system â€” it delivers air directly","The mini split uses different refrigerant","The mini split only cools, it can't heat"],c:1,e:"La principal diferencia del mini split es que no requiere ductos. Cada unidad interior enfrÃ­a su zona.",e_en:"Mini splits are ductless â€” the indoor unit blows conditioned air directly into the room without ducts.",a:"Un split convencional es como un sistema de riego con mangueras (ductos) que van a cada cuarto. El mini split es como tener una regadera individual en cada cuarto, sin mangueras. MÃ¡s fÃ¡cil de instalar.",a_en:"A conventional split is like a central water system with pipes to every room. A mini split is like putting a water cooler in each room â€” no pipes needed. That's why they're called ductless."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"Un equipo con SEER de 20 comparado con uno de SEER 14:",q_en:"A unit with SEER 20 compared to SEER 14:",o:["EnfrÃ­a mÃ¡s rÃ¡pido","EnfrÃ­a a menor temperatura","Usa menos electricidad para dar el mismo enfriamiento","Necesita menos refrigerante"],o_en:["Cools faster","Cools to a lower temperature","Uses less electricity for the same cooling","Needs less refrigerant"],c:2,e:"SEER mÃ¡s alto = misma capacidad pero menos consumo elÃ©ctrico. No enfrÃ­a mÃ¡s ni menos.",e_en:"Higher SEER = same capacity but less electrical consumption. It doesn't cool more or less.",a:"Es como comparar un carro que da 30 millas por galÃ³n con uno de 20. Los dos te llevan al mismo lugar, pero el de 30 gasta menos gasolina. SEER alto = menos factura de luz.",a_en:"It's like comparing a car that gets 30 miles per gallon with one that gets 20. Both take you to the same place, but the 30 MPG one uses less gas. Higher SEER = lower electric bill."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"Tu cliente tiene una casa de 2,000 sq ft. SegÃºn regla general, Â¿cuÃ¡ntas toneladas de AC necesita?",q_en:"Your customer has a 2,000 sq ft home. The general rule of thumb for tonnage sizing is:",o:["2 toneladas","3 a 4 toneladas dependiendo de factores","Siempre 5 toneladas para que sobre","1 tonelada es suficiente"],o_en:["1 ton â€” one ton is enough for any house","3-4 tons â€” approximately 500 sq ft per ton","10 tons â€” better to oversize","Half ton â€” save on energy costs"],c:1,e:"Regla general: 400-500 sq ft por tonelada, pero aislamiento, ventanas y clima afectan el cÃ¡lculo.",e_en:"General rule: about 400-500 sq ft per ton. So 2,000 sq ft â‰ˆ 4-5 tons. But always do a Manual J load calculation.",a:"La regla del pulgar es 1 tonelada por cada 400-500 pies cuadrados. Pero es como la ropa: no es solo la talla, importa si hace calor, si la casa tiene buen aislamiento, cuÃ¡ntas ventanas. Siempre haz Manual J.",a_en:"500 sq ft per ton is the quick napkin calculation. 2,000 Ã· 500 = 4 tons. BUT the real answer is ALWAYS do a Manual J â€” windows, insulation, climate all change the number."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"El filtro de aire debe cambiarse cada:",q_en:"The air filter should be changed every:",o:["6 meses a 1 aÃ±o","1-3 meses dependiendo del tipo y uso","Solo cuando el equipo no enfrÃ­a","Cada 5 aÃ±os con el mantenimiento"],o_en:["Once a year is enough","30-90 days depending on type and environment","Only when the AC stops cooling","Every day for maximum efficiency"],c:1,e:"Filtros estÃ¡ndar de 1 pulgada: cada 1-3 meses. Filtros de 4 pulgadas: cada 6-12 meses.",e_en:"Standard 1\" filters: every 30-90 days. High-efficiency HEPA: 6-12 months. Depends on dust, pets, and usage.",a:"El filtro es como el cubrebocas del sistema. Si no lo cambias, se tapa y el equipo no puede respirar. Un filtro sucio es la causa #1 de llamadas de servicio innecesarias.",a_en:"A dirty filter is like trying to breathe through a pillow. Change cheap filters every month, medium quality every 3 months. If you have pets or allergies, closer to monthly."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"El evaporador estÃ¡ congelado. Tu PRIMER paso es:",q_en:"The evaporator is frozen. Your FIRST step is:",o:["Agregar mÃ¡s refrigerante inmediatamente","Apagar el equipo y dejar que se descongele antes de diagnosticar","Raspar el hielo con un destornillador","Subir el termostato a calefacciÃ³n"],o_en:["Add more refrigerant immediately","Turn off cooling and run the fan to thaw the ice","Chip the ice off with a screwdriver","Turn the thermostat to the coldest setting"],c:1,e:"Primero deja que se descongele completamente. No puedes diagnosticar con hielo encima.",e_en:"First: stop cooling and run fan only to thaw. Once thawed, THEN diagnose the cause â€” low charge, airflow issue, or dirty filter.",a:"Es como cuando se te empaÃ±a el parabrisas: primero limpia para poder ver, luego maneja. No diagnostiques con hielo â€” no puedes ver presiones reales ni medir flujo de aire correcto.",a_en:"You can't diagnose a frozen evaporator â€” it's like trying to examine a patient covered in ice. Thaw it first (fan only mode), THEN figure out why it froze: dirty filter? Low charge? Bad blower?"},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"El condensador estÃ¡ en el sol directo y obstruido con plantas. Las presiones de alta van a estar:",q_en:"The condenser is in direct sun and obstructed with plants. High side pressures will be:",o:["MÃ¡s bajas de lo normal","MÃ¡s altas de lo normal","Igual que siempre","Intermitentes"],o_en:["Lower than normal","Higher than normal","Same as always","Intermittent"],c:1,e:"Condensador obstruido = no puede liberar calor = presiÃ³n de alta se eleva.",e_en:"Obstructed condenser = can't release heat = high side pressure rises.",a:"Es como taparte la boca mientras exhalas: la presiÃ³n sube porque el aire no puede salir. El condensador necesita exhalar el calor. Si estÃ¡ tapado con plantas o basura, la presiÃ³n sube.",a_en:"It's like covering your mouth while exhaling: pressure builds because air can't escape. The condenser needs to exhale the heat. If it's blocked with plants or debris, pressure rises."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"El mantenimiento preventivo de AC se recomienda:",q_en:"AC preventive maintenance is recommended:",o:["Solo cuando algo falla","Una vez al aÃ±o en primavera","Dos veces al aÃ±o: primavera para AC y otoÃ±o para calefacciÃ³n","Cada mes sin excepciÃ³n"],o_en:["Only when something breaks","Once a year in spring","Twice a year: spring for AC and fall for heating","Every month without exception"],c:2,e:"Dos visitas anuales: antes del verano para AC y antes del invierno para calefacciÃ³n.",e_en:"Two annual visits: before summer for AC and before winter for heating.",a:"Es como el dentista: vas dos veces al aÃ±o aunque no te duela nada. Si esperas a que duela, el tratamiento es caro. Mantenimiento preventivo ahorra dinero y extiende la vida del equipo.",a_en:"It's like the dentist: you go twice a year even if nothing hurts. If you wait until it hurts, the treatment is expensive. Preventive maintenance saves money and extends equipment life."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"El return air en una casa estÃ¡ ubicado tÃ­picamente:",q_en:"Return air in a home is typically located:",o:["En el techo cerca del AC","En una pared interior, generalmente bajo o central","Afuera de la casa","En el baÃ±o siempre"],o_en:["On the ceiling near the AC","On an interior wall, usually low or centrally placed","Outside the house","Always in the bathroom"],c:1,e:"Los returns estÃ¡n en paredes interiores, centrales, para recircular el aire de la casa.",e_en:"Returns are on interior walls, centrally located, to recirculate the house air.",a:"El return es la boca del sistema que traga el aire de la casa para reciclarlo. Generalmente estÃ¡ abajo en la pared de un pasillo. Si lo tapas con un mueble, el sistema se ahoga.",a_en:"The return is the system's mouth that swallows the house air to recycle it. It's usually low on a hallway wall. If you block it with furniture, the system suffocates."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"El termostato llama por cooling pero el equipo no enciende. Mides 24V entre R y Y en el termostato. Esto indica:",q_en:"The thermostat calls for cooling but the unit doesn't turn on. You measure 24V between R and Y at the thermostat. This indicates:",o:["El termostato estÃ¡ malo","La seÃ±al sale bien del termostato, el problema estÃ¡ despuÃ©s","No hay voltaje suficiente","El compresor estÃ¡ en delay"],o_en:["The thermostat is bad","The signal is leaving the thermostat correctly, the problem is downstream","There's not enough voltage","The compressor is in delay"],c:1,e:"24V entre R y Y = el termostato estÃ¡ mandando la seÃ±al correctamente. El problema estÃ¡ en otro lado.",e_en:"24V between R and Y = the thermostat is sending the correct signal. The problem is somewhere else.",a:"Es como cuando mandas un mensaje de texto y te dice enviado: tu telÃ©fono hizo su trabajo. Si la otra persona no responde, el problema no es tu telÃ©fono. 24V en el termostato = Ã©l estÃ¡ haciendo su trabajo.",a_en:"It's like when you send a text message and it says delivered: your phone did its job. If the other person doesn't respond, the problem isn't your phone. 24V at the thermostat = it's doing its job."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"Un condensador sucio puede causar TODO lo siguiente EXCEPTO:",q_en:"A dirty condenser can cause ALL of the following EXCEPT:",o:["Presiones de descarga altas","Mayor consumo de energÃ­a","Menor superheat en el evaporador","Posible daÃ±o al compresor"],o_en:["High discharge pressures","Higher energy consumption","Lower evaporator superheat","Possible compressor damage"],c:2,e:"Condensador sucio causa presiones altas, mÃ¡s consumo y posible daÃ±o. El superheat tiende a SUBIR, no bajar.",e_en:"Dirty condenser causes high pressures, more consumption and possible damage. Superheat tends to RISE, not drop.",a:"Condensador sucio es como una persona acalorada que no puede sudar: la temperatura sube, gasta mÃ¡s energÃ­a, y eventualmente colapsa. Pero el superheat no baja, sube porque el sistema pierde eficiencia.",a_en:"A dirty condenser is like an overheated person who can't sweat: temperature rises, more energy is spent, and eventually they collapse. But superheat doesn't drop, it rises because the system loses efficiency."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"BTU significa British Thermal Unit. Un BTU es la energÃ­a necesaria para:",q_en:"BTU stands for British Thermal Unit. One BTU is the energy needed to:",o:["Enfriar 1 libra de aire en 1Â°F","Subir 1 libra de agua en 1Â°F","Derretir 1 libra de hielo","Evaporar 1 libra de refrigerante"],o_en:["Cool 1 pound of air by 1Â°F","Raise 1 pound of water by 1Â°F","Melt 1 pound of ice","Evaporate 1 pound of refrigerant"],c:1,e:"1 BTU = energÃ­a para subir 1Â°F a 1 libra de agua. Es la unidad base de calor en HVAC.",e_en:"1 BTU = the energy to raise 1 pound of water by 1Â°F. It's the base unit of heat in HVAC.",a:"Imagina una libra de agua (como una botellita). Un BTU es lo que necesitas para calentarla UN gradito. 12,000 BTU (1 tonelada) = calentar 12,000 botellitas un grado cada hora.",a_en:"Imagine a pound of water (like a small bottle). One BTU is what you need to heat it ONE little degree. 12,000 BTU (1 ton) = heating 12,000 little bottles one degree every hour."},
{cat:"â„ï¸ Aire Acondicionado BÃ¡sico",cat_en:"â„ï¸ Basic Air Conditioning",q:"Mides la temperatura del supply a 58Â°F y el return a 75Â°F. El delta T es:",q_en:"You measure supply temperature at 58Â°F and return at 75Â°F. The delta T is:",o:["133Â°F","58Â°F","17Â°F â€” estÃ¡ en rango normal","75Â°F"],o_en:["133Â°F","58Â°F","17Â°F â€” it's in normal range","75Â°F"],c:2,e:"Delta T = Return - Supply = 75 - 58 = 17Â°F. Normal es 15-20Â°F.",e_en:"Delta T = Return - Supply = 75 - 58 = 17Â°F. Normal is 15-20Â°F.",a:"Delta T es la diferencia entre lo que entra y lo que sale. Como medir cuÃ¡nto bajÃ³ la temperatura del agua despuÃ©s de ponerle hielo. 17Â°F de diferencia = tu equipo estÃ¡ trabajando bien.",a_en:"Delta T is the difference between what goes in and what comes out. Like measuring how much the water temperature dropped after adding ice. 17Â°F difference = your equipment is working well."}
];

const QUIZ_ELECTRICIDAD=[
// ===== SEGURIDAD (10) =====
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"SegÃºn OSHA, el voltaje mÃ­nimo que se considera PELIGROSO para el cuerpo humano es:",q_en:"According to OSHA, the minimum voltage considered DANGEROUS to the human body is:",o:["120V â€” por eso las casas son peligrosas","50V â€” la piel mojada baja la resistencia","220V â€” solo el alto voltaje mata","12V â€” cualquier voltaje es mortal"],o_en:["120V â€” that's why houses are dangerous","50V â€” wet skin lowers resistance","220V â€” only high voltage kills","12V â€” any voltage is deadly"],c:1,e:"OSHA considera 50V como umbral peligroso. Con piel mojada, incluso menos puede ser letal.",e_en:"OSHA considers 50V as the danger threshold. With wet skin, even less can be lethal.",a:"Tu cuerpo es como una esponja: seco resiste mÃ¡s, mojado conduce fÃ¡cil. Por eso 50V con manos sudadas puede matarte, y 12V en la tina de baÃ±o tambiÃ©n.",a_en:"Your body is like a sponge: dry it resists more, wet it conducts easily. That's why 50V with sweaty hands can kill you, and 12V in the bathtub can too."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"Antes de trabajar en un circuito energizado, la PRIMERA acciÃ³n segÃºn NFPA 70E es:",q_en:"Before working on an energized circuit, the FIRST action according to NFPA 70E is:",o:["Ponerte guantes dielÃ©ctricos","Verificar con el multÃ­metro que hay voltaje","Intentar des-energizar el circuito","Avisar a tu compaÃ±ero que vas a trabajar"],o_en:["Put on dielectric gloves","Verify with your multimeter that there's voltage","Attempt to de-energize the circuit","Tell your coworker you're going to work on it"],c:2,e:"NFPA 70E requiere PRIMERO intentar des-energizar. Solo si es imposible se trabaja energizado con PPE.",e_en:"NFPA 70E requires FIRST attempting to de-energize. Only if impossible do you work energized with PPE.",a:"Es como cruzar la calle: primero intentas usar el semÃ¡foro. Solo si no hay semÃ¡foro cruzas con precauciÃ³n. Nunca te avientas directo al trÃ¡fico.",a_en:"It's like crossing the street: first you try to use the traffic light. Only if there's no light do you cross carefully. Never jump right into traffic."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"El procedimiento de Lockout/Tagout requiere que despuÃ©s de bloquear el breaker, el tÃ©cnico debe:",q_en:"The Lockout/Tagout procedure requires that after locking out the breaker, the technician must:",o:["Poner el candado y empezar a trabajar","Poner el candado, verificar ausencia de voltaje, y luego trabajar","Poner la etiqueta es suficiente sin candado","Solo apagar el breaker ya es suficiente"],o_en:["Put the lock and start working","Put the lock, verify absence of voltage, then work","Putting the tag is enough without a lock","Just turning off the breaker is sufficient"],c:1,e:"LOTO requiere: bloquear + candado + verificar con multÃ­metro que hay 0V. Las tres cosas.",e_en:"LOTO requires: lock + padlock + verify zero voltage with multimeter. All three steps.",a:"Es como descargar un arma: le quitas el cargador, la aseguras, Y verificas que la recÃ¡mara estÃ© vacÃ­a. No te confÃ­as solo con una cosa.",a_en:"It's like unloading a gun: you remove the magazine, put the safety on, AND verify the chamber is empty. You don't trust just one step."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"Un tÃ©cnico recibe una descarga de 120V y cae al piso. Â¿QuÃ© haces PRIMERO?",q_en:"A technician gets a 120V shock and falls to the floor. What do you do FIRST?",o:["Jalarle la mano para separarlo del circuito","Buscar el breaker y desconectar la corriente","Echarle agua para que reaccione","Gritarle que suelte el cable"],o_en:["Grab their hand to pull them away from the circuit","Find the breaker and disconnect the power","Throw water on them to revive them","Yell at them to let go of the wire"],c:1,e:"PRIMERO corta la energÃ­a. Si tocas a la vÃ­ctima mientras estÃ¡ energizada, tÃº tambiÃ©n recibes la descarga.",e_en:"FIRST cut the power. If you touch the victim while they're energized, you'll get shocked too.",a:"Si alguien se estÃ¡ ahogando en un rÃ­o con corriente, primero paras el agua, no te avientas tÃº tambiÃ©n. Corta la energÃ­a PRIMERO, luego ayudas.",a_en:"If someone is drowning in a river with current, you stop the water first, you don't jump in too. Cut the power FIRST, then help."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"El NEC ArtÃ­culo 110.26 requiere un espacio libre de trabajo frente a un panel elÃ©ctrico de al menos:",q_en:"NEC Article 110.26 requires a clear working space in front of an electrical panel of at least:",o:["24 pulgadas de ancho y 30 de profundo","30 pulgadas de ancho y 36 de profundo","36 pulgadas de ancho y 48 de profundo","El NEC no especifica distancias exactas"],o_en:["24 inches wide and 30 deep","30 inches wide and 36 deep","36 inches wide and 48 deep","The NEC doesn't specify exact distances"],c:1,e:"NEC 110.26 requiere mÃ­nimo 30\" de ancho y 36\" de profundidad frente a paneles elÃ©ctricos.",e_en:"NEC 110.26 requires minimum 30\" wide and 36\" deep in front of electrical panels.",a:"Imagina que necesitas salir corriendo del panel si hay un arco elÃ©ctrico. Necesitas espacio para moverte. 30 pulgadas de ancho y 3 pies de profundidad es lo mÃ­nimo.",a_en:"Imagine needing to run away from the panel if there's an arc flash. You need room to move. 30 inches wide and 3 feet deep is the minimum."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"Los guantes dielÃ©ctricos Clase 00 protegen hasta un mÃ¡ximo de:",q_en:"Class 00 dielectric gloves protect up to a maximum of:",o:["500V â€” solo para bajo voltaje","1000V â€” pero deben probarse cada 6 meses","5000V â€” son los mÃ¡s comunes en HVAC","120V â€” solo protegen de corriente residencial"],o_en:["500V â€” low voltage only","1000V â€” but must be tested every 6 months","5000V â€” most common in HVAC","120V â€” only protects from residential current"],c:0,e:"Clase 00 = mÃ¡ximo 500V AC. Para mÃ¡s voltaje necesitas Clase 0 (1000V) o superiores.",e_en:"Class 00 = maximum 500V AC. For higher voltage you need Class 0 (1000V) or higher.",a:"Los guantes son como cascos: un casco de bicicleta no te protege de un accidente de moto. Cada clase de guante tiene su lÃ­mite, y usar el incorrecto es tan peligroso como no usar ninguno.",a_en:"Gloves are like helmets: a bicycle helmet won't protect you in a motorcycle crash. Each glove class has its limit, and using the wrong one is as dangerous as wearing none."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"Â¿CuÃ¡l es la corriente mÃ­nima que puede causar fibrilaciÃ³n ventricular (paro cardÃ­aco)?",q_en:"What is the minimum current that can cause ventricular fibrillation (cardiac arrest)?",o:["1 amperio","100 miliamperios (0.1A)","10 amperios","500 miliamperios"],o_en:["1 ampere","100 milliamps (0.1A)","10 amperes","500 milliamps"],c:1,e:"100mA (0.1A) puede causar fibrilaciÃ³n ventricular y muerte. 10mA ya causa dolor muscular.",e_en:"100mA (0.1A) can cause ventricular fibrillation and death. 10mA already causes muscle pain.",a:"Un foco de 100W a 120V usa menos de 1 amperio. Tu corazÃ³n se para con solo 0.1A. Por eso la electricidad no se ve pero sÃ­ mata.",a_en:"A 100W light bulb at 120V uses less than 1 amp. Your heart stops with just 0.1A. That's why electricity can't be seen but it kills."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"EstÃ¡s trabajando en un techo metÃ¡lico bajo el sol. Tu riesgo de electrocuciÃ³n es MAYOR porque:",q_en:"You're working on a metal roof in the sun. Your electrocution risk is HIGHER because:",o:["El metal refleja la electricidad hacia ti","El metal caliente genera corriente estÃ¡tica","El sudor reduce la resistencia de tu piel dramÃ¡ticamente","La altura aumenta el voltaje"],o_en:["The metal reflects electricity toward you","Hot metal generates static current","Sweat dramatically reduces your skin resistance","Height increases voltage"],c:2,e:"El sudor reduce la resistencia de la piel de ~100kÎ© a menos de 1kÎ©, permitiendo mucha mÃ¡s corriente.",e_en:"Sweat reduces skin resistance from ~100kÎ© to less than 1kÎ©, allowing much more current to flow.",a:"Tu piel seca es como un guante de goma. Pero el sudor es como echarle agua al guante: ya no te protege. Por eso los accidentes elÃ©ctricos pasan mÃ¡s en verano.",a_en:"Your dry skin is like a rubber glove. But sweat is like pouring water on the glove: it no longer protects you. That's why electrical accidents happen more in summer."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"SegÃºn NEC 240.4(D), un conductor de cobre #14 AWG puede protegerse con un breaker mÃ¡ximo de:",q_en:"According to NEC 240.4(D), a #14 AWG copper conductor can be protected with a breaker of maximum:",o:["20 amperios â€” es el estÃ¡ndar residencial","15 amperios â€” es la protecciÃ³n mÃ¡xima permitida","30 amperios â€” el cobre aguanta mucho","25 amperios â€” con factor de seguridad incluido"],o_en:["20A â€” it handles the extra load","15A â€” per NEC code table","30A â€” copper handles heat well","10A â€” for extra safety"],c:1,e:"NEC 240.4(D): #14 AWG = 15A mÃ¡ximo. #12 AWG = 20A. #10 AWG = 30A.",e_en:"NEC 240.4(D): #14 AWG = 15A max, #12 AWG = 20A max, #10 AWG = 30A max.",a:"Es como un puente: cada puente tiene su lÃ­mite de peso. Si pasas un camiÃ³n de 20 toneladas por un puente de 15, se cae. El cable #14 solo aguanta 15A.",a_en:"It's like weight limits on shelves: each wire size has its max. #14 holds 15A, #12 holds 20A, #10 holds 30A. Go over the limit and things break â€” or catch fire."},
{cat:"ðŸ›¡ï¸ Seguridad ElÃ©ctrica",cat_en:"ðŸ›¡ï¸ Electrical Safety",q:"Un multÃ­metro categorÃ­a CAT III es apropiado para medir en:",q_en:"A CAT III rated multimeter is appropriate for measuring at:",o:["Solo tomacorrientes residenciales","Paneles de distribuciÃ³n y alimentadores","La acometida del transformador de la calle","Circuitos de bajo voltaje solamente"],o_en:["Low voltage batteries only","Distribution panels, motors, and fixed installations","High voltage transmission lines","Any location without limitation"],c:1,e:"CAT III = distribuciÃ³n fija (paneles, alimentadores). CAT IV = origen de servicio. CAT II = tomacorrientes.",e_en:"CAT III = distribution level: panels, motors, heavy equipment. CAT IV = utility entrance. CAT II = outlets.",a:"Las categorÃ­as son como las ligas de fÃºtbol: CAT II es la liguilla local, CAT III es primera divisiÃ³n, CAT IV es el mundial. Cada nivel tiene mÃ¡s energÃ­a y necesita equipo mÃ¡s fuerte.",a_en:"CAT ratings are like car crash ratings: higher CAT handles bigger surges. CAT III for panels, CAT IV at the meter. Using CAT II at a panel is like driving a golf cart on the highway."},
// ===== INSTRUMENTOS DE MEDICIÃ“N (8) =====
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Para medir amperaje en un circuito SIN interrumpirlo, usas:",q_en:"To measure amperage in a circuit WITHOUT breaking it, you use:",o:["Un multÃ­metro en serie con el circuito","Una pinza amperimÃ©trica alrededor del conductor","Un megÃ³hmetro de alta impedancia","Un osciloscopio conectado en paralelo"],o_en:["A standard multimeter in series","A clamp meter around the conductor","An ohmmeter across the load","A voltage tester between hot and neutral"],c:1,e:"La pinza amperimÃ©trica mide por inducciÃ³n electromagnÃ©tica sin abrir el circuito.",e_en:"A clamp meter measures current by detecting the magnetic field around the conductor â€” no need to disconnect anything.",a:"La pinza es como un radar de velocidad: mide sin tocar ni detener el trÃ¡fico. Abraza el cable y te da la lectura. Si pones el multÃ­metro en serie, tienes que cortar el cable como una caseta de peaje.",a_en:"A clamp meter is like measuring traffic by counting cars from a bridge â€” you don't have to stop traffic. It clamps around the wire and reads the current magnetically."},
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Al medir continuidad, el multÃ­metro debe estar configurado en:",q_en:"When measuring continuity, the multimeter must be set to:",o:["La escala de voltaje AC mÃ¡s alta por seguridad","La escala de ohmios/continuidad con el circuito DESENERGIZADO","La escala de amperios para detectar flujo","La escala de voltaje DC para circuitos apagados"],o_en:["AC volts â€” to check if current flows","The ohms/continuity setting with the circuit DE-ENERGIZED","DC amps to measure flow","Any setting works for continuity"],c:1,e:"Continuidad se mide en ohmios con circuito SIN energÃ­a. Medir continuidad con voltaje presente daÃ±a el metro.",e_en:"Continuity test = ohms/beep mode with circuit OFF. Measuring continuity on a live circuit damages the meter.",a:"Medir continuidad es como soplar por una manguera para ver si pasa aire â€” pero primero cierras la llave del agua. Si no la cierras, te llega un chorro a la cara. Sin desconectar, daÃ±as el metro.",a_en:"Continuity is like checking if a pipe is clear by blowing through it â€” you need the water OFF first. The meter sends a tiny signal to check the path. Live voltage will fry the meter."},
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Un megÃ³hmetro (Megger) se usa principalmente para:",q_en:"A megohmmeter (Megger) is primarily used to:",o:["Medir voltaje en alta tensiÃ³n","Medir la resistencia del aislamiento de cables y motores","Medir la corriente de fuga en circuitos","Calibrar otros instrumentos de mediciÃ³n"],o_en:["Measure very low resistance in conductors","Test insulation resistance of motors and cables","Measure voltage at the panel","Test capacitor microfarads"],c:1,e:"El megÃ³hmetro aplica alto voltaje DC para probar que el aislamiento no tenga fugas.",e_en:"A Megger applies high voltage (250-5000V) to test insulation integrity. Finds degraded insulation before it fails.",a:"El Megger es como una prueba de presiÃ³n de agua a una tuberÃ­a: le metes presiÃ³n alta para ver si hay fugas. Si el aislamiento estÃ¡ daÃ±ado, la corriente se escapa y el Megger lo detecta.",a_en:"A Megger is like a stress test for insulation: it pushes harder than normal to see if the insulation can handle it. Like testing a bridge with heavy trucks before opening it to traffic."},
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Tu multÃ­metro digital muestra \"OL\" al medir resistencia. Esto significa:",q_en:"Your digital multimeter shows \"OL\" when measuring resistance. This means:",o:["El componente tiene sobrecarga (overload)","El circuito estÃ¡ abierto â€” no hay continuidad","El multÃ­metro estÃ¡ daÃ±ado o necesita pilas","La resistencia es exactamente 0 ohms"],o_en:["Zero ohms â€” perfect continuity","Over Limit â€” open circuit or infinite resistance","Overload â€” too much resistance to display","The meter is broken"],c:1,e:"OL = Over Limit. Resistencia infinita = circuito abierto. No hay camino para la corriente.",e_en:"OL = Over Limit = open circuit. No path for current. Could be broken wire, blown fuse, or open component.",a:"OL es como un camino cortado: no hay paso. Si mides un cable roto, el metro dice OL porque los electrones no pueden pasar. Es un circuito abierto.",a_en:"OL means 'nothing's getting through' â€” like trying to call a disconnected phone number. The circuit is open somewhere and current can't flow."},
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Al medir voltaje AC en un circuito de 240V, tus puntas del multÃ­metro deben ir:",q_en:"When measuring AC voltage on a 240V circuit, your multimeter probes must go:",o:["Ambas en la lÃ­nea caliente (hot)","En paralelo: una en cada lÃ­nea caliente (L1 y L2)","En serie: cortando un cable e insertando el metro","Una en hot y otra en tierra para mayor seguridad"],o_en:["Both to the same hot line","One to each hot line (L1 and L2)","One to hot and one to ground only","One to neutral and one to ground"],c:1,e:"Para medir 240V, las puntas van en paralelo entre las dos lÃ­neas calientes L1 y L2.",e_en:"240V = measured between L1 and L2 (the two hot lines). Each hot to neutral gives 120V.",a:"Medir voltaje es como tomar la temperatura del agua: metes el termÃ³metro SIN cortar la tuberÃ­a. Las puntas tocan los dos puntos y el metro te dice la diferencia de presiÃ³n (voltaje) entre ellos.",a_en:"It's like measuring the full length of a table â€” you put the tape measure from one end to the other. L1 to L2 gives the full 240V. L1 to neutral is only half: 120V."},
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Una pinza amperimÃ©trica muestra lectura cuando abrazas DOS conductores juntos (hot + neutro). La lectura indica:",q_en:"A clamp meter shows a reading when you clamp BOTH conductors together (hot and neutral). This indicates:",o:["La corriente total del circuito","Cero amperios si el circuito estÃ¡ balanceado","El doble de la corriente real","La potencia en watts del circuito"],o_en:["Normal operation â€” that's how it works","Current leakage to ground â€” the currents should cancel to zero","The meter is miscalibrated","The circuit is overloaded"],c:1,e:"Hot y neutro llevan corriente igual y opuesta. Se cancelan. Si marca algo, hay fuga de corriente.",e_en:"Hot and neutral should carry equal and opposite currents that cancel. A reading means current is leaking to ground.",a:"Es como dos personas jalando una cuerda en direcciones opuestas con la misma fuerza: se anulan. Si la pinza marca algo, hay corriente que se estÃ¡ escapando por otro lado â€” posible fuga a tierra.",a_en:"Hot carries current TO the load, neutral carries it BACK. Clamping both should read ZERO because they cancel out. If you get a reading, current is escaping somewhere â€” ground fault!"},
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Para verificar que un capacitor estÃ¡ descargado antes de tocarlo, debes:",q_en:"To verify a capacitor is discharged before touching it, you must:",o:["Esperar 5 minutos despuÃ©s de apagar el equipo","Medir voltaje DC entre sus terminales","Cortocircuitar los terminales con un desarmador","Medir resistencia con el multÃ­metro"],o_en:["Visually inspect it â€” if it looks normal it's safe","Measure voltage across its terminals with your multimeter","Just wait 5 minutes â€” it discharges itself","Touch it quickly â€” short exposure is safe"],c:1,e:"SIEMPRE mide voltaje DC en las terminales. Un capacitor puede retener carga letal por horas.",e_en:"Always measure voltage across capacitor terminals before handling. Even disconnected, capacitors can hold lethal charge.",a:"Un capacitor es como un tanque de agua presurizado: aunque cierres la vÃ¡lvula, el tanque sigue lleno. Puede soltar toda esa energÃ­a en un instante si lo tocas. MIDE ANTES de tocar.",a_en:"A capacitor is like a loaded spring â€” it stores energy even when disconnected. You wouldn't grab a loaded mousetrap without checking. Measure voltage first, discharge safely if needed."},
{cat:"ðŸ”¬ Instrumentos de MediciÃ³n",cat_en:"ðŸ”¬ Measuring Instruments",q:"Al usar un multÃ­metro para medir amperaje en serie, si seleccionas la escala de VOLTAJE por error:",q_en:"When using a multimeter to measure amperage in series, if you select the wrong scale you can:",o:["El multÃ­metro mostrarÃ¡ voltaje en vez de amperaje","QuemarÃ¡s el fusible interno del multÃ­metro","CrearÃ¡s un cortocircuito potencialmente peligroso","El multÃ­metro se auto-protege y cambia de escala"],o_en:["Get a slightly inaccurate reading","Blow the internal fuse of the meter or damage it","Nothing happens â€” the meter auto-adjusts","Only lose the warranty"],c:2,e:"En modo voltaje, el multÃ­metro tiene alta impedancia. En serie para medir amperios necesitas baja impedancia. Error de selecciÃ³n puede crear cortocircuito.",e_en:"Measuring amps on the wrong scale (especially voltage scale) can blow the meter's internal fuse or damage it permanently.",a:"Es como conectar una manguera de agua al revÃ©s: la presiÃ³n va al lado equivocado y revienta algo. La escala incorrecta puede fundir el fusible del metro o peor.",a_en:"It's like putting diesel in a gasoline car â€” wrong input, serious damage. The meter's fuse is the last line of defense. Use the correct scale or you'll be buying a new meter."},
// ===== TEORÃA BÃSICA / LEY DE OHM (10) =====
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"Si en un circuito la resistencia se DUPLICA y el voltaje permanece igual, la corriente:",q_en:"If resistance DOUBLES and voltage stays the same in a circuit, current:",o:["TambiÃ©n se duplica proporcionalmente","Se reduce a la mitad exactamente","No cambia porque el voltaje es constante","Se cuadruplica por la relaciÃ³n exponencial"],o_en:["Doubles too","Is cut in half","Stays the same","Quadruples"],c:1,e:"V = IR. Si R se duplica y V es constante: I = V/2R = la mitad de la corriente original.",e_en:"Ohm's Law: I = V/R. If R doubles with same V, current is halved.",a:"Imagina que aprietas una manguera con la mano (mÃ¡s resistencia) pero la presiÃ³n del agua no cambia. Sale menos agua. MÃ¡s resistencia = menos corriente si el voltaje es igual.",a_en:"Think of a highway: if you double the toll booths (resistance), traffic (current) slows to half. Same number of cars wanting to pass, but more obstacles in the way."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"La fÃ³rmula para calcular POTENCIA cuando conoces voltaje y corriente es:",q_en:"The formula to calculate POWER when you know voltage and current is:",o:["P = V / I (voltaje dividido corriente)","P = IÂ² Ã— R (corriente al cuadrado por resistencia)","P = V Ã— I (voltaje por corriente)","Las opciones B y C son ambas correctas"],o_en:["P = V/I","P = I/V","P = V Ã— I (watts = volts Ã— amps)","P = V + I"],c:3,e:"P = VÃ—I y P = IÂ²Ã—R son ambas correctas. Son derivaciones de la misma ley usando V=IR.",e_en:"Power formula: P = V Ã— I. Also known as Watt's Law.",a:"Es como calcular el Ã¡rea de un rectÃ¡ngulo: puedes usar baseÃ—altura o puedes usar otros mÃ©todos. Ambas fÃ³rmulas te dan watts. P=VI es la mÃ¡s directa, P=IÂ²R es cuando no conoces el voltaje.",a_en:"Volts Ã— Amps = Watts. It's like length Ã— width = area. 120V Ã— 10A = 1200W. This formula is the bread and butter of electrical work."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"Un calentador elÃ©ctrico de 5000W a 240V. Â¿CuÃ¡l es la resistencia del elemento calefactor?",q_en:"A 5000W electric heater at 240V. What is the resistance of the heating element?",o:["1,200,000 ohms","20.83 ohms","48 ohms","11.52 ohms"],o_en:["1,200,000 ohms","20.83 ohms","11.52 ohms","48 ohms"],c:3,e:"R = VÂ²/P = 240Â²/5000 = 57600/5000 = 11.52Î©. TambiÃ©n: I = P/V = 20.83A, R = V/I = 240/20.83 = 11.52Î©.",e_en:"R = VÂ²/P = 240Â²/5000 = 57600/5000 = 11.52Î©. Or R = V/I where I = P/V = 5000/240 = 20.83A, then R = 240/20.83 = 11.52Î©.",a:"Dos caminos llegan al mismo resultado: R = VÂ²Ã·P o primero sacas los amperios y luego divides. Es como ir al trabajo por la autopista o por la calle â€” llegas al mismo lugar.",a_en:"Two ways to get there: find amps first (5000Ã·240=20.83A) then Ohm's Law (240Ã·20.83=11.52Î©). Or shortcut: R=VÂ²/P. Both give you 11.52 ohms."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"Un circuito de 120V tiene un consumo de 1440W. El breaker de 15A:",q_en:"A 120V circuit has a consumption of 1440W. The 15A breaker:",o:["Es suficiente â€” 1440W a 120V = 12A","Va a disparar porque el circuito consume exactamente 15A","Es suficiente pero estÃ¡ al 80% de su capacidad â€” hay que considerar NEC 210.20","Se dispararÃ¡ porque excede el 80% continuo permitido por NEC"],o_en:["Is fine â€” it can handle it","WILL trip â€” 1440W/120V = 12A which is exactly 80% of 15A capacity","WILL trip â€” 1440W/120V = 12A which exceeds 15A","Cannot be calculated with this information"],c:2,e:"1440/120 = 12A. NEC 210.20 dice que cargas continuas no deben exceder 80% del breaker (15Ã—0.8=12A). EstÃ¡ justo al lÃ­mite.",e_en:"1440W/120V = 12A. NEC requires continuous loads not exceed 80% of breaker rating. 80% of 15A = 12A. It's at the limit.",a:"Un breaker de 15A puede aguantar 15A, pero el NEC dice que para cargas continuas solo puedes usar el 80%, o sea 12A. Es como un carro que llega a 200 km/h pero no debes manejarlo asÃ­ todo el dÃ­a.",a_en:"12 amps is exactly 80% of a 15A breaker â€” right at the NEC continuous load limit. One more thing plugged in and it trips. This is why kitchens need 20A circuits."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"Si un motor consume 30A a 240V, Â¿cuÃ¡ntos watts de potencia estÃ¡ usando?",q_en:"If a motor draws 30A at 240V, how many watts of power is it using?",o:["7,200 watts","270 watts","8 watts","7.2 kilowatts ambas A y D son correctas"],o_en:["270W","7,200W","8W","30,240W"],c:3,e:"P = V Ã— I = 240 Ã— 30 = 7,200W = 7.2kW. Las respuestas A y D expresan lo mismo.",e_en:"P = V Ã— I = 240 Ã— 30 = 7,200W or 7.2kW.",a:"Watts es voltaje Ã— amperaje. 240 Ã— 30 = 7,200. Si alguien te dice 7.2 kilowatts es exactamente lo mismo. Kilo = mil. 7,200W = 7.2kW. Ojo con las unidades.",a_en:"Multiply: 240 Ã— 30 = 7,200 watts. That's 7.2 kilowatts. Now you know why large motors need thick wire and big breakers â€” they consume serious power."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"En un circuito con tres resistencias de 10Î© cada una en SERIE, la resistencia total es:",q_en:"In a circuit with three 10Î© resistors each in SERIES, total resistance is:",o:["3.33 ohms â€” se dividen","30 ohms â€” se suman","10 ohms â€” queda igual que una sola","100 ohms â€” se multiplican"],o_en:["3.33Î© â€” they divide","30Î© â€” they add up","10Î© â€” stays the same","100Î© â€” they multiply"],c:1,e:"En serie: RT = R1 + R2 + R3 = 10 + 10 + 10 = 30Î©. Las resistencias se SUMAN.",e_en:"In series: Rtotal = R1 + R2 + R3 = 10 + 10 + 10 = 30Î©. Resistances add up.",a:"Resistencias en serie son como casetas de peaje en la carretera: cada una te frena. Tres casetas = tres veces mÃ¡s lento. La resistencia total SUBE.",a_en:"Series is like speed bumps on a road: each one slows you down more. Three 10Î© bumps = 30Î© total of resistance. They stack up."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"Esas mismas tres resistencias de 10Î© ahora en PARALELO, la resistencia total es:",q_en:"Those same three 10Î© resistors now in PARALLEL, total resistance is:",o:["30 ohms â€” se suman igual que en serie","3.33 ohms â€” se divide entre el nÃºmero","10 ohms â€” la mÃ¡s pequeÃ±a domina","0.3 ohms â€” se multiplican los recÃ­procos"],o_en:["30Î© â€” same as series","10Î© â€” stays the same","3.33Î© â€” they divide","0Î© â€” they cancel out"],c:1,e:"En paralelo: 1/RT = 1/10 + 1/10 + 1/10 = 3/10. RT = 10/3 = 3.33Î©. Siempre menor que la menor.",e_en:"In parallel: 1/Rt = 1/10 + 1/10 + 1/10 = 3/10, so Rt = 10/3 = 3.33Î©. For equal resistors: R/n.",a:"En paralelo es como abrir tres carriles en la autopista: el trÃ¡fico fluye mÃ¡s rÃ¡pido. Tres caminos de 10Î© = resistencia total de solo 3.33Î©. MÃ¡s caminos = menos resistencia.",a_en:"Parallel is like opening more lanes on a highway: more paths = less total resistance. Three 10Î© paths = 10Ã·3 = 3.33Î©. Quick shortcut for equal resistors: divide by the count."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"Un circuito tiene 120V y una resistencia de 0 ohms. Â¿QuÃ© sucede?",q_en:"A circuit has 120V and a resistance of 0 ohms. What happens?",o:["La corriente es 0 porque no hay resistencia","La corriente es infinita â€” es un cortocircuito","El voltaje se cae a 0V automÃ¡ticamente","No pasa nada porque 0 ohms no existe en la prÃ¡ctica"],o_en:["No current flows â€” zero resistance means no flow","Short circuit â€” theoretically infinite current","The circuit operates normally","The voltage drops to zero safely"],c:1,e:"V/R = 120/0 = infinito. Corriente infinita = cortocircuito. Por eso se disparan los breakers.",e_en:"V/R = 120/0 = undefined (infinity). Zero resistance = short circuit = massive uncontrolled current. Extremely dangerous.",a:"Si quitas toda la resistencia de un circuito, es como quitar la presa de un rÃ­o: el agua se desborda sin control. 0 ohms = camino libre = toda la corriente disponible pasa de golpe.",a_en:"Zero resistance is like a dam with no wall: all the water rushes through uncontrolled. That's a short circuit â€” current goes to infinity and something burns, melts, or explodes."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"La ley de Kirchhoff de voltajes dice que en un circuito cerrado, la suma de todos los voltajes es:",q_en:"Kirchhoff's voltage law states that in a closed circuit, the sum of all:",o:["Igual al voltaje de la fuente","Proporcional a la corriente total","Igual a cero â€” las caÃ­das = la fuente","Igual a la suma de las resistencias"],o_en:["Currents equals zero","Resistances equals the source voltage","Voltage drops equals the source voltage","Powers equals zero"],c:2,e:"KVL: La suma algebraica de voltajes en un lazo cerrado = 0. Las caÃ­das de voltaje igualan al voltaje de la fuente.",e_en:"KVL: The sum of all voltage drops in a closed loop equals the source voltage. What goes in must come out.",a:"Es como un viaje redondo en carro: subes una montaÃ±a (fuente de voltaje) y luego bajas por diferentes pendientes (caÃ­das). Al final estÃ¡s al mismo nivel donde empezaste. La suma es cero.",a_en:"It's like money: if you earn $120 (source voltage) and buy 3 things, the prices must add up to $120. Every volt the source provides gets used up across the components."},
{cat:"ðŸ“ Ley de Ohm",cat_en:"ðŸ“ Ohm's Law",q:"Un tÃ©cnico mide 13.5 amperios en una de las fases de un compresor trifÃ¡sico. Las otras dos miden 12.8A y 14.1A. El porcentaje de desbalance de amperaje es:",q_en:"A technician measures 13.5 amps on one phase of a three-phase compressor. The other two phases read 14.2A and 14.8A. The amp imbalance is:",o:["Aproximadamente 4.4% â€” dentro de lo normal","Aproximadamente 9.6% â€” hay que investigar","Aproximadamente 1.3% â€” perfecto","No se puede calcular sin saber el voltaje"],o_en:["Acceptable â€” all three are the same","Concerning â€” calculate the percentage to determine severity","Impossible to determine without voltage readings","Normal for three-phase â€” phases are never equal"],c:0,e:"Promedio = (13.5+12.8+14.1)/3 = 13.47A. Mayor desviaciÃ³n = 14.1-13.47 = 0.63. Desbalance = 0.63/13.47 Ã— 100 = 4.7%. Cercano a 4.4%.",e_en:"Average = (13.5+14.2+14.8)/3 = 14.17A. Max deviation = 14.8-14.17 = 0.63A. Imbalance = 0.63/14.17 = 4.4%. Over 2% needs investigation.",a:"Es como tres caballos jalando una carreta: si uno jala mucho mÃ¡s que los otros, la carreta se va chueca. 5% o mÃ¡s ya es preocupante. AquÃ­ estamos en el lÃ­mite.",a_en:"Like a car with uneven tires â€” it still drives but wears unevenly. Over 2% amp imbalance means something is off: bad contactor, voltage issue, or winding problem. Calculate and investigate."},
// ===== MAGNETISMO (5) =====
{cat:"ðŸ§² Magnetismo",cat_en:"ðŸ§² Magnetism",q:"Un electroimÃ¡n se diferencia de un imÃ¡n permanente porque:",q_en:"An electromagnet differs from a permanent magnet because:",o:["El electroimÃ¡n es mÃ¡s fuerte siempre","El electroimÃ¡n pierde magnetismo cuando se corta la corriente","El imÃ¡n permanente genera mÃ¡s calor","No hay diferencia funcional entre ambos"],o_en:["The electromagnet is always stronger","The electromagnet loses magnetism when current is cut off","The permanent magnet generates more heat","There's no functional difference between them"],c:1,e:"Un electroimÃ¡n funciona solo con corriente. Sin electricidad, no hay campo magnÃ©tico.",e_en:"An electromagnet works only with current. Without electricity, there's no magnetic field.",a:"Un electroimÃ¡n es como una linterna: funciona solo cuando estÃ¡ encendida. Un imÃ¡n permanente es como una pintura: siempre estÃ¡ ahÃ­. Los contactores y relÃ©s usan electroimanes porque necesitas poder encender y apagar el magnetismo.",a_en:"An electromagnet is like a flashlight: it only works when it's turned on. A permanent magnet is like paint: it's always there. Contactors and relays use electromagnets because you need to turn magnetism on and off."},
{cat:"ðŸ§² Magnetismo",cat_en:"ðŸ§² Magnetism",q:"La bobina de un contactor crea un campo magnÃ©tico para:",q_en:"The coil of a contactor creates a magnetic field to:",o:["Generar calor y proteger contra sobrecargas","Atraer la armadura y cerrar los contactos principales","Medir el voltaje del circuito de control","Reducir el voltaje al nivel del circuito de control"],o_en:["Generate heat and protect against overloads","Attract the armature and close the main contacts","Measure the voltage of the control circuit","Reduce voltage to the control circuit level"],c:1,e:"La bobina energizada crea campo magnÃ©tico que atrae la armadura, cerrando los contactos de potencia.",e_en:"The energized coil creates a magnetic field that attracts the armature, closing the power contacts.",a:"Piensa en un timbre de puerta: cuando oprimes el botÃ³n, la electricidad magnetiza una bobinita que jala un martillito. El contactor es igual: la bobina jala los contactos y cierra el circuito de potencia.",a_en:"Think of a doorbell: when you press the button, electricity magnetizes a small coil that pulls a little hammer. A contactor is the same: the coil pulls the contacts and closes the power circuit."},
{cat:"ðŸ§² Magnetismo",cat_en:"ðŸ§² Magnetism",q:"En un motor elÃ©ctrico, la interacciÃ³n entre el campo magnÃ©tico del estator y el del rotor produce:",q_en:"In an electric motor, the interaction between the stator's magnetic field and the rotor creates:",o:["Calor para calentar los rodamientos","Torque â€” la fuerza giratoria que hace rotar el eje","Voltaje que alimenta el propio motor","Resistencia que protege contra sobrecarga"],o_en:["Heat that powers the motor","Rotational torque that spins the shaft","Voltage that feeds back to the panel","Sound that indicates normal operation"],c:1,e:"La interacciÃ³n de campos magnÃ©ticos opuestos genera torque (par motor) que hace girar el rotor.",e_en:"The interaction between stator and rotor magnetic fields creates torque â€” the rotational force that spins the shaft.",a:"Es como dos imanes enfrentados: se empujan o se atraen. En un motor, los campos magnÃ©ticos empujan al rotor constantemente, haciÃ©ndolo girar como un carrusel magnÃ©tico.",a_en:"It's like two magnets: when you bring opposite poles close, they attract with force. In a motor, the stator's field pushes and pulls the rotor in circles, creating the spinning motion."},
{cat:"ðŸ§² Magnetismo",cat_en:"ðŸ§² Magnetism",q:"La inductancia de una bobina se mide en:",q_en:"The inductance of a coil is measured in:",o:["Faradios â€” igual que los capacitores","Henrios â€” proporcional a las vueltas de alambre","Ohmios â€” porque se opone a la corriente","Watts â€” porque almacena energÃ­a"],o_en:["Farads","Henrys","Ohms","Watts"],c:1,e:"La inductancia se mide en Henrios (H). Depende del nÃºmero de espiras, material del nÃºcleo y geometrÃ­a.",e_en:"Inductance is measured in Henrys (H). Capacitance is in Farads, resistance in Ohms, power in Watts.",a:"Los Henrios son como la inercia de un trompo: mÃ¡s pesado y mÃ¡s vueltas de cuerda = mÃ¡s difÃ­cil pararlo una vez girando. Una bobina con mÃ¡s vueltas tiene mÃ¡s Henrios y se resiste mÃ¡s a los cambios de corriente.",a_en:"Each electrical property has its unit: Henrys for inductance (coils), Farads for capacitance (capacitors), Ohms for resistance (resistors). Know your units!"},
{cat:"ðŸ§² Magnetismo",cat_en:"ðŸ§² Magnetism",q:"Un transformador funciona basado en el principio de:",q_en:"A transformer works based on the principle of:",o:["Resistencia variable entre dos bobinas","InducciÃ³n electromagnÃ©tica mutua entre bobinas","ConducciÃ³n directa de corriente entre enrollados","Magnetismo permanente con nÃºcleo de acero"],o_en:["Direct current flow between windings","Mutual electromagnetic induction between coils","Chemical energy conversion","Static electricity generation"],c:1,e:"El transformador usa inducciÃ³n mutua: la corriente AC en el primario crea campo magnÃ©tico variable que induce voltaje en el secundario.",e_en:"Transformers use electromagnetic induction: AC in the primary coil creates a changing magnetic field that induces voltage in the secondary coil.",a:"El transformador es como dos personas hablando a travÃ©s de una pared: la primera persona (primario) habla, las vibraciones pasan por la pared (nÃºcleo), y la segunda persona (secundario) escucha. La energÃ­a se transfiere sin contacto directo.",a_en:"A transformer is like two people on a seesaw connected by a board â€” when one goes up, the other goes down. The primary coil creates a magnetic wave that pushes voltage into the secondary coil."},
// ===== CORRIENTE ALTERNA AC (7) =====
{cat:"âš¡ Corriente Alterna",cat_en:"âš¡ Alternating Current",q:"El valor RMS de 120VAC significa que entrega la misma potencia que:",q_en:"The RMS value of 120VAC means it delivers the same power as:",o:["120V de pico AC","120V de corriente directa DC","169.7V de pico AC","85V de corriente directa DC"],o_en:["120V peak AC","120VDC continuous","170VDC","240V half the time"],c:1,e:"RMS (Root Mean Square) es el valor equivalente de DC. 120VAC RMS = misma potencia que 120VDC.",e_en:"RMS (Root Mean Square) means 120VAC delivers the same heating power as 120VDC. It's the effective value.",a:"RMS es como el promedio efectivo. Si AC fuera una montaÃ±a rusa subiendo y bajando, RMS es la altura promedio que realmente trabaja. 120V RMS trabaja igual que 120V DC constante.",a_en:"RMS is the 'effective' value. 120VAC RMS heats a light bulb the same as 120V from a battery. The actual peak is higher (170V), but RMS is what matters for real work."},
{cat:"âš¡ Corriente Alterna",cat_en:"âš¡ Alternating Current",q:"El voltaje PICO de una seÃ±al de 120VAC RMS es:",q_en:"The PEAK voltage of a 120VAC RMS signal is:",o:["120V â€” pico y RMS son iguales","240V â€” el pico es el doble","169.7V â€” se multiplica por âˆš2 (1.414)","84.85V â€” se divide por âˆš2"],o_en:["120V â€” RMS and peak are the same","240V â€” it doubles","169.7V â€” multiply RMS by 1.414","60V â€” half of RMS"],c:2,e:"Vpico = VRMS Ã— âˆš2 = 120 Ã— 1.414 = 169.7V. El pico siempre es mayor que el RMS.",e_en:"Vpeak = VRMS Ã— âˆš2 = 120 Ã— 1.414 = 169.7V. The sine wave swings from +170V to -170V.",a:"Imagina una ola del mar: el RMS es como la altura promedio del agua, pero la cresta de la ola (pico) llega mÃ¡s arriba. En AC, el voltaje sube hasta 169.7V aunque decimos que son 120V.",a_en:"The wave goes up to +170V and down to -170V, but the effective work it does equals 120V steady. Multiply RMS by 1.414 to get peak. This is why some components are rated for higher voltage."},
{cat:"âš¡ Corriente Alterna",cat_en:"âš¡ Alternating Current",q:"En un sistema trifÃ¡sico 208/120V, los 208V se obtienen midiendo entre:",q_en:"In a three-phase 208/120V system, the 208V is obtained by measuring between:",o:["LÃ­nea y neutro","LÃ­nea y tierra","Dos lÃ­neas cualesquiera (fase a fase)","Las tres lÃ­neas juntas"],o_en:["One hot line and neutral","Two hot lines (any two phases)","Hot and ground","All three phases together"],c:2,e:"208V = voltaje lÃ­nea a lÃ­nea en trifÃ¡sico. LÃ­nea a neutro = 120V. 120 Ã— âˆš3 = 208V.",e_en:"208V = line to line (between any two phases). 120V = line to neutral (one phase to neutral).",a:"Es como tres caballos en un carrusel: cada caballo estÃ¡ a 120V del centro (neutro), pero entre un caballo y otro hay 208V. Es geometrÃ­a, no magia. 120 Ã— 1.732 = 208.",a_en:"Think of three people holding hands in a circle: the distance between any two people (208V) is longer than the distance from one person to the center (120V). Phase to phase = 208V."},
{cat:"âš¡ Corriente Alterna",cat_en:"âš¡ Alternating Current",q:"Un motor trifÃ¡sico gira al revÃ©s de lo deseado. Para corregirlo debes:",q_en:"A three-phase motor is spinning the wrong direction. To correct it you must:",o:["Cambiar las tres fases de posiciÃ³n","Intercambiar DOS de las tres fases cualesquiera","Invertir la polaridad del capacitor","Cambiar la frecuencia de 60Hz a 50Hz"],o_en:["Reverse all three phase wires","Swap ANY two of the three phase wires","Change the motor's internal wiring","Install a phase reversal relay"],c:1,e:"Para invertir rotaciÃ³n en trifÃ¡sico, solo intercambias dos fases cualquiera. No las tres.",e_en:"Swapping any two of the three phases reverses rotation direction. It's the simplest fix in three-phase work.",a:"Es como cambiar la direcciÃ³n de un ventilador de techo: no cambias todo, solo inviertes dos cables. En trifÃ¡sico, intercambiar dos fases cambia la secuencia de rotaciÃ³n del campo magnÃ©tico.",a_en:"It's like reversing a revolving door by changing which side you push from. Just swap two wires â€” any two â€” and the motor spins the other way. Simple but powerful fix."},
{cat:"âš¡ Corriente Alterna",cat_en:"âš¡ Alternating Current",q:"El factor de potencia de 0.85 en un motor significa que:",q_en:"A power factor of 0.85 on a motor means:",o:["Solo usa el 85% de la electricidad que paga","El 85% de la potencia es Ãºtil, el 15% es reactiva","El motor estÃ¡ al 85% de su capacidad","La eficiencia del motor es 85%"],o_en:["It only uses 85% of the electricity you pay for","85% of the power is useful, 15% is reactive","The motor is at 85% of its capacity","Motor efficiency is 85%"],c:1,e:"Factor de potencia = potencia real / potencia aparente. 0.85 significa que 15% es potencia reactiva (no trabaja).",e_en:"Power factor = real power / apparent power. 0.85 means 15% is reactive power (does no work).",a:"Es como un vaso de cerveza con espuma: el 85% es cerveza (potencia Ãºtil) y el 15% es espuma (potencia reactiva). Pagas por el vaso lleno pero solo disfrutas la cerveza.",a_en:"It's like a glass of beer with foam: 85% is beer (useful power) and 15% is foam (reactive power). You pay for the full glass but only enjoy the beer."},
{cat:"âš¡ Corriente Alterna",cat_en:"âš¡ Alternating Current",q:"La frecuencia de 60Hz significa que la corriente completa:",q_en:"A frequency of 60Hz means the current completes:",o:["60 ciclos completos por minuto","60 ciclos completos por segundo","60 cambios de direcciÃ³n por segundo","60,000 oscilaciones por segundo"],o_en:["60 complete cycles per minute","60 complete cycles per second","60 direction changes per second","60,000 oscillations per second"],c:1,e:"Hertz = ciclos por segundo. 60Hz = 60 ciclos completos cada segundo.",e_en:"Hertz = cycles per second. 60Hz = 60 complete cycles every second.",a:"Hz es como el ritmo de un corazÃ³n: 60 latidos por minuto es lo normal del corazÃ³n, 60 ciclos por SEGUNDO es lo normal de la electricidad AC en USA.",a_en:"Hz is like a heartbeat rhythm: 60 beats per minute is normal for the heart, 60 cycles per SECOND is normal for AC electricity in the USA."},
{cat:"âš¡ Corriente Alterna",cat_en:"âš¡ Alternating Current",q:"En un circuito puramente capacitivo, la corriente:",q_en:"In a purely capacitive circuit, the current:",o:["EstÃ¡ en fase con el voltaje","Adelanta al voltaje por 90 grados","Atrasa al voltaje por 90 grados","Se opone completamente al voltaje"],o_en:["Is in phase with voltage","Leads voltage by 90 degrees","Lags voltage by 90 degrees","Has no relationship to voltage"],c:1,e:"En capacitores, la corriente ADELANTA al voltaje por 90Â°. MnemÃ³nico: \"ELI the ICE man\" â€” en C, I adelanta a E.",e_en:"In a capacitive circuit, current leads voltage by 90Â°. In inductive circuits, current lags. Remember: ELI the ICE man.",a:"ELI el hombre de ICE: En un Inductor (L), el voltaje (E) adelanta a la corriente (I). En un Capacitor (C), la corriente (I) adelanta al voltaje (E). I-C-E.",a_en:"ELI the ICE man: In an Inductor (L), voltage (E) leads current (I). In a Capacitor (C), current (I) leads voltage (E). ICE = current leads in capacitors."},
// ===== CORRIENTE DIRECTA DC (5) =====
{cat:"ðŸ”‹ Corriente Directa",cat_en:"ðŸ”‹ Direct Current",q:"En un circuito DC, los electrones fluyen del terminal:",q_en:"In a DC circuit, electrons flow from the terminal:",o:["Positivo al negativo â€” siguiendo la convenciÃ³n","Negativo al positivo â€” flujo real de electrones","En ambas direcciones simultÃ¡neamente","La direcciÃ³n depende del tipo de carga"],o_en:["Positive to negative (conventional flow)","Negative to positive (electron flow)","In both directions simultaneously","Only when the circuit is grounded"],c:1,e:"El flujo REAL de electrones va de negativo a positivo. La convenciÃ³n dice al revÃ©s por razones histÃ³ricas.",e_en:"Electron flow goes from negative to positive. Conventional flow (used in schematics) goes positive to negative.",a:"Benjamin Franklin se equivocÃ³ hace 200 aÃ±os y dijo que la corriente iba de + a -. En realidad los electrones viajan de - a +. Pero como todos ya lo aprend ieron al revÃ©s, usamos ambas convenciones.",a_en:"Electrons are negative, so they're attracted to the positive terminal â€” they flow from - to +. But schematics use 'conventional flow' which goes + to -. Both are correct, just different perspectives."},
{cat:"ðŸ”‹ Corriente Directa",cat_en:"ðŸ”‹ Direct Current",q:"Un circuito de control de 24VDC requiere un fusible de protecciÃ³n. Si la carga consume 2A, el fusible debe ser:",q_en:"A 24VDC control circuit needs a protection fuse. If the load draws 2A, the fuse should be:",o:["24V/2A = 12A â€” segÃºn Ohm","Un fusible de 3A â€” ligeramente arriba del consumo","Un fusible de 2A exacto â€” para que proteja al 100%","Un fusible de 10A â€” para dejar margen amplio"],o_en:["Exactly 2A â€” to match the load","3A â€” slightly above the load for margin","20A â€” to avoid nuisance trips","A 24V fuse regardless of amperage"],c:1,e:"El fusible debe ser ligeramente superior al consumo normal. 3A protege sin disparar en operaciÃ³n normal.",e_en:"Fuse should be slightly above load current but sized to protect the wire. 3A gives margin without risking wire damage.",a:"El fusible es como el cinturÃ³n de seguridad: no debe estar tan apretado que te asfixie (2A = se dispara por nada), ni tan flojo que no te proteja (10A = no protege nada). 3A es el punto justo.",a_en:"Like a bodyguard: strong enough to let normal people through but stops anything too big. 2A load needs a fuse just above â€” 3A gives breathing room without leaving the wire unprotected."},
{cat:"ðŸ”‹ Corriente Directa",cat_en:"ðŸ”‹ Direct Current",q:"La diferencia entre un circuito de control de 24VAC y 24VDC es que:",q_en:"The difference between a 24VAC and 24VDC control circuit is that:",o:["Son intercambiables â€” 24V es 24V","El AC puede alimentar bobinas de relÃ©s convencionales, el DC necesita relÃ©s especiales o diodos","El DC es mÃ¡s peligroso que el AC al mismo voltaje","No existe control a 24VDC en HVAC"],o_en:["They're interchangeable â€” 24V is 24V","AC alternates direction, DC flows one way â€” components may not be interchangeable","DC is more dangerous at 24V","AC can only power lights"],c:1,e:"Los relÃ©s AC y DC funcionan diferente. Un relÃ© diseÃ±ado para AC puede no liberar con DC por el magnetismo residual.",e_en:"24VAC and 24VDC are NOT interchangeable. Relays, solenoids, and control boards are designed for one or the other.",a:"AC y DC son como agua de rÃ­o (fluye ida y vuelta) y agua de canal (fluye en una direcciÃ³n). Ambos mojan, pero las turbinas de rÃ­o no funcionan en el canal. RelÃ©s AC y DC no son intercambiables.",a_en:"It's like regular gas vs diesel â€” both are fuel, both cost about the same, but put the wrong one in your engine and you're in trouble. Always check if the component needs AC or DC."},
{cat:"ðŸ”‹ Corriente Directa",cat_en:"ðŸ”‹ Direct Current",q:"Un termostato digital moderno usa internamente:",q_en:"A modern digital thermostat internally uses:",o:["240VAC para mayor potencia de procesamiento","24VAC convertido a DC bajo voltaje para el microprocesador","Corriente directa de la lÃ­nea de 120V","EnergÃ­a solar exclusivamente"],o_en:["AC power directly from the line","DC power â€” it converts 24VAC to low-voltage DC internally","It generates its own power","It runs on solar cells"],c:1,e:"Los termostatos digitales reciben 24VAC y lo rectifican internamente a DC bajo voltaje (3.3V o 5V) para alimentar el microprocesador.",e_en:"Digital thermostats convert 24VAC to DC internally using a rectifier circuit to power the microprocessor and display.",a:"El termostato es como tu celular con cargador: la pared tiene AC, pero tu celular usa DC. El termostato recibe 24VAC y lo convierte a DC bajito para que funcione su cerebrito digital.",a_en:"The thermostat gets 24VAC from the transformer but its brain is a tiny computer that runs on DC. It has a little converter inside, like a phone charger converts wall AC to USB DC."},
{cat:"ðŸ”‹ Corriente Directa",cat_en:"ðŸ”‹ Direct Current",q:"Un diodo en un circuito DC permite que la corriente fluya:",q_en:"A diode in a DC circuit allows current to flow:",o:["En ambas direcciones libremente","Solo en una direcciÃ³n â€” del Ã¡nodo al cÃ¡todo","Solo cuando hay sobrecarga","En direcciÃ³n opuesta a la convenciÃ³n"],o_en:["In both directions equally","In one direction only â€” from anode to cathode","Only when voltage exceeds 120V","In neither direction â€” it blocks everything"],c:1,e:"El diodo es una vÃ¡lvula unidireccional: solo deja pasar corriente del Ã¡nodo (+) al cÃ¡todo (-).",e_en:"A diode is a one-way valve for electricity. Current flows from anode (+) to cathode (-) only.",a:"Un diodo es como una puerta de metro que solo abre hacia un lado: puedes salir pero no puedes entrar por esa puerta. La corriente pasa en una direcciÃ³n y se bloquea en la otra.",a_en:"A diode is like a check valve in plumbing: water flows one way only. If current tries to go backwards, the diode blocks it. This protects sensitive circuits from reverse current."},
// ===== CONDUCTORES (6) =====
{cat:"ðŸ”Œ Conductores",cat_en:"ðŸ”Œ Conductors",q:"Al AUMENTAR el nÃºmero AWG de un conductor (ej: de #10 a #14), el cable es:",q_en:"When INCREASING the AWG number of a conductor (e.g., from #10 to #14), the wire is:",o:["MÃ¡s grueso y aguanta mÃ¡s corriente","MÃ¡s delgado y aguanta MENOS corriente","Del mismo grosor pero diferente material","MÃ¡s largo pero con la misma capacidad"],o_en:["Thicker and can carry more current","Thinner and carries LESS current","The same size â€” AWG doesn't indicate size","Thicker but carries less current"],c:1,e:"En AWG, nÃºmero MAYOR = cable MÃS delgado. #14 es mÃ¡s delgado que #10. #10 > #12 > #14.",e_en:"Higher AWG number = thinner wire = less current capacity. #14 is thinner than #10. It's counterintuitive.",a:"AWG es al revÃ©s de lo que piensas: nÃºmero grande = cable chico. Es como las tallas de ropa en JapÃ³n: una talla 14 es mÃ¡s chica que una talla 10. #14 es flaquito, #10 es gordito.",a_en:"AWG is backwards from what you'd expect: bigger number = smaller wire. Think of it like this: #14 was drawn through the machine 14 times (making it thinner). #10 only 10 times (thicker)."},
{cat:"ðŸ”Œ Conductores",cat_en:"ðŸ”Œ Conductors",q:"SegÃºn NEC Table 310.16, un conductor de cobre #10 AWG tipo THHN en tubo conduit puede llevar hasta:",q_en:"According to NEC Table 310.16, a #10 AWG copper THHN conductor in conduit can carry a maximum of:",o:["20 amperios continuos","30 amperios continuos","40 amperios continuos","50 amperios continuos"],o_en:["15A","20A","30A","40A"],c:1,e:"NEC 310.16: #10 THHN a 90Â°C = 40A, pero con factor de correcciÃ³n en conduit a 75Â°C = 35A. ComÃºnmente se usa 30A.",e_en:"NEC Table 310.16: #14 = 15A, #12 = 20A, #10 = 30A, #8 = 40A for THHN copper in conduit at 30Â°C.",a:"La tabla 310.16 del NEC es la biblia de los conductores. Memoriza los mÃ¡s comunes: #14=15A, #12=20A, #10=30A, #8=40A, #6=55A. Estos nÃºmeros los vas a usar TODOS los dÃ­as.",a_en:"Memorize this table â€” you'll use it every day: 14â†’15, 12â†’20, 10â†’30, 8â†’40, 6â†’55. It's the multiplication table of electrical work."},
{cat:"ðŸ”Œ Conductores",cat_en:"ðŸ”Œ Conductors",q:"Un cable THHN vs un cable THWN. La \"W\" significa:",q_en:"A THHN cable vs a THWN cable. The \"W\" means:",o:["Watts â€” aguanta mÃ¡s potencia","Wet â€” resistente a humedad y puede ir en lugares mojados","Wide â€” es de mayor diÃ¡metro","Wired â€” viene pre-cableado de fÃ¡brica"],o_en:["Watts â€” rated for higher power","Wet â€” rated for wet locations","Wireless â€” for outdoor antennas","Warning â€” high voltage only"],c:1,e:"W = Wet locations (lugares hÃºmedos). THWN puede instalarse en conduit enterrado o expuesto a humedad.",e_en:"W = Wet locations. THWN is rated for wet environments. THHN is only for dry and damp.",a:"La W es de Water. THHN es para lugares secos como dentro de paredes. THWN puede mojarse. Es como la diferencia entre zapatos de vestir (THHN) y botas de lluvia (THWN).",a_en:"T=Thermoplastic, H=Heat resistant, HH=High Heat, N=Nylon jacket, W=Wet rated. The letters tell the story. If you're running wire where water might be, you need that W."},
{cat:"ðŸ”Œ Conductores",cat_en:"ðŸ”Œ Conductors",q:"La caÃ­da de voltaje mÃ¡xima recomendada por NEC para un circuito de alimentaciÃ³n es:",q_en:"The maximum recommended voltage drop per NEC for a branch circuit is:",o:["10% â€” solo para circuitos industriales","3% para el alimentador, 5% total incluyendo rama","5% para alimentador, 10% total","No hay lÃ­mite â€” el NEC no regula caÃ­da de voltaje"],o_en:["10% â€” acceptable for most circuits","3% for branch circuits, 5% total including feeder","0% â€” no drop is acceptable","15% â€” electricity is flexible"],c:1,e:"NEC recomienda 3% mÃ¡ximo en alimentador y 5% total (alimentador + circuito rama). No es obligatorio pero sÃ­ recomendado.",e_en:"NEC recommends 3% max voltage drop for branch circuits and 5% total (feeder + branch). Not a code requirement but a strong recommendation.",a:"La caÃ­da de voltaje es como la presiÃ³n del agua que se pierde en tuberÃ­a muy larga. Si empiezas con 120V y pierdes mÃ¡s del 5%, el equipo al final no funciona bien. Es como regar con manguera de 500 pies â€” casi no sale agua al final.",a_en:"3% of 120V = 3.6V. So the load should see no less than 116.4V. It's like water pressure: too much drop in the pipes and the shower barely trickles. Keep it under 3%."},
{cat:"ðŸ”Œ Conductores",cat_en:"ðŸ”Œ Conductors",q:"Â¿Por quÃ© el aluminio requiere un conductor de mayor calibre que el cobre para la misma corriente?",q_en:"Why does aluminum require a larger gauge conductor than copper for the same ampacity?",o:["El aluminio pesa mÃ¡s y se calienta mÃ¡s fÃ¡cil","El aluminio tiene mayor resistencia que el cobre â€” conduce peor","El aluminio es mÃ¡s peligroso por ser inflamable","No es cierto â€” ambos metales son equivalentes"],o_en:["Aluminum is heavier","Aluminum has higher resistance per foot than copper","Aluminum is more expensive","There's no difference â€” they're equal"],c:1,e:"El aluminio tiene aproximadamente 61% de la conductividad del cobre. Para llevar la misma corriente necesitas cable mÃ¡s grueso.",e_en:"Aluminum has about 1.6Ã— the resistance of copper. So you need a thicker aluminum wire to carry the same current safely.",a:"Si el cobre es una autopista de 4 carriles, el aluminio es de 2.5 carriles. Para mover el mismo trÃ¡fico, necesitas la autopista de aluminio mÃ¡s ancha. Por eso el cable de aluminio es mÃ¡s gordo.",a_en:"Aluminum conducts worse than copper â€” like a wider dirt road vs a paved road. To carry the same traffic (current), the aluminum road needs to be wider (bigger gauge). That's why aluminum wire is always bigger."},
{cat:"ðŸ”Œ Conductores",cat_en:"ðŸ”Œ Conductors",q:"Al hacer una conexiÃ³n de aluminio con cobre (bimetÃ¡lica), es OBLIGATORIO usar:",q_en:"When making an aluminum-to-copper connection (bimetallic), it is MANDATORY to use:",o:["Cinta aislante de alta calidad","Conectores aprobados anti-oxidante y marcados AL/CU","Soldadura de plata para uniÃ³n permanente","No se permite nunca conectar aluminio con cobre"],o_en:["Regular wire nuts â€” they work for everything","Anti-oxidant compound and approved bimetallic connectors","Solder to join them permanently","Electrical tape is sufficient"],c:1,e:"Las uniones bimetÃ¡licas requieren conectores marcados AL/CU y pasta anti-oxidante para prevenir corrosiÃ³n galvÃ¡nica.",e_en:"Bimetallic connections require approved connectors and anti-oxidant paste. Without them, oxidation causes high resistance and fire risk.",a:"Aluminio y cobre son como perros y gatos: si los juntas sin cuidado, hay problemas. La corrosiÃ³n galvÃ¡nica afloja la conexiÃ³n y puede causar incendio. Los conectores AL/CU son como el mediador que los mantiene en paz.",a_en:"Aluminum and copper together is like oil and water â€” they don't mix well. Without anti-oxidant compound, the aluminum corrodes, resistance builds up, and you get a house fire. Always use approved connectors."},
// ===== INTERRUPTORES / BREAKERS (5) =====
{cat:"ðŸ”² Interruptores",cat_en:"ðŸ”² Switches",q:"Un breaker de 20A se dispara instantÃ¡neamente. La causa MÃS probable es:",q_en:"A 20A breaker trips instantly. The MOST probable cause is:",o:["Sobrecarga gradual en el circuito","Cortocircuito en algÃºn punto del circuito","El breaker estÃ¡ viejo y necesita reemplazo","La temperatura ambiente es muy alta"],o_en:["A slight overload","A short circuit â€” massive current caused immediate trip","A loose neutral wire","The breaker is defective"],c:1,e:"Disparo instantÃ¡neo = cortocircuito. La sobrecarga causa disparo retardado (tardado). Son mecanismos diferentes.",e_en:"Instant trip = short circuit. Overloads cause slow trips (thermal element heats up gradually).",a:"Un breaker tiene dos cerebros: uno lento para sobrecargas (se calienta gradualmente) y uno rÃ¡pido para cortocircuitos (dispara de golpe). Si disparÃ³ instantÃ¡neamente, hay un cortocircuito.",a_en:"Instant trip is like a punch in the face â€” the breaker reacts immediately to a massive current surge. A slow trip is like getting tired â€” it builds up over time. Instant = short circuit."},
{cat:"ðŸ”² Interruptores",cat_en:"ðŸ”² Switches",q:"Un breaker se siente caliente al tacto comparado con los demÃ¡s. Esto puede indicar:",q_en:"A breaker feels hot to the touch compared to the others. This could indicate:",o:["Es normal â€” todos los breakers generan calor","ConexiÃ³n floja que genera resistencia y calor","El circuito estÃ¡ sub-cargado","El breaker es de mayor capacidad que los otros"],o_en:["Normal â€” breakers always get warm","A loose connection, overloaded circuit, or failing breaker","The panel has poor ventilation","Someone recently reset it"],c:1,e:"Un breaker mÃ¡s caliente que sus vecinos indica conexiÃ³n floja, mala terminal, o sobrecarga en ese circuito.",e_en:"A hot breaker indicates a problem: loose connection (high resistance), overload, or internal failure. Investigate immediately.",a:"Si una llanta de tu carro estÃ¡ mÃ¡s caliente que las otras, hay un problema: freno pegado, baja presiÃ³n, etc. Un breaker caliente es lo mismo â€” algo estÃ¡ mal en esa conexiÃ³n.",a_en:"A hot breaker is like a fever in a person â€” it means something is wrong. Loose connection = high resistance = heat. Overload = too much current = heat. Either way, don't ignore it."},
{cat:"ðŸ”² Interruptores",cat_en:"ðŸ”² Switches",q:"SegÃºn NEC 210.12, los breakers AFCI (Arc-Fault) son requeridos en:",q_en:"According to NEC 210.12, AFCI (Arc-Fault) breakers are required in:",o:["Solo en baÃ±os y cocinas","Dormitorios, salas, comedores y la mayorÃ­a de Ã¡reas habituales","Solo en circuitos de 240V","Exclusivamente en instalaciones comerciales"],o_en:["Only in kitchens and bathrooms","Bedrooms, living rooms, hallways, and most habitable rooms","Only in commercial buildings","Garages and basements only"],c:1,e:"NEC 210.12 requiere AFCI en dormitorios, salas, comedores, pasillos, closets y la mayorÃ­a de Ã¡reas habituales residenciales.",e_en:"NEC 210.12 requires AFCI in bedrooms, living rooms, dining rooms, hallways, closets, and most habitable spaces.",a:"AFCI protege contra arcos elÃ©ctricos que causan incendios â€” como un cable daÃ±ado dentro de la pared chispeando. Los cuartos donde duermes son los mÃ¡s peligrosos por eso se requieren ahÃ­.",a_en:"AFCI protects against electrical fires from damaged wires â€” like a nail through a wire in the wall. Most house fires start in living spaces, so that's where AFCI goes. Kitchens and bathrooms get GFCI instead."},
{cat:"ðŸ”² Interruptores",cat_en:"ðŸ”² Switches",q:"La diferencia principal entre un breaker de 1 polo y uno de 2 polos es:",q_en:"The main difference between a 1-pole and 2-pole breaker is:",o:["El de 2 polos protege el doble de circuitos","El de 1 polo protege 120V, el de 2 polos protege 240V interrumpiendo ambas lÃ­neas","El de 2 polos es mÃ¡s seguro para cocinas","Solo es diferencia de tamaÃ±o fÃ­sico"],o_en:["1-pole is more powerful","A 1-pole protects one hot line (120V), a 2-pole protects two hot lines (240V)","2-pole is only for commercial use","There's no functional difference"],c:1,e:"Un breaker de 2 polos desconecta las dos lÃ­neas calientes simultÃ¡neamente para circuitos de 240V.",e_en:"1-pole = one hot line = 120V. 2-pole = two hot lines = 240V. The 2-pole trips both legs simultaneously.",a:"Un breaker de 1 polo es como una puerta sencilla. Uno de 2 polos es como una puerta doble que se abre junta: desconecta las dos lÃ­neas al mismo tiempo. Para 240V necesitas cortar ambas lÃ­neas.",a_en:"120V circuits need one breaker (1-pole). 240V circuits have TWO hot wires, so they need TWO connected breakers (2-pole) that trip together. If only one tripped, you'd still have 120V â€” dangerous."},
{cat:"ðŸ”² Interruptores",cat_en:"ðŸ”² Switches",q:"Un breaker que se puede resetear pero se vuelve a disparar inmediatamente indica:",q_en:"A breaker that can be reset but immediately trips again indicates:",o:["El breaker necesita reemplazo urgente","El cortocircuito o falla sigue presente en el circuito","Se necesita un breaker de mayor amperaje","Hay que esperar 5 minutos entre cada reset"],o_en:["The breaker needs to cool down first","A persistent fault â€” likely a short circuit that hasn't been fixed","Normal breaker behavior after tripping","The breaker is too small for the circuit"],c:1,e:"Si se re-dispara inmediatamente, la falla persiste. Hay que encontrar y reparar la falla ANTES de resetear.",e_en:"Immediate re-trip = the fault is still present. Don't keep resetting â€” find and fix the short circuit or ground fault.",a:"Es como una alarma de humo que suena otra vez cuando la reseteas: el fuego sigue ahÃ­. No pongas cinta a la alarma â€” apaga el fuego primero.",a_en:"It's like a fire alarm that keeps going off after you reset it â€” the fire is still there! Stop resetting the breaker and start looking for the short. Repeated resetting can cause a fire."},
// ===== FUSIBLES (4) =====
{cat:"ðŸ”¥ Fusibles",cat_en:"ðŸ”¥ Fuses",q:"Un fusible tipo \"dual-element\" o de retardo se usa para proteger:",q_en:"A \"dual-element\" or time-delay fuse is used to protect:",o:["Solo circuitos de iluminaciÃ³n","Circuitos con motores que tienen alta corriente de arranque","Circuitos de control de bajo voltaje exclusivamente","Paneles principales de alta potencia"],o_en:["Light circuits only","Motor circuits â€” handles startup surge without blowing","High voltage circuits exclusively","Computer equipment"],c:1,e:"Los fusibles de retardo aguantan el pico de arranque de motores sin disparar, pero protegen contra cortocircuitos.",e_en:"Time-delay fuses tolerate brief high current (motor startup) without blowing, but still protect against sustained overloads.",a:"Un motor al arrancar consume 5-7 veces su corriente normal por unos segundos. Un fusible normal se volarÃ­a. El de retardo es como un padre paciente: aguanta un berrinche corto pero actÃºa si el problema dura.",a_en:"Motors surge to 6-8Ã— their normal amps when starting. A fast fuse would blow every time the compressor kicks on. Time-delay fuses say 'I'll wait a few seconds to see if this surge is temporary or permanent.'"},
{cat:"ðŸ”¥ Fusibles",cat_en:"ðŸ”¥ Fuses",q:"Â¿CuÃ¡l es la diferencia entre un fusible de acciÃ³n rÃ¡pida y uno de retardo?",q_en:"What is the difference between a fast-acting fuse and a time-delay fuse?",o:["El de acciÃ³n rÃ¡pida es para AC, el de retardo para DC","El de acciÃ³n rÃ¡pida protege componentes electrÃ³nicos sensibles, el de retardo tolera picos de arranque","El de retardo es mÃ¡s barato y menos preciso","No hay diferencia real â€” solo son de diferentes fabricantes"],o_en:["Fast-acting is for higher voltage","Fast-acting blows immediately at any overcurrent; time-delay tolerates brief surges","Time-delay is cheaper","They're interchangeable"],c:1,e:"AcciÃ³n rÃ¡pida dispara ante cualquier sobrecorriente. Retardo tolera picos breves (arranque de motores).",e_en:"Fast-acting = blows instantly at overcurrent (for electronics). Time-delay = allows brief surges (for motors). Not interchangeable.",a:"Fusible rÃ¡pido es como un guardaespaldas nervioso: al primer movimiento extraÃ±o, actÃºa. El de retardo es como un guardaespaldas experimentado: sabe que un empujÃ³n accidental no es un ataque. Ambos protegen, pero de diferente manera.",a_en:"Fast-acting is like a hair trigger â€” any overcurrent and boom. Time-delay is like a patient person who waits to see if the situation resolves. Motors need patient fuses; electronics need fast ones."},
{cat:"ðŸ”¥ Fusibles",cat_en:"ðŸ”¥ Fuses",q:"Un fusible se quemÃ³ y solo tienes uno de voltaje MAYOR pero mismo amperaje. Â¿Puedes usarlo?",q_en:"A fuse blew and you only have one with HIGHER voltage but same amperage. Can you use it?",o:["SÃ­ â€” el voltaje del fusible solo indica su capacidad mÃ¡xima de interrupciÃ³n","No â€” mayor voltaje significa que dejarÃ¡ pasar mÃ¡s corriente","No â€” los fusibles de diferente voltaje tienen diferente tamaÃ±o","SÃ­ pero solo temporalmente por 24 horas"],o_en:["Yes â€” higher voltage rating is safe to use","No â€” you must always match voltage and amperage exactly","Only temporarily until you get the right one","Higher voltage fuses blow faster"],c:0,e:"El voltaje del fusible indica hasta quÃ© voltaje puede interrumpir con seguridad. Uno de mayor voltaje funciona en un circuito de menor voltaje.",e_en:"A higher voltage rated fuse at the same amperage is safe. It can handle MORE voltage, not less. But never use higher amperage.",a:"Un fusible de 600V en un circuito de 240V es como un puente diseÃ±ado para 40 toneladas cargando solo 15. EstÃ¡ sobrado, no hay problema. Pero NUNCA al revÃ©s: un fusible de 250V en un circuito de 480V es peligroso.",a_en:"Voltage rating is the MAX the fuse can safely interrupt. Using a 600V fuse on a 240V circuit is fine â€” it's overqualified. But a 20A fuse where a 15A goes? That's dangerous. Match amps, voltage can be equal or higher."},
{cat:"ðŸ”¥ Fusibles",cat_en:"ðŸ”¥ Fuses",q:"Para verificar si un fusible estÃ¡ quemado SIN sacarlo del circuito, puedes:",q_en:"To check if a fuse is blown WITHOUT removing it from the circuit, you can:",o:["Medir voltaje a travÃ©s del fusible â€” si marca voltaje estÃ¡ abierto","Medir resistencia con el circuito energizado","Observar visualmente si el alambre estÃ¡ roto","Solo se puede verificar sacÃ¡ndolo del circuito"],o_en:["Visually inspect it â€” if the element is intact it's good","Measure voltage across the fuse â€” voltage present means it's blown","Shake it and listen for the broken element","Feel if it's warm â€” warm means it's working"],c:0,e:"Un fusible bueno tiene 0V entre sus terminales. Si mides voltaje significa que estÃ¡ abierto (quemado).",e_en:"Voltage across a good fuse = 0V (it's a conductor). Voltage across a blown fuse = source voltage (it's an open circuit).",a:"Un fusible bueno es como un puente: no hay diferencia de nivel entre un lado y otro. Si mides voltaje entre ambos lados, es como una cascada â€” hay un desnivel porque el puente se cayÃ³. Voltaje = fusible quemado.",a_en:"A good fuse is like a closed door â€” no voltage difference on either side. A blown fuse is like a wall â€” full voltage builds up on one side and zero on the other. Measure across it: 0V = good, voltage = blown."},
// ===== GFCI (5) =====
{cat:"âš¡ GFCI",cat_en:"âš¡ GFCI",q:"Un GFCI (Ground Fault Circuit Interrupter) se dispara cuando detecta una diferencia de corriente de:",q_en:"A GFCI (Ground Fault Circuit Interrupter) trips when it detects a current difference between hot and neutral of:",o:["15 amperios entre hot y neutro","100 miliamperios de fuga","4-6 miliamperios entre hot y neutro","1 amperio de corriente a tierra"],o_en:["1 amp â€” standard threshold","4 to 6 milliamps (0.004 to 0.006A)","100 milliamps","500 milliamps"],c:2,e:"GFCI dispara con diferencia de 4-6mA entre hot y neutro, indicando que corriente se estÃ¡ escapando por otro camino (posiblemente a travÃ©s de una persona).",e_en:"GFCI trips at 4-6mA imbalance. This is well below the lethal threshold of 100mA, providing fast protection.",a:"El GFCI es como un contador de ovejas: si salen 100 ovejas y solo regresan 96, cuatro se perdieron. Si salen 10A por el hot y solo regresan 9.995A por el neutro, 5mA se escaparon â€” posiblemente por una persona. Â¡TRIP!",a_en:"The GFCI is like a bodyguard counting people in and out of a room. If more people went in than came out (current leaking), it shuts the door at just 5mA â€” way before the 100mA that stops your heart."},
{cat:"âš¡ GFCI",cat_en:"âš¡ GFCI",q:"SegÃºn NEC 210.8, los tomacorrientes GFCI son requeridos en:",q_en:"According to NEC 210.8, GFCI outlets are required in:",o:["Todos los circuitos de una casa sin excepciÃ³n","BaÃ±os, cocinas, garajes, exteriores, sÃ³tanos y cerca de fuentes de agua","Solo en cuartos de baÃ±o y ningÃºn otro lugar","Solo en circuitos de 20 amperios o mÃ¡s"],o_en:["All circuits in a house without exception","Bathrooms, kitchens, garages, outdoors, basements and near water sources","Only in bathrooms and nowhere else","Only on 20-amp circuits or higher"],c:1,e:"NEC 210.8 requiere GFCI en baÃ±os, cocinas (cerca del lavabo), garajes, exteriores, sÃ³tanos sin terminar, lavanderÃ­as, y mÃ¡s.",e_en:"NEC 210.8 requires GFCI in bathrooms, kitchens (near sink), garages, outdoors, unfinished basements, laundry rooms, and more.",a:"Donde hay agua hay peligro. El NEC pone GFCI en todos los lugares donde podrÃ­as estar mojado: baÃ±o, cocina, garage, afuera. El agua y la electricidad no se llevan.",a_en:"Where there's water there's danger. The NEC puts GFCI everywhere you might be wet: bathroom, kitchen, garage, outside. Water and electricity don't get along."},
{cat:"âš¡ GFCI",cat_en:"âš¡ GFCI",q:"Un GFCI protege contra:",q_en:"A GFCI protects against:",o:["Sobrecarga del circuito","Cortocircuitos","Fugas de corriente a tierra que podrÃ­an electrocutar a una persona","Las tres anteriores"],o_en:["Overloads and short circuits","Ground faults â€” current leaking to ground through a person or conductor","Voltage surges from lightning","Power outages"],c:2,e:"GFCI solo protege contra fugas a tierra. NO protege contra sobrecargas ni cortocircuitos â€” para eso estÃ¡ el breaker.",e_en:"GFCI specifically detects ground faults â€” current going where it shouldn't, like through your body to ground.",a:"El GFCI es un especialista: solo detecta si la corriente se estÃ¡ escapando del circuito por donde no debe (como a travÃ©s de tu cuerpo). El breaker es el que cuida sobrecargas y cortocircuitos. Cada uno tiene su trabajo.",a_en:"A GFCI doesn't care about overloads or shorts â€” that's the breaker's job. The GFCI only watches for current sneaking out through the ground path, like through your wet hand to the faucet. That's what kills people."},
{cat:"âš¡ GFCI",cat_en:"âš¡ GFCI",q:"Un GFCI se dispara repetidamente en un circuito de exteriores. La causa MÃS probable es:",q_en:"A GFCI trips repeatedly on an outdoor circuit. The MOST likely cause is:",o:["El GFCI es de mala calidad y necesita uno mejor","Hay humedad en las cajas elÃ©ctricas o cables daÃ±ados permitiendo fuga","El circuito estÃ¡ sobrecargado con demasiados equipos","La tierra fÃ­sica estÃ¡ desconectada"],o_en:["The GFCI is defective","Moisture in the outlet box or connections","The circuit is overloaded","The wire is too long"],c:1,e:"En exteriores, la humedad en conexiones o cables daÃ±ados es la causa mÃ¡s comÃºn de disparos repetitivos de GFCI.",e_en:"Outdoor GFCI tripping = moisture infiltration in boxes, connections, or underground wiring. Water causes current leakage to ground.",a:"El GFCI en exteriores es como un perro guardiÃ¡n que ladra por todo: rata, gato, sombra. Pero si ladra mucho, hay algo real. La humedad crea caminos de fuga que el GFCI detecta correctamente.",a_en:"Water is the usual suspect outdoors. Rain gets in the box, condenses in the conduit, or soaks into a damaged wire underground. The GFCI does its job â€” it detects the leak. Fix the moisture, fix the problem."},
{cat:"âš¡ GFCI",cat_en:"âš¡ GFCI",q:"Puedes instalar un GFCI en el primer tomacorriente de un circuito para proteger todos los demÃ¡s. Esto se llama:",q_en:"You can install a GFCI at the first outlet of a circuit to protect all downstream outlets. This is called:",o:["ProtecciÃ³n maestra â€” pero no cumple cÃ³digo","ProtecciÃ³n en cascada â€” conectando los demÃ¡s al terminal LOAD","ProtecciÃ³n dedicada â€” cada tomacorriente necesita su propio GFCI","ProtecciÃ³n simple â€” solo protege ese tomacorriente"],o_en:["Series protection â€” but only with the same brand","Feed-through protection â€” using the LOAD terminals","Parallel protection â€” all outlets must be GFCI","This is not possible â€” each outlet needs its own GFCI"],c:1,e:"Conectando los demÃ¡s tomacorrientes al terminal LOAD del primer GFCI, todos quedan protegidos. Se etiquetan \"GFCI Protected\".",e_en:"Using the LOAD terminals of the first GFCI protects all downstream outlets. Cost-effective way to protect an entire circuit.",a:"El GFCI tiene dos lados: LINE (entrada) y LOAD (salida). Todo lo que conectes al LOAD queda protegido. Es como poner un guardia en la entrada del edificio: protege a todos los que estÃ¡n adentro.",a_en:"The first GFCI is like a security guard at the entrance â€” everyone who enters after that point is protected. Wire the downstream outlets to the LOAD side and they all get protection from one GFCI."},
// ===== ARC FAULT BREAKERS (4) =====
{cat:"ðŸ”¥ Arc Fault (AFCI)",cat_en:"ðŸ”¥ Arc Fault (AFCI)",q:"Un AFCI detecta algo que un breaker normal y un GFCI NO pueden detectar:",q_en:"An AFCI detects something that a regular breaker and GFCI CANNOT detect:",o:["Sobrecarga por exceso de equipos conectados","Arcos elÃ©ctricos peligrosos como cables daÃ±ados chispeando","Voltaje incorrecto en el circuito","Corriente DC en un circuito de AC"],o_en:["Overloads","Ground faults","Arcing â€” sparking from damaged or loose wires","Voltage surges"],c:1,e:"AFCI detecta patrones de arco (chispeo) que pueden iniciar incendios. Ni el breaker normal ni el GFCI detectan esto.",e_en:"AFCI detects arc faults: dangerous sparking from damaged wires, loose connections, or pinched cables that can start fires.",a:"Un cable pelado dentro de la pared puede chispear sin causar cortocircuito ni fuga a tierra. El breaker normal no lo ve, el GFCI tampoco. Pero el AFCI escucha ese chisporroteo elÃ©ctrico y desconecta antes del incendio.",a_en:"A nail through a wire in the wall creates tiny sparks (arcs). A regular breaker doesn't notice, a GFCI doesn't care â€” but an AFCI hears those sparks and shuts down before your wall catches fire."},
{cat:"ðŸ”¥ Arc Fault (AFCI)",cat_en:"ðŸ”¥ Arc Fault (AFCI)",q:"Â¿Puede un AFCI causar disparos en falso (nuisance tripping)?",q_en:"Can an AFCI cause nuisance tripping (false trips)?",o:["No â€” los AFCI modernos son 100% precisos","SÃ­ â€” ciertos equipos con motores de escobillas o arcos normales pueden dispararlo","Solo si estÃ¡ mal instalado","Solo con equipos de mÃ¡s de 15 amperios"],o_en:["Never â€” AFCI technology is perfect","Yes â€” some appliances with motors or electronics can cause false trips","Only if installed incorrectly","Only with LED lighting"],c:1,e:"Aspiradoras, taladros, y otros equipos con motores de escobillas generan pequeÃ±os arcos normales que pueden confundir al AFCI.",e_en:"Some devices like vacuum cleaners, treadmills, or cheap electronics can generate signals that mimic arcing, causing nuisance trips.",a:"Un AFCI es como un detector de humo ultra sensible: a veces se activa con el vapor de la ducha o el humo de cocinar. No es falla, es que es muy sensible. Los motores de escobillas generan chispitas normales que el AFCI a veces confunde.",a_en:"Some motors and electronics make electrical noise that sounds like arcing to the AFCI. It's like a smoke detector going off when you cook â€” annoying but the detector is doing its job. Use quality AFCI breakers to reduce false trips."},
{cat:"ðŸ”¥ Arc Fault (AFCI)",cat_en:"ðŸ”¥ Arc Fault (AFCI)",q:"Un breaker Dual-Function (AFCI/GFCI) combina protecciÃ³n contra:",q_en:"A Dual-Function (AFCI/GFCI) breaker combines protection against:",o:["Sobrecarga y cortocircuito solamente","Arcos elÃ©ctricos Y fugas de corriente a tierra en un solo breaker","Solo arcos en circuitos de 240V","Solo protecciÃ³n GFCI con etiqueta AFCI"],o_en:["Overloads and short circuits only","Arc faults AND ground faults in one device","Surges and lightning","High and low voltage"],c:1,e:"Dual-Function = AFCI + GFCI en un solo breaker. Protege contra arcos peligrosos y fugas a tierra simultÃ¡neamente.",e_en:"Dual-function = AFCI + GFCI in one breaker. Protects against both arcing fires and ground fault electrocution.",a:"Es como tener guardia de seguridad y detector de incendios en uno solo. El AFCI cuida contra chispas peligrosas y el GFCI contra fugas que te pueden electrocutar. Dos protecciones, un solo breaker.",a_en:"It's the Swiss Army knife of breakers: detects dangerous arcs (fire prevention) AND ground faults (electrocution prevention) in one package. More expensive but covers both hazards."},
{cat:"ðŸ”¥ Arc Fault (AFCI)",cat_en:"ðŸ”¥ Arc Fault (AFCI)",q:"NEC 2020 requiere AFCI en circuitos de 120V en:",q_en:"NEC 2020 requires AFCI in 120V circuits in:",o:["Solo dormitorios de casas nuevas","PrÃ¡cticamente todas las Ã¡reas habitables: dormitorios, salas, comedores, cocinas, lavanderÃ­as","Solo Ã¡reas hÃºmedas como baÃ±os y cocinas","Circuitos comerciales de 20A o mÃ¡s"],o_en:["Only bedrooms","Kitchens, laundry, bedrooms, living rooms, hallways â€” virtually all habitable rooms","Only new construction","Only commercial buildings"],c:1,e:"NEC 2020 expandiÃ³ AFCI a casi toda la residencia excepto baÃ±os y garajes.",e_en:"NEC 2020 expanded AFCI requirements to kitchens, laundry rooms, and essentially all 120V habitable spaces.",a:"El NEC cada versiÃ³n exige mÃ¡s AFCI porque los incendios elÃ©ctricos por arcos son la causa #1 de incendios residenciales. Es como el cinturÃ³n de seguridad: antes era opcional, ahora es obligatorio en casi todo.",a_en:"The NEC keeps expanding AFCI requirements because electrical fires keep happening. Now almost every room in the house needs AFCI protection. The only common exceptions are bathrooms and garages (which get GFCI)."},
// ===== CIRCUITOS EN SERIE (4) =====
{cat:"ðŸ”— Circuitos en Serie",cat_en:"ðŸ”— Series Circuits",q:"En un circuito en serie con tres cargas, la CORRIENTE en cada carga es:",q_en:"In a series circuit with three loads, the CURRENT through each load is:",o:["Diferente en cada una â€” se divide proporcionalmente","Igual en todas â€” solo hay un camino para la corriente","Mayor en la primera carga porque llega primero","Depende del voltaje de cada carga"],o_en:["Different at each load â€” it divides","The same through all loads","Zero at the last load","Double at each subsequent load"],c:1,e:"En serie hay un solo camino. La misma corriente pasa por todas las cargas. Lo que cambia es el voltaje.",e_en:"In series, current is the SAME through all components. There's only one path for current to flow.",a:"Un circuito en serie es como un rÃ­o sin ramificaciones: toda el agua pasa por cada punto. 10A entran, 10A pasan por cada carga, 10A salen. Lo que se divide es el voltaje, no la corriente.",a_en:"Series is like a single-lane road â€” every car (electron) passes through every toll booth (load). The traffic (current) is the same at every point because there's only one path."},
{cat:"ðŸ”— Circuitos en Serie",cat_en:"ðŸ”— Series Circuits",q:"Si una de tres luces en serie se quema:",q_en:"If one of three lights in series burns out:",o:["Las otras dos siguen brillando igual","Las otras dos brillan mÃ¡s fuerte","Las tres se apagan â€” el circuito se abre","Las otras dos brillan mÃ¡s dÃ©bil"],o_en:["The other two stay on but dimmer","All three go out â€” the circuit is broken","The other two get brighter","Only the ones after the burned one go out"],c:2,e:"En serie, si una carga se abre, se rompe el Ãºnico camino de corriente y TODAS se apagan.",e_en:"In series, one open = entire circuit is open. No current flows to any load. That's why old Christmas lights all went dark when one bulb blew.",a:"Luces de navidad viejas: se quema un foquito y se apagan TODOS. Eso es serie. Por eso ahora las hacen en paralelo â€” se quema una y las demÃ¡s siguen.",a_en:"It's like a chain: if one link breaks, the whole chain is broken. Old Christmas lights were in series â€” one bad bulb and the whole string went dark. That's why series is rarely used for lighting anymore."},
{cat:"ðŸ”— Circuitos en Serie",cat_en:"ðŸ”— Series Circuits",q:"Un circuito en serie con una fuente de 120V y tres resistencias de 10Î©, 20Î© y 30Î©. Â¿CuÃ¡l tiene la mayor caÃ­da de voltaje?",q_en:"A series circuit with a 120V source and three resistors of 10Î©, 20Î©, and 30Î© has a total current of:",o:["La de 10Î© porque la corriente llega primero con mÃ¡s fuerza","La de 20Î© porque estÃ¡ en el medio","La de 30Î© porque la resistencia mÃ¡s grande consume mÃ¡s voltaje","Las tres tienen la misma caÃ­da de voltaje"],o_en:["120A","2A â€” I = V/Rtotal = 120/60","12A","60A"],c:2,e:"En serie, V = IR. La corriente es igual para todas: I = 120/60 = 2A. V30 = 2Ã—30 = 60V (la mayor).",e_en:"Rtotal = 10+20+30 = 60Î©. I = V/R = 120/60 = 2A. Same 2A flows through all three resistors.",a:"Es como tres peajes en la carretera: el mÃ¡s caro te quita mÃ¡s dinero. La resistencia de 30Î© se queda con 60V de los 120V disponibles. MÃ¡s resistencia = mÃ¡s caÃ­da de voltaje.",a_en:"Add them up: 10+20+30 = 60 ohms total. Then Ohm's Law: 120V Ã· 60Î© = 2 amps. That 2A flows through every resistor â€” that's the rule of series circuits."},
{cat:"ðŸ”— Circuitos en Serie",cat_en:"ðŸ”— Series Circuits",q:"Los safety switches (interruptores de seguridad) en HVAC estÃ¡n conectados en SERIE porque:",q_en:"Safety switches (safety controls) in HVAC are connected in SERIES with the control circuit because:",o:["En serie usan menos cable y es mÃ¡s econÃ³mico","Cualquier switch abierto interrumpe TODO el circuito de control","En serie cada switch controla una funciÃ³n diferente","No estÃ¡n en serie â€” estÃ¡n en paralelo"],o_en:["It's cheaper to wire in series","If ANY safety opens, it breaks the ENTIRE circuit and stops the equipment","They work better at higher voltage","Series gives them more power"],c:1,e:"Los safeties en serie significan que SI CUALQUIERA detecta un problema, TODO el circuito de control se desconecta.",e_en:"Series connection means ANY safety switch opening breaks the circuit. This ensures the equipment stops if any safety limit is reached.",a:"Los safeties en serie son como los candados de una cadena: si uno se abre, la cadena se rompe. High pressure, low pressure, flow switch â€” si CUALQUIERA detecta problema, el compresor se apaga. Eso es seguridad.",a_en:"Safeties in series are like security checkpoints: you must pass ALL of them to get through. If any one says stop, everything stops. High pressure, low pressure, rollout â€” if ANY trips, the system shuts down. That's the point."},
// ===== CIRCUITOS EN PARALELO (4) =====
{cat:"ðŸ”€ Circuitos en Paralelo",cat_en:"ðŸ”€ Parallel Circuits",q:"En un circuito en paralelo, el VOLTAJE en cada rama es:",q_en:"In a parallel circuit, the VOLTAGE across each branch is:",o:["Diferente en cada rama â€” se divide","Igual en todas las ramas â€” comparten la misma fuente","Mayor en la rama con menos resistencia","Cero en las ramas sin carga"],o_en:["Different â€” it divides between branches","The same across all branches","Zero in all but the first branch","Doubled in each subsequent branch"],c:1,e:"En paralelo, todas las ramas estÃ¡n conectadas directamente a la fuente. El voltaje es IGUAL en cada rama.",e_en:"In parallel, voltage is the SAME across all branches. Each branch sees the full source voltage.",a:"Las casas en tu calle estÃ¡n en paralelo: todas reciben 120V de la compaÃ±Ã­a elÃ©ctrica. Si tu vecino prende 10 focos, tu voltaje no baja. Todas las ramas ven el mismo voltaje.",a_en:"Parallel is like houses on a street: each house gets the full 120V from the power company. It doesn't matter if there are 2 houses or 200 â€” each one gets the same voltage."},
{cat:"ðŸ”€ Circuitos en Paralelo",cat_en:"ðŸ”€ Parallel Circuits",q:"Al AGREGAR una carga mÃ¡s en paralelo a un circuito, la corriente total:",q_en:"When ADDING another load in parallel to a circuit, the total current:",o:["Disminuye porque hay mÃ¡s resistencia","Aumenta â€” cada rama adicional consume mÃ¡s corriente de la fuente","No cambia porque el voltaje es constante","Se divide entre mÃ¡s cargas y cada una recibe menos"],o_en:["Decreases â€” more paths means less current","Increases â€” each new branch adds more current","Stays exactly the same","Becomes zero"],c:1,e:"MÃ¡s ramas en paralelo = mÃ¡s caminos para la corriente = mÃ¡s corriente total de la fuente.",e_en:"Each parallel branch draws its own current. Adding a branch adds more current from the source. Total current = sum of all branch currents.",a:"Es como abrir mÃ¡s llaves de agua en tu casa: cada llave jala agua de la calle. MÃ¡s llaves abiertas = mÃ¡s agua total consumida. MÃ¡s cargas en paralelo = mÃ¡s amperios totales.",a_en:"It's like opening more faucets in your house â€” each one draws more water from the main line. More parallel loads = more total current from the panel. That's why circuits have breakers â€” to limit how many faucets you open."},
{cat:"ðŸ”€ Circuitos en Paralelo",cat_en:"ðŸ”€ Parallel Circuits",q:"Dos resistencias de 100Î© en paralelo dan una resistencia total de:",q_en:"Two 100Î© resistors in parallel give a total resistance of:",o:["200 ohms â€” se suman como en serie","100 ohms â€” quedan igual","50 ohms â€” se divide entre dos","10,000 ohms â€” se multiplican"],o_en:["200Î© â€” they add up","100Î© â€” stays the same","50Î© â€” for equal resistors, divide by the count","10,000Î© â€” they multiply"],c:2,e:"Resistencias iguales en paralelo: RT = R/n = 100/2 = 50Î©. Siempre es MENOR que la menor individual.",e_en:"For equal resistors in parallel: Rtotal = R/n = 100/2 = 50Î©. Two parallel paths of 100Î© each = 50Î© total.",a:"Dos puertas abiertas dejan pasar mÃ¡s gente que una sola. La resistencia total en paralelo SIEMPRE es menor que cualquier resistencia individual. Es el atajo: mÃ¡s caminos = menos resistencia total.",a_en:"Two equal resistors in parallel = half the resistance. Like opening a second identical lane on a highway â€” total traffic capacity doubles, which means resistance to flow cuts in half."},
{cat:"ðŸ”€ Circuitos en Paralelo",cat_en:"ðŸ”€ Parallel Circuits",q:"En un panel elÃ©ctrico residencial, los circuitos de la casa estÃ¡n conectados en:",q_en:"In a residential electrical panel, the house circuits are connected in:",o:["Serie â€” todos salen del mismo breaker principal","Paralelo â€” cada circuito tiene su propio breaker","Mixto â€” algunos en serie y otros en paralelo","Depende del diseÃ±o del electricista"],o_en:["Series â€” one after another","Parallel â€” each circuit has its own breaker and path","A mix â€” half series, half parallel","It depends on the electrician"],c:1,e:"Cada circuito de la casa estÃ¡ en paralelo con los demÃ¡s, con su propio breaker. Por eso apagar uno no apaga los demÃ¡s.",e_en:"All house circuits are in parallel from the panel. Each breaker feeds an independent circuit with full voltage.",a:"Tu casa es como un centro comercial: cada tienda tiene su propia puerta (breaker). Si una tienda cierra, las demÃ¡s siguen abiertas. Eso es paralelo. Si fuera serie, apagar la cocina apagarÃ­a toda la casa.",a_en:"Every circuit in your house gets its own breaker and its own path to the panel â€” that's parallel. If they were in series, turning off the kitchen lights would kill the bedroom too. Parallel = independence."},
// ===== CIRCUITO MIXTO (3) =====
{cat:"ðŸ”„ Circuito Mixto",cat_en:"ðŸ”„ Mixed Circuits",q:"Un circuito mixto tiene dos resistencias en serie (R1=10Î©, R2=20Î©) seguidas de una resistencia en paralelo (R3=30Î©) con R2. La resistencia total es:",q_en:"A mixed circuit has two resistors in series (R1=10Î©, R2=20Î©) followed by a third in parallel (R3=30Î©). With 120V applied, first you calculate:",o:["60 ohms â€” suma de las tres","22 ohms â€” R1 en serie con el paralelo de R2 y R3","10 ohms â€” solo cuenta la primera","40 ohms â€” promedio de las tres"],o_en:["Total current directly using 120V","The series combination first: 10+20=30Î©, then parallel with 30Î© = 15Î© total","Each resistor individually","The parallel section first, then add series"],c:1,e:"Primero: R2||R3 = (20Ã—30)/(20+30) = 600/50 = 12Î©. Luego: RT = R1 + 12 = 10 + 12 = 22Î©.",e_en:"Step 1: Series group = 10+20 = 30Î©. Step 2: 30Î© parallel with 30Î© = 15Î© total. Step 3: I = 120/15 = 8A.",a:"Resuelve de adentro hacia afuera, como las matemÃ¡ticas con parÃ©ntesis. Primero resuelves el paralelo: R2 y R3 = 12Î©. Luego sumas lo que estÃ¡ en serie: 10 + 12 = 22Î©.",a_en:"Mixed circuits are like a math problem: solve the inner parentheses first. Group the series resistors (10+20=30), then combine that group with the parallel one (30||30=15). Then use Ohm's Law."},
{cat:"ðŸ”„ Circuito Mixto",cat_en:"ðŸ”„ Mixed Circuits",q:"En un circuito mixto, para encontrar la corriente total PRIMERO debes:",q_en:"In a mixed circuit, to find total current you FIRST must:",o:["Medir con la pinza amperimÃ©trica directamente","Calcular la resistencia total equivalente del circuito","Sumar todos los voltajes de cada componente","Dividir el voltaje entre el nÃºmero de componentes"],o_en:["Measure it with a clamp meter â€” calculation isn't possible","Find total equivalent resistance by simplifying series and parallel groups","Add all individual currents","Divide source voltage by the number of resistors"],c:1,e:"Paso 1: Simplifica el circuito calculando RT. Paso 2: I = V/RT. Sin RT no puedes calcular nada.",e_en:"Simplify step by step: combine series groups, then parallel groups, until you have one total resistance. Then I = V/Rtotal.",a:"Es como armar un rompecabezas: primero necesitas la imagen completa (RT), luego puedes ver cada pieza. Simplifica el circuito primero, luego aplica Ohm.",a_en:"It's like simplifying a fraction: break it into steps. First, add series resistors together. Then combine parallel groups. Keep simplifying until you have one number. Then Ohm's Law gives you the current."},
{cat:"ðŸ”„ Circuito Mixto",cat_en:"ðŸ”„ Mixed Circuits",q:"Un circuito de control de HVAC tÃ­picamente tiene los safeties en serie y las cargas de seÃ±alizaciÃ³n en:",q_en:"A typical HVAC control circuit has safeties in series and loads in parallel because:",o:["TambiÃ©n en serie â€” todo debe estar en serie","Paralelo â€” las luces indicadoras no deben afectar el circuito de control","Mixto pero al azar segÃºn el instalador","En un circuito completamente separado sin relaciÃ³n"],o_en:["It's the only way it works electrically","Series safeties ensure ANY fault stops the system; parallel loads allow independent operation","It saves wire","The thermostat requires this configuration"],c:1,e:"Safeties en serie para que cualquiera pueda interrumpir. Indicadores en paralelo para que no afecten la operaciÃ³n.",e_en:"Safeties in series = any fault stops everything (safety). Loads in parallel = each operates independently (functionality). Best of both worlds.",a:"Los safeties son como guardias en la puerta: si uno dice no, nadie pasa (serie). Las luces indicadoras son como cÃ¡maras de seguridad: observan sin bloquear el paso (paralelo). Cada uno tiene su funciÃ³n.",a_en:"The safeties are like security guards in a single hallway â€” everyone must pass all of them. The loads are like rooms off a main hall â€” each room works independently. Together, it's safe AND functional."},
// ===== CONTACTORES (5) =====
{cat:"ðŸ“¦ Contactores",cat_en:"ðŸ“¦ Contactors",q:"Un contactor tiene terminales marcados L1, L2, T1, T2. Los cables de alimentaciÃ³n van en:",q_en:"A contactor has terminals marked L1, L2, T1, T2. The power supply cables connect to:",o:["T1 y T2 â€” porque T es de transformador (fuente)","L1 y L2 â€” lÃ­nea de alimentaciÃ³n entra por L","No importa â€” es reversible","L1 y T1 del mismo lado"],o_en:["T1 and T2 â€” T stands for transformer","L1 and L2 â€” L stands for Line (power input)","It doesn't matter â€” both sides are the same","L1 and T1 on the same side"],c:1,e:"L = Line (lÃ­nea de entrada). T = Terminal/Load (carga/motor). La alimentaciÃ³n SIEMPRE entra por L.",e_en:"L = Line (power in), T = Terminal/Load (power out to motor). Power supply goes to L, motor goes to T.",a:"L de LÃ­nea = de donde viene la energÃ­a. T de Terminal = a donde va la energÃ­a. Es como la entrada y salida de una autopista: L es la entrada, T es la salida hacia el motor.",a_en:"L = Line = where power comes IN. T = Terminal = where power goes OUT to the load. It's like a door: L is the entrance, T is the exit. Power flows through from L to T when the contactor closes."},
{cat:"ðŸ“¦ Contactores",cat_en:"ðŸ“¦ Contactors",q:"La bobina de un contactor de 24VAC mide 20 ohms de resistencia. Si le aplicas 240VAC por error:",q_en:"The coil of a 24VAC contactor measures 20 ohms resistance. If you apply 24V to it, it draws:",o:["Funciona normal â€” los contactores tienen protecciÃ³n interna","La bobina se quemarÃ¡ por exceso de corriente","El contactor trabaja mejor con mÃ¡s voltaje","Solo consume mÃ¡s corriente pero no se daÃ±a"],o_en:["480A â€” way too much","1.2A â€” I = V/R = 24/20","0.83A","20A"],c:1,e:"I = V/R = 240/20 = 12A. La bobina diseÃ±ada para 24V/20Î© consume solo 1.2A. Con 240V consume 10 veces mÃ¡s y se destruye.",e_en:"I = V/R = 24V/20Î© = 1.2A. This is normal coil current for a 24VAC contactor.",a:"Es como meter 240V a un foco de 24V: explota instantÃ¡neamente. La bobina de 24V espera 1.2A. Si le metes 240V consume 12A y se convierte en humo en segundos.",a_en:"Simple Ohm's Law: 24 Ã· 20 = 1.2 amps. That's what the coil draws to create the magnetic field. If you measure more, the coil is shorted. If less, the connection is bad."},
{cat:"ðŸ“¦ Contactores",cat_en:"ðŸ“¦ Contactors",q:"Los contactos de un contactor estÃ¡n picados y quemados. La consecuencia MÃS peligrosa es:",q_en:"The contacts of a contactor are pitted and burned. The MOST dangerous consequence is:",o:["Mayor consumo de energÃ­a solamente","CaÃ­da de voltaje en los contactos que puede daÃ±ar el motor","El contactor hace mÃ¡s ruido al cerrar","La bobina del contactor se sobrecalienta"],o_en:["The contactor looks ugly","High resistance causing voltage drop, overheating, and possible fire","The contactor gets louder","Nothing â€” pitting is cosmetic"],c:1,e:"Contactos quemados = mayor resistencia = caÃ­da de voltaje = motor recibe menos voltaje = se sobrecalienta y puede quemarse.",e_en:"Pitted contacts = high resistance = heat buildup = melted wires, damaged equipment, or fire. Replace immediately.",a:"Contactos picados son como un camino lleno de baches: el trÃ¡fico (corriente) pasa pero con dificultad. Esa dificultad es resistencia extra que roba voltaje al motor. Un motor con bajo voltaje se calienta y muere.",a_en:"Burnt contacts are like corroded battery terminals on a car â€” the connection gets worse over time. More resistance = more heat = eventually something melts or catches fire. Replace the contactor, don't just clean it."},
{cat:"ðŸ“¦ Contactores",cat_en:"ðŸ“¦ Contactors",q:"Un contactor zumba fuertemente cuando estÃ¡ energizado. La causa MÃS probable es:",q_en:"A contactor buzzes loudly when energized. The MOST probable cause is:",o:["Es normal â€” todos los contactores zumban","La bobina tiene un cortocircuito entre espiras","Las espiras de sombra (shading coils) estÃ¡n rotas","El voltaje de la bobina es muy alto"],o_en:["Normal for all contactors","A broken shading coil or the armature isn't seating fully","The coil voltage is too high","The motor is overloaded"],c:2,e:"Las shading coils suavizan la vibraciÃ³n AC. Si se rompen, la armadura vibra a 120Hz causando zumbido excesivo.",e_en:"Loud buzzing = shading coil broken (for AC contactors) or armature not fully closing. The shading coil prevents AC buzzing.",a:"Las shading coils son como los amortiguadores de un carro: sin ellos, sientes cada bache. En AC, la magnetizaciÃ³n sube y baja 120 veces por segundo. Sin shading coils, la armadura vibra y zumba como loca.",a_en:"AC contactors have a tiny copper ring called a shading coil that prevents the magnetic field from vibrating. If it breaks, the contactor buzzes like crazy. It's like the muffler on a car â€” without it, everything is loud."},
{cat:"ðŸ“¦ Contactores",cat_en:"ðŸ“¦ Contactors",q:"Para verificar si un contactor estÃ¡ cerrando correctamente, mides voltaje entre L1 y T1 con el contactor energizado. Si mides voltaje significativo:",q_en:"To verify if a contactor is closing properly, you measure voltage between L1 and T1 when energized. It should read:",o:["Es normal â€” siempre hay voltaje entre L y T","Los contactos NO estÃ¡n haciendo buen contacto â€” hay resistencia","El motor estÃ¡ desconectado del lado T","La bobina no tiene suficiente voltaje"],o_en:["Full line voltage â€” proving power passes through","0V or near 0V â€” closed contacts have no voltage drop","Half of line voltage","The coil voltage (24V)"],c:1,e:"Con el contactor cerrado, L1 y T1 son el mismo punto. Si mides voltaje entre ellos, hay caÃ­da = contactos malos.",e_en:"Good contacts = no resistance = no voltage drop = 0V across them. Voltage present means the contacts are not fully closing.",a:"Es como medir la temperatura del agua antes y despuÃ©s de un tubo: si hay diferencia, el tubo tiene una obstrucciÃ³n. Con el contactor cerrado, L1 y T1 deberÃ­an ser el mismo punto. Voltaje entre ellos = contactos resistivos.",a_en:"A closed contact is like a closed switch â€” electricity flows straight through with no resistance. If you measure voltage across a closed switch, something is wrong. 0V = good contact. Any voltage = bad contact."},
// ===== CONTROLADORES ELÃ‰CTRICOS HVAC (4) =====
{cat:"ðŸŽ›ï¸ Controles HVAC",cat_en:"ðŸŽ›ï¸ HVAC Controls",q:"Un relay de retardo de tiempo (time delay relay) en un sistema de AC se usa para:",q_en:"A time delay relay in an AC system is used to:",o:["Apagar el sistema si la temperatura es muy alta","Evitar que el compresor arranque inmediatamente despuÃ©s de apagarse","Controlar la velocidad del ventilador","Medir el consumo elÃ©ctrico del sistema"],o_en:["Speed up the cooling cycle","Prevent the compressor from short-cycling by delaying restart after shutdown","Increase compressor power","Reduce energy costs"],c:1,e:"El time delay protege el compresor esperando 5 minutos antes de permitir re-arranque, dejando que las presiones se igualen.",e_en:"Time delay prevents compressor short-cycling by enforcing a minimum off-time (usually 5 minutes) before allowing restart.",a:"El compresor necesita descanso entre arranques, como un corredor entre sprints. Arrancarlo contra presiÃ³n alta es como arrancar tu carro sin soltar el freno. El time delay le da 5 minutos para que las presiones se igualen.",a_en:"If you turn a car off and immediately try to restart it repeatedly, you damage the starter. The time delay relay forces the compressor to wait 5 minutes before restarting â€” protecting it from rapid on-off damage."},
{cat:"ðŸŽ›ï¸ Controles HVAC",cat_en:"ðŸŽ›ï¸ HVAC Controls",q:"El transformer de un sistema HVAC convierte:",q_en:"The transformer in an HVAC system converts:",o:["240VAC a 24VDC para el termostato","240VAC a 24VAC para el circuito de control","24VAC a 240VAC para alimentar el compresor","120VDC a 24VDC para los sensores"],o_en:["24V to 240V for the compressor","240V (or 120V) to 24VAC for the control circuit","AC to DC for the thermostat","High pressure to low pressure"],c:1,e:"El transformador baja 240VAC (o 120VAC) a 24VAC para alimentar el circuito de control (termostato, relÃ©s, vÃ¡lvulas).",e_en:"The transformer steps down line voltage (240V or 120V) to 24VAC to safely power the thermostat and control circuit.",a:"El transformer es como un traductor: convierte voltaje alto (240V) a voltaje bajo (24V) para que el termostato y los controles puedan hablar con seguridad. Sin Ã©l, el termostato necesitarÃ­a manejar 240V peligrosos.",a_en:"It's like a water pressure reducer: the high pressure main line (240V) gets stepped down to a safe pressure (24V) for the delicate control faucets (thermostat, relays, safeties)."},
{cat:"ðŸŽ›ï¸ Controles HVAC",cat_en:"ðŸŽ›ï¸ HVAC Controls",q:"En un diagrama de cableado HVAC, la letra \"Y\" tÃ­picamente representa:",q_en:"In an HVAC wiring diagram, the letter \"Y\" typically represents:",o:["El cable amarillo que va al ventilador","La seÃ±al de demanda de enfriamiento (compressor contactor)","La seÃ±al de respaldo (Y de Yield)","El sensor de temperatura del aire"],o_en:["The yellow wire","The compressor/cooling contactor circuit","The heating circuit","The blower motor"],c:1,e:"Y = compressor/cooling contactor. R = power. W = heat. G = fan. O/B = reversing valve.",e_en:"Y = Cooling (compressor). R = Power. G = Fan. W = Heat. These are standard thermostat terminal designations.",a:"Memoriza el cÃ³digo de colores HVAC: R=Rojo=Power, Y=Amarillo=Cooling, W=Blanco=Heat, G=Verde=Fan. La Y activa el contactor del compresor cuando el termostato pide frÃ­o.",a_en:"Y = Yellow = Cooling. W = White = Heat. G = Green = Fan. R = Red = Power. O/B = Reversing valve. Once you memorize these letters, you can read any HVAC wiring diagram."},
{cat:"ðŸŽ›ï¸ Controles HVAC",cat_en:"ðŸŽ›ï¸ HVAC Controls",q:"Si el fusible del circuito de control de 24V se quema repetidamente, la causa MÃS probable es:",q_en:"If the 24V control circuit fuse blows repeatedly, the MOST common cause is:",o:["El transformer es de mala calidad","Hay un cortocircuito en el circuito de 24V â€” cable pelado o componente daÃ±ado","El termostato consume demasiada corriente","El fusible es de amperaje muy bajo para el sistema"],o_en:["The transformer is too small","A short circuit in the thermostat wiring â€” often a pinched or rubbed-through wire","The thermostat is too powerful","The fuse is the wrong size"],c:1,e:"Fusible de control que se quema repetidamente = cortocircuito en el circuito de 24V. Busca cables pelados, rozando metal.",e_en:"Repeated fuse blowing = short in the low voltage wiring. Often caused by a wire rubbing against sheet metal or a pinched wire in the conduit.",a:"Un fusible que se quema es un sÃ­ntoma, no la enfermedad. Es como un doctor que solo te da aspirina sin buscarte la causa de la fiebre. Busca el cable pelado, la bobina quemada, o el corto en el termostato.",a_en:"Low voltage wires are thin and fragile. They run through sheet metal cabinets with sharp edges. One nick through the insulation and the wire shorts to the cabinet. Check every inch of thermostat wire â€” especially near sharp edges."},
// ===== MOTORES (6) =====
{cat:"âš™ï¸ Motores",cat_en:"âš™ï¸ Motors",q:"Un motor monofÃ¡sico PSC (Permanent Split Capacitor) usa:",q_en:"A single-phase PSC (Permanent Split Capacitor) motor uses:",o:["Solo capacitor de arranque que se desconecta","Solo capacitor de marcha (run) que queda conectado permanentemente","Ambos: arranque y marcha","NingÃºn capacitor â€” usa polos sombreados"],o_en:["A start capacitor that disconnects","A run capacitor that stays connected at all times","Both start and run capacitors","No capacitors at all"],c:1,e:"PSC = Permanent Split Capacitor. Solo usa capacitor de RUN permanentemente conectado. No tiene start cap ni relay.",e_en:"PSC motors use only a run capacitor permanently in the circuit. No start capacitor, no centrifugal switch. Simple and reliable.",a:"PSC es el motor mÃ¡s simple con capacitor: un solo capacitor de marcha conectado siempre. No necesita relay ni switch centrÃ­fugo porque el capacitor nunca se desconecta. Es como un carro automÃ¡tico â€” simple y confiable.",a_en:"PSC = Permanent Split Capacitor. The 'permanent' tells you: the cap stays connected all the time. No switching, no relay needed. Simple but less starting torque than a CSIR motor."},
{cat:"âš™ï¸ Motores",cat_en:"âš™ï¸ Motors",q:"La placa de datos de un motor dice FLA 12A y LRA 72A. LRA significa:",q_en:"A motor nameplate says FLA 12A and LRA 72A. LRA means:",o:["Low Running Amperage â€” la corriente mÃ­nima de operaciÃ³n","Locked Rotor Amperage â€” corriente mÃ¡xima al arrancar","Line Regulated Amperage â€” la corriente con voltaje estable","Load Rated Amperage â€” la capacidad mÃ¡xima continua"],o_en:["Low Running Amps â€” minimum consumption","Locked Rotor Amps â€” maximum startup current","Line Rated Amps â€” maximum line current","Load Resistance Amps â€” under full load"],c:1,e:"LRA = Locked Rotor Amps. Es la corriente mÃ¡xima al arrancar cuando el rotor aÃºn no gira. Puede ser 5-7x el FLA.",e_en:"LRA = Locked Rotor Amps = the maximum current the motor draws at startup when the rotor isn't spinning yet. Usually 5-8Ã— FLA.",a:"Cuando arrancas un motor es como empujar un carro estacionado: necesitas MUCHA fuerza al principio. LRA es esa fuerza mÃ¡xima inicial. Una vez que el motor gira, baja a FLA â€” como cuando el carro ya se mueve solo.",a_en:"LRA is like pushing a car that's stopped: it takes maximum effort at first (72A) but once it's rolling (running), much less effort is needed (12A). That's why lights dim briefly when the compressor kicks on."},
{cat:"âš™ï¸ Motores",cat_en:"âš™ï¸ Motors",q:"Un motor de 5HP trifÃ¡sico tiene FLA de 15A por fase. El breaker segÃºn NEC 430.52 debe ser mÃ¡ximo:",q_en:"A 5HP three-phase motor has FLA of 15A per phase. The breaker per NEC 430.52 should be maximum:",o:["15A â€” exacto al FLA","20A â€” 125% del FLA como dice NEC 210.20","40A â€” 250% del FLA para arranque","60A â€” 400% del FLA para motores trifÃ¡sicos"],o_en:["15A â€” match the FLA exactly","30A â€” double the FLA","45A â€” 250% of FLA for standard breakers","100A â€” to avoid nuisance trips"],c:2,e:"NEC 430.52 permite breaker de hasta 250% del FLA para motores con protecciÃ³n estÃ¡ndar. 15 Ã— 2.5 = 37.5, sube al siguiente estÃ¡ndar = 40A.",e_en:"NEC 430.52: For standard inverse-time breakers, max = 250% of FLA. 15A Ã— 2.5 = 37.5A, round up to 40A. But 45A is the closest option at 300% which some motor types allow.",a:"Los motores necesitan breakers mÃ¡s grandes que su FLA por la corriente de arranque (LRA). Si pones un breaker de 15A, se dispara cada vez que arranca. 250% del FLA da espacio para el arranque sin dejar el cable desprotegido.",a_en:"Motors need oversized breakers because startup current (LRA) is much higher than running current (FLA). NEC allows up to 250% of FLA for standard breakers. 15 Ã— 2.5 = 37.5A. The breaker protects the wire, not the motor â€” overloads protect the motor."},
{cat:"âš™ï¸ Motores",cat_en:"âš™ï¸ Motors",q:"Un motor trifÃ¡sico funciona pero una de las tres fases se cae (single phasing). Â¿QuÃ© le pasa al motor?",q_en:"A three-phase motor runs but one of the three phases drops out (single phasing). What happens?",o:["Se detiene inmediatamente y el breaker se dispara","Sigue funcionando pero consume MÃS corriente en las dos fases restantes y se sobrecalienta","Funciona normal con dos fases â€” la tercera es de respaldo","Se invierte la rotaciÃ³n automÃ¡ticamente"],o_en:["The motor stops immediately","The motor continues running but draws excessive current on the remaining phases and overheats","Nothing changes â€” two phases are enough","The motor speeds up"],c:1,e:"Single phasing es peligroso: el motor sigue pero las fases restantes cargan la corriente extra, sobrecalentÃ¡ndose rÃ¡pidamente.",e_en:"Single phasing: motor keeps running on 2 phases but current increases dramatically, causing dangerous overheating and potential winding failure.",a:"Es como un equipo de tres personas cargando un piano: si una se cae, las otras dos cargan el peso extra. No se caen inmediatamente, pero se cansan MUCHO mÃ¡s rÃ¡pido. El motor se quema si no lo proteges.",a_en:"Imagine a three-legged stool losing one leg â€” it can still stand but it's wobbly and stressed. The motor on two phases works harder, draws more amps on the remaining legs, and overheats. It's a motor killer."},
{cat:"âš™ï¸ Motores",cat_en:"âš™ï¸ Motors",q:"Un motor ECM (Electronically Commutated Motor) es mÃ¡s eficiente porque:",q_en:"An ECM (Electronically Commutated Motor) is more efficient because:",o:["Usa corriente directa DC y controla la velocidad electrÃ³nicamente","Es mÃ¡s grande y tiene mÃ¡s cobre","Opera a velocidad fija optimizada de fÃ¡brica","No usa capacitores y eso reduce pÃ©rdidas"],o_en:["It runs faster","It adjusts speed electronically to match the exact demand","It uses more copper in the windings","It runs on higher voltage"],c:0,e:"ECM convierte AC a DC internamente y usa electrÃ³nica para controlar velocidad, alcanzando eficiencias sobre 80%.",e_en:"ECMs are brushless DC motors with variable speed control. They ramp up and down to match airflow needs, saving significant energy.",a:"Un ECM es como un carro hÃ­brido: usa tecnologÃ­a inteligente para ser mÃ¡s eficiente. En vez de desperdiciar energÃ­a como un motor PSC (que es como un carro viejo), el ECM ajusta su velocidad exactamente a lo que necesita.",a_en:"An ECM is like cruise control vs slamming the gas pedal: it smoothly adjusts to exactly what's needed. A PSC motor is either full blast or off. ECMs save 50-80% on blower energy."},
{cat:"âš™ï¸ Motores",cat_en:"âš™ï¸ Motors",q:"Las tres terminales de un compresor hermÃ©tico monofÃ¡sico se identifican como C, S y R. La resistencia MAYOR se mide entre:",q_en:"The three terminals of a hermetic single-phase compressor are identified as C, S, and R. To identify them:",o:["C y R â€” Common a Run","C y S â€” Common a Start","S y R â€” Start a Run","Todas las mediciones deben ser iguales"],o_en:["They're always labeled on the compressor","Measure resistance: C-S is highest, C-R is medium, S-R is lowest","Measure resistance: C-S is lowest, C-R is highest, S-R is medium","Color-coded wires tell you which is which"],c:2,e:"S a R = mayor resistencia (es la suma de los dos devanados en serie). C a S > C a R. Run = menor resistencia.",e_en:"C=Common, S=Start, R=Run. C-S has highest resistance (both windings in series). S-R is lowest. C-R is medium.",a:"C es el punto medio (Common). S es Start, R es Run. De S a R pasas por ambos devanados sumados = mayor resistencia. Es como ir de tu casa al trabajo por el camino largo: pasas por ambos barrios.",a_en:"CSR trick: the two HIGHEST resistance pins are S and R (the outer ones). The third pin is C (common). Then: C to S > C to R > S to R. Remember: the highest reading is across both windings (C to S)."},
// ===== ARRANCADORES (4) =====
{cat:"ðŸš€ Arrancadores",cat_en:"ðŸš€ Motor Starters",q:"Un arrancador magnÃ©tico se diferencia de un contactor porque incluye:",q_en:"A magnetic starter differs from a contactor because it includes:",o:["Una bobina mÃ¡s grande para mayor magnetismo","ProtecciÃ³n de sobrecarga (overload relay) integrada","Un capacitor de arranque interno","ProtecciÃ³n de bajo voltaje automÃ¡tica"],o_en:["A bigger coil","Built-in overload protection (overload relays)","A time delay circuit","Voltage regulation"],c:1,e:"Arrancador = Contactor + Overload relay. El contactor solo cierra contactos; el arrancador ademÃ¡s protege contra sobrecarga.",e_en:"A magnetic starter = contactor + overload relay. The overload protects the motor from sustained overcurrent.",a:"Un contactor es como un switch gigante. Un arrancador es ese switch gigante CON guardia de seguridad (overload). El guardia vigila que el motor no se sobrecargue y lo desconecta si consume demasiada corriente.",a_en:"A contactor is just a switch. A starter is a switch WITH a bodyguard (overload relay). The overload watches the motor's amps and shuts things down if the motor is working too hard for too long."},
{cat:"ðŸš€ Arrancadores",cat_en:"ðŸš€ Motor Starters",q:"Un arrancador estrella-delta (star-delta) se usa para:",q_en:"A star-delta (wye-delta) starter is used to:",o:["Invertir la rotaciÃ³n del motor","Reducir la corriente de arranque conectando primero en estrella y luego en delta","Aumentar la velocidad del motor gradualmente","Proteger contra caÃ­da de voltaje en el arranque"],o_en:["Reverse motor direction","Reduce starting current by starting in star (lower voltage) then switching to delta (full voltage)","Increase motor speed","Convert single-phase to three-phase"],c:1,e:"En estrella, el motor ve voltaje/âˆš3 = menos corriente de arranque. Al alcanzar velocidad, cambia a delta para potencia total.",e_en:"Star-delta starting reduces inrush current to about 1/3 by starting at reduced voltage (star) then switching to full voltage (delta) once running.",a:"Estrella-delta es como arrancar un carro en primera velocidad: arrancas suave (estrella = menos voltaje), y cuando agarras velocidad, cambias a segunda (delta = potencia completa). Reduces el jalÃ³n inicial.",a_en:"It's like starting a car in first gear (star = low power) then shifting to third (delta = full power) once you're moving. Less strain at startup, same full power once running."},
{cat:"ðŸš€ Arrancadores",cat_en:"ðŸš€ Motor Starters",q:"El overload relay de un arrancador se disparÃ³. Para resetear PRIMERO debes:",q_en:"The overload relay on a starter tripped. To reset, FIRST you should:",o:["Presionar el botÃ³n de reset inmediatamente","Investigar POR QUÃ‰ se disparÃ³ antes de resetear","Reemplazar el elemento tÃ©rmico del overload","Subir el ajuste del overload al siguiente nivel"],o_en:["Press the reset button immediately and restart","Find WHY the overload tripped, fix the cause, then reset","Replace the overload relay","Bypass it temporarily to keep production running"],c:1,e:"Un overload que dispara tiene una razÃ³n. Resetearlo sin investigar puede causar daÃ±o permanente al motor.",e_en:"ALWAYS find the cause before resetting. Could be: locked rotor, single phasing, low voltage, bearing failure, or overloaded equipment.",a:"El overload es como el mÃ©dico que te dice \"algo anda mal\". Si ignoras al doctor y sigues trabajando, te pones peor. Investiga la causa: motor trabado, rodamiento daÃ±ado, baja tensiÃ³n, sobrecarga mecÃ¡nica.",a_en:"The overload tripped for a reason â€” it's protecting the motor from burning up. Resetting without investigating is like ignoring a check engine light. Find the problem first, THEN reset."},
{cat:"ðŸš€ Arrancadores",cat_en:"ðŸš€ Motor Starters",q:"Un soft starter electrÃ³nico reduce la corriente de arranque:",q_en:"An electronic soft starter reduces starting current by:",o:["Bajando la frecuencia gradualmente","Reduciendo el voltaje gradualmente con SCRs/tiristores","Conectando resistencias en serie temporalmente","Desconectando una fase durante el arranque"],o_en:["Switching windings from star to delta","Gradually increasing voltage using SCRs/thyristors","Reducing motor speed permanently","Adding resistance to the circuit"],c:1,e:"El soft starter usa SCRs para incrementar gradualmente el voltaje al motor, limitando la corriente de arranque.",e_en:"Soft starters use SCRs to gradually ramp up voltage from 0 to full over a set time, limiting inrush current smoothly.",a:"Un soft starter es como un dimmer de luz para el motor: empieza bajito y va subiendo gradualmente hasta potencia total. Eso evita el golpe de arranque que estresa cables, contactos y el motor mismo.",a_en:"A soft starter is like a dimmer switch for a motor: it smoothly ramps up from zero to full power instead of slamming on all at once. Easier on the motor, the electrical system, and your lights won't dim."},
// ===== VFD (4) =====
{cat:"ðŸŽšï¸ VFD",cat_en:"ðŸŽšï¸ VFD",q:"Un VFD (Variable Frequency Drive) controla la velocidad del motor cambiando:",q_en:"A VFD (Variable Frequency Drive) controls motor speed by changing:",o:["Solo el voltaje â€” la frecuencia se mantiene fija","Solo la frecuencia â€” el voltaje se mantiene fijo","Voltaje Y frecuencia proporcionalmente","La resistencia del circuito del motor"],o_en:["Only the voltage","Only the resistance in the circuit","Both the frequency AND voltage supplied to the motor","The number of motor poles"],c:2,e:"VFD cambia V y f juntos manteniendo la relaciÃ³n V/f constante para mantener el torque del motor.",e_en:"VFDs convert incoming AC to DC, then synthesize new AC at variable frequency and voltage. Speed = frequency Ã— 120 / poles.",a:"V/f es como las marchas de una bicicleta: cambias piÃ±Ã³n Y pedales juntos. Si solo cambias uno, pierdes fuerza o control. El VFD mantiene esa relaciÃ³n para que el motor tenga buena fuerza a cualquier velocidad.",a_en:"Motor speed depends on frequency: 60Hz = full speed, 30Hz = half speed. The VFD creates its own custom AC at whatever frequency you want. It's like having your own personal power plant that adjusts on demand."},
{cat:"ðŸŽšï¸ VFD",cat_en:"ðŸŽšï¸ VFD",q:"Un VFD NUNCA debe alimentar a un motor monofÃ¡sico estÃ¡ndar porque:",q_en:"A VFD should NEVER be used to power a standard single-phase motor because:",o:["La frecuencia variable daÃ±a los capacitores del motor monofÃ¡sico","El motor monofÃ¡sico no puede usar la salida trifÃ¡sica del VFD correctamente","El VFD no puede generar suficiente potencia para un motor monofÃ¡sico","Los motores monofÃ¡sicos no tienen rodamientos para velocidad variable"],o_en:["VFDs only work on 480V","VFDs output three-phase power â€” a single-phase motor can't handle it","Single-phase motors are too small","VFDs are too expensive for single-phase"],c:1,e:"VFDs producen salida trifÃ¡sica. Un motor monofÃ¡sico no puede convertir esa seÃ±al trifÃ¡sica en rotaciÃ³n adecuada.",e_en:"VFDs output three-phase power regardless of input. A standard single-phase motor is not designed to receive three-phase output and will be damaged.",a:"Es como tratar de escuchar una estaciÃ³n de FM en un radio de AM: la seÃ±al estÃ¡ ahÃ­ pero el radio no la puede procesar. El motor monofÃ¡sico necesita seÃ±al monofÃ¡sica, no la trifÃ¡sica que produce el VFD.",a_en:"A VFD speaks three-phase language. A single-phase motor only understands single-phase. It's like plugging a US appliance into a European outlet â€” wrong format, bad results. Use a VFD only with three-phase motors."},
{cat:"ðŸŽšï¸ VFD",cat_en:"ðŸŽšï¸ VFD",q:"Al instalar un VFD, es CRÃTICO usar cable blindado (shielded) al motor porque:",q_en:"When installing a VFD, it's CRITICAL to use shielded cable to the motor because:",o:["El cable blindado es mÃ¡s grueso y aguanta mÃ¡s corriente","El VFD genera armÃ³nicos y ruido elÃ©ctrico que interfiere con otros equipos","El blindaje protege contra sobrevoltaje del VFD","Es requerimiento estÃ©tico del fabricante"],o_en:["It looks more professional","VFDs create electrical noise (EMI) that can interfere with nearby electronics","Shielded cable carries more current","It's required for warranty only"],c:1,e:"La onda PWM del VFD crea interferencia electromagnÃ©tica (EMI) que puede afectar controles, radios y equipos cercanos.",e_en:"VFDs generate high-frequency electrical noise (EMI/RFI) that can interfere with sensitive equipment. Shielded cable contains this noise.",a:"La salida del VFD no es una onda limpia como la de la compaÃ±Ã­a elÃ©ctrica â€” es una onda cortada que genera \"ruido\" elÃ©ctrico. El cable blindado es como los audÃ­fonos con cancelaciÃ³n de ruido: contiene ese ruido para que no moleste a los demÃ¡s.",a_en:"A VFD chops up electricity at high speed, creating radio-frequency noise. Without shielded cable, it's like playing loud music â€” every electronic device nearby hears it and gets confused. The shield is the soundproofing."},
{cat:"ðŸŽšï¸ VFD",cat_en:"ðŸŽšï¸ VFD",q:"Si un VFD muestra error de \"ground fault\" o \"falla a tierra\", Â¿cuÃ¡l es la acciÃ³n correcta?",q_en:"If a VFD shows a \"ground fault\" error, the FIRST action is:",o:["Resetear el error y reiniciar â€” probablemente fue una falsa alarma","Revisar el aislamiento del motor y cables con un megÃ³hmetro","Subir el parÃ¡metro de sensibilidad de tierra en el VFD","Desconectar la tierra del motor para eliminar el error"],o_en:["Reset the drive and restart","Megger the motor windings and check cable insulation to ground","Replace the VFD","Increase the ground fault trip setting"],c:1,e:"Falla a tierra = corriente escapando del motor o cables. Hay que probar aislamiento con megÃ³hmetro ANTES de re-energizar.",e_en:"Ground fault = insulation breakdown. Megger the motor and cable. Could be damaged insulation, moisture, or a failing winding.",a:"Un error de tierra es como una fuga de agua: no la ignoras, no subes el termostato del calentador para compensar, y definitivamente no cierras el detector de fugas. Buscas DÃ“NDE se estÃ¡ escapando la corriente.",a_en:"A ground fault alarm is the VFD saying 'current is escaping to ground somewhere.' The Megger test checks insulation integrity. Find the leak before resetting, or you could damage the VFD permanently."},
// ===== TOMACORRIENTES / ILUMINACIÃ“N (4) =====
{cat:"ðŸ’¡ Tomacorrientes",cat_en:"ðŸ’¡ Receptacles",q:"Un tomacorriente NEMA 5-15R tiene tres ranuras. La ranura mÃ¡s larga es:",q_en:"A NEMA 5-15R outlet has three slots. The longer slot is:",o:["La lÃ­nea caliente (hot) para mayor contacto","El neutro â€” es mÃ¡s grande por seguridad","La tierra â€” para hacer mejor conexiÃ³n","La fase B en circuitos de 240V"],o_en:["Hot (live) â€” it carries the power","Neutral â€” wider slot identifies the grounded conductor","Ground â€” the safety connection","It varies by manufacturer"],c:1,e:"La ranura larga es el neutro, la corta es el hot, y la redonda es tierra. DiseÃ±ado asÃ­ para que los enchufes polarizados solo entren de una manera.",e_en:"The longer slot = neutral. Shorter slot = hot. D-shaped hole = ground. NEMA 5-15R is the standard 120V household outlet.",a:"Ranura larga = neutro, ranura corta = hot, hoyo redondo = tierra. La ranura larga es como la puerta grande del garaje: estÃ¡ diseÃ±ada asÃ­ para que no metas el carro (enchufe) al revÃ©s.",a_en:"Think of it as a face: two eyes and a mouth. The longer eye (left slot) is neutral, the shorter eye (right slot) is hot, and the round mouth at the bottom is ground. This is the most common outlet in America."},
{cat:"ðŸ’¡ Tomacorrientes",cat_en:"ðŸ’¡ Receptacles",q:"Un circuito de iluminaciÃ³n tiene 10 focos de 100W cada uno a 120V. La corriente total del circuito es:",q_en:"A lighting circuit has 10 bulbs of 100W each at 120V. The total current is:",o:["1,000A â€” 10 focos Ã— 100A","8.33A â€” 1000W Ã· 120V","12A â€” se necesita factor de seguridad","100A â€” cada foco consume 100A"],o_en:["1.2A","8.33A â€” I = total watts / voltage = 1000/120","120A","100A"],c:1,e:"Potencia total = 10 Ã— 100 = 1000W. I = P/V = 1000/120 = 8.33A.",e_en:"Total watts = 10 Ã— 100 = 1000W. I = P/V = 1000/120 = 8.33A.",a:"Watts totales dividido voltaje = amperios. 10 focos de 100W = 1000W totales. 1000 Ã· 120 = 8.33A. Este circuito cabe en un breaker de 15A. Pero recuerda el 80% continuo: 15 Ã— 0.8 = 12A mÃ¡ximo continuo.",a_en:"Add up all the watts: 10 Ã— 100 = 1000W. Then divide by voltage: 1000 Ã· 120 = 8.33 amps. This circuit fits on a 15A breaker with room to spare."},
{cat:"ðŸ’¡ Tomacorrientes",cat_en:"ðŸ’¡ Receptacles",q:"SegÃºn NEC, el nÃºmero MÃXIMO de tomacorrientes en un circuito residencial de 15A es:",q_en:"According to NEC, the MAXIMUM number of outlets on a 15A residential circuit is:",o:["Exactamente 8 â€” no mÃ¡s no menos","No hay un nÃºmero mÃ¡ximo especÃ­fico en el NEC residencial","MÃ¡ximo 10 tomacorrientes por circuito","Depende del calibre del cable solamente"],o_en:["5 outlets maximum","8 outlets maximum","NEC doesn't specify an exact number â€” it's based on calculated load","20 outlets minimum"],c:1,e:"El NEC residencial no especifica un mÃ¡ximo de tomacorrientes por circuito. Es la carga conectada la que determina si el circuito estÃ¡ sobrecargado.",e_en:"NEC doesn't set a specific number for residential outlets. However, convention suggests 8-10 per 15A circuit based on 180VA per outlet.",a:"Sorpresa: el NEC no dice cuÃ¡ntos tomacorrientes puedes poner en un circuito de casa. Pero el sentido comÃºn y las reglas de carga dicen que no abuses. En comercial SÃ hay reglas especÃ­ficas: 180VA por tomacorriente.",a_en:"Surprisingly, the NEC doesn't say 'maximum 8 outlets.' It's based on load calculations. But the industry standard is about 8-10 outlets per 15A circuit, assuming 1.5A (180VA) per outlet. More outlets = lower load each."},
{cat:"ðŸ’¡ Tomacorrientes",cat_en:"ðŸ’¡ Receptacles",q:"Un lumen mide:",q_en:"A lumen measures:",o:["La potencia elÃ©ctrica consumida por un foco","La cantidad de luz visible producida por una fuente","La temperatura del color de la luz","La vida Ãºtil del foco en horas"],o_en:["Electrical power consumed by a light","The total amount of visible light emitted by a source","The color temperature of the light","The lifespan of a bulb"],c:1,e:"Lumen = cantidad de luz visible. Watts = energÃ­a consumida. Lumen/watt = eficiencia lumÃ­nica.",e_en:"Lumens measure total light output. Watts measure energy consumed. More lumens per watt = more efficient light.",a:"Antes comprabas focos por watts (60W, 100W). Ahora con LED, los watts no te dicen quÃ© tan brillante es. 800 lÃºmenes = equivalente a un foco viejo de 60W. LÃºmenes miden LUZ, watts miden CONSUMO.",a_en:"Watts tells you what a bulb eats (energy). Lumens tells you what it gives back (light). A 10W LED gives 800 lumens â€” same as a 60W incandescent. Same light, 6Ã— less energy. Buy lumens, not watts."},
// ===== CAÃDA DE VOLTAJE / DESBALANCE (5) =====
{cat:"ðŸ“‰ CaÃ­da de Voltaje",cat_en:"ðŸ“‰ Voltage Drop",q:"La fÃ³rmula para calcular caÃ­da de voltaje en un circuito monofÃ¡sico es:",q_en:"The formula for calculating voltage drop in a single-phase circuit is:",o:["Vd = IR (ley de Ohm simple)","Vd = 2 Ã— K Ã— I Ã— D / CM (ida y vuelta del conductor)","Vd = V Ã— I Ã— cosÏ†","Vd = P / I (potencia sobre corriente)"],o_en:["Vd = IR (simple Ohm's Law)","Vd = 2 Ã— K Ã— I Ã— D / CM (round trip of conductor)","Vd = V Ã— I Ã— cosÏ†","Vd = P / I (power over current)"],c:1,e:"Vd = 2KILD/CM donde K=resistividad, I=corriente, D=distancia, CM=circular mils. El 2 es porque la corriente va y regresa.",e_en:"Vd = 2KILD/CM where K=resistivity, I=current, D=distance, CM=circular mils. The 2 is because current goes and returns.",a:"La corriente viaja por DOS cables: va por el hot y regresa por el neutro. Por eso el 2 en la fÃ³rmula: la distancia real que recorre la electricidad es el DOBLE de la distancia del panel al equipo.",a_en:"Current travels through TWO wires: goes through the hot and returns through the neutral. That's why the 2 in the formula: the real distance electricity travels is DOUBLE the distance from panel to equipment."},
{cat:"ðŸ“‰ CaÃ­da de Voltaje",cat_en:"ðŸ“‰ Voltage Drop",q:"Un compresor de 240V muestra 218V en sus terminales. El porcentaje de caÃ­da de voltaje es:",q_en:"A 240V compressor shows 218V at its terminals. The voltage drop percentage is:",o:["9.2% â€” esto es EXCESIVO y causarÃ¡ problemas","22V de caÃ­da â€” necesitas medir en porcentaje","218% â€” el voltaje es casi normal","Imposible calcular sin conocer la resistencia"],o_en:["218% â€” direct reading","9.2% â€” (240-218)/240 Ã— 100 â€” way too high","22% â€” 240-218","Impossible to calculate without amps"],c:0,e:"CaÃ­da = (240-218)/240 Ã— 100 = 9.17%. MÃ¡s del 5% total es excesivo segÃºn NEC.",e_en:"Voltage drop = (240-218)/240 Ã— 100 = 9.17%. NEC recommends max 3-5%. This is way too high â€” check wire size and connections.",a:"Si te prometen 240V y solo llegan 218V, perdiste 22V en el camino. Eso es 9.2% de pÃ©rdida. El NEC dice mÃ¡ximo 5%. Tu compresor estÃ¡ recibiendo voltaje bajo y puede sobrecalentarse y quemarse.",a_en:"22 volts lost out of 240 = 9.2% drop. That's like losing almost $10 out of every $100 before it reaches the machine. The compressor will overheat and fail. Check for undersized wire, loose connections, or long runs."},
{cat:"ðŸ“‰ CaÃ­da de Voltaje",cat_en:"ðŸ“‰ Voltage Drop",q:"El desbalance de voltaje en un sistema trifÃ¡sico se calcula como:",q_en:"Voltage imbalance in a three-phase system is calculated as:",o:["El voltaje mÃ¡s alto menos el mÃ¡s bajo, dividido entre tres","La mayor desviaciÃ³n del promedio, dividida entre el promedio, multiplicada por 100","La suma de los tres voltajes dividida entre tres","El voltaje entre la fase mÃ¡s alta y tierra"],o_en:["Average of all three voltages","Maximum deviation from average Ã· average Ã— 100","Highest voltage minus lowest voltage","Sum of all three voltages"],c:1,e:"%Desbalance = (Mayor desviaciÃ³n del promedio / Voltaje promedio) Ã— 100. MÃ¡ximo aceptable: 2% segÃºn NEMA.",e_en:"Voltage imbalance % = (max deviation from average voltage) / average voltage Ã— 100. Keep under 2%.",a:"Es como una mesa con tres patas: si una es mÃ¡s corta, la mesa cojea. Mides las tres patas, sacas el promedio, y ves cuÃ¡nto se desvÃ­a la peor. MÃ¡s de 2% de diferencia y el motor sufre.",a_en:"Find the average of all three voltages. Then find which voltage is farthest from the average. Divide that difference by the average and multiply by 100. Over 2% = trouble for motors."},
{cat:"ðŸ“‰ CaÃ­da de Voltaje",cat_en:"ðŸ“‰ Voltage Drop",q:"Un desbalance de voltaje del 3% en un motor trifÃ¡sico causa un desbalance de corriente de aproximadamente:",q_en:"A 3% voltage imbalance on a three-phase motor causes a current imbalance of approximately:",o:["3% â€” igual que el voltaje","6-9% â€” el desbalance de corriente es 2-3 veces el de voltaje","18-27% â€” se multiplica por 6-9 veces","0% â€” la corriente se auto-balancea"],o_en:["Also 3% â€” they're proportional","18-24% â€” current imbalance is 6-8 times the voltage imbalance","0% â€” current self-corrects","50% â€” half the voltage imbalance"],c:2,e:"El desbalance de corriente es 6-10 veces el desbalance de voltaje. 3% voltaje = 18-30% corriente. Â¡Extremadamente peligroso!",e_en:"Rule of thumb: current imbalance = 6-8Ã— voltage imbalance. So 3% voltage imbalance = 18-24% current imbalance. Very damaging to motors.",a:"Un pequeÃ±o desbalance de voltaje causa un ENORME desbalance de corriente. Es como un columpio: un empujoncito chueco al inicio se amplifica mucho al final. 3% de voltaje puede causar 27% de corriente desbalanceada. El motor se quema rÃ¡pido.",a_en:"This is the scary multiplier: a small 3% voltage imbalance becomes a HUGE 18-24% current imbalance. It's like a small crack in a dam â€” the pressure multiplies it into a big problem. That's why 2% voltage imbalance is the max."},
{cat:"ðŸ“‰ CaÃ­da de Voltaje",cat_en:"ðŸ“‰ Voltage Drop",q:"Para REDUCIR la caÃ­da de voltaje en un circuito largo, la soluciÃ³n mÃ¡s efectiva es:",q_en:"To REDUCE voltage drop in a long circuit, the most effective solution is:",o:["Aumentar el voltaje de la fuente","Usar un conductor de mayor calibre (mÃ¡s grueso)","Reducir el nÃºmero de cargas en el circuito","Agregar un capacitor al final del circuito"],o_en:["Increase the voltage at the source","Use a larger gauge (thicker) conductor","Add more outlets to distribute the load","Shorten the distance by rerouting"],c:1,e:"Cable mÃ¡s grueso = menor resistencia = menor caÃ­da. Es la soluciÃ³n mÃ¡s prÃ¡ctica y efectiva.",e_en:"Larger wire = less resistance per foot = less voltage drop. Going from #12 to #10 or #10 to #8 can solve most voltage drop issues.",a:"Un cable delgado para una distancia larga es como una pajita para tomar refresco: mucha distancia y poco diÃ¡metro = poca presiÃ³n al final. Un cable mÃ¡s gordo es como una manguera: la presiÃ³n (voltaje) llega mejor.",a_en:"Thicker wire = less resistance = less voltage lost. It's like upgrading from a garden hose to a fire hose â€” more capacity, less pressure loss. Going up one wire size often solves the problem completely."},
// ===== NEC CÃ“DIGO (5) =====
{cat:"ðŸ“– NEC CÃ³digo",cat_en:"ðŸ“– NEC Code",q:"El NEC (National Electrical Code) se actualiza cada:",q_en:"The NEC (National Electrical Code) is updated every:",o:["5 aÃ±os â€” siguiendo el ciclo de construcciÃ³n","3 aÃ±os â€” la NFPA lo revisa cada ciclo trienal","10 aÃ±os â€” los cÃ³digos elÃ©ctricos cambian poco","Anualmente â€” por la rapidez de cambios tecnolÃ³gicos"],o_en:["Every year","Every 3 years","Every 5 years","Every 10 years"],c:1,e:"El NEC se actualiza cada 3 aÃ±os por la NFPA. La ediciÃ³n actual es NEC 2023 (publicada 2022).",e_en:"The NEC is updated on a 3-year cycle by NFPA. Current editions: NEC 2020, 2023, etc.",a:"Cada 3 aÃ±os sale un NEC nuevo con reglas actualizadas: 2014, 2017, 2020, 2023. Es como los iPhones pero para electricistas. Cada versiÃ³n agrega mÃ¡s protecciones y requisitos. Tu jurisdicciÃ³n puede adoptar versiones anteriores.",a_en:"Every 3 years a new NEC comes out: 2017, 2020, 2023, 2026... But your local jurisdiction might still be on an older version. Always check what edition your area has adopted."},
{cat:"ðŸ“– NEC CÃ³digo",cat_en:"ðŸ“– NEC Code",q:"SegÃºn NEC 210.52, en Ã¡reas de cocina, los tomacorrientes deben estar a no mÃ¡s de:",q_en:"According to NEC 210.52, in kitchen areas, outlets must be no more than:",o:["6 pies de distancia entre cada uno","4 pies de distancia a lo largo del counter","2 pies del borde del fregadero","8 pies de distancia mÃ¡xima"],o_en:["6 feet apart along the countertop","4 feet apart â€” no point along the counter should be more than 2 feet from an outlet","2 feet apart â€” every 2 feet needs an outlet","10 feet apart â€” kitchens don't need many outlets"],c:1,e:"NEC 210.52(C) requiere que ningÃºn punto del counter estÃ© a mÃ¡s de 24 pulgadas (2 pies) de un tomacorriente, lo que equivale a mÃ¡ximo 4 pies entre tomacorrientes.",e_en:"NEC 210.52(C): No point along kitchen countertop wall should be more than 24 inches from an outlet. This means outlets every 4 feet maximum.",a:"La regla es que no tengas que usar extensiÃ³n en la cocina: cada 4 pies de counter necesita un tomacorriente. Imagina que cada aparato de cocina tiene cable de 2 pies â€” necesitas un enchufe a esa distancia mÃ¡xima.",a_en:"The NEC wants you to never need an extension cord in the kitchen. Every 4 feet along the countertop gets an outlet. This way, your toaster or blender cord always reaches without stretching dangerously."},
{cat:"ðŸ“– NEC CÃ³digo",cat_en:"ðŸ“– NEC Code",q:"NEC ArtÃ­culo 250 cubre:",q_en:"NEC Article 250 covers:",o:["ProtecciÃ³n contra sobrecorriente","Puesta a tierra y uniones (grounding and bonding)","InstalaciÃ³n de conductos y canalizaciones","Requisitos para motores y sus circuitos"],o_en:["Lighting circuits only","Grounding and bonding â€” the complete grounding system","Motor installations","Transformer sizing"],c:1,e:"NEC 250 es el artÃ­culo dedicado a grounding y bonding. Es uno de los mÃ¡s extensos e importantes del cÃ³digo.",e_en:"Article 250 is the grounding and bonding article â€” one of the most important in the NEC. Covers equipment grounding, system grounding, bonding, and grounding electrode systems.",a:"El ArtÃ­culo 250 es la biblia de la tierra: cÃ³mo conectar todo al planeta para que si algo falla, la corriente tenga un camino seguro. Grounding protege a las personas, bonding conecta todo el metal junto.",a_en:"Article 250 is the safety backbone of the NEC. Grounding protects people; bonding ensures metal parts are connected so faults trip breakers. If you only memorize one NEC article, make it 250."},
{cat:"ðŸ“– NEC CÃ³digo",cat_en:"ðŸ“– NEC Code",q:"Un circuito de 20A segÃºn NEC 210.3 requiere conductor mÃ­nimo de:",q_en:"A 20A circuit per NEC 210.3 requires a minimum conductor of:",o:["#14 AWG â€” el estÃ¡ndar para circuitos de rama","#12 AWG â€” NEC 210.3 requiere conductor adecuado para la protecciÃ³n","#10 AWG â€” por seguridad en circuitos de 20A","#8 AWG â€” para cumplir con la caÃ­da de voltaje"],o_en:["#14 AWG â€” it handles 20A","#12 AWG â€” per NEC table","#10 AWG â€” for extra safety","#8 AWG â€” to prevent voltage drop"],c:1,e:"NEC 240.4(D): Circuito de 20A = mÃ­nimo #12 AWG. Circuito de 15A = mÃ­nimo #14 AWG. Circuito de 30A = mÃ­nimo #10 AWG.",e_en:"NEC: 15A circuit = #14 AWG minimum. 20A circuit = #12 AWG minimum. 30A = #10. These are absolute minimums.",a:"Cada breaker tiene su cable mÃ­nimo: 15A=#14, 20A=#12, 30A=#10. Es como zapatos y pies: si usas zapatos chicos para un pie grande, te aprieta y te lastima. El cable debe ser del tamaÃ±o correcto para la corriente.",a_en:"NEC says: 20A breaker MUST have at least #12 wire. No exceptions. #14 on a 20A breaker is a code violation and fire hazard. Remember: 14â†’15, 12â†’20, 10â†’30."},
{cat:"ðŸ“– NEC CÃ³digo",cat_en:"ðŸ“– NEC Code",q:"SegÃºn NEC 310.15(B)(3)(a), cuando tienes mÃ¡s de 3 conductores portando corriente en un mismo conduit, debes:",q_en:"According to NEC 310.15(B)(3)(a), when you have more than 3 current-carrying conductors in a conduit, you must:",o:["No hay ajuste necesario â€” el conduit protege los cables","Aplicar factor de reducciÃ³n de amperaje (derating) a los conductores","Solo agregar un conductor de tierra extra","Cambiar a un conduit de mayor tamaÃ±o solamente"],o_en:["Use larger conduit only","Apply ampacity derating â€” reduce the maximum allowed current per conductor","Add ventilation to the conduit","Nothing changes â€” the number of conductors doesn't matter"],c:1,e:"Con 4-6 conductores: 80% de capacidad. 7-9: 70%. 10-20: 50%. El calor se acumula y los cables deben reducir su carga.",e_en:"More conductors in conduit = more heat = must derate ampacity. 4-6 conductors = derate to 80%. 7-9 = 70%. This prevents overheating.",a:"Imagina un autobÃºs lleno: entre mÃ¡s gente, mÃ¡s calor genera cada persona. Los cables en un tubo son igual: mÃ¡s cables = mÃ¡s calor = cada cable puede llevar MENOS corriente. El NEC te dice cuÃ¡nto reducir.",a_en:"More wires in a pipe = more heat with less room to cool. It's like stuffing more people in an elevator â€” everyone gets hotter. The NEC says reduce the current limit so the wires don't overheat: 4-6 wires = 80%, 7-9 = 70%."}
];


let quizData=[];
let quizIdx=0;
let quizRight=0;
let quizWrong=0;
let quizAnswered=false;
let quizAnswers=[];

function shuffleArray(arr){
    const a=[...arr];
    for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
    return a;
}

function startQuiz(id){
    const qId=id||currentQuizId||'principiante';
    currentQuizId=qId;
    if(qId==='intro')quizData=shuffleArray(QUIZ_INTRO);
    else if(qId==='electricidad')quizData=shuffleArray(QUIZ_ELECTRICIDAD);
    else if(qId==='refrigeracion')quizData=shuffleArray(QUIZ_REFRIGERACION);
    else quizData=shuffleArray(QUIZ_PRINCIPIANTE);
    quizIdx=0;quizRight=0;quizWrong=0;quizStreak=0;
    quizAnswers=new Array(quizData.length).fill(-1);
    document.getElementById('qRight').textContent='0';
    document.getElementById('qWrong').textContent='0';
    go('s8');
    showQuestion();
}

function retryQuiz(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    // Only retry the questions the user got WRONG (not the entire quiz)
    const failedQuestions=[];
    for(let i=0;i<quizData.length;i++){
        if(quizAnswers[i]>=0 && quizAnswers[i]!==quizData[i].c){
            failedQuestions.push(quizData[i]);
        }
    }
    if(failedQuestions.length===0){
        // Perfect score - just restart full quiz
        startQuiz(currentQuizId);
        return;
    }
    // Start quiz with ONLY failed questions
    quizData=shuffleArray(failedQuestions);
    quizIdx=0;quizRight=0;quizWrong=0;quizStreak=0;
    quizAnswers=new Array(quizData.length).fill(-1);
    document.getElementById('qRight').textContent='0';
    document.getElementById('qWrong').textContent='0';
    go('s8');
    showQuestion();
    const q=QUIZ_LIST.find(x=>x.id===currentQuizId);
    speakText(D.lang==='es'?'Â¡Vamos a repasar las '+failedQuestions.length+' que fallaste, '+D.name+'! Â¡TÃº puedes, '+gn('campeÃ³n','campeona')+'!':'Let\'s review the '+failedQuestions.length+' you missed, '+D.name+'! You got this!');
}

// ========== FORMULA DETECTION SYSTEM ==========
const FORMULA_PATTERNS=[
    {
        id:'ohm_r',
        keywords:['resistencia segÃºn ohm','resistencia segÃºn Ohm','cuÃ¡l es la resistencia','ohms','ley de ohm','R = V'],
        title:'âš¡ Ley de Ohm â€” Resistencia',
        formula:'R = V Ã· I',
        vars:'R = Resistencia (Î©) | V = Voltaje (V) | I = Corriente (A)',
        hint:'Â¡Usa la Ley de Ohm! Divide el voltaje entre la corriente.',
        showWheel:true
    },
    {
        id:'ohm_v',
        keywords:['voltaje.*ohm','V = I','voltaje usando ohm','calcular el voltaje'],
        title:'âš¡ Ley de Ohm â€” Voltaje',
        formula:'V = I Ã— R',
        vars:'V = Voltaje (V) | I = Corriente (A) | R = Resistencia (Î©)',
        hint:'Â¡La Ley de Ohm te da el voltaje! Multiplica corriente por resistencia.',
        showWheel:true
    },
    {
        id:'ohm_i',
        keywords:['corriente.*ohm','I = V','amperios.*ohm','calcular la corriente','cuÃ¡ntos amperios'],
        title:'âš¡ Ley de Ohm â€” Corriente',
        formula:'I = V Ã· R',
        vars:'I = Corriente (A) | V = Voltaje (V) | R = Resistencia (Î©)',
        hint:'Â¡La Ley de Ohm! Divide el voltaje entre la resistencia para sacar amperios.',
        showWheel:true
    },
    {
        id:'watt_i',
        keywords:['amperios consume','cuÃ¡ntos amperios','corriente total','1500W','watts.*amperios','I = P','I = W'],
        title:'âš¡ Ley de Watt â€” Corriente',
        formula:'I = W Ã· V',
        vars:'I = Corriente (A) | W = Potencia (Watts) | V = Voltaje (V)',
        hint:'Â¡Para sacar amperios desde watts, usa I = W Ã· V!',
        showWheel:true
    },
    {
        id:'watt_p',
        keywords:['potencia total','watts total','cuÃ¡ntos watts','P = V','W = V'],
        title:'âš¡ Ley de Watt â€” Potencia',
        formula:'W = V Ã— I',
        vars:'W = Potencia (Watts) | V = Voltaje (V) | I = Corriente (A)',
        hint:'Â¡La potencia es voltaje por corriente! W = V Ã— I.',
        showWheel:true
    },
    {
        id:'vdrop',
        keywords:['caÃ­da de voltaje','porcentaje de caÃ­da','voltage drop','Vd ='],
        title:'ðŸ“‰ CaÃ­da de Voltaje',
        formula:'Vd = 2 Ã— K Ã— I Ã— D Ã· CM',
        vars:'K = Resistividad | I = Corriente | D = Distancia | CM = Circular Mils',
        hint:'Â¡Recuerda la fÃ³rmula de caÃ­da de voltaje! El 2 es por ida y vuelta.',
        showWheel:false
    },
    {
        id:'superheat',
        keywords:['superheat','superheat se mide','temperatura de succiÃ³n'],
        title:'ðŸŒ¡ï¸ Superheat',
        formula:'SH = T.lÃ­nea succiÃ³n âˆ’ T.saturaciÃ³n',
        vars:'SH = Superheat | T.lÃ­nea = Temp real | T.sat = SegÃºn tabla P-T',
        hint:'Â¡Para medir superheat necesitas dos cosas: la temperatura real y la de la tabla!',
        showWheel:false
    },
    {
        id:'subcooling',
        keywords:['subcooling','subcooling se mide','temp.*lÃ­quido'],
        title:'ðŸŒ¡ï¸ Subcooling',
        formula:'SC = T.saturaciÃ³n âˆ’ T.lÃ­nea lÃ­quido',
        vars:'SC = Subcooling | T.sat = SegÃºn tabla P-T | T.lÃ­nea = Temp real',
        hint:'Â¡Subcooling es lo opuesto al superheat! La temp de saturaciÃ³n MENOS la real.',
        showWheel:false
    },
    {
        id:'delta_t',
        keywords:['delta T','supply.*return','return.*supply','temperatura del supply'],
        title:'ðŸŒ¡ï¸ Delta T',
        formula:'Î”T = T.return âˆ’ T.supply',
        vars:'Normal: 15-20Â°F | Return = aire que entra | Supply = aire que sale',
        hint:'Â¡Delta T es la diferencia entre el aire que entra y el que sale!',
        showWheel:false
    },
    {
        id:'desbalance',
        keywords:['desbalance de voltaje','desbalance.*trifÃ¡sico','porcentaje.*desbalance'],
        title:'âš–ï¸ Desbalance de Voltaje',
        formula:'% = (Mayor desviaciÃ³n Ã· Promedio) Ã— 100',
        vars:'MÃ¡ximo aceptable: 2% segÃºn NEMA',
        hint:'Â¡Saca el promedio de los tres voltajes, y ve cuÃ¡nto se desvÃ­a el peor!',
        showWheel:false
    },
    {
        id:'breaker_motor',
        keywords:['breaker.*motor','NEC 430','250%','FLA.*breaker'],
        title:'ðŸ“– NEC 430.52 â€” Breaker de Motor',
        formula:'Breaker mÃ¡x = FLA Ã— 250%',
        vars:'FLA = Full Load Amps | Sube al siguiente tamaÃ±o estÃ¡ndar',
        hint:'Â¡Para motores, el breaker puede ser hasta 250% del FLA!',
        showWheel:false
    }
];

function detectFormula(q){
    const text=(tq(q,'q')+' '+tq(q,'e')).toLowerCase();
    for(const f of FORMULA_PATTERNS){
        for(const kw of f.keywords){
            try{
                if(new RegExp(kw,'i').test(text))return f;
            }catch(e){
                if(text.includes(kw.toLowerCase()))return f;
            }
        }
    }
    return null;
}

function showFormulaHelper(q){
    const formula=detectFormula(q);
    const helper=document.getElementById('qFormula');
    const wheel=document.getElementById('qPowerWheel');
    
    if(!formula){
        helper.classList.remove('show');
        return;
    }
    
    helper.classList.add('show');
    document.getElementById('qFormToggleText').textContent='ðŸ“ '+(D.lang==='es'?formula.hint:(formula.hint_en||formula.hint));
    document.getElementById('qFormTitle').textContent=formula.title;
    document.getElementById('qFormText').innerHTML=
        '<span class="formula-big">'+formula.formula+'</span>'+
        '<span class="formula-vars">'+formula.vars+'</span>';
    
    if(formula.showWheel){
        wheel.classList.add('show');
    }else{
        wheel.classList.remove('show');
    }
}

function toggleFormulaDetail(){
    const detail=document.getElementById('qFormDetail');
    const toggle=document.getElementById('qFormToggle');
    if(detail.style.display==='none'){
        detail.style.display='block';
        toggle.classList.add('open');
    }else{
        detail.style.display='none';
        toggle.classList.remove('open');
    }
}

function getFormulaHintBubble(q){
    const formula=detectFormula(q);
    if(!formula)return null;
    
    const hints_es=[
        'Â¡'+D.name+'! Para esta pregunta ocupa usar una fÃ³rmula. Â¿Necesitas ayuda? Â¡Toca la pista! ðŸ“',
        'Â¡Ojo, '+D.name+'! Esta pregunta requiere cÃ¡lculo. Te dejÃ© la fÃ³rmula abajo. Â¡TÃº puedes!',
        D.name+', recuerda que para resolver esta pregunta debes usar una fÃ³rmula. Â¡AhÃ­ te la dejÃ©!',
        'Â¡'+D.name+'! Esta es de cÃ¡lculo. No te asustes â€” te puse la herramienta abajo. Â¡Dale!',
        'Hey '+D.name+', esta necesita matemÃ¡ticas. Pero tranquilo, ahÃ­ abajo tienes todo lo que necesitas.',
    ];
    const hints_en=[
        D.name+'! This one needs a formula. Need help? Tap the hint! ðŸ“',
        'Watch out, '+D.name+'! This requires calculation. I left the formula below!',
        D.name+', remember you need a formula for this one. I got you covered below!',
    ];
    const list=D.lang==='es'?hints_es:hints_en;
    return list[Math.floor(Math.random()*list.length)];
}

// ========== MOTIVATIONAL QUOTES SYSTEM ==========
const MOTIVATION_QUOTES=[
    // 48 Laws of Power - Robert Greene
    {es:'"Nunca brilles mÃ¡s que tu maestro... hasta que lo superes."',en:'"Never outshine your master... until you surpass them."',author:'â€” 48 Laws of Power'},
    {es:'"Los que mÃ¡s saben, mÃ¡s practican en silencio."',en:'"Those who know most, practice in silence."',author:'â€” 48 Laws of Power'},
    {es:'"Domina el arte de la paciencia â€” todo maestro fue primero estudiante."',en:'"Master the art of patience â€” every master was first a student."',author:'â€” 48 Laws of Power'},
    {es:'"El Ã©xito no viene de lo que haces de vez en cuando, sino de lo que haces consistentemente."',en:'"Success doesn\'t come from what you do occasionally, but from what you do consistently."',author:'â€” 48 Laws of Power'},
    {es:'"Planea hasta el final: el tÃ©cnico que anticipa, domina."',en:'"Plan all the way to the end: the tech who anticipates, dominates."',author:'â€” 48 Laws of Power'},
    {es:'"Gana a travÃ©s de tus acciones, nunca a travÃ©s de argumentos."',en:'"Win through your actions, never through arguments."',author:'â€” 48 Laws of Power'},
    {es:'"La reputaciÃ³n es la piedra angular del poder â€” cuida tu trabajo."',en:'"Reputation is the cornerstone of power â€” take care of your work."',author:'â€” 48 Laws of Power'},
    // Art of War - Sun Tzu
    {es:'"El guerrero que se prepara, no le teme a la batalla."',en:'"The warrior who prepares does not fear the battle."',author:'â€” Sun Tzu'},
    {es:'"Conoce tu oficio y conoce tus herramientas, y en 100 diagnÃ³sticos no fallarÃ¡s."',en:'"Know your trade and know your tools, and in 100 diagnostics you will not fail."',author:'â€” Sun Tzu'},
    {es:'"La victoria pertenece al que se prepara mÃ¡s."',en:'"Victory belongs to the most prepared."',author:'â€” Sun Tzu'},
    {es:'"Un tÃ©cnico preparado no necesita suerte."',en:'"A prepared technician doesn\'t need luck."',author:'â€” Sun Tzu'},
    {es:'"El mejor diagnÃ³stico se hace antes de abrir la unidad."',en:'"The best diagnostic is done before opening the unit."',author:'â€” Sun Tzu'},
    // Napoleon Hill
    {es:'"Todo lo que la mente puede concebir y creer, lo puede lograr."',en:'"Whatever the mind can conceive and believe, it can achieve."',author:'â€” Napoleon Hill'},
    {es:'"El punto de partida de todo logro es el deseo."',en:'"The starting point of all achievement is desire."',author:'â€” Napoleon Hill'},
    {es:'"La paciencia, la persistencia y el sudor hacen una combinaciÃ³n imbatible."',en:'"Patience, persistence, and perspiration make an unbeatable combination."',author:'â€” Napoleon Hill'},
    {es:'"No esperes. El momento perfecto nunca llegarÃ¡. Empieza ahora."',en:'"Don\'t wait. The perfect moment will never come. Start now."',author:'â€” Napoleon Hill'},
    // Stephen Covey
    {es:'"Comienza con el fin en mente â€” Â¿quieres ser dueÃ±o o empleado?"',en:'"Begin with the end in mind â€” do you want to be an owner or an employee?"',author:'â€” Stephen Covey'},
    {es:'"Afila la sierra: cada hora que estudias vale mÃ¡s que 10 horas de trabajo sin preparaciÃ³n."',en:'"Sharpen the saw: every hour you study is worth more than 10 hours of unprepared work."',author:'â€” Stephen Covey'},
    {es:'"Primero lo primero: domina las bases y todo lo demÃ¡s caerÃ¡ en su lugar."',en:'"First things first: master the basics and everything else falls into place."',author:'â€” Stephen Covey'},
    // Kiyosaki
    {es:'"Los pobres trabajan por dinero. Los ricos hacen que el dinero trabaje para ellos."',en:'"The poor work for money. The rich make money work for them."',author:'â€” Robert Kiyosaki'},
    {es:'"Tu conocimiento es tu activo mÃ¡s valioso â€” invierte en Ã©l."',en:'"Your knowledge is your most valuable asset â€” invest in it."',author:'â€” Robert Kiyosaki'},
    // Maestro Mario
    {es:'"Si no mides, estÃ¡s adivinando." Â¡Nunca adivines, mide!',en:'"If you don\'t measure, you\'re guessing." Never guess, measure!',author:'â€” Maestro Mario'},
    {es:'"El tÃ©cnico que estudia hoy, cobra mÃ¡s maÃ±ana."',en:'"The technician who studies today earns more tomorrow."',author:'â€” Maestro Mario'},
    {es:'"Cada pregunta que fallas es una lecciÃ³n que ganas."',en:'"Every question you miss is a lesson you gain."',author:'â€” Maestro Mario'},
    {es:'"No hay tÃ©cnico malo, hay tÃ©cnico que no practica."',en:'"There\'s no bad technician, only one who doesn\'t practice."',author:'â€” Maestro Mario'},
    {es:'"Tu herramienta mÃ¡s poderosa es tu conocimiento, no tu llave."',en:'"Your most powerful tool is your knowledge, not your wrench."',author:'â€” Maestro Mario'},
    {es:'"Un tÃ©cnico sin certificaciÃ³n es como un doctor sin tÃ­tulo."',en:'"A technician without certification is like a doctor without a degree."',author:'â€” Maestro Mario'},
    {es:'"El que sabe diagnosticar, nunca se queda sin trabajo."',en:'"The one who knows how to diagnose never runs out of work."',author:'â€” Maestro Mario'},
    {es:'"Hoy estudias, maÃ±ana cobras. AsÃ­ de simple."',en:'"Study today, earn more tomorrow. Simple as that."',author:'â€” Maestro Mario'},
    {es:'"La diferencia entre un tÃ©cnico de $20/hr y uno de $50/hr es lo que sabe, no lo que hace."',en:'"The difference between a $20/hr and a $50/hr tech is what they know, not what they do."',author:'â€” Maestro Mario'},
    {es:'"Cada circuito que entiendes, cada fÃ³rmula que dominas, te acerca a tu libertad."',en:'"Every circuit you understand, every formula you master, brings you closer to freedom."',author:'â€” Maestro Mario'},
    {es:'"Los mejores tÃ©cnicos nunca dejan de aprender."',en:'"The best technicians never stop learning."',author:'â€” Maestro Mario'},
    {es:'"Tu competencia no estudia â€” tÃº sÃ­. Por eso vas a ganar."',en:'"Your competition isn\'t studying â€” you are. That\'s why you\'ll win."',author:'â€” Maestro Mario'},
    // Kobe Bryant
    {es:'"El trabajo duro supera al talento cuando el talento no trabaja duro."',en:'"Hard work beats talent when talent doesn\'t work hard."',author:'â€” Kobe Bryant'},
    {es:'"Yo no le tengo miedo al fracaso. Le tengo miedo a no intentarlo."',en:'"I don\'t fear failure. I fear not trying."',author:'â€” Kobe Bryant'},
    // Other
    {es:'"El Ã©xito es la suma de pequeÃ±os esfuerzos repetidos dÃ­a tras dÃ­a."',en:'"Success is the sum of small efforts repeated day after day."',author:'â€” Robert Collier'},
    {es:'"Disciplina es hacer lo que necesitas hacer, aunque no tengas ganas."',en:'"Discipline is doing what you need to do, even when you don\'t feel like it."',author:'â€” Anonymous'},
    {es:'"El experto en algo fue una vez un principiante."',en:'"The expert in anything was once a beginner."',author:'â€” Helen Hayes'},
    {es:'"No te compares con otros. CompÃ¡rate con quien eras ayer."',en:'"Don\'t compare yourself to others. Compare yourself to who you were yesterday."',author:'â€” Jordan Peterson'},
    {es:'"La consistencia es mÃ¡s importante que la perfecciÃ³n."',en:'"Consistency is more important than perfection."',author:'â€” Anonymous'},
];

let lastQuoteIdx=-1;

function showMotivation(qIdx){
    const bar=document.getElementById('qMotive');
    // Show motivation every 3 questions
    if(qIdx%3===0){
        let idx=Math.floor(Math.random()*MOTIVATION_QUOTES.length);
        while(idx===lastQuoteIdx&&MOTIVATION_QUOTES.length>1)idx=Math.floor(Math.random()*MOTIVATION_QUOTES.length);
        lastQuoteIdx=idx;
        const quote=MOTIVATION_QUOTES[idx];
        document.getElementById('qMotiveText').textContent=D.lang==='es'?quote.es:quote.en;
        document.getElementById('qMotiveAuthor').textContent=quote.author;
        bar.classList.add('show');
    }else{
        bar.classList.remove('show');
    }
}

function showQuestion(){
    if(quizIdx>=quizData.length){showResult();return;}
    const q=quizData[quizIdx];
    const alreadyAnswered=quizAnswers[quizIdx]>=0;
    quizAnswered=alreadyAnswered;
    const pct=Math.round((quizIdx/quizData.length)*100);
    document.getElementById('qBar').style.width=pct+'%';
    document.getElementById('qNum').textContent=(D.lang==='es'?'Pregunta ':'Question ')+(quizIdx+1)+' / '+quizData.length;
    document.getElementById('qPrev').textContent=D.lang==='es'?'â† Anterior':'â† Previous';
    document.getElementById('qCat').textContent=q.cat;
    
    // Show formula helper if question needs it
    showFormulaHelper(q);
    
    // Show motivational quote
    showMotivation(quizIdx);
    
    // Reset formula detail toggle
    const formDetail=document.getElementById('qFormDetail');
    if(formDetail)formDetail.style.display='none';
    const formToggle=document.getElementById('qFormToggle');
    if(formToggle)formToggle.classList.remove('open');
    
    // Back button
    const prevBtn=document.getElementById('qPrev');
    if(quizIdx>0){prevBtn.classList.add('show');}else{prevBtn.classList.remove('show');}
    
    if(alreadyAnswered){
        // Revisiting a question already answered
        const userAnswer=quizAnswers[quizIdx];
        const correct=userAnswer===q.c;
        document.getElementById('qBubble').textContent=correct?(D.lang==='es'?'âœ… Ya contestaste bien esta pregunta.':'âœ… You already got this right.'):(D.lang==='es'?'âŒ AquÃ­ fallaste. La correcta es la '+['A','B','C','D'][q.c]+'.':'âŒ You missed this one. Correct: '+['A','B','C','D'][q.c]+'.');
        document.getElementById('qText').textContent=tq(q,'q');
        const letters=['A','B','C','D'];
        document.getElementById('qOpts').innerHTML=tq(q,'o').map((o,i)=>{
            let cls='quiz-opt disabled';
            if(i===q.c)cls+=' correct';
            if(i===userAnswer&&!correct)cls+=' wrong';
            return '<div class="'+cls+'"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>';
        }).join('');
        document.getElementById('qExplain').innerHTML=correct?('<b>'+(D.lang==='es'?'ExplicaciÃ³n:':'Explanation:')+'</b> '+tq(q,'e')):('<b style="color:#ff6b2b">'+(D.lang==='es'?'ðŸ“– Con peras y manzanas:':'ðŸ“– Simply put:')+'</b><br>'+tq(q,'a')+'<br><br><b>'+(D.lang==='es'?'TÃ©cnico:':'Technical:')+'</b> '+tq(q,'e'));
        document.getElementById('qExplain').classList.add('show');
        const nextBtn=document.getElementById('qNext');
        nextBtn.textContent=(quizIdx<quizData.length-1)?(D.lang==='es'?'Siguiente â†’':'Next â†’'):(D.lang==='es'?'Ver Resultado ðŸ†':'See Result ðŸ†');
        nextBtn.classList.add('show');
    }else{
        // New unanswered question
        const formulaHint=getFormulaHintBubble(q);
        if(formulaHint){
            document.getElementById('qBubble').textContent=formulaHint;
        }else{
            document.getElementById('qBubble').textContent=quizIdx===0?(D.lang==='es'?'Â¡Dale, tÃº puedes!':'You got this!'):(D.lang==='es'?'Â¿QuÃ© piensas, '+D.name+'?':'What do you think, '+D.name+'?');
        }
        document.getElementById('qText').textContent=tq(q,'q');
        document.getElementById('qExplain').classList.remove('show');
        document.getElementById('qNext').classList.remove('show');
        const letters=['A','B','C','D'];
        document.getElementById('qOpts').innerHTML=tq(q,'o').map((o,i)=>'<div class="quiz-opt" onclick="answerQuiz('+i+',this)"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>').join('');
    }
    window.scrollTo(0,0);
}

let quizStreak=0;

const CHEERS_ES=[
    ['Â¡Correcto!','Â¡Bien hecho!','Â¡AsÃ­ se hace!','Â¡Muy bien, '+'{name}'+'!','Â¡Buena elecciÃ³n!','Â¡Exacto!','Â¡Le atinaste!'],
    ['Â¡Chaka, '+'{name}'+'!','Â¡Excelente!','Â¡Wow, quÃ© bÃ¡rbaro!','Â¡PerrÃ­simo!','Â¡Bravo, '+'{name}'+'!','Â¡Me sorprendes!','Â¡Ã“rale, asÃ­ mero!'],
    ['Â¡Ufff quÃ© bÃ¡rbaro, '+'{name}'+'!','Â¡Espectacular!','Â¡EstÃ¡s que ardes!','Â¡QuÃ© mÃ¡quina eres!','Â¡Nadie te para!','Â¡Crack total!'],
    ['ðŸ”¥ Â¡ESTÃS IMPARABLE, '+'{name}'+'! ðŸ”¥','âš¡ Â¡WOW, NO TE PARA NADIE! âš¡','ðŸ’ª Â¡PERRÃSIMO, ERES UNA BESTIA! ðŸ’ª','ðŸ† Â¡VAS CON TODO, CAMPEÃ“N! ðŸ†','ðŸŒŸ Â¡ME SORPRENDES, QUÃ‰ NIVEL! ðŸŒŸ','ðŸ’¥ Â¡CHAKA! Â¡ERES IMPARABLE! ðŸ’¥']
];
const CHEERS_EN=[
    ['Correct!','Well done!','Nice job!','Good pick, '+'{name}'+'!','That\'s right!','Nailed it!','Spot on!'],
    ['Perfect!','Excellent!','Brilliant!','Amazing!','Great work, '+'{name}'+'!','Killing it!','Impressive!'],
    ['Spectacular!','You\'re on fire!','Incredible, '+'{name}'+'!','Crushing it!','Nobody stops you!','Total beast mode!'],
    ['ðŸ”¥ UNSTOPPABLE, '+'{name}'+'! ðŸ”¥','âš¡ NOBODY STOPS YOU! âš¡','ðŸ’ª YOU ARE A BEAST! ðŸ’ª','ðŸ† ALL THE WAY, CHAMP! ðŸ†','ðŸŒŸ WHAT A LEVEL! ðŸŒŸ','ðŸ’¥ INCREDIBLE RUN! ðŸ’¥']
];
const MISS_ES=[
    'Â¡No te preocupes, {name}! Todos fallamos al principio. AsÃ­ se aprende, echÃ¡ndole ganas.',
    'Â¡Ey {name}, tranquilo! Los mejores tÃ©cnicos tambiÃ©n empezaron equivocÃ¡ndose. Â¡TÃº puedes!',
    'Â¡{name}, ya eres {ganador} solo por intentarlo! No te desanimes, vamos {campeon}.',
    'Â¡Ã“rale {name}, casi le atinas! Eres una estrella en entrenamiento. Mira la explicaciÃ³n.',
    'Â¡{name}, no pasa nada! Hasta Mario se equivocaba al principio. Lo importante es aprender.',
    'Â¡Ãnimo {name}! Cada error te acerca mÃ¡s a ser un crack del HVAC. Â¡TÃº puedes con esto!',
    'Â¡Hey {name}! Esta estaba difÃ­cil. Pero tÃº eres {chingon}, vas a dominar este tema.',
    'Â¡{name}, respira! Los grandes se hacen a base de prÃ¡ctica. Mira la explicaciÃ³n y vas a ver quÃ© fÃ¡cil es.'
];
const MISS_EN=[
    'Don\'t worry {name}! Everyone struggles at first. That\'s how you learn!',
    'Hey {name}, take it easy! The best techs started by making mistakes too. You got this!',
    '{name}, you\'re already a winner just for trying! Don\'t give up, champ.',
    'Almost {name}! You\'re a star in training. Check out the explanation.',
    '{name}, no big deal! Even Mario made mistakes starting out. What matters is learning.',
    'Keep going {name}! Every mistake brings you closer to being an HVAC pro!',
    'Hey {name}! That was a tough one. But you\'re awesome, you\'ll master this.',
    '{name}, take a breath! Greatness comes from practice. Check the explanation and you\'ll get it.'
];

function pickCheer(streak){
    const cheers=D.lang==='es'?CHEERS_ES:CHEERS_EN;
    let tier=0;
    if(streak>=8)tier=3;
    else if(streak>=5)tier=2;
    else if(streak>=3)tier=1;
    const list=cheers[tier];
    return list[Math.floor(Math.random()*list.length)].replace('{name}',D.name);
}

function pickMiss(){
    const list=D.lang==='es'?MISS_ES:MISS_EN;
    let msg=list[Math.floor(Math.random()*list.length)].replace(/\{name\}/g,D.name);
    msg=msg.replace(/\{campeon\}/g,gn('campeÃ³n','campeona')).replace(/\{ganador\}/g,gn('ganador','ganadora')).replace(/\{chingon\}/g,gn('chingÃ³n','chingona'));
    const letter=' '+(D.lang==='es'?'La correcta es la ':'Correct answer is ')+['A','B','C','D'][quizData[quizIdx].c]+'.';
    return msg+letter;
}

function celebrate(streak){
    const el=document.getElementById('s8');
    // Vibrate phone
    if(navigator.vibrate){
        if(streak>=5)navigator.vibrate([100,50,100,50,200]);
        else navigator.vibrate(80);
    }
    // Screen shake
    if(streak>=5){
        el.classList.add('big-shake');
        setTimeout(()=>el.classList.remove('big-shake'),600);
    }else if(streak>=2){
        el.classList.add('shake');
        setTimeout(()=>el.classList.remove('shake'),400);
    }
    // Lightning flash at 5+ streak
    if(streak>=5){
        const flash=document.createElement('div');
        flash.className='lightning-flash';
        document.body.appendChild(flash);
        setTimeout(()=>flash.remove(),400);
    }
    // Fire emojis at 3+ streak (reduced for performance)
    if(streak>=3){
        const emojis=streak>=8?['ðŸ”¥','âš¡','ðŸ’¥','ðŸŒŸ']:streak>=5?['ðŸ”¥','âš¡','ðŸ’¥']:['ðŸ”¥','âœ¨'];
        const count=streak>=8?6:streak>=5?4:2;
        for(let i=0;i<count;i++){
            setTimeout(()=>{
                const fire=document.createElement('div');
                fire.className='fire-emoji';
                fire.textContent=emojis[Math.floor(Math.random()*emojis.length)];
                fire.style.left=Math.random()*80+10+'%';
                fire.style.bottom='10%';
                document.body.appendChild(fire);
                setTimeout(()=>fire.remove(),1200);
            },i*150);
        }
    }
    // Streak badge at 5+ 
    if(streak>=5){
        const badge=document.createElement('div');
        badge.className='streak-badge';
        badge.textContent=streak>=10?'ðŸ† '+streak+'x COMBO! ðŸ†':streak>=8?'âš¡ '+streak+'x RACHA! âš¡':'ðŸ”¥ '+streak+'x STREAK! ðŸ”¥';
        document.body.appendChild(badge);
        setTimeout(()=>badge.remove(),1500);
    }
    // Confetti at 5+
    if(streak>=5)cft();
}

function answerQuiz(idx,el){
    if(quizAnswered)return;
    quizAnswered=true;
    quizAnswers[quizIdx]=idx;
    const q=quizData[quizIdx];
    const correct=idx===q.c;
    const opts=document.querySelectorAll('.quiz-opt');
    
    opts.forEach((o,i)=>{
        if(i===q.c)o.classList.add('correct');
        if(i===idx&&!correct)o.classList.add('wrong');
        if(i!==q.c&&i!==idx)o.classList.add('disabled');
    });
    
    if(correct){
        quizRight++;
        quizStreak++;
        if(quizStreak>bestStreak)bestStreak=quizStreak;
        document.getElementById('qRight').textContent=quizRight;
        let cheer=pickCheer(quizStreak);
        // === MILESTONE MESSAGES based on progress ===
        const progressPct=Math.round(((quizIdx+1)/quizData.length)*100);
        if(progressPct>=90&&progressPct<95){
            cheer=D.lang==='es'?'ðŸŽ¯ Â¡ConcentraciÃ³n total, '+D.name+'! Â¡Ya lo tienes, '+gn('campeÃ³n','campeona')+'!':'ðŸŽ¯ Total focus, '+D.name+'! You almost got it, champ!';
        }else if(progressPct>=70&&progressPct<75){
            cheer=D.lang==='es'?'ðŸ‘‘ Â¡Ya puedes saborear la victoria, '+D.name+'! Â¡No aflojes!':'ðŸ‘‘ You can taste victory, '+D.name+'! Don\'t let up!';
        }else if(progressPct>=48&&progressPct<52){
            cheer=D.lang==='es'?'ðŸ… Â¡Ya casi llegas a la mitad! Â¡Esa medalla se acerca, '+D.name+'!':'ðŸ… Almost halfway there! That medal is getting closer, '+D.name+'!';
        }
        document.getElementById('qBubble').textContent=cheer;
        celebrate(quizStreak);
        document.getElementById('qExplain').innerHTML='<b>'+(D.lang==='es'?'ExplicaciÃ³n:':'Explanation:')+'</b> '+tq(q,'e');
        speakText(cheer+' '+tq(q,'e'));
        // Track correct in study tracker (reduce fail count)
        trackAnswer(q,true);
    }else{
        quizWrong++;
        quizStreak=0;
        document.getElementById('qWrong').textContent=quizWrong;
        const motivation=pickMiss();
        const bubble=document.getElementById('qBubble');
        bubble.textContent=motivation;
        // After 4 seconds, update bubble with the simple analogy
        setTimeout(()=>{
            bubble.innerHTML='<span style="color:#ff6b2b">ðŸ“–</span> '+tq(q,'a');
        },4000);
        // Show deep explanation with analogy
        let explain='<b style="color:#ff6b2b">'+(D.lang==='es'?'ðŸ“– Te lo explico con peras y manzanas:':'ðŸ“– Let me break it down simply:')+'</b><br>'+tq(q,'a')+'<br><br><b>'+(D.lang==='es'?'ExplicaciÃ³n tÃ©cnica:':'Technical explanation:')+'</b> '+tq(q,'e');
        document.getElementById('qExplain').innerHTML=explain;
        // Mario speaks EVERYTHING: motivation + analogy + technical explanation
        speakText(motivation+' '+(D.lang==='es'?'Te lo explico fÃ¡cil: ':'Let me explain simply: ')+tq(q,'a')+' '+(D.lang==='es'?'En tÃ©rminos tÃ©cnicos: ':'Technically speaking: ')+tq(q,'e'));
        // Track wrong in study tracker
        trackAnswer(q,false);
    }
    
    document.getElementById('qExplain').classList.add('show');
    document.getElementById('qNext').textContent=(quizIdx<quizData.length-1)?(D.lang==='es'?'Siguiente â†’':'Next â†’'):(D.lang==='es'?'Ver Resultado ðŸ†':'See Result ðŸ†');
    document.getElementById('qNext').classList.add('show');
}

function nextQuestion(){
    stopSpeech();
    quizIdx++;
    showQuestion();
}

function prevQuestion(){
    stopSpeech();
    if(quizIdx>0){quizIdx--;showQuestion();}
}

function showResult(){
    go('s9');
    const pct=Math.round((quizRight/quizData.length)*100);
    document.getElementById('rScore').textContent=pct+'%';
    document.getElementById('rLabel').textContent=quizRight+' / '+quizData.length+(D.lang==='es'?' correctas':' correct');
    
    // Award XP: 10 per correct, bonus for streaks
    const xpEarned=quizRight*10+(bestStreak>=10?50:bestStreak>=5?25:0);
    profile.xp+=xpEarned;
    profile.totalCorrect+=quizRight;
    profile.totalAnswered+=quizData.length;
    profile.quizzesTaken++;
    if(bestStreak>profile.bestStreak)profile.bestStreak=bestStreak;
    
    // Level up check
    while(profile.xp>=profile.xpNeeded){
        profile.xp-=profile.xpNeeded;
        profile.level++;
        profile.xpNeeded=Math.floor(profile.xpNeeded*1.4);
    }
    
    let medal,msg,stars;
    const medalEarned=document.getElementById('rMedalEarned');
    medalEarned.style.display='none';
    
    if(pct===100){
        medal='ðŸ†';stars=5;
        msg=D.lang==='es'?'Â¡Â¡PERFECTO, '+D.name+'!! 100% sin fallar. Â¡Eres leyenda! Te ganaste tu medalla de Bronce ðŸ¥‰':'PERFECT, '+D.name+'!! 100% flawless. You earned your Bronze Medal ðŸ¥‰';
        if(!profile.medals.includes('bronze_principiante')){
            profile.medals.push('bronze_principiante');
            medalEarned.style.display='block';
            document.getElementById('rNewMedal').textContent='ðŸ¥‰';
            document.getElementById('rMedalName').textContent=D.lang==='es'?'Â¡MEDALLA DE BRONCE DESBLOQUEADA!\nPrincipiante Perfecto':'BRONZE MEDAL UNLOCKED!\nPerfect Beginner';
        }
    }else if(pct>=90){
        medal='ðŸ†';stars=5;
        msg=D.lang==='es'?'Â¡IncreÃ­ble, '+D.name+'! Casi perfecto. El Maestro Mario estÃ¡ orgulloso. Â¡Intenta el 100% para tu medalla!':'Incredible, '+D.name+'! Almost perfect. Try for 100% to earn your medal!';
    }else if(pct>=80){
        medal='ðŸ¥‡';stars=4;
        msg=D.lang==='es'?'Â¡Excelente, '+D.name+'! Tienes muy buena base. Repasa lo que fallaste y ve por el 100%.':'Excellent, '+D.name+'! Great foundation. Review mistakes and go for 100%!';
    }else if(pct>=70){
        medal='ðŸ¥ˆ';stars=3;
        msg=D.lang==='es'?'Â¡Bien, '+D.name+'! Vas por buen camino. No te rindas, cada error es una lecciÃ³n.':'Good job, '+D.name+'! On the right track. Every mistake is a lesson.';
    }else if(pct>=60){
        medal='ðŸ¥‰';stars=2;
        msg=D.lang==='es'?'Â¡No te desanimes, '+D.name+'! Ya eres ganador por intentarlo. Repasa y vuelve mÃ¡s fuerte.':'Don\'t get discouraged, '+D.name+'! You\'re a winner for trying. Review and come back stronger.';
    }else{
        medal='ðŸ’ª';stars=1;
        msg=D.lang==='es'?'Â¡'+D.name+', vamos '+gn('campeÃ³n','campeona')+'! Todos fallamos al principio. TÃº puedes, eres una estrella. Â¡Estudia y regresa con todo!':D.name+', let\'s go champ! Everyone struggles at first. You\'re a star. Study and come back strong!';
    }
    
    document.getElementById('rMedal').textContent=medal;
    document.getElementById('rMsg').textContent=msg;
    
    const starEls=document.querySelectorAll('#rStars span');
    starEls.forEach((s,i)=>{s.classList.remove('lit');});
    starEls.forEach((s,i)=>{
        setTimeout(()=>{if(i<stars)s.classList.add('lit');},i*300);
    });
    
    saveProfile();
    
    // Save best quiz score
    const scores=JSON.parse(localStorage.getItem('maestro_quiz_scores')||'{}');
    if(!scores[currentQuizId]||pct>scores[currentQuizId])scores[currentQuizId]=pct;
    localStorage.setItem('maestro_quiz_scores',JSON.stringify(scores));
    
    // === SYNC TO SUPABASE ===
    syncV2Profile();
    syncV2QuizAttempt(currentQuizId, quizData.length, quizRight, quizWrong, pct, null);
    
    // Electricity-specific medal
    if(currentQuizId==='electricidad'&&pct===100&&!profile.medals.includes('bronze_electricidad')){
        profile.medals.push('bronze_electricidad');
        medalEarned.style.display='block';
        document.getElementById('rNewMedal').textContent='âš¡';
        document.getElementById('rMedalName').textContent='Â¡MEDALLA ELÃ‰CTRICA DESBLOQUEADA!\nMaestro de Electricidad';
        saveProfile();
    }
    // Refrigeration medal
    if(currentQuizId==='refrigeracion'&&pct===100&&!profile.medals.includes('bronze_refrigeracion')){
        profile.medals.push('bronze_refrigeracion');
        medalEarned.style.display='block';
        document.getElementById('rNewMedal').textContent='â„ï¸';
        document.getElementById('rMedalName').textContent='Â¡MEDALLA DE REFRIGERACIÃ“N DESBLOQUEADA!\nMaestro de RefrigeraciÃ³n';
        saveProfile();
    }
    
    // Enhanced celebration based on score
    if(pct>=90){
        // EPIC celebration - confetti + video + fanfare
        cft();
        setTimeout(()=>cft(),800);
        setTimeout(()=>cft(),1600);
        showVideo('medalla',()=>{});
    }else if(pct>=70){
        cft();
        setTimeout(()=>cft(),1000);
    }else{
        cft();
    }
    speakText(msg);
    
    // Update retry button to show failed count
    const failedCount=quizData.length-quizRight;
    const retryBtn=document.querySelector('#s9 .bt[onclick="retryQuiz()"]');
    if(retryBtn){
        if(failedCount>0&&pct<100){
            retryBtn.textContent=D.lang==='es'?'ðŸ”„ Repasar las '+failedCount+' que fallÃ©':'ðŸ”„ Review the '+failedCount+' I missed';
            retryBtn.style.display='block';
        }else{
            retryBtn.textContent=D.lang==='es'?'ðŸ”„ Â¡Perfecto! Intentar de Nuevo':'ðŸ”„ Perfect! Try Again';
        }
    }
    
    // Show study zone redirect if score < 100%
    const studyRedirect=document.getElementById('rStudyRedirect');
    const wrongCount=getStudyQuestions().length;
    if(pct<100&&wrongCount>0){
        studyRedirect.style.display='block';
        document.getElementById('rStudyDesc').textContent=D.lang==='es'?
            'Tienes '+wrongCount+' preguntas que necesitas reforzar. Ve a la Zona de Repaso para dominarlas.':
            'You have '+wrongCount+' questions to review. Go to the Review Zone to master them.';
    // Update redirect button text
    const redirectTitle=document.querySelector('#rStudyRedirect .study-redirect-title');
    if(redirectTitle)redirectTitle.textContent=D.lang==='es'?'Â¡El Maestro Mario te recomienda repasar!':'Maestro Mario recommends you review!';
    }else{
        studyRedirect.style.display='none';
    }
}

// ========== PROFILE & MEDAL SYSTEM ==========
const MEDALS_DEF=[
    {id:'bronze_principiante',icon:'ðŸ¥‰',name:'Bronce Principiante',name_en:'Bronze Beginner',desc:'100% en quiz principiante',desc_en:'100% on beginner quiz'},
    {id:'silver_principiante',icon:'ðŸ¥ˆ',name:'Plata Principiante',name_en:'Silver Beginner',desc:'100% dos veces seguidas',desc_en:'100% twice in a row'},
    {id:'gold_principiante',icon:'ðŸ¥‡',name:'Oro Principiante',name_en:'Gold Beginner',desc:'100% tres veces seguidas',desc_en:'100% three times in a row'},
    {id:'bronze_electricidad',icon:'âš¡',name:'Maestro ElÃ©ctrico',name_en:'Electrical Master',desc:'100% en quiz de electricidad',desc_en:'100% on electrical quiz'},
    {id:'bronze_refrigeracion',icon:'â„ï¸',name:'Maestro RefrigeraciÃ³n',name_en:'Refrigeration Master',desc:'100% en quiz de refrigeraciÃ³n',desc_en:'100% on refrigeration quiz'},
    {id:'streak_5',icon:'ðŸ”¥',name:'En Llamas',name_en:'On Fire',desc:'Racha de 5 correctas',desc_en:'Streak of 5 correct'},
    {id:'streak_10',icon:'âš¡',name:'Imparable',name_en:'Unstoppable',desc:'Racha de 10 correctas',desc_en:'Streak of 10 correct'},
    {id:'streak_20',icon:'ðŸ’¥',name:'Leyenda',name_en:'Legend',desc:'Racha de 20 correctas',desc_en:'Streak of 20 correct'},
    {id:'quiz_5',icon:'ðŸ“',name:'Estudiante',name_en:'Student',desc:'Completar 5 quizzes',desc_en:'Complete 5 quizzes'},
    {id:'quiz_15',icon:'ðŸ“š',name:'Estudioso',name_en:'Scholar',desc:'Completar 15 quizzes',desc_en:'Complete 15 quizzes'},
    {id:'correct_100',icon:'ðŸ’¯',name:'CenturiÃ³n',name_en:'Centurion',desc:'100 respuestas correctas',desc_en:'100 correct answers'},
    {id:'correct_500',icon:'ðŸŒŸ',name:'Maestro en Entrenamiento',name_en:'Master in Training',desc:'500 respuestas correctas',desc_en:'500 correct answers'},
    {id:'level_5',icon:'â­',name:'Nivel 5',name_en:'Level 5',desc:'Alcanzar nivel 5',desc_en:'Reach level 5'},
    {id:'level_10',icon:'ðŸ‘‘',name:'Nivel 10',name_en:'Level 10',desc:'Alcanzar nivel 10',desc_en:'Reach level 10'}
];

const LEVEL_TITLES_ES={
    1:'Aprendiz Novato',2:'Aprendiz',3:'Ayudante',4:'TÃ©cnico Jr.',5:'TÃ©cnico',
    6:'TÃ©cnico Senior',7:'Especialista',8:'Experto',9:'Maestro',10:'Gran Maestro',};
const LEVEL_TITLES_EN={
    1:'Rookie Apprentice',2:'Apprentice',3:'Helper',4:'Jr. Technician',5:'Technician',
    6:'Senior Technician',7:'Specialist',8:'Expert',9:'Master',10:'Grand Master',};
function getLevelTitle(lvl){return D.lang==='es'?(LEVEL_TITLES_ES[lvl]||'Leyenda'):(LEVEL_TITLES_EN[lvl]||'Legend');}
const LEVEL_TITLES={
    1:'Aprendiz Novato',2:'Aprendiz',3:'Ayudante',4:'TÃ©cnico Jr.',5:'TÃ©cnico',
    6:'TÃ©cnico Senior',7:'Especialista',8:'Experto',9:'Maestro',10:'Gran Maestro',
    11:'Leyenda HVAC',12:'Maestro Supremo',15:'Dios del HVAC'
};

let profile={level:1,xp:0,xpNeeded:100,totalCorrect:0,totalAnswered:0,quizzesTaken:0,bestStreak:0,medals:[],perfectStreakCount:0,avatar:'novato'};
let bestStreak=0;

const AVATARS=[
    // === STARTER (always available) ===
    {id:'novato',icon:'ðŸ‘¤',name:'Novato',cat:'starter',unlock:'always'},
    {id:'aprendiz',icon:'ðŸ§‘â€ðŸ”§',name:'Aprendiz',cat:'starter',unlock:'always'},
    {id:'casco',icon:'ðŸ‘·',name:'Casco Duro',cat:'starter',unlock:'always'},
    {id:'tools',icon:'ðŸ”§',name:'Herramientas',cat:'starter',unlock:'always'},
    
    // === ELECTRICIDAD (unlock with electricity mastery) ===
    {id:'voltimetro',icon:'âš¡',name:'VoltÃ­metro',cat:'electric',unlock:'quiz',quizId:'electricidad',minPct:50,desc:'50% en Electricidad'},
    {id:'multimetro',icon:'ðŸ”¬',name:'MultÃ­metro',cat:'electric',unlock:'quiz',quizId:'electricidad',minPct:70,desc:'70% en Electricidad'},
    {id:'megger',icon:'ðŸ’¡',name:'Megger Pro',cat:'electric',unlock:'quiz',quizId:'electricidad',minPct:90,desc:'90% en Electricidad'},
    {id:'maestro_elec',icon:'ðŸ—²',name:'Maestro ElÃ©ctrico',cat:'electric',unlock:'quiz',quizId:'electricidad',minPct:100,desc:'100% en Electricidad'},
    
    // === REFRIGERACIÃ“N (unlock with refrigeration mastery) ===
    {id:'manifold',icon:'ðŸ§Š',name:'Manifold Gauges',cat:'refrig',unlock:'quiz',quizId:'refrigeracion',minPct:50,desc:'50% en RefrigeraciÃ³n'},
    {id:'txv',icon:'â„ï¸',name:'VÃ¡lvula TXV',cat:'refrig',unlock:'quiz',quizId:'refrigeracion',minPct:70,desc:'70% en RefrigeraciÃ³n'},
    {id:'recovery',icon:'ðŸ”µ',name:'Recovery Machine',cat:'refrig',unlock:'quiz',quizId:'refrigeracion',minPct:90,desc:'90% en RefrigeraciÃ³n'},
    {id:'maestro_ref',icon:'â˜ƒï¸',name:'Maestro Refrig.',cat:'refrig',unlock:'quiz',quizId:'refrigeracion',minPct:100,desc:'100% en RefrigeraciÃ³n'},
    
    // === AIRE ACONDICIONADO (unlock with AC mastery) ===
    {id:'anemometer',icon:'ðŸŒ€',name:'AnemÃ³metro',cat:'ac',unlock:'quiz',quizId:'ac_residencial',minPct:50,desc:'50% en AC Resid.'},
    {id:'thermostat',icon:'ðŸŒ¡ï¸',name:'Termostato',cat:'ac',unlock:'quiz',quizId:'ac_residencial',minPct:70,desc:'70% en AC Resid.'},
    {id:'minisplit',icon:'ðŸ§Š',name:'Mini Split Pro',cat:'ac',unlock:'quiz',quizId:'ac_comercial',minPct:70,desc:'70% en AC Comerc.'},
    {id:'maestro_ac',icon:'ðŸ”ï¸',name:'Maestro AC',cat:'ac',unlock:'quiz',quizId:'ac_residencial',minPct:100,desc:'100% en AC'},
    
    // === POR NIVEL (unlock with level progression) ===
    {id:'pinzas',icon:'ðŸ”©',name:'Pinzas',cat:'level',unlock:'level',minLevel:2,desc:'Nivel 2'},
    {id:'desarmador',icon:'ðŸª›',name:'Desarmador',cat:'level',unlock:'level',minLevel:3,desc:'Nivel 3'},
    {id:'drill',icon:'ðŸ”¨',name:'Taladro',cat:'level',unlock:'level',minLevel:5,desc:'Nivel 5'},
    {id:'soldadura',icon:'ðŸ”¥',name:'Soplete',cat:'level',unlock:'level',minLevel:7,desc:'Nivel 7'},
    {id:'experto',icon:'â­',name:'Experto',cat:'level',unlock:'level',minLevel:10,desc:'Nivel 10'},
    {id:'birrete',icon:'ðŸŽ“',name:'Graduado',cat:'level',unlock:'level',minLevel:12,desc:'Nivel 12'},
    {id:'corona',icon:'ðŸ‘‘',name:'Rey del HVAC',cat:'level',unlock:'level',minLevel:15,desc:'Nivel 15'},
    
    // === POR LOGROS (unlock with stats) ===
    {id:'racha5',icon:'ðŸ”¥',name:'En Llamas',cat:'achieve',unlock:'streak',minStreak:5,desc:'Racha de 5'},
    {id:'racha10',icon:'ðŸ’¥',name:'Imparable',cat:'achieve',unlock:'streak',minStreak:10,desc:'Racha de 10'},
    {id:'cent',icon:'ðŸ’¯',name:'Centenario',cat:'achieve',unlock:'correct',minCorrect:100,desc:'100 correctas'},
    {id:'quinientos',icon:'ðŸŒŸ',name:'500 Club',cat:'achieve',unlock:'correct',minCorrect:500,desc:'500 correctas'},
    {id:'triple',icon:'ðŸ†',name:'Triple Amenaza',cat:'achieve',unlock:'triple',desc:'Dominar Elec+Refrig+AC'},
    {id:'leyenda',icon:'ðŸ’Ž',name:'Leyenda HVAC',cat:'achieve',unlock:'correct',minCorrect:1000,desc:'1000 correctas'}
];

function isAvatarUnlocked(av){
    if(av.unlock==='always')return true;
    const scores=JSON.parse(localStorage.getItem('maestro_quiz_scores')||'{}');
    
    if(av.unlock==='quiz'){
        const score=scores[av.quizId]||0;
        return score>=av.minPct;
    }
    if(av.unlock==='level'){
        return profile.level>=av.minLevel;
    }
    if(av.unlock==='streak'){
        return profile.bestStreak>=av.minStreak;
    }
    if(av.unlock==='correct'){
        return profile.totalCorrect>=av.minCorrect;
    }
    if(av.unlock==='triple'){
        // Must have â‰¥80% in electricidad AND refrigeracion AND ac_residencial
        return (scores['electricidad']||0)>=80 && (scores['refrigeracion']||0)>=80 && (scores['ac_residencial']||0)>=80;
    }
    return false;
}

function toggleAvatarPicker(){
    const picker=document.getElementById('avatarPicker');
    picker.classList.toggle('open');
    if(picker.classList.contains('open')){
        renderAvatarGrid();
    }
}

function renderAvatarGrid(){
    const grid=document.getElementById('avatarGrid');
    
    const sections=[
        {key:'starter',title:'ðŸ”§ Disponibles',avatars:AVATARS.filter(a=>a.cat==='starter')},
        {key:'electric',title:'âš¡ Electricidad',avatars:AVATARS.filter(a=>a.cat==='electric')},
        {key:'refrig',title:'â„ï¸ RefrigeraciÃ³n',avatars:AVATARS.filter(a=>a.cat==='refrig')},
        {key:'ac',title:'ðŸŒ€ Aire Acondicionado',avatars:AVATARS.filter(a=>a.cat==='ac')},
        {key:'level',title:'ðŸ“ˆ Por Nivel',avatars:AVATARS.filter(a=>a.cat==='level')},
        {key:'achieve',title:'ðŸ† Logros',avatars:AVATARS.filter(a=>a.cat==='achieve')}
    ];
    
    let html='';
    sections.forEach(sec=>{
        const unlockedCount=sec.avatars.filter(a=>isAvatarUnlocked(a)).length;
        html+='<div class="avatar-section">';
        html+='<div class="avatar-section-title">'+sec.title+' <span style="color:var(--electric);font-size:10px">('+unlockedCount+'/'+sec.avatars.length+')</span></div>';
        html+='<div class="avatar-grid">';
        sec.avatars.forEach(av=>{
            const unlocked=isAvatarUnlocked(av);
            const selected=profile.avatar===av.id;
            const cls='avatar-option'+(selected?' selected':'')+(unlocked?'':' locked');
            if(unlocked){
                html+='<div class="'+cls+'" onclick="selectAvatar(\''+av.id+'\')">';
                html+='<div class="av-icon">'+av.icon+'</div>';
                html+='<div class="av-name">'+av.name+'</div>';
                html+='</div>';
            }else{
                html+='<div class="'+cls+'" onclick="showAvatarLockMsg(\''+av.desc.replace(/'/g,"\\'")+'\')" title="'+av.desc+'">';
                html+='<div class="av-icon">ðŸ”’</div>';
                html+='<div class="av-name">'+av.name+'</div>';
                html+='<div class="av-lock">'+av.desc+'</div>';
                html+='</div>';
            }
        });
        html+='</div></div>';
    });
    
    grid.innerHTML=html;
}

function showAvatarLockMsg(desc){
    const bubble=document.getElementById('studyBubble')||document.getElementById('hubBubble');
    // Simple alert for now
    const msg=D.lang==='es'?'ðŸ”’ Para desbloquear este avatar necesitas: '+desc:'ðŸ”’ To unlock this avatar you need: '+desc;
    alert(msg);
}

function selectAvatar(avatarId){
    const av=AVATARS.find(a=>a.id===avatarId);
    if(!av||!isAvatarUnlocked(av))return;
    profile.avatar=avatarId;
    saveProfile();
    const icon=av.icon;
    document.getElementById('profAvatar').innerHTML=icon+'<div class="prof-avatar-edit">âœï¸</div>';
    document.getElementById('profileBtn').textContent=icon;
    document.getElementById('avatarPicker').classList.remove('open');
    renderAvatarGrid();
}

function getAvatarIcon(avatarId){
    const av=AVATARS.find(a=>a.id===avatarId);
    return av?av.icon:'ðŸ‘¤';
}

function getTitle(lvl){
    let title='Aprendiz';
    for(let l of Object.keys(LEVEL_TITLES).map(Number).sort((a,b)=>b-a)){
        if(lvl>=l){title=LEVEL_TITLES[l];break;}
    }
    return title;
}

function checkAutoMedals(){
    if(bestStreak>=5&&!profile.medals.includes('streak_5'))profile.medals.push('streak_5');
    if(bestStreak>=10&&!profile.medals.includes('streak_10'))profile.medals.push('streak_10');
    if(bestStreak>=20&&!profile.medals.includes('streak_20'))profile.medals.push('streak_20');
    if(profile.quizzesTaken>=5&&!profile.medals.includes('quiz_5'))profile.medals.push('quiz_5');
    if(profile.quizzesTaken>=15&&!profile.medals.includes('quiz_15'))profile.medals.push('quiz_15');
    if(profile.totalCorrect>=100&&!profile.medals.includes('correct_100'))profile.medals.push('correct_100');
    if(profile.totalCorrect>=500&&!profile.medals.includes('correct_500'))profile.medals.push('correct_500');
    if(profile.level>=5&&!profile.medals.includes('level_5'))profile.medals.push('level_5');
    if(profile.level>=10&&!profile.medals.includes('level_10'))profile.medals.push('level_10');
}

function saveProfile(){
    checkAutoMedals();
    try{localStorage.setItem('maestro_profile',JSON.stringify(profile));}catch(e){}
}

function loadProfile(){
    try{
        const saved=localStorage.getItem('maestro_profile');
        if(saved){
            const p=JSON.parse(saved);
            Object.assign(profile,p);
            // Migrate old emoji avatars to new ID system
            if(profile.avatar&&!AVATARS.find(a=>a.id===profile.avatar)){
                // Old system used emojis, map to closest new ID
                const emojiMap={'ðŸ‘¤':'novato','ðŸ§‘â€ðŸ”§':'aprendiz','ðŸ‘·':'casco','ðŸ”§':'tools','âš¡':'voltimetro','ðŸ”¥':'racha5','â„ï¸':'txv','ðŸ§Š':'manifold','ðŸŒŸ':'quinientos','ðŸ’Ž':'leyenda','ðŸ†':'triple','ðŸ‘‘':'corona','âš™ï¸':'desarmador','ðŸŒ€':'anemometer','ðŸ’ª':'drill'};
                profile.avatar=emojiMap[profile.avatar]||'novato';
                saveProfile();
            }
            document.getElementById('profileBtn').classList.add('active');
            document.getElementById('profileBtn').textContent=getAvatarIcon(profile.avatar);
            if(D.name)D.gender=detectGender(D.name);
        }
    }catch(e){}
}

function renderProfile(){
    const icon=getAvatarIcon(profile.avatar);
    document.getElementById('profAvatar').innerHTML=icon+'<div class="prof-avatar-edit">âœï¸</div>';
    document.getElementById('profileBtn').textContent=icon;
    document.getElementById('profName').textContent=D.name||gn('TÃ©cnico','TÃ©cnica');
    document.getElementById('profTitle').textContent=getTitle(profile.level);
    document.getElementById('profLevel').textContent=profile.level;
    const xpPct=Math.round((profile.xp/profile.xpNeeded)*100);
    document.getElementById('profXpBar').style.width=xpPct+'%';
    document.getElementById('profXpTxt').textContent=profile.xp+' / '+profile.xpNeeded+' XP';
    document.getElementById('profPts').textContent=profile.totalCorrect*10;
    const acc=profile.totalAnswered>0?Math.round((profile.totalCorrect/profile.totalAnswered)*100):0;
    document.getElementById('profAcc').textContent=acc+'%';
    document.getElementById('profStrk').textContent=profile.bestStreak;
    
    // Medals grid
    document.getElementById('medalsGrid').innerHTML=MEDALS_DEF.map(m=>{
        const earned=profile.medals.includes(m.id);
        const mName=D.lang==='es'?m.name:(m.name_en||m.name);
        const mDesc=D.lang==='es'?m.desc:(m.desc_en||m.desc);
        return '<div class="medal-slot'+(earned?' earned':'')+'"><div class="medal-icon">'+(earned?m.icon:'ðŸ”’')+'</div><div class="medal-name">'+mName+'</div><div style="font-size:10px;color:var(--muted);margin-top:2px">'+mDesc+'</div></div>';
    }).join('');

    // Load cross-app progress from Supabase
    loadCrossAppProgress().then(function(data){
      if(!data) return;
      var section = document.getElementById('crossAppSection');
      section.style.display = 'block';
      document.getElementById('crossV2Quizzes').textContent = data.v2_quizzes || 0;
      document.getElementById('crossV1Quizzes').textContent = data.v1_quizzes || 0;
      document.getElementById('crossTotalQuizzes').textContent = data.total_quizzes || 0;
      document.getElementById('crossAvgScore').textContent = (data.overall_avg_score || 0) + '%';
      document.getElementById('crossCerts').textContent = data.total_certificates || 0;
      
      if(D.lang==='en'){
        document.getElementById('crossAppTitle').textContent = 'Total Progress';
        document.getElementById('crossTotalLabel').textContent = 'Total Quizzes';
        document.getElementById('crossAvgLabel').textContent = 'Average';
        document.getElementById('crossCertsLabel').textContent = 'Certificates';
      }
    }).catch(function(){});
}

// Load profile on start
loadProfile();

// Close music panel on outside click
document.addEventListener('click',e=>{
    const panel=document.getElementById('musicPanel');
    const btn=document.getElementById('musicBtn');
    const setBtn=document.querySelector('.music-settings');
    if(musicPanelOpen&&!panel.contains(e.target)&&e.target!==btn&&e.target!==setBtn){
        musicPanelOpen=false;
        panel.classList.remove('open');
    }
});

document.getElementById('nm').addEventListener('keydown',e=>{if(e.key==='Enter'&&e.target.value.trim().length>=2)sName();});

// ========== 3-ZONE SYSTEM ==========

// === WRONG ANSWER TRACKER ===
// Stores: { "questionHash": { q, cat, fails, lastFail, masteredAt, quizId } }
function getTracker(){
    try{return JSON.parse(localStorage.getItem('maestro_study_tracker')||'{}');}catch(e){return{};}
}
function saveTracker(t){
    try{localStorage.setItem('maestro_study_tracker',JSON.stringify(t));}catch(e){}
}

function questionHash(q){
    // Simple hash from question text
    return q.q.substring(0,60).replace(/[^a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃ±]/g,'').toLowerCase();
}

function trackAnswer(q,correct){
    const tracker=getTracker();
    const hash=questionHash(q);
    if(!tracker[hash]){
        tracker[hash]={q:q.q,cat:q.cat,fails:0,correct:0,lastFail:null,masteredAt:null,quizId:currentQuizId,
            // Store full question for study mode
            fullQ:{cat:q.cat,q:q.q,o:[...q.o],c:q.c,e:q.e,a:q.a}
        };
    }
    if(correct){
        tracker[hash].correct++;
        // If they get it right 2 times after failing, mark as mastered
        if(tracker[hash].fails>0&&tracker[hash].correct>=2){
            tracker[hash].masteredAt=Date.now();
        }
    }else{
        tracker[hash].fails++;
        tracker[hash].lastFail=Date.now();
        tracker[hash].masteredAt=null; // Reset mastery if they fail again
        tracker[hash].correct=0; // Reset correct streak
    }
    saveTracker(tracker);
}

function getStudyQuestions(catFilter){
    const tracker=getTracker();
    const questions=[];
    for(const hash in tracker){
        const t=tracker[hash];
        // Include if: failed at least 1 time AND not mastered yet
        if(t.fails>=1&&!t.masteredAt&&t.fullQ){
            if(!catFilter||t.cat===catFilter){
                questions.push({...t.fullQ,_hash:hash,_fails:t.fails});
            }
        }
    }
    // Sort by most fails first
    questions.sort((a,b)=>b._fails-a._fails);
    return questions;
}

function getStudyCategories(){
    const questions=getStudyQuestions();
    const cats={};
    questions.forEach(q=>{
        if(!cats[q.cat])cats[q.cat]={count:0,icon:q.cat.split(' ')[0]};
        cats[q.cat].count++;
    });
    return cats;
}

// === HUB FUNCTIONS ===
function updateLanguageUI(){
    const es=D.lang==='es';
    // Helper to set text by ID
    function tx(id,esT,enT){const el=document.getElementById(id);if(el)el.textContent=es?esT:enT;}
    function txH(id,esT,enT){const el=document.getElementById(id);if(el)el.innerHTML=es?esT:enT;}
    
    // === HUB ZONES ===
    tx('hubQuizName','Quiz Zone','Quiz Zone');
    tx('hubQuizDesc',es?'Toma quizzes y demuestra lo que sabes':'Take quizzes and show what you know','Take quizzes and show what you know');
    tx('hubQuizBadge',es?'Â¡Vamos!':'Let\'s go!','Let\'s go!');
    tx('hubRepasoName',es?'Zona de Repaso':'Review Zone','Review Zone');
    tx('hubRepasoDesc',es?'Repasa solo las preguntas que fallaste en los quizzes':'Review only the questions you missed in quizzes','Review only the questions you missed in quizzes');
    tx('hubEstudioName',es?'Zona de Estudio':'Study Zone','Study Zone');
    tx('hubEstudioDesc',es?'Todas las preguntas con explicaciones detalladas, fÃ³rmulas y ejemplos de campo':'All questions with detailed explanations, formulas and field examples','All questions with detailed explanations, formulas and field examples');
    tx('hubVideoName','Video Zone','Video Zone');
    tx('hubVideoDesc',es?'Videos de Maestro Mario para aprender visualmente':'Maestro Mario videos to learn visually','Maestro Mario videos to learn visually');
    tx('hubProfileBtn',es?'ðŸ‘¤ Mi Perfil':'ðŸ‘¤ My Profile','ðŸ‘¤ My Profile');
    tx('hubRutaBtn',es?'â† Mi Ruta':'â† My Path','â† My Path');
    
    // === SECTION TITLES ===
    tx('repasoTitle',es?'ðŸ”„ ZONA DE REPASO':'ðŸ”„ REVIEW ZONE','ðŸ”„ REVIEW ZONE');
    tx('estudioTitle',es?'ðŸ“– ZONA DE ESTUDIO':'ðŸ“– STUDY ZONE','ðŸ“– STUDY ZONE');
    
    // === QUIZ SELECTOR ===
    tx('quizSelBubble',es?'Â¿QuÃ© quiz quieres tomar hoy?':'Which quiz do you want to take today?','Which quiz do you want to take today?');
    
    // === STUDY ZONE ===
    const sb=document.getElementById('studyBubble');
    if(sb&&!sb.textContent)sb.textContent=es?'AquÃ­ repasamos lo que necesitas reforzar.':'Here we review what you need to strengthen.';
    
    // === LIBRARY ===
    tx('floatLibBtn',es?'ðŸ“– Zona de Estudio':'ðŸ“– Study Zone','ðŸ“– Study Zone');
    const lb=document.getElementById('libraryBubble');
    if(lb&&(!lb.textContent||lb.textContent.includes('estudiar')||lb.textContent.includes('study')))
        lb.textContent=es?'AquÃ­ puedes estudiar TODAS las preguntas con explicaciones detalladas y ejemplos de campo.':'Here you can study ALL questions with detailed explanations and field examples.';
    
    // === VIDEO ZONE ===
    tx('videoBubble',es?'Videos del Maestro Mario para que aprendas viendo.':'Maestro Mario videos to learn by watching.','Maestro Mario videos to learn by watching.');
    
    // === AI CHAT ===
    tx('aiChatStatus',es?'ðŸŸ¢ Disponible para ayudarte':'ðŸŸ¢ Available to help you','ðŸŸ¢ Available to help you');
    tx('aiChatWelcome',es?'Â¡Ã“rale '+(D.name||gn('tÃ©cnico','tÃ©cnica'))+'! Soy el Maestro Mario con inteligencia artificial. Â¿En quÃ© te puedo ayudar? PregÃºntame lo que quieras sobre HVAC, refrigeraciÃ³n, o electricidad. ðŸ”§':'Hey '+(D.name||'technician')+'! I\'m Maestro Mario with AI. How can I help? Ask me anything about HVAC, refrigeration, or electrical. ðŸ”§','');
    tx('aiChatTyping',es?'Maestro Mario estÃ¡ hablando...':'Maestro Mario is typing...','Maestro Mario is typing...');
    
    // === AVATAR & MUSIC ===
    tx('avatarPickerTitle',es?'ðŸ”§ Elige tu Avatar':'ðŸ”§ Choose your Avatar','ðŸ”§ Choose your Avatar');
    tx('avatarPickerSub',es?'Desbloquea avatares dominando quizzes y subiendo de nivel':'Unlock avatars by mastering quizzes and leveling up','Unlock avatars by mastering quizzes and leveling up');
    tx('musicPanelTitle',es?'ðŸŽ¶ Elige tu mÃºsica':'ðŸŽ¶ Choose your music','ðŸŽ¶ Choose your music');
    
    // === FORMULA HINT DEFAULT ===
    const ft=document.getElementById('qFormToggleText');
    if(ft&&!ft.textContent)ft.textContent=es?'Mario te da una pista â€” tÃ³came':'Mario gives you a hint â€” tap me';
    
    // === QUIZ NAV BUTTONS (defaults) ===
    const qp=document.getElementById('qPrev');if(qp&&!qp.textContent)qp.textContent=es?'â† Anterior':'â† Previous';
    const qn=document.getElementById('qNext');if(qn&&!qn.textContent)qn.textContent=es?'Siguiente â†’':'Next â†’';
    const sp=document.getElementById('sqPrev');if(sp&&!sp.textContent)sp.textContent=es?'â† Anterior':'â† Previous';
    const sn=document.getElementById('sqNext');if(sn&&!sn.textContent)sn.textContent=es?'Siguiente â†’':'Next â†’';
    
    // === RESULT PAGE ===
    tx('retryBtn',es?'ðŸ”„ Intentar de Nuevo':'ðŸ”„ Try Again','ðŸ”„ Try Again');
    tx('otherQuizBtn',es?'ðŸ“ Otro Quiz':'ðŸ“ Another Quiz','ðŸ“ Another Quiz');
    tx('viewProfileBtn',es?'ðŸ‘¤ Ver Mi Perfil':'ðŸ‘¤ View My Profile','ðŸ‘¤ View My Profile');
    tx('studyRedirectTitle',es?'Â¡El Maestro Mario te recomienda repasar!':'Maestro Mario recommends you review!','Maestro Mario recommends you review!');
    
    // === STUDY RESULT ===
    tx('studyRetryBtn',es?'ðŸ”„ Repasar de Nuevo':'ðŸ”„ Review Again','ðŸ”„ Review Again');
    tx('studyZoneRepasoBtn',es?'ðŸ”„ Zona de Repaso':'ðŸ”„ Review Zone','ðŸ”„ Review Zone');
    
    // === VIDEO ===
    tx('videoLabel',es?'ðŸ”´ EN VIVO':'ðŸ”´ LIVE','ðŸ”´ LIVE');
    
    // === NEWBIE ZONE ===
    tx('hubNewbieName',es?'Soy Nuevo en HVAC':'I\'m New to HVAC','I\'m New to HVAC');
    tx('hubNewbieDesc',es?'IntroducciÃ³n a HVACR: la industria, herramientas, terminologÃ­a, salarios y cÃ³mo empezar tu carrera':'Intro to HVACR: the industry, tools, terminology, salary, and how to start your career','Intro to HVACR: the industry, tools, terminology, salary, and how to start your career');
    tx('hubNewbieBadge',es?'Nivel 1':'Level 1','Level 1');
    tx('hubNewbieStat',es?'ðŸŽ“ 8 temas + 50 preguntas':'ðŸŽ“ 8 topics + 50 questions','ðŸŽ“ 8 topics + 50 questions');
    
    // === PROFILE PAGE ===
    tx('profLevelLabel',es?'NIVEL':'LEVEL','LEVEL');
    tx('profPtsLabel',es?'Puntos':'Points','Points');
    tx('profAccLabel',es?'PrecisiÃ³n':'Accuracy','Accuracy');
    tx('profStrkLabel',es?'Mejor Racha':'Best Streak','Best Streak');
    tx('profMedalsTitle',es?'ðŸ… Medallas':'ðŸ… Medals','ðŸ… Medals');
    tx('profQuizBtn',es?'ðŸ“ Tomar un Quiz':'ðŸ“ Take a Quiz','ðŸ“ Take a Quiz');
    tx('profMusicBtn',es?'ðŸŽ¶ Cambiar MÃºsica':'ðŸŽ¶ Change Music','ðŸŽ¶ Change Music');
    tx('exitAppBtn',es?'ðŸšª Salir del App':'ðŸšª Exit App','ðŸšª Exit App');
    tx('avatarPickerTitle',es?'ðŸ”§ Elige tu Avatar':'ðŸ”§ Choose your Avatar','ðŸ”§ Choose your Avatar');
    tx('avatarPickerSub',es?'Desbloquea avatares dominando quizzes y subiendo de nivel':'Unlock avatars by mastering quizzes and leveling up','Unlock avatars by mastering quizzes and leveling up');
    
    // === ALL "Volver al Hub" BUTTONS ===
    document.querySelectorAll('[data-lang="volver-hub"]').forEach(b=>{b.textContent=es?'â† Volver al Hub':'â† Back to Hub';});
    
    // === LANG-REPASO-BTN ===
    document.querySelectorAll('.lang-repaso-btn').forEach(b=>{b.textContent=es?'ðŸ”„ Ir a Zona de Repaso â†’':'ðŸ”„ Go to Review Zone â†’';});
}

function updateHub(){
    updateLanguageUI();
    // Quiz zone stats
    const totalQuizzes=QUIZ_LIST.length;
    const totalQs=QUIZ_LIST.reduce((s,q)=>s+q.count,0);
    document.getElementById('hubQuizCount').textContent='ðŸ“‹ '+totalQuizzes+' quizzes';
    document.getElementById('hubQuizTotal').textContent='ðŸ“Š '+totalQs+(D.lang==='es'?' preguntas':' questions');
    
    // Study zone stats
    const studyQs=getStudyQuestions();
    document.getElementById('hubStudyCount').textContent='ðŸ”„ '+studyQs.length+(D.lang==='es'?' por repasar':' to review');
    const studyBadge=document.getElementById('hubStudyBadge');
    if(studyQs.length>0){
        studyBadge.style.display='block';
        studyBadge.textContent=studyQs.length>=10?'ðŸ”¥ '+studyQs.length:studyQs.length>=5?'âš ï¸ '+studyQs.length:(D.lang==='es'?'ðŸ“– Repasa':'ðŸ“– Review');
    }else{
        studyBadge.style.display='none';
    }
    
    // Hub bubble message
    const bubble=document.getElementById('hubBubble');
    if(studyQs.length>=10){
        bubble.textContent=D.lang==='es'?'Â¡'+D.name+'! Tienes '+studyQs.length+' preguntas por repasar. Â¡Ve a la Zona de Repaso!':''+D.name+'! You have '+studyQs.length+' questions to review. Hit the Review Zone!';
    }else if(studyQs.length>0){
        bubble.textContent=D.lang==='es'?'Â¿QuÃ© quieres hacer hoy, '+D.name+'? Tienes '+studyQs.length+' preguntas pendientes de repaso.':'What do you want to do, '+D.name+'? You have '+studyQs.length+' questions to review.';
    }else{
        bubble.textContent=D.lang==='es'?'Â¡'+D.name+'! Â¿Listo para aprender? Elige tu zona.':''+D.name+'! Ready to learn? Pick your zone.';
    }
    
    // Library zone stats
    updateHubLibraryCount();
}

function goQuizZone(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    renderQuizSelector();
    go('s7b');
    speakText(D.lang==='es'?'Â¡Vamos con los quizzes, '+D.name+'! Elige cuÃ¡l quieres tomar.':'Let\'s do quizzes, '+D.name+'! Pick which one you want.');
}

function goStudyZone(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    renderStudyZone();
    go('s-study');
    const count=getStudyQuestions().length;
    if(count>0){
        speakText(D.lang==='es'?'Zona de estudio, '+D.name+'. Tienes '+count+' preguntas para repasar. Â¡Vamos a dominarlas!':'Study zone, '+D.name+'. You have '+count+' questions to review. Let\'s master them!');
    }else{
        speakText(D.lang==='es'?'Â¡'+D.name+', tu zona de estudio estÃ¡ limpia! Ve a tomar quizzes para practicar.':''+D.name+', your study zone is clean! Go take quizzes to practice.');
    }
}

function goVideoZone(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    renderVideoZone();
    go('s-videos');
    speakText(D.lang==='es'?'Zona de videos. Pronto tendrÃ¡s videos del Maestro Mario aquÃ­.':'Video zone. Maestro Mario videos coming soon.');
}

function goNewbieZone(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    go('s-newbie');
    renderNewbieZone();
    speakText(D.lang==='en'?'Welcome! Let me show you the basics of HVAC. This is where your journey begins!':'Â¡Bienvenido! DÃ©jame enseÃ±arte lo bÃ¡sico de HVAC. Â¡AquÃ­ empieza tu camino!');
}

function startIntroQuiz(){
    selectQuiz('intro');
}

function renderNewbieZone(){
    const en=D.lang==='en';
    document.getElementById('newbieTitle').textContent=en?'ðŸ†• I\'M NEW TO HVAC':'ðŸ†• SOY NUEVO EN HVAC';
    document.getElementById('newbieBubble').textContent=en?'Welcome to the HVAC world! Here\'s everything you need to know to get started.':'Â¡Bienvenido al mundo HVAC! AquÃ­ te explico todo lo que necesitas saber para empezar.';
    document.getElementById('newbieQuizBtn').textContent=en?'ðŸ“ Take Intro HVACR Quiz (50 questions)':'ðŸ“ Tomar Quiz Intro HVACR (50 preguntas)';
    const topics=en?[
        {icon:'â„ï¸',title:'What is HVAC?',text:'HVAC stands for <b>Heating, Ventilation, and Air Conditioning</b>. It\'s the system that keeps buildings comfortable â€” warm in winter, cool in summer, and with clean air year-round. As an HVAC technician, you\'ll install, maintain, and repair these systems.'},
        {icon:'ðŸ”§',title:'Basic Tools You Need',text:'Every tech needs: <b>Multimeter</b> (measures voltage, amps, ohms), <b>Manifold gauges</b> (measures refrigerant pressure), <b>Thermometer</b>, <b>Screwdrivers & wrenches</b>, <b>Vacuum pump</b> (removes moisture from systems), and <b>Refrigerant scale</b>.'},
        {icon:'âš¡',title:'Basic Electrical',text:'<b>Voltage (V)</b> = pressure that pushes electricity. <b>Current (A)</b> = flow of electrons. <b>Resistance (Î©)</b> = opposition to flow. <b>Ohm\'s Law: V = I Ã— R</b>. You\'ll use this EVERY day. Example: 240V Ã· 20A = 12Î©.'},
        {icon:'ðŸ§Š',title:'How Refrigeration Works',text:'Refrigeration moves heat from inside to outside using 4 components: <b>Compressor</b> (pumps refrigerant), <b>Condenser</b> (releases heat outside), <b>Metering device</b> (drops pressure), <b>Evaporator</b> (absorbs heat inside). The refrigerant cycles continuously.'},
        {icon:'ðŸŒ¡ï¸',title:'Key Measurements',text:'<b>Superheat</b> = how much the gas is heated above boiling point (suction line). <b>Subcooling</b> = how much the liquid is cooled below condensing point (liquid line). These tell you if the system has the right refrigerant charge.'},
        {icon:'ðŸ“œ',title:'Certifications You Need',text:'<b>EPA 608</b> â€” Required by law to handle refrigerants. <b>OSHA 10/30</b> â€” Safety training. <b>NATE</b> â€” Industry certification. <b>NCCER</b> â€” Construction certification. Start with EPA 608, it\'s mandatory!'},
        {icon:'ðŸ›¡ï¸',title:'Safety First!',text:'Always: <b>Lock out / Tag out (LOTO)</b> before working on equipment. Wear <b>PPE</b> (safety glasses, gloves, steel-toe boots). Never work on live circuits unless testing. Remember: <b>If you don\'t measure, you\'re guessing!</b>'},
        {icon:'ðŸ’°',title:'Career Path & Salary',text:'HVAC is one of the best trades! <b>Entry:</b> $18-25/hr. <b>Experienced:</b> $30-45/hr. <b>Business owner:</b> $100K-300K+/year. Start as a helper, get certified, gain field experience, then start your own company!'}
    ]:[
        {icon:'â„ï¸',title:'Â¿QuÃ© es HVAC?',text:'HVAC significa <b>Heating, Ventilation, and Air Conditioning</b> (CalefacciÃ³n, VentilaciÃ³n y Aire Acondicionado). Es el sistema que mantiene los edificios cÃ³modos. Como tÃ©cnico HVAC, instalarÃ¡s, darÃ¡s mantenimiento y repararÃ¡s estos sistemas.'},
        {icon:'ðŸ”§',title:'Herramientas BÃ¡sicas',text:'Todo tÃ©cnico necesita: <b>MultÃ­metro</b> (mide voltaje, amperaje, ohms), <b>Manifold gauges</b> (mide presiÃ³n de refrigerante), <b>TermÃ³metro</b>, <b>Desarmadores y llaves</b>, <b>Bomba de vacÃ­o</b>, y <b>BÃ¡scula de refrigerante</b>.'},
        {icon:'âš¡',title:'Electricidad BÃ¡sica',text:'<b>Voltaje (V)</b> = la presiÃ³n que empuja la electricidad. <b>Corriente (A)</b> = el flujo de electrones. <b>Resistencia (Î©)</b> = oposiciÃ³n al flujo. <b>Ley de Ohm: V = I Ã— R</b>. Esto lo usarÃ¡s TODOS los dÃ­as. Ejemplo: 240V Ã· 20A = 12Î©.'},
        {icon:'ðŸ§Š',title:'CÃ³mo Funciona la RefrigeraciÃ³n',text:'La refrigeraciÃ³n mueve calor de adentro hacia afuera con 4 componentes: <b>Compresor</b> (bombea refrigerante), <b>Condensador</b> (libera calor afuera), <b>Dispositivo de mediciÃ³n</b> (baja presiÃ³n), <b>Evaporador</b> (absorbe calor adentro).'},
        {icon:'ðŸŒ¡ï¸',title:'Mediciones Clave',text:'<b>Superheat</b> = cuÃ¡nto se calienta el gas arriba de su punto de ebulliciÃ³n (lÃ­nea de succiÃ³n). <b>Subcooling</b> = cuÃ¡nto se enfrÃ­a el lÃ­quido abajo de su punto de condensaciÃ³n (lÃ­nea de lÃ­quido). Te dicen si el sistema tiene la carga correcta.'},
        {icon:'ðŸ“œ',title:'Certificaciones Necesarias',text:'<b>EPA 608</b> â€” Requerida por ley para manejar refrigerantes. <b>OSHA 10/30</b> â€” Seguridad. <b>NATE</b> â€” CertificaciÃ³n de la industria. <b>NCCER</b> â€” CertificaciÃ³n de construcciÃ³n. Â¡Empieza con EPA 608, es obligatoria!'},
        {icon:'ðŸ›¡ï¸',title:'Â¡Seguridad Primero!',text:'Siempre: <b>Lock out / Tag out (LOTO)</b> antes de trabajar en equipos. Usa <b>EPP</b> (gafas, guantes, botas con punta de acero). Nunca trabajes en circuitos energizados. Recuerda: <b>Â¡Si no mides, estÃ¡s adivinando!</b>'},
        {icon:'ðŸ’°',title:'Carrera y Salario',text:'Â¡HVAC es uno de los mejores oficios! <b>Entrada:</b> $18-25/hr. <b>Experimentado:</b> $30-45/hr. <b>DueÃ±o de negocio:</b> $100K-300K+/aÃ±o. Empieza como ayudante, saca certificaciones, gana experiencia, Â¡y abre tu empresa!'}
    ];
    let html='';
    topics.forEach(t=>{
        html+='<div style="background:var(--card);border-radius:16px;padding:18px;border:1px solid rgba(255,255,255,0.06)">';
        html+='<div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">';
        html+='<span style="font-size:28px">'+t.icon+'</span>';
        html+='<span style="font-size:16px;font-weight:700;color:#3498db;font-family:Fredoka,sans-serif">'+t.title+'</span>';
        html+='</div>';
        html+='<div style="font-size:13px;line-height:1.7;color:var(--txt)">'+t.text+'</div>';
        html+='</div>';
    });
    document.getElementById('newbieContent').innerHTML=html;
}

// === STUDY ZONE RENDER ===
function renderStudyZone(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    const container=document.getElementById('studyContent');
    const questions=getStudyQuestions();
    const cats=getStudyCategories();
    const bubble=document.getElementById('studyBubble');
    
    if(questions.length===0){
        bubble.textContent=D.lang==='es'?'Â¡Felicidades '+D.name+'! No tienes preguntas pendientes. Ve a tomar quizzes.':'Congrats '+D.name+'! No pending questions. Go take quizzes.';
        container.innerHTML='<div class="study-empty">'+
            '<div class="study-empty-icon">ðŸŽ‰</div>'+
            '<div class="study-empty-title">'+(D.lang==='es'?'Â¡Todo limpio!':'All clean!')+'</div>'+
            '<div class="study-empty-desc">'+(D.lang==='es'?'No tienes preguntas por repasar. Â¡Sigue tomando quizzes para seguir aprendiendo!':'No questions to review. Keep taking quizzes to keep learning!')+'</div>'+
            '</div>'+
            '<button class="bt" onclick="goQuizZone()" style="margin-top:16px">'+(D.lang==='es'?'ðŸ“ Ir a Quiz Zone':'ðŸ“ Go to Quiz Zone')+'</button>';
        return;
    }
    
    bubble.textContent=D.lang==='es'?D.name+', tienes '+questions.length+' preguntas que necesitas reforzar. Â¡TÃº puedes!':D.name+', you have '+questions.length+' questions to strengthen. You got this!';
    
    let html='<div class="study-alert">ðŸ“š '+(D.lang==='es'?'Tienes <b>'+questions.length+' preguntas</b> que fallaste en los quizzes. RepÃ¡salas aquÃ­ hasta dominarlas.':'You have <b>'+questions.length+' questions</b> you missed in quizzes. Review them here until you master them.')+'</div>';
    
    // Show "Review All" button
    html+='<button class="bt" onclick="startStudyQuiz(\'all\')" style="margin-bottom:16px">ðŸ”¥ '+(D.lang==='es'?'Repasar Todas ('+questions.length+')':'Review All ('+questions.length+')')+'</button>';
    
    // Show by category
    for(const cat in cats){
        html+='<div class="study-topic" onclick="startStudyQuiz(\''+cat.replace(/'/g,"\\'")+'\')">';
        html+='<div class="study-topic-icon">'+cats[cat].icon+'</div>';
        html+='<div class="study-topic-info">';
        html+='<div class="study-topic-name">'+cat+'</div>';
        html+='<div class="study-topic-count">'+cats[cat].count+(D.lang==='es'?' preguntas por repasar':' questions to review')+'</div>';
        html+='</div></div>';
    }
    
    // Show mastered count
    const tracker=getTracker();
    const mastered=Object.values(tracker).filter(t=>t.masteredAt).length;
    if(mastered>0){
        html+='<div style="text-align:center;margin-top:20px;font-size:13px;color:var(--electric)">âœ… '+(D.lang==='es'?mastered+' preguntas dominadas':mastered+' questions mastered')+'</div>';
    }
    
    container.innerHTML=html;
}

// === STUDY QUIZ MODE ===
let studyData=[];
let studyIdx=0;
let studyRight=0;
let studyWrong=0;
let studyAnswered=false;
let studyAnswers=[];
let lastStudyCat='all';

function startStudyQuiz(catFilter){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    lastStudyCat=catFilter;
    const questions=catFilter==='all'?getStudyQuestions():getStudyQuestions(catFilter);
    if(questions.length===0){
        goStudyZone();
        return;
    }
    studyData=shuffleArray(questions);
    studyIdx=0;studyRight=0;studyWrong=0;
    studyAnswers=new Array(studyData.length).fill(-1);
    document.getElementById('sqRight').textContent='0';
    document.getElementById('sqWrong').textContent='0';
    go('s-study-quiz');
    showStudyQuestion();
}

function showStudyQuestion(){
    if(studyIdx>=studyData.length){showStudyResult();return;}
    const q=studyData[studyIdx];
    const alreadyAnswered=studyAnswers[studyIdx]>=0;
    studyAnswered=alreadyAnswered;
    const pct=Math.round((studyIdx/studyData.length)*100);
    document.getElementById('sqBar').style.width=pct+'%';
    document.getElementById('sqNum').textContent='ðŸ“š '+(D.lang==='es'?'Repaso ':'Review ')+(studyIdx+1)+' / '+studyData.length;
    document.getElementById('sqCat').textContent=q.cat;
    
    const prevBtn=document.getElementById('sqPrev');
    if(studyIdx>0){prevBtn.classList.add('show');}else{prevBtn.classList.remove('show');}
    
    if(alreadyAnswered){
        const userAnswer=studyAnswers[studyIdx];
        const correct=userAnswer===q.c;
        document.getElementById('sqBubble').textContent=correct?'âœ… Â¡Bien! Ya la dominas.':'âŒ Sigue intentando. La correcta es la '+['A','B','C','D'][q.c]+'.';
        document.getElementById('sqText').textContent=tq(q,'q');
        const letters=['A','B','C','D'];
        document.getElementById('sqOpts').innerHTML=tq(q,'o').map((o,i)=>{
            let cls='quiz-opt disabled';
            if(i===q.c)cls+=' correct';
            if(i===userAnswer&&!correct)cls+=' wrong';
            return '<div class="'+cls+'"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>';
        }).join('');
        document.getElementById('sqExplain').innerHTML='<b style="color:#ff6b2b">ðŸ“–</b> '+tq(q,'a')+'<br><br><b>'+(D.lang==='es'?'TÃ©cnico:':'Technical:')+'</b> '+tq(q,'e');
        document.getElementById('sqExplain').classList.add('show');
        const nextBtn=document.getElementById('sqNext');
        nextBtn.textContent=(studyIdx<studyData.length-1)?'Siguiente â†’':'Ver Resultado ðŸ†';
        nextBtn.classList.add('show');
    }else{
        document.getElementById('sqBubble').textContent=D.lang==='es'?'Esta la fallaste antes. Â¡PiÃ©nsale bien, '+D.name+'!':'You missed this before. Think carefully, '+D.name+'!';
        document.getElementById('sqText').textContent=tq(q,'q');
        document.getElementById('sqExplain').classList.remove('show');
        document.getElementById('sqNext').classList.remove('show');
        const letters=['A','B','C','D'];
        document.getElementById('sqOpts').innerHTML=tq(q,'o').map((o,i)=>'<div class="quiz-opt" onclick="answerStudy('+i+',this)"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>').join('');
    }
    window.scrollTo(0,0);
}

function answerStudy(idx,el){
    if(studyAnswered)return;
    studyAnswered=true;
    studyAnswers[studyIdx]=idx;
    const q=studyData[studyIdx];
    const correct=idx===q.c;
    const opts=document.querySelectorAll('#s-study-quiz .quiz-opt');
    
    opts.forEach((o,i)=>{
        if(i===q.c)o.classList.add('correct');
        if(i===idx&&!correct)o.classList.add('wrong');
        if(i!==q.c&&i!==idx)o.classList.add('disabled');
    });
    
    // Track in study tracker
    trackAnswer(q,correct);
    
    if(correct){
        studyRight++;
        document.getElementById('sqRight').textContent=studyRight;
        document.getElementById('sqBubble').textContent=D.lang==='es'?'âœ… Â¡Muy bien, '+D.name+'! Â¡Ya le estÃ¡s agarrando!':'âœ… Great job, '+D.name+'! You\'re getting it!';
        document.getElementById('sqExplain').innerHTML='<b>'+(D.lang==='es'?'ExplicaciÃ³n:':'Explanation:')+'</b> '+tq(q,'e');
        celebrate(1);
        speakText(D.lang==='es'?'Â¡Correcto! Ya le agarraste. '+tq(q,'e'):'Correct! You got it. '+tq(q,'e'));
    }else{
        studyWrong++;
        document.getElementById('sqWrong').textContent=studyWrong;
        document.getElementById('sqBubble').textContent=D.lang==='es'?'âŒ AÃºn no, '+D.name+'. La correcta es la '+['A','B','C','D'][q.c]+'. Lee bien la explicaciÃ³n.':'âŒ Not yet, '+D.name+'. Correct: '+['A','B','C','D'][q.c]+'. Read the explanation.';
        document.getElementById('sqExplain').innerHTML='<b style="color:#ff6b2b">'+(D.lang==='es'?'ðŸ“– Con peras y manzanas:':'ðŸ“– Simply put:')+'</b><br>'+tq(q,'a')+'<br><br><b>'+(D.lang==='es'?'TÃ©cnico:':'Technical:')+'</b> '+tq(q,'e');
        speakText(D.lang==='es'?'AÃºn no, pero no te rindas. Te lo explico: ':' Not yet, but don\'t give up. Let me explain: '+tq(q,'a')+' '+tq(q,'e'));
    }
    
    document.getElementById('sqExplain').classList.add('show');
    document.getElementById('sqNext').textContent=(studyIdx<studyData.length-1)?'Siguiente â†’':'Ver Resultado ðŸ†';
    document.getElementById('sqNext').classList.add('show');
}

function studyNext(){
    stopSpeech();
    studyIdx++;
    showStudyQuestion();
}

function studyPrev(){
    stopSpeech();
    if(studyIdx>0){studyIdx--;showStudyQuestion();}
}

function showStudyResult(){
    go('s-study-result');
    const pct=studyData.length>0?Math.round((studyRight/studyData.length)*100):0;
    document.getElementById('srScore').textContent=pct+'%';
    document.getElementById('srLabel').textContent=studyRight+' / '+studyData.length+(D.lang==='es'?' correctas en repaso':' correct in review');
    
    let medal,msg;
    if(pct>=90){
        medal='ðŸ†';
        msg=D.lang==='es'?'Â¡IncreÃ­ble, '+D.name+'! Â¡Ya dominas estas preguntas! Las que sacaste bien se van de tu zona de estudio.':'Amazing, '+D.name+'! You\'ve mastered these! Correct ones leave your study zone.';
    }else if(pct>=70){
        medal='ðŸ¥‡';
        msg=D.lang==='es'?'Â¡Muy bien, '+D.name+'! Vas mejorando. Sigue repasando las que fallaste.':'Great job, '+D.name+'! You\'re improving. Keep reviewing the ones you missed.';
    }else if(pct>=50){
        medal='ðŸ¥ˆ';
        msg=D.lang==='es'?'Â¡Vas progresando, '+D.name+'! Repasa las explicaciones y vuelve a intentar.':'Making progress, '+D.name+'! Review explanations and try again.';
    }else{
        medal='ðŸ’ª';
        msg=D.lang==='es'?'Â¡No te rindas, '+D.name+'! La prÃ¡ctica hace al maestro. Lee las explicaciones con calma.':'Don\'t give up, '+D.name+'! Practice makes perfect. Read explanations carefully.';
    }
    
    document.getElementById('srMedal').textContent=medal;
    document.getElementById('srMsg').textContent=msg;
    
    // Award XP for study
    const xpEarned=studyRight*5;
    profile.xp+=xpEarned;
    while(profile.xp>=profile.xpNeeded){
        profile.xp-=profile.xpNeeded;
        profile.level++;
        profile.xpNeeded=Math.floor(profile.xpNeeded*1.4);
    }
    saveProfile();
    
    cft();
    speakText(msg);
}

// === VIDEO ZONE ===
const VIDEO_TOPICS=[
    {cat:'âš¡ Electricidad',cat_en:'âš¡ Electrical',videos:[
        {title:'Ley de Ohm Explicada',desc:'Voltaje, corriente y resistencia con ejemplos reales',icon:'âš¡',dur:'PrÃ³ximamente'},
        {title:'CÃ³mo Usar el MultÃ­metro',desc:'Medir voltaje, amperaje, resistencia y continuidad',icon:'ðŸ”¬',dur:'PrÃ³ximamente'},
        {title:'Circuitos Serie vs Paralelo',desc:'Diferencias y cÃ³mo diagnosticar cada uno',icon:'ðŸ”Œ',dur:'PrÃ³ximamente'},
        {title:'GFCI y AFCI Explicados',desc:'Protecciones elÃ©ctricas y cuÃ¡ndo se requieren',icon:'ðŸ›¡ï¸',dur:'PrÃ³ximamente'}
    ]},
    {cat:'â„ï¸ Aire Acondicionado',cat_en:'â„ï¸ Air Conditioning',videos:[
        {title:'Ciclo de RefrigeraciÃ³n',desc:'Los 4 componentes y cÃ³mo funciona el sistema',icon:'ðŸ”„',dur:'PrÃ³ximamente'},
        {title:'Superheat y Subcooling',desc:'QuÃ© son, cÃ³mo medirlos y valores normales',icon:'ðŸŒ¡ï¸',dur:'PrÃ³ximamente'},
        {title:'DiagnÃ³stico con Manifold',desc:'Leer presiones y diagnosticar problemas',icon:'ðŸ“Š',dur:'PrÃ³ximamente'},
        {title:'Mantenimiento Preventivo',desc:'Checklist completo para servicio de AC',icon:'ðŸ”§',dur:'PrÃ³ximamente'}
    ]},
    {cat:'ðŸ§Š RefrigeraciÃ³n',cat_en:'ðŸ§Š Refrigeration',videos:[
        {title:'Walk-in Coolers 101',desc:'Componentes y troubleshooting bÃ¡sico',icon:'ðŸ§Š',dur:'PrÃ³ximamente'},
        {title:'VÃ¡lvula TXV',desc:'CÃ³mo funciona y cÃ³mo diagnosticar problemas',icon:'âš™ï¸',dur:'PrÃ³ximamente'},
        {title:'EPA 608 Prep',desc:'Todo lo que necesitas para pasar el examen',icon:'ðŸ“‹',dur:'PrÃ³ximamente'}
    ]},
    {cat:'ðŸ›¡ï¸ Seguridad',cat_en:'ðŸ›¡ï¸ Safety',videos:[
        {title:'Lockout/Tagout (LOTO)',desc:'Procedimiento correcto paso a paso',icon:'ðŸ”’',dur:'PrÃ³ximamente'},
        {title:'PPE para HVAC',desc:'Equipo de protecciÃ³n personal obligatorio',icon:'ðŸ¥½',dur:'PrÃ³ximamente'}
    ]}
];

function renderVideoZone(){
    const container=document.getElementById('videoContent');
    let html='';
    
    VIDEO_TOPICS.forEach(topic=>{
        html+='<div class="video-section-title">'+topic.cat+'</div>';
        topic.videos.forEach(v=>{
            html+='<div class="video-card" onclick="alert(\''+(D.lang==='es'?'PrÃ³ximamente â€” estamos grabando los videos del Maestro Mario':'Coming soon â€” we are recording Maestro Mario videos')+'\')">';
            html+='<div class="video-card-thumb">'+v.icon+'</div>';
            html+='<div class="video-card-info">';
            html+='<div class="video-card-title">'+v.title+'</div>';
            html+='<div class="video-card-desc">'+v.desc+'</div>';
            html+='<div class="video-card-dur">ðŸŽ¬ '+v.dur+'</div>';
            html+='</div></div>';
        });
    });
    
    container.innerHTML=html;
}

// ========== ZONA DE ESTUDIO (STUDY LIBRARY) ==========
function goStudyLibrary(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    renderStudyLibrary();
    go('s-library');
    speakText(D.lang==='es'?'Bienvenido a la Zona de Estudio, '+D.name+'. AquÃ­ puedes estudiar todas las preguntas con explicaciones detalladas.':'Welcome to the Study Library, '+D.name+'. Study all questions with detailed explanations here.');
}

function getAllQuizQuestions(){
    const all=[];
    if(typeof QUIZ_INTRO!=='undefined')all.push(...QUIZ_INTRO.map(q=>({...q,_source:'intro'})));
    if(typeof QUIZ_PRINCIPIANTE!=='undefined')all.push(...QUIZ_PRINCIPIANTE.map(q=>({...q,_source:'principiante'})));
    if(typeof QUIZ_ELECTRICIDAD!=='undefined')all.push(...QUIZ_ELECTRICIDAD.map(q=>({...q,_source:'electricidad'})));
    if(typeof QUIZ_REFRIGERACION!=='undefined')all.push(...QUIZ_REFRIGERACION.map(q=>({...q,_source:'refrigeracion'})));
    return all;
}

function getLibraryCategories(){
    const all=getAllQuizQuestions();
    const cats={};
    all.forEach(q=>{
        if(!cats[q.cat])cats[q.cat]={count:0,icon:q.cat.split(' ')[0],questions:[]};
        cats[q.cat].count++;
        cats[q.cat].questions.push(q);
    });
    return cats;
}

function renderStudyLibrary(){
    if(!window.checkAIPremium || !window.checkAIPremium()) return;
    const container=document.getElementById('libraryContent');
    const cats=getLibraryCategories();
    const allQ=getAllQuizQuestions();
    const bubble=document.getElementById('libraryBubble');
    bubble.textContent=D.lang==='es'?
        D.name+', aquÃ­ tienes '+allQ.length+' preguntas organizadas por tema. Estudia con calma, cada una tiene explicaciÃ³n completa y ejemplos de campo.':
        D.name+', here are '+allQ.length+' questions organized by topic. Study at your pace, each has full explanations and field examples.';
    
    let html='<div style="text-align:center;margin-bottom:16px;font-size:14px;color:var(--electric);font-weight:700">ðŸ“– '+allQ.length+(D.lang==='es'?' preguntas disponibles en ':' questions available in ')+Object.keys(cats).length+(D.lang==='es'?' temas':' topics')+'</div>';
    
    const sortedCats=Object.keys(cats).sort((a,b)=>cats[b].count-cats[a].count);
    
    for(const cat of sortedCats){
        const c=cats[cat];
        html+='<div class="quiz-sel-card" onclick="showLibraryCategory(\''+cat.replace(/'/g,"\\'")+'\')" style="border-color:rgba(46,204,113,0.15);margin-bottom:10px">';
        html+='<div class="qs-icon" style="background:rgba(46,204,113,0.1);font-size:32px">'+c.icon+'</div>';
        html+='<div class="qs-info"><div class="qs-title" style="color:#2ecc71">'+cat+'</div>';
        html+='<div class="qs-count" style="color:var(--muted)">ðŸ“– '+c.count+(D.lang==='es'?' preguntas con explicaciÃ³n':' questions with explanation')+'</div>';
        html+='</div></div>';
    }
    
    container.innerHTML=html;
}

function detectFormulas(text){
    // Detect formula patterns in question or explanation text
    const formulas=[];
    const patterns=[
        {rx:/R\s*=\s*V\s*[Ã·\/]\s*I/i,f:'R = V Ã· I',name:'Ley de Ohm (Resistencia)',ex:'Si V=240V y I=20A â†’ R = 240Ã·20 = 12Î©'},
        {rx:/V\s*=\s*I\s*[Ã—x\*]\s*R/i,f:'V = I Ã— R',name:'Ley de Ohm (Voltaje)',ex:'Si I=10A y R=12Î© â†’ V = 10Ã—12 = 120V'},
        {rx:/I\s*=\s*V\s*[Ã·\/]\s*R/i,f:'I = V Ã· R',name:'Ley de Ohm (Corriente)',ex:'Si V=240V y R=20Î© â†’ I = 240Ã·20 = 12A'},
        {rx:/P\s*=\s*V\s*[Ã—x\*]\s*I|[Ww]att/i,f:'P = V Ã— I',name:'Ley de Watt (Potencia)',ex:'Si V=120V y I=10A â†’ P = 120Ã—10 = 1,200W'},
        {rx:/superheat/i,f:'Superheat = T lÃ­nea succiÃ³n âˆ’ T saturaciÃ³n (segÃºn presiÃ³n)',name:'Superheat',ex:'Si presiÃ³n=70psi (40Â°F sat.) y T lÃ­nea=50Â°F â†’ SH = 50âˆ’40 = 10Â°F'},
        {rx:/subcooling/i,f:'Subcooling = T saturaciÃ³n (segÃºn presiÃ³n) âˆ’ T lÃ­nea lÃ­quido',name:'Subcooling',ex:'Si presiÃ³n=280psi (120Â°F sat.) y T lÃ­nea=110Â°F â†’ SC = 120âˆ’110 = 10Â°F'},
        {rx:/[Oo]hm|resistencia.*voltaje|voltaje.*corriente/i,f:'V = I Ã— R  |  I = V Ã· R  |  R = V Ã· I',name:'Ley de Ohm',ex:'Con 2 valores conocidos, siempre puedes calcular el tercero'},
        {rx:/BTU|capacidad.*enfriamiento|tonelada/i,f:'1 Ton = 12,000 BTU/h  |  CFM = BTU Ã· (1.08 Ã— Î”T)',name:'Capacidad de Enfriamiento',ex:'3 Ton = 36,000 BTU/h. Para Î”T=20Â°F â†’ CFM = 36000Ã·(1.08Ã—20) = 1,667 CFM'},
        {rx:/[Aa]mperaje|amperios|overload/i,f:'I = P Ã· V  |  P = V Ã— I  |  I = V Ã· R',name:'CÃ¡lculo de Corriente',ex:'Motor de 1HP(746W) a 240V â†’ I = 746Ã·240 = 3.1A'},
    ];
    const combined=text;
    patterns.forEach(p=>{
        if(p.rx.test(combined))formulas.push(p);
    });
    return formulas;
}

function showLibraryCategory(catName){
    const cats=getLibraryCategories();
    const cat=cats[catName];
    if(!cat)return;
    
    document.getElementById('libDetailTitle').textContent=catName;
    const container=document.getElementById('libDetailContent');
    
    let html='<div style="text-align:center;margin-bottom:14px;font-size:13px;color:var(--muted)">'+cat.count+(D.lang==='es'?' preguntas â€” toca cada una para estudiar a fondo':' questions â€” tap each to study in depth')+'</div>';
    cat.questions.forEach((q,i)=>{
        const letters=['A','B','C','D'];
        html+='<div style="background:var(--card);border:1.5px solid rgba(46,204,113,0.15);border-radius:16px;padding:18px;margin-bottom:14px">';
        html+='<div style="font-size:11px;color:var(--electric);font-weight:700;margin-bottom:6px;letter-spacing:1px">ðŸ“– '+(D.lang==='es'?'PREGUNTA':'QUESTION')+' '+(i+1)+(D.lang==='es'?' DE ':' OF ')+cat.count+'</div>';
        html+='<div style="font-size:15px;font-weight:700;line-height:1.5;margin-bottom:12px">'+q.q+'</div>';
        
        // Options - all shown with correct highlighted
        tq(q,'o').forEach((opt,j)=>{
            const isCorrect=j===q.c;
            const bg=isCorrect?'rgba(46,204,113,0.15)':'rgba(255,255,255,0.03)';
            const border=isCorrect?'rgba(46,204,113,0.4)':'rgba(255,255,255,0.06)';
            const color=isCorrect?'#2ecc71':'var(--txt)';
            html+='<div style="background:'+bg+';border:1.5px solid '+border+';border-radius:12px;padding:10px 14px;margin-bottom:6px;display:flex;align-items:center;gap:10px;font-size:14px">';
            html+='<span style="width:28px;height:28px;border-radius:8px;background:'+(isCorrect?'#2ecc71':'rgba(255,255,255,0.08)')+';display:flex;align-items:center;justify-content:center;font-family:Fredoka;font-size:14px;font-weight:700;color:'+(isCorrect?'white':'var(--txt)')+';flex-shrink:0">'+letters[j]+'</span>';
            html+='<span style="color:'+color+';font-weight:'+(isCorrect?'700':'400')+'">'+opt+(isCorrect?' âœ…':'')+'</span></div>';
        });
        
        // === TECHNICAL EXPLANATION (primary, bigger) ===
        html+='<div style="background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:12px;padding:16px;margin-top:14px">';
        html+='<div style="font-size:14px;font-weight:700;color:var(--electric);margin-bottom:8px">ðŸ“˜ '+(D.lang==='es'?'ExplicaciÃ³n TÃ©cnica Detallada':'Detailed Technical Explanation')+'</div>';
        html+='<div style="font-size:14px;line-height:1.7;color:var(--txt)">'+tq(q,'e')+'</div>';
        
        // === WHY CORRECT ANSWER (detailed reasoning) ===
        html+='<div style="margin-top:10px;padding-top:10px;border-top:1px solid rgba(0,212,255,0.15)">';
        html+='<div style="font-size:12px;font-weight:700;color:#2ecc71;margin-bottom:4px">âœ… '+(D.lang==='es'?'Â¿Por quÃ© la respuesta '+letters[q.c]+' es correcta?':'Why is answer '+letters[q.c]+' correct?')+'</div>';
        html+='<div style="font-size:13px;line-height:1.6;color:var(--muted)">'+(D.lang==='es'?'La opciÃ³n correcta es':'The correct answer is')+' <b style="color:#2ecc71">'+tq(q,'o')[q.c]+'</b>. '+tq(q,'e')+'</div>';
        html+='</div>';
        
        // === WHY OTHERS ARE WRONG ===
        let wrongExplain='';
        q.o.forEach((opt,j)=>{
            if(j!==q.c) wrongExplain+='<span style="color:#e74c3c">'+letters[j]+')</span> '+opt+(D.lang==='es'?' â€” Incorrecto. ':' â€” Incorrect. ');
        });
        html+='<div style="margin-top:8px;padding-top:8px;border-top:1px solid rgba(0,212,255,0.1)">';
        html+='<div style="font-size:12px;font-weight:700;color:#e74c3c;margin-bottom:4px">âŒ '+(D.lang==='es'?'Â¿Por quÃ© las otras estÃ¡n mal?':'Why are the others wrong?')+'</div>';
        html+='<div style="font-size:12px;line-height:1.6;color:var(--muted)">'+wrongExplain+'</div>';
        html+='</div>';
        html+='</div>';
        
        // === FORMULA BREAKDOWN (if applicable) ===
        const formulas=detectFormulas(tq(q,'q')+' '+tq(q,'e'));
        if(formulas.length>0){
            html+='<div style="background:rgba(241,196,15,0.08);border:1px solid rgba(241,196,15,0.25);border-radius:12px;padding:16px;margin-top:8px">';
            html+='<div style="font-size:14px;font-weight:700;color:var(--gold);margin-bottom:10px">ðŸ“ '+(D.lang==='es'?'FÃ³rmulas Aplicables':'Applicable Formulas')+'</div>';
            formulas.forEach(f=>{
                html+='<div style="background:rgba(0,0,0,0.2);border-radius:10px;padding:12px;margin-bottom:8px">';
                html+='<div style="font-family:Fredoka;font-size:16px;color:var(--gold);font-weight:700;text-align:center;margin-bottom:6px">'+f.f+'</div>';
                html+='<div style="font-size:12px;color:var(--electric);font-weight:600;margin-bottom:4px">'+f.name+'</div>';
                html+='<div style="font-size:12px;color:var(--muted);line-height:1.5">ðŸ“Š '+(D.lang==='es'?'Ejemplo':'Example')+': '+f.ex+'</div>';
                html+='</div>';
            });
            html+='</div>';
        }
        
        // === FIELD TIP (analogy - secondary, collapsible feel) ===
        if(tq(q,'a')){
            html+='<div style="background:rgba(255,107,43,0.06);border:1px solid rgba(255,107,43,0.15);border-radius:12px;padding:14px;margin-top:8px">';
            html+='<div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:6px">ðŸ’¡ '+(D.lang==='es'?'Tip de Campo (AnalogÃ­a):':'Field Tip (Analogy):')+'</div>';
            html+='<div style="font-size:13px;line-height:1.6;color:var(--muted)">'+tq(q,'a')+'</div>';
            html+='</div>';
        }
        
        html+='</div>';
    });
    
    container.innerHTML=html;
    go('s-library-detail');
    window.scrollTo(0,0);
}

function updateHubLibraryCount(){
    const el=document.getElementById('hubLibraryCount');
    if(el){
        const all=getAllQuizQuestions();
        const cats=getLibraryCategories();
        el.textContent='ðŸ“– '+all.length+(D.lang==='es'?' preguntas en ':' questions in ')+Object.keys(cats).length+(D.lang==='es'?' temas':' topics');
    }
}

</script>
<!-- HOME BUTTON -->
<button class="home-fab" onclick="window.location.href='https://acvolttech.github.io/maestroac-app/'" title="MenÃº Principal">ðŸ </button>

<!-- AI CHARACTER COUNTER -->
<div class="ai-chars-banner" id="aiCharsBanner">ðŸ¤– <span id="aiCharsCount">50,000</span> / 50,000</div>

<!-- AI PAYWALL MODAL -->
<div class="paywall-overlay" id="paywallModal">
  <div class="paywall-card" style="max-width:440px;padding:18px 16px">
    <!-- Mario avatar -->
    <div style="display:flex;justify-content:center;margin-bottom:8px">
      <div style="width:60px;height:60px;border-radius:50%;overflow:hidden;border:2px solid var(--accent);box-shadow:0 0 15px rgba(255,107,43,0.3)">
        <img src="mario.jpg" alt="Maestro Mario" style="width:100%;height:100%;object-fit:cover">
      </div>
    </div>
    
    <!-- Mario's personal message -->
    <div class="pw-title" style="font-size:17px" id="pwTitle">Â¡Hey, tÃ©cnico!</div>
    <div style="background:var(--card2);border-radius:12px;padding:12px;margin:8px 0;text-align:left;font-size:13px;line-height:1.6;color:var(--txt);border-left:3px solid var(--accent)">
      <span id="pwMarioMsg">Esta es una herramienta poderosa que te puede cambiar la carrera. ðŸš€ Con AI Premium desbloqueas mÃ¡s de 10,000 preguntas, videos personalizados, y yo te guÃ­o con inteligencia artificial. PregÃºntame lo que necesites del campo â€” diagnÃ³sticos, cÃ³digos, herramientas. Recibes 50,000 caracteres de AI por mes, como tener un mentor 24/7.</span>
    </div>

    <!-- Benefits -->
    <div class="pw-features" style="margin:10px 0" id="pwFeatures">
      <div class="pw-feature"><span>ðŸ“š</span> 10,000+ preguntas de prÃ¡ctica con explicaciones detalladas</div>
      <div class="pw-feature"><span>ðŸ¤–</span> Chat con Mario AI â€” hazme preguntas de campo y te busco la respuesta</div>
      <div class="pw-feature"><span>ðŸ—£ï¸</span> Mi voz te guÃ­a mientras estudias</div>
      <div class="pw-feature"><span>ðŸŽ¥</span> Videos personalizados con enlaces directos a cada tema</div>
      <div class="pw-feature"><span>ðŸ’¬</span> 50,000 caracteres de AI por mes â€” como tener un mentor 24/7</div>
      <div class="pw-feature"><span>ðŸ“Š</span> Todo lo que aprendas aquÃ­ cuenta en Maestro ACVOLT</div>
      <div class="pw-feature"><span>ðŸ”§</span> PregÃºntame lo que sea del campo â€” diagnÃ³stico, cÃ³digos, herramientas</div>
      <div class="pw-feature"><span>ðŸ”„</span> Las DOS apps conectadas â€” un solo progreso</div>
    </div>

    <!-- Community message -->
    <div id="pwCommunity" style="background:rgba(0,212,255,0.08);border-radius:10px;padding:10px 12px;margin:8px 0;text-align:center;font-size:12px;line-height:1.5;color:var(--electric);border:1px solid rgba(0,212,255,0.15)">
      ðŸ’™ Al suscribirte ayudas a <b>ACVOLT Tech School</b> a seguir mejorando las apps, crear mÃ¡s contenido y ofrecer mejores recursos para toda la comunidad de tÃ©cnicos HVAC.
    </div>

    <div class="pw-price" style="margin-top:10px">$49 USD</div>
    <div class="pw-period" id="pwPeriod">por mes Â· cancela cuando quieras</div>
    <button class="pw-btn" onclick="startStripeCheckout()" id="pwBtn">ðŸ’³ Quiero Suscribirme</button>
    <button class="pw-close" onclick="closePaywall()" id="pwClose">Ahora no, gracias</button>
  </div>
</div>

<!-- AI PREMIUM SYSTEM + V1 USER DETECTION -->
<script>
(function(){
  var CHAR_LIMIT = 50000;
  var STRIPE_PAYMENT_LINK = 'https://buy.stripe.com/bJecN54zJ8Bic2X6If3sI0h';

  function getPremiumData(){
    try {
      var d = JSON.parse(localStorage.getItem('maestroac_ai_premium') || 'null');
      if(!d) d = { active: false, chars_used: 0, month: new Date().getMonth(), year: new Date().getFullYear() };
      var now = new Date();
      if(d.month !== now.getMonth() || d.year !== now.getFullYear()){
        d.chars_used = 0; d.month = now.getMonth(); d.year = now.getFullYear();
        savePremiumData(d);
      }
      return d;
    } catch(e){ return { active: false, chars_used: 0, month: new Date().getMonth(), year: new Date().getFullYear() }; }
  }

  function savePremiumData(d){
    try { localStorage.setItem('maestroac_ai_premium', JSON.stringify(d)); } catch(e){}
  }

  function getCharsRemaining(){
    var d = getPremiumData();
    return Math.max(0, CHAR_LIMIT - d.chars_used);
  }

  function useChars(count){
    var d = getPremiumData();
    d.chars_used += count;
    savePremiumData(d);
    updateCharsUI();
    checkCharWarnings(d);
  }

  function updateCharsUI(){
    var remaining = getCharsRemaining();
    var el = document.getElementById('aiCharsCount');
    var banner = document.getElementById('aiCharsBanner');
    if(el) el.textContent = remaining.toLocaleString();
    if(banner){
      var d = getPremiumData();
      if(d.active) banner.classList.add('show');
      else banner.classList.remove('show');
    }
  }

  function checkCharWarnings(d){
    var remaining = CHAR_LIMIT - d.chars_used;
    var pct = remaining / CHAR_LIMIT;
    var nombre = (typeof D !== 'undefined' && D.name) ? D.name : 'tÃ©cnico';
    if(remaining <= 0){
      var nextMonth = new Date(); nextMonth.setMonth(nextMonth.getMonth()+1); nextMonth.setDate(1);
      setTimeout(function(){ alert('ðŸ”’ Se acabaron tus caracteres AI este mes, '+nombre+'. Quizzes y explicaciones escritas siguen gratis. Se renuevan el '+nextMonth.toLocaleDateString('es-MX')+'.'); },500);
    } else if(pct <= 0.2 && pct > 0){
      setTimeout(function(){ alert('âš ï¸ Te quedan pocos caracteres AI ('+remaining.toLocaleString()+'), '+nombre+'. GuÃ¡rdalos para las mÃ¡s difÃ­ciles.'); },500);
    }
  }

  window.checkAIPremium = function(){
    var d = getPremiumData();
    if(!d.active){
      // Personalize Mario's message
      var nombre = (typeof D !== 'undefined' && D.name) ? D.name.split(' ')[0] : ((typeof D !== 'undefined' && D.lang === 'en') ? 'technician' : 'tÃ©cnico');
      var isEn = (typeof D !== 'undefined' && D.lang === 'en');
      var titleEl = document.getElementById('pwTitle');
      var msgEl = document.getElementById('pwMarioMsg');
      if(titleEl) titleEl.textContent = isEn ? 'Hey, ' + nombre + '! ðŸ‘‹' : 'Â¡Hey, ' + nombre + '! ðŸ‘‹';
      if(msgEl) msgEl.innerHTML = isEn
        ? 'I can see you want to keep growing â€” that says a lot about you. ðŸ’ª This is a powerful tool, <b>' + nombre + '</b>. With A.C.VOLT Premium you unlock over <b>10,000 questions</b>, personalized videos, and I personally guide you with artificial intelligence. Ask me anything about the field â€” diagnostics, codes, tools â€” I\'ll find the answer. You get <b>50,000 AI characters per month</b>, like having a mentor with you 24/7. And everything you learn here <b>counts in Maestro A.C.VOLT</b> too â€” both apps work together to take you further.'
        : 'Veo que quieres seguir avanzando â€” eso me dice mucho de ti. ðŸ’ª Esta herramienta es poderosa, <b>' + nombre + '</b>. Con ACVOLT Premium desbloqueas mÃ¡s de <b>10,000 preguntas</b>, videos personalizados, y yo personalmente te guÃ­o con inteligencia artificial. PregÃºntame lo que quieras del campo â€” diagnÃ³sticos, cÃ³digos, herramientas â€” yo te busco la respuesta. Recibes <b>50,000 caracteres de AI por mes</b>, es como tener un mentor contigo 24/7. Y todo lo que aprendas aquÃ­ <b>cuenta en Maestro ACVOLT</b> tambiÃ©n â€” las dos apps trabajan juntas para que llegues mÃ¡s lejos.';
      document.getElementById('paywallModal').classList.add('active');
      // Swap all text to English if needed
      if(isEn){
        var feat = document.getElementById('pwFeatures');
        if(feat) feat.innerHTML = '<div class="pw-feature"><span>ðŸ“š</span> 10,000+ practice questions with detailed explanations</div><div class="pw-feature"><span>ðŸ¤–</span> Chat with Mario AI â€” ask me field questions and I\'ll find the answer</div><div class="pw-feature"><span>ðŸ—£ï¸</span> My voice guides you while you study</div><div class="pw-feature"><span>ðŸŽ¥</span> personalized videos with direct links to each topic</div><div class="pw-feature"><span>ðŸ’¬</span> 50,000 AI characters per month â€” like having a mentor 24/7</div><div class="pw-feature"><span>ðŸ“Š</span> Everything you learn here counts in Maestro ACVOLT</div><div class="pw-feature"><span>ðŸ”§</span> Ask me anything â€” diagnostics, codes, tools</div><div class="pw-feature"><span>ðŸ”„</span> BOTH apps connected â€” one single progress</div>';
        var comm = document.getElementById('pwCommunity');
        if(comm) comm.innerHTML = 'ðŸ’™ By subscribing you help <b>ACVOLT Tech School</b> keep improving the apps, create more content, and offer better resources for the entire HVAC technician community.';
        var period = document.getElementById('pwPeriod');
        if(period) period.textContent = 'per month Â· cancel anytime';
        var btn = document.getElementById('pwBtn');
        if(btn) btn.innerHTML = 'ðŸ’³ Subscribe Now';
        var close = document.getElementById('pwClose');
        if(close) close.textContent = 'Not now, thanks';
      }
      // Mario speaks the message - bilingual
      var speech = isEn 
        ? 'Hey, ' + nombre + '! I can see you want to keep growing, and that says a lot about you. This is a powerful tool. With A.C.volt Premium you unlock over 10 thousand questions, personalized videos, and I personally guide you with artificial intelligence. Ask me anything about the field, diagnostics, codes, tools, I will find the answer for you. You get 50 thousand A.I. characters per month, it is like having a mentor with you 24 7. And everything you learn here counts in Maestro A.C.volt too. By subscribing you help A.C.volt Tech School keep improving the apps for the entire HVAC technician community.'
        : 'Hey, ' + nombre + '! Veo que quieres seguir avanzando, eso me dice mucho de ti. Esta herramienta es poderosa. Con A.C.volt Premium desbloqueas mÃ¡s de 10 mil preguntas, videos personalizados, y yo personalmente te guÃ­o con inteligencia artificial. PregÃºntame lo que quieras del campo, diagnÃ³sticos, cÃ³digos, herramientas, yo te busco la respuesta. Recibes 50 mil caracteres de A.I. por mes, es como tener un mentor contigo las 24 horas. Y todo lo que aprendas aquÃ­ cuenta en Maestro A.C.volt tambiÃ©n. Al suscribirte ayudas a A.C.volt Tech School a seguir mejorando las apps para toda la comunidad de tÃ©cnicos.';
      if(typeof speakText === 'function') speakText(speech);
      return false;
    }
    if(getCharsRemaining() <= 0){
      var nombre = (typeof D !== 'undefined' && D.name) ? D.name : 'tÃ©cnico';
      alert('ðŸ”’ Se acabaron tus caracteres AI este mes, '+nombre+'. Se renuevan el prÃ³ximo mes.');
      return false;
    }
    return true;
  };

  window.trackAIChars = function(text){
    if(text) useChars(text.length);
  };

  window.closePaywall = function(){
    document.getElementById('paywallModal').classList.remove('active');
    if(window.speechSynthesis) window.speechSynthesis.cancel();
  };

  window.startStripeCheckout = function(){
    window.location.href = STRIPE_PAYMENT_LINK;
  };

  function checkStripeReturn(){
    var params = new URLSearchParams(window.location.search);
    if(params.get('premium') === 'success'){
      var d = getPremiumData();
      d.active = true;
      d.activated_at = new Date().toISOString();
      savePremiumData(d);
      window.history.replaceState({}, '', window.location.pathname);
      var nombre = (typeof D !== 'undefined' && D.name) ? D.name : 'tÃ©cnico';
      setTimeout(function(){
        alert('ðŸŽ‰ Â¡Bienvenido a AI Premium, '+nombre+'! Tienes 50,000 caracteres de AI este mes. ðŸ§ ');
      }, 500);
    }
  }

  // V1 USER DETECTION
  function detectV1User(){
    try {
      var tecnico = localStorage.getItem('tecnico_user');
      if(!tecnico) return;
      var data = JSON.parse(tecnico);
      var nombre = data.nombre || data.name || '';
      if(!nombre) return;
      if(typeof D !== 'undefined' && !D.name){
        D.name = nombre;
        D.lang = 'es';
        D.level = 3;
        D.specs = ['all'];
        D.school = data.escuela || 'acvolt';
        D.goals = ['certs','diag'];
        D.gender = (typeof detectGender === 'function') ? detectGender(nombre) : 'm';
        setTimeout(function(){
          if(typeof u === 'function') u();
          if(typeof updateLanguageUI === 'function') updateLanguageUI();
          if(typeof enterStudyMode === 'function') enterStudyMode();
          if(typeof updateHub === 'function') updateHub();
          if(typeof go === 'function') go('s-hub');
          if(typeof speakText === 'function'){
            speakText('Â¡Hola '+nombre.split(' ')[0]+'! Te reconozco de Maestro ACVOLT. Â¡Bienvenido a Maestro Mario AI!');
          }
        }, 800);
      }
    } catch(e){ console.log('V1 detection:', e); }
  }

  updateCharsUI();
  checkStripeReturn();
  setTimeout(detectV1User, 1500);
})();
</script>

<!-- NOTIFICATION & REMINDER SYSTEM -->
<div id="welcomeBackOverlay" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(10,22,40,0.97);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);align-items:center;justify-content:center;padding:20px">
  <div style="background:var(--card);border:1px solid rgba(0,212,255,0.2);border-radius:20px;max-width:400px;width:100%;padding:24px 20px;text-align:center;animation:pwSlide 0.4s ease">
    <div style="width:70px;height:70px;border-radius:50%;overflow:hidden;border:2px solid var(--accent);margin:0 auto 12px;box-shadow:0 0 20px rgba(255,107,43,0.3)">
      <img src="mario.jpg" alt="Mario" style="width:100%;height:100%;object-fit:cover">
    </div>
    <div id="wbTitle" style="font-family:'Fredoka',sans-serif;font-size:20px;font-weight:700;color:var(--txt);margin-bottom:8px">Â¡Hey, tÃ©cnico!</div>
    <div id="wbMessage" style="background:var(--card2);border-radius:12px;padding:14px;text-align:left;font-size:14px;line-height:1.7;color:var(--txt);border-left:3px solid var(--accent);margin-bottom:16px"></div>
    <div id="wbProgress" style="font-size:13px;color:var(--electric);margin-bottom:16px"></div>
    <button onclick="closeWelcomeBack()" style="width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--accent),#e84500);color:#fff;font-size:16px;font-weight:700;cursor:pointer;font-family:'Fredoka',sans-serif" id="wbBtn">ðŸš€ Â¡Vamos a estudiar!</button>
  </div>
</div>

<script>
(function(){
  var INACTIVITY_HOURS = 4;
  var CHECK_INTERVAL_MS = 60000; // check every minute
  var STORAGE_KEY = 'maestro_last_activity';
  var NOTIF_KEY = 'maestro_notif_sent';
  var APP_NAME = 'v2';
  var SUPABASE_ACTIVITY_URL = 'https://htklsowiyjwsjnacnvnr.supabase.co/rest/v1/rpc/update_user_activity';
  var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0a2xzb3dpeWp3c2puYWNudm5yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NjIwMjQsImV4cCI6MjA4NjAzODAyNH0.6A3F7MI4YJEMo98b4Zfzao9p_hMh2T0ha0dRJ4SUhv0';
  var lastSyncTime = 0;
  var SYNC_INTERVAL = 300000; // sync to Supabase every 5 minutes max

  // ===== SUPABASE ACTIVITY SYNC =====
  function syncActivityToSupabase(){
    var now = Date.now();
    if(now - lastSyncTime < SYNC_INTERVAL) return; // throttle
    lastSyncTime = now;

    try {
      var nombre = 'tÃ©cnico';
      var email = null;
      var telefono = null;
      var lang = 'es';
      var quizCount = 0;
      var bestScore = null;
      var premium = false;

      try { nombre = D.name || 'tÃ©cnico'; } catch(e){}
      try { lang = D.lang || 'es'; } catch(e){}
      try { email = D.email || null; } catch(e){}
      try { telefono = D.telefono || D.phone || null; } catch(e){}
      try {
        var scores = JSON.parse(localStorage.getItem('maestro_quiz_scores')||'{}');
        quizCount = Object.keys(scores).length;
        var vals = Object.values(scores);
        bestScore = vals.length ? Math.max.apply(null, vals) : null;
      } catch(e){}
      try { premium = !!JSON.parse(localStorage.getItem('ai_premium_data')||'{}').active; } catch(e){}

      // Only sync if we have an email
      if(!email) {
        // Try to get from tecnico_user
        try { 
          var tu = JSON.parse(localStorage.getItem('tecnico_user')||'{}');
          email = tu.email || null;
          if(!nombre || nombre === 'tÃ©cnico') nombre = tu.nombre || nombre;
          telefono = telefono || tu.telefono || null;
        } catch(e){}
      }

      if(!email) return; // can't sync without email

      fetch(SUPABASE_ACTIVITY_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': 'Bearer ' + SUPABASE_ANON_KEY
        },
        body: JSON.stringify({
          p_nombre: nombre,
          p_email: email,
          p_telefono: telefono,
          p_lang: lang,
          p_app: APP_NAME,
          p_quiz_score: bestScore,
          p_quizzes: quizCount,
          p_premium: premium
        })
      }).catch(function(e){ console.log('Activity sync error:', e); });
    } catch(e){ console.log('Sync prep error:', e); }
  }

  // ===== ACTIVITY TRACKING =====
  function updateActivity(){
    var now = Date.now();
    localStorage.setItem(STORAGE_KEY, now.toString());
    localStorage.removeItem(NOTIF_KEY); // reset notification flag on activity
    syncActivityToSupabase(); // sync to Supabase (throttled)
  }

  function getLastActivity(){
    var t = localStorage.getItem(STORAGE_KEY);
    return t ? parseInt(t) : Date.now();
  }

  function getInactiveHours(){
    return (Date.now() - getLastActivity()) / (1000 * 60 * 60);
  }

  // Track user activity
  var activityEvents = ['click','keydown','scroll','touchstart'];
  activityEvents.forEach(function(ev){
    document.addEventListener(ev, updateActivity, {passive:true});
  });
  updateActivity(); // mark activity on load

  // ===== BROWSER NOTIFICATIONS =====
  function requestNotifPermission(){
    if('Notification' in window && Notification.permission === 'default'){
      // Ask after 30 seconds of using app
      setTimeout(function(){
        Notification.requestPermission();
      }, 30000);
    }
  }

  function sendBrowserNotification(title, body){
    if('Notification' in window && Notification.permission === 'granted'){
      try {
        var n = new Notification(title, {
          body: body,
          icon: 'mario.jpg',
          badge: 'mario.jpg',
          tag: 'maestro-reminder',
          renotify: true
        });
        n.onclick = function(){ window.focus(); n.close(); };
      } catch(e){ console.log('Notif error:', e); }
    }
  }

  // ===== INACTIVITY CHECKER (runs while tab is open/background) =====
  function checkInactivity(){
    var hours = getInactiveHours();
    var alreadySent = localStorage.getItem(NOTIF_KEY);
    
    if(hours >= INACTIVITY_HOURS && !alreadySent){
      localStorage.setItem(NOTIF_KEY, 'true');
      
      var nombre = 'tÃ©cnico';
      try { nombre = D.name ? D.name.split(' ')[0] : 'tÃ©cnico'; } catch(e){}
      var isEn = false;
      try { isEn = D.lang === 'en'; } catch(e){}

      // Send browser notification if tab is in background
      if(document.hidden){
        var notifTitle = isEn ? 'Hey ' + nombre + '! ðŸ“š' : 'Â¡Hey ' + nombre + '! ðŸ“š';
        var notifBody = isEn 
          ? 'You haven\'t studied in ' + Math.floor(hours) + ' hours. Maestro Mario is waiting for you!'
          : 'Llevas ' + Math.floor(hours) + ' horas sin estudiar. Â¡El Maestro Mario te espera!';
        sendBrowserNotification(notifTitle, notifBody);
      }
    }
  }

  setInterval(checkInactivity, CHECK_INTERVAL_MS);

  // ===== WELCOME BACK SCREEN =====
  function showWelcomeBack(){
    var hours = getInactiveHours();
    if(hours < INACTIVITY_HOURS) return;

    var nombre = 'tÃ©cnico';
    var isEn = false;
    var quizCount = 0;
    var bestScore = 0;
    
    try { nombre = D.name ? D.name.split(' ')[0] : 'tÃ©cnico'; } catch(e){}
    try { isEn = D.lang === 'en'; } catch(e){}
    try { 
      var scores = JSON.parse(localStorage.getItem('maestro_quiz_scores')||'{}');
      quizCount = Object.keys(scores).length;
      var vals = Object.values(scores);
      bestScore = vals.length ? Math.max.apply(null, vals) : 0;
    } catch(e){}

    var hoursAway = Math.floor(hours);
    var daysAway = Math.floor(hours / 24);
    var timeText = '';
    
    if(isEn){
      timeText = daysAway >= 1 ? daysAway + ' day' + (daysAway>1?'s':'') : hoursAway + ' hour' + (hoursAway>1?'s':'');
    } else {
      timeText = daysAway >= 1 ? daysAway + ' dÃ­a' + (daysAway>1?'s':'') : hoursAway + ' hora' + (hoursAway>1?'s':'');
    }

    // Pick motivational message based on context
    var messages_es = [
      'Â¡' + nombre + ', te extraÃ±aba! Llevas ' + timeText + ' sin estudiar. Recuerda: la consistencia es mÃ¡s importante que la perfecciÃ³n. Cada dÃ­a que estudias es un dÃ­a mÃ¡s cerca de tu meta. Â¡Vamos con todo!',
      'Â¡' + nombre + '! Ya pasaron ' + timeText + '. Un tÃ©cnico que no practica se oxida como un contacto sin mantenimiento. Â¡Vamos a repasar y mantener ese conocimiento afilado!',
      'Â¡Ã“rale, ' + nombre + '! ' + timeText + ' sin estudiar es mucho tiempo. Los mejores tÃ©cnicos practican todos los dÃ­as. Â¡Yo sÃ© que tÃº puedes, vamos a darle!',
      'Â¡' + nombre + ', bienvenido de vuelta! ' + timeText + ' lejos es bastante. Pero lo bueno es que regresaste â€” eso dice mucho de ti. Â¡Ahora sÃ­, a darle con todo!'
    ];
    var messages_en = [
      nombre + ', I missed you! It\'s been ' + timeText + ' since you last studied. Remember: consistency beats perfection. Every day you study is a day closer to your goal. Let\'s go!',
      nombre + '! ' + timeText + ' have passed. A technician who doesn\'t practice gets rusty like an unmaintained contact. Let\'s review and keep that knowledge sharp!',
      'Hey ' + nombre + '! ' + timeText + ' without studying is too long. The best techs practice every day. I know you can do it, let\'s get to work!',
      nombre + ', welcome back! ' + timeText + ' away is a lot. But the good thing is you came back â€” that says a lot about you. Now let\'s hit it hard!'
    ];

    var msgs = isEn ? messages_en : messages_es;
    var msg = msgs[Math.floor(Math.random() * msgs.length)];

    // Progress info
    var progressHtml = '';
    if(quizCount > 0){
      progressHtml = isEn 
        ? 'ðŸ“Š You\'ve completed <b>' + quizCount + ' quiz' + (quizCount>1?'zes':'') + '</b> with a best score of <b>' + bestScore + '%</b>. Keep it up!'
        : 'ðŸ“Š Has completado <b>' + quizCount + ' quiz' + (quizCount>1?'zes':'') + '</b> con tu mejor score de <b>' + bestScore + '%</b>. Â¡Sigue asÃ­!';
    } else {
      progressHtml = isEn
        ? 'ðŸ“ You haven\'t taken any quizzes yet. Today is a great day to start!'
        : 'ðŸ“ AÃºn no has tomado ningÃºn quiz. Â¡Hoy es un gran dÃ­a para empezar!';
    }

    document.getElementById('wbTitle').textContent = isEn ? 'Welcome back, ' + nombre + '! ðŸ‘‹' : 'Â¡Bienvenido de vuelta, ' + nombre + '! ðŸ‘‹';
    document.getElementById('wbMessage').innerHTML = msg;
    document.getElementById('wbProgress').innerHTML = progressHtml;
    document.getElementById('wbBtn').textContent = isEn ? 'ðŸš€ Let\'s study!' : 'ðŸš€ Â¡Vamos a estudiar!';
    
    var overlay = document.getElementById('welcomeBackOverlay');
    overlay.style.display = 'flex';

    // Mario speaks
    if(typeof speakText === 'function') speakText(msg);
  }

  window.closeWelcomeBack = function(){
    document.getElementById('welcomeBackOverlay').style.display = 'none';
    if(window.speechSynthesis) window.speechSynthesis.cancel();
    updateActivity();
  };

  // ===== REGISTER SERVICE WORKER FOR BACKGROUND NOTIFICATIONS =====
  if('serviceWorker' in navigator){
    // Create inline service worker
    var swCode = 'self.addEventListener("push",function(e){var d=e.data?e.data.json():{};self.registration.showNotification(d.title||"Maestro Mario",{body:d.body||"Es hora de estudiar!",icon:"mario.jpg",tag:"maestro-reminder"});});';
    var swBlob = new Blob([swCode], {type:'application/javascript'});
    var swUrl = URL.createObjectURL(swBlob);
    navigator.serviceWorker.register(swUrl).catch(function(){});
  }

  // ===== INIT =====
  requestNotifPermission();
  
  // Show welcome back after a short delay (let app load first)
  setTimeout(function(){
    showWelcomeBack();
  }, 2000);

})();
</script>

</body>
</html>
