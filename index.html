<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maestro Mario - HVAC Training App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{--accent:#ff6b2b;--electric:#00d4ff;--gold:#f1c40f;--dark:#0a1628;--card:#111d33;--card2:#162440;--txt:#e8f0ff;--muted:#7a93b8;--r:16px}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Nunito',sans-serif;background:var(--dark);color:var(--txt);min-height:100vh;min-height:100dvh;overflow-x:hidden}
        .bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
        .bg .o{position:absolute;border-radius:50%;filter:blur(90px);opacity:.12;animation:d 22s ease-in-out infinite}
        .bg .o:nth-child(1){width:420px;height:420px;background:var(--accent);top:-120px;left:-120px}
        .bg .o:nth-child(2){width:360px;height:360px;background:var(--electric);bottom:-100px;right:-100px;animation-delay:-8s}
        .bg .o:nth-child(3){width:280px;height:280px;background:#6366f1;top:40%;left:40%;animation-delay:-15s}
        @keyframes d{0%,100%{transform:translate(0,0) scale(1)}33%{transform:translate(30px,-30px) scale(1.08)}66%{transform:translate(-20px,20px) scale(.92)}}
        .gr{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,212,255,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,.025) 1px,transparent 1px);background-size:44px 44px}
        .app{position:relative;z-index:1;max-width:460px;margin:0 auto;min-height:100vh;min-height:100dvh;padding:16px 18px;display:flex;flex-direction:column}
        .s{display:none;flex-direction:column;align-items:center;flex:1;animation:si .55s cubic-bezier(.16,1,.3,1)}
        .s.on{display:flex}
        @keyframes si{from{opacity:0;transform:translateY(36px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
        
        /* VIDEO FLOTANTE DESDE LA DERECHA */
        .video-float{position:fixed;bottom:100px;right:-320px;z-index:900;width:300px;transition:right 0.6s cubic-bezier(.34,1.56,.64,1);pointer-events:none}
        .video-float.active{right:20px;pointer-events:auto}
        .video-float.hiding{right:-320px}
        .video-float-inner{position:relative;border-radius:20px;overflow:hidden;box-shadow:0 15px 50px rgba(255,107,43,0.6),0 0 0 3px var(--accent);background:#000}
        .video-float video{width:100%;display:block;border-radius:17px}
        .video-float-label{position:absolute;top:12px;left:12px;background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:12px;font-weight:700;padding:6px 14px;border-radius:20px;display:flex;align-items:center;gap:8px;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .video-float-label::before{content:'';width:10px;height:10px;border-radius:50%;background:#00ff00;animation:blink 1s infinite;box-shadow:0 0 10px #00ff00}
        @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
        .video-float-close{position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,0.7);border:2px solid rgba(255,255,255,0.3);color:white;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s}
        .video-float-close:hover{background:var(--accent);border-color:var(--accent);transform:scale(1.1)}
        .video-float-glow{position:absolute;inset:-4px;border-radius:24px;background:conic-gradient(var(--accent),var(--electric),var(--gold),var(--accent));z-index:-1;animation:sp 3s linear infinite}
        
        /* MODAL AI CHAT */
        .ai-modal{position:fixed;inset:0;z-index:600;background:rgba(10,22,40,0.95);display:flex;align-items:flex-end;justify-content:center;opacity:0;visibility:hidden;transition:all 0.3s}
        .ai-modal.active{opacity:1;visibility:visible}
        .ai-chat{width:100%;max-width:460px;height:75vh;background:var(--card);border-radius:24px 24px 0 0;display:flex;flex-direction:column;transform:translateY(100%);transition:transform 0.4s cubic-bezier(.16,1,.3,1)}
        .ai-modal.active .ai-chat{transform:translateY(0)}
        .ai-chat-header{padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:12px}
        .ai-chat-avatar{width:48px;height:48px;border-radius:50%;overflow:hidden;border:2px solid var(--accent)}
        .ai-chat-avatar img{width:100%;height:100%;object-fit:cover}
        .ai-chat-title{flex:1}
        .ai-chat-title h3{font-family:'Fredoka',sans-serif;font-size:17px;color:var(--txt)}
        .ai-chat-title span{font-size:12px;color:var(--electric)}
        .ai-chat-close{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.1);border:none;color:var(--txt);font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .ai-chat-close:hover{background:var(--accent)}
        .ai-chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}
        .ai-msg{max-width:85%;padding:14px 18px;border-radius:18px;font-size:15px;line-height:1.5}
        .ai-msg.mario{background:linear-gradient(135deg,rgba(255,107,43,0.2),rgba(0,212,255,0.1));border:1px solid rgba(255,107,43,0.3);align-self:flex-start;border-bottom-left-radius:4px}
        .ai-msg.user{background:var(--card2);align-self:flex-end;border-bottom-right-radius:4px}
        .ai-chat-input{padding:16px;border-top:1px solid rgba(255,255,255,0.1);display:flex;gap:12px}
        .ai-chat-input input{flex:1;padding:14px 18px;border-radius:25px;border:2px solid rgba(255,255,255,0.1);background:var(--dark);color:var(--txt);font-size:15px;outline:none}
        .ai-chat-input input:focus{border-color:var(--accent)}
        .ai-chat-input button{width:50px;height:50px;border-radius:50%;background:var(--accent);border:none;color:white;font-size:22px;cursor:pointer}
        .ai-chat-input button:disabled{opacity:0.5;cursor:not-allowed}
        
        /* SPEAKING INDICATOR */
        .speaking-indicator{display:none;align-items:center;gap:8px;padding:10px 16px;background:rgba(255,107,43,0.2);border-radius:12px;margin-top:8px}
        .speaking-indicator.active{display:flex}
        .speaking-indicator .waves{display:flex;gap:3px;align-items:center}
        .speaking-indicator .wave{width:4px;height:16px;background:var(--accent);border-radius:2px;animation:wave 0.8s ease-in-out infinite}
        .speaking-indicator .wave:nth-child(2){animation-delay:0.1s}
        .speaking-indicator .wave:nth-child(3){animation-delay:0.2s}
        .speaking-indicator .wave:nth-child(4){animation-delay:0.3s}
        @keyframes wave{0%,100%{height:8px}50%{height:20px}}
        .speaking-indicator span{font-size:13px;color:var(--accent);font-weight:600}
        
        /* CONFETTI */
        .cw{position:fixed;inset:0;pointer-events:none;z-index:100}.cf{position:absolute;top:-16px;animation:cff 2.8s ease-out forwards}
        @keyframes cff{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
        
        /* AVATAR - CLICKEABLE PARA ABRIR AI */
        .aw{position:relative;margin:16px auto 12px;cursor:pointer;transition:transform 0.3s}
        .aw:hover{transform:scale(1.05)}
        .aw.lg{width:190px;height:190px}.aw.md{width:140px;height:140px}.aw.sm{width:120px;height:120px}
        .ar{position:absolute;inset:-6px;border-radius:50%;background:conic-gradient(var(--accent),var(--electric),var(--accent));animation:sp 4s linear infinite}
        @keyframes sp{to{transform:rotate(360deg)}}
        .ag{position:absolute;inset:-20px;border-radius:50%;background:radial-gradient(circle,var(--accent) 0%,transparent 70%);opacity:.25;animation:pu 3s ease-in-out infinite}
        @keyframes pu{0%,100%{transform:scale(1);opacity:.25}50%{transform:scale(1.12);opacity:.4}}
        .ai{position:relative;width:100%;height:100%;border-radius:50%;overflow:hidden;border:4px solid var(--dark);animation:fl 4.5s ease-in-out infinite}
        .ai img{width:100%;height:100%;object-fit:cover}
        @keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        
        /* BADGE DE AI EN AVATAR */
        .aw .ai-badge{position:absolute;bottom:5px;right:5px;background:var(--accent);color:white;font-family:'Fredoka',sans-serif;font-size:10px;font-weight:700;padding:4px 8px;border-radius:10px;border:2px solid var(--dark)}
        
        /* BURBUJA */
        .bb{background:var(--card);border:1.5px solid rgba(0,212,255,.15);border-radius:var(--r);padding:18px 22px;margin:0 6px 20px;position:relative;box-shadow:0 6px 28px rgba(0,0,0,.25);text-align:center;font-size:16.5px;line-height:1.55;font-weight:600;min-height:60px}
        .bb::before{content:'';position:absolute;top:-10px;left:50%;transform:translateX(-50%);border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid rgba(0,212,255,.15)}
        .bb::after{content:'';position:absolute;top:-8px;left:50%;transform:translateX(-50%);border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--card)}
        
        /* OTROS ESTILOS */
        .lo{text-align:center;padding:4px 0}.lo-t{font-family:'Fredoka',sans-serif;font-size:26px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.lo-s{font-size:12px;color:var(--muted);letter-spacing:2.5px;text-transform:uppercase;margin-top:2px}
        .pb{width:100%;height:5px;background:rgba(255,255,255,.06);border-radius:3px;margin:12px 0 6px;overflow:hidden}.pbf{height:100%;background:linear-gradient(90deg,var(--accent),var(--electric));border-radius:3px;transition:width .6s}
        .ps{font-size:12px;color:var(--muted);margin-bottom:12px;text-align:center}.ps b{color:var(--accent)}
        .os{width:100%;display:flex;flex-direction:column;gap:10px}
        .oc{background:var(--card);border:2px solid rgba(255,255,255,.06);border-radius:var(--r);padding:16px 18px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px}
        .oc:hover{border-color:rgba(255,107,43,.4);background:var(--card2);transform:translateY(-1px)}
        .oc.sel{border-color:var(--accent);background:linear-gradient(135deg,rgba(255,107,43,.12),rgba(0,212,255,.06))}
        .oi{width:44px;height:44px;border-radius:12px;background:rgba(255,255,255,.05);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;transition:all .25s}
        .oc.sel .oi{background:var(--accent);transform:scale(1.08)}
        .ot{font-family:'Fredoka',sans-serif;font-size:15px;font-weight:600}.od{font-size:12.5px;color:var(--muted);margin-top:1px}
        .ck{width:22px;height:22px;border-radius:7px;border:2px solid rgba(255,255,255,.12);margin-left:auto;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;color:white}
        .oc.sel .ck{background:var(--accent);border-color:var(--accent)}.oc.sel .ck::after{content:'‚úì'}
        .mh{font-size:12.5px;color:var(--muted);text-align:center;margin-bottom:8px}
        .fl{display:flex;gap:18px;justify-content:center;margin-top:16px}
        .fc{width:135px;height:155px;background:var(--card);border:2.5px solid rgba(255,255,255,.06);border-radius:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;cursor:pointer;transition:all .3s}
        .fc:hover{border-color:var(--accent);transform:translateY(-3px);box-shadow:0 10px 28px rgba(255,107,43,.18)}
        .fe{font-size:42px;line-height:1}.fn{font-family:'Fredoka',sans-serif;font-size:17px;font-weight:600}
        .bt{width:100%;padding:16px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:17px;font-weight:700;cursor:pointer;margin-top:20px;transition:all .25s;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .bt:hover{transform:translateY(-2px);box-shadow:0 7px 24px rgba(255,107,43,.35)}.bt:disabled{opacity:.35;cursor:not-allowed;transform:none}
        .ip{width:100%;padding:16px 18px;border:2px solid rgba(255,255,255,.06);border-radius:var(--r);background:var(--card);color:var(--txt);font-size:16px;font-weight:600;outline:none}.ip:focus{border-color:var(--accent)}.ip::placeholder{color:var(--muted)}
        .sp{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;text-align:center}
        .sp-t{font-family:'Fredoka',sans-serif;font-size:40px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.15}
        .sp-s{font-size:17px;color:var(--muted);max-width:280px}
        .badge{display:inline-flex;align-items:center;gap:7px;background:rgba(255,107,43,.1);border:1px solid rgba(255,107,43,.25);border-radius:28px;padding:5px 14px;font-family:'Fredoka',sans-serif;font-size:13px;color:var(--accent)}
        .rt{background:var(--card);border:1.5px solid rgba(0,212,255,.12);border-radius:var(--r);padding:16px 18px;margin-bottom:10px;display:flex;align-items:center;gap:14px;animation:ri .5s ease-out backwards}
        @keyframes ri{from{opacity:0;transform:translateX(-24px)}to{opacity:1;transform:translateX(0)}}
        .rn{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--electric));display:flex;align-items:center;justify-content:center;font-family:'Fredoka',sans-serif;font-weight:700;font-size:16px;flex-shrink:0}
        .rtt{font-family:'Fredoka',sans-serif;font-size:14.5px;font-weight:600}.rd{font-size:12px;color:var(--muted)}
        .rl{width:2px;height:16px;background:linear-gradient(var(--accent),var(--electric));margin-left:35px;border-radius:2px}
        .typing{display:inline-flex;gap:4px;align-items:center;padding:4px 0}
        .typing .dot{width:8px;height:8px;border-radius:50%;background:var(--electric);animation:tblink 1.4s infinite both}
        .typing .dot:nth-child(2){animation-delay:.2s}.typing .dot:nth-child(3){animation-delay:.4s}
        @keyframes tblink{0%,80%,100%{opacity:.3;transform:scale(.8)}40%{opacity:1;transform:scale(1)}}
        
        /* MUSIC BUTTON */
        .music-btn{position:fixed;bottom:20px;left:20px;z-index:800;width:48px;height:48px;border-radius:50%;background:var(--card);border:2px solid rgba(0,212,255,0.3);color:var(--electric);font-size:22px;cursor:pointer;display:none;align-items:center;justify-content:center;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .music-btn:hover{background:var(--card2);border-color:var(--electric);transform:scale(1.1)}
        .music-btn.active{display:flex}
        .music-btn.muted{color:var(--muted);border-color:rgba(255,255,255,0.1)}
        
        /* QUIZ STYLES */
        .quiz-header{width:100%;display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
        .quiz-cat{font-size:11px;color:var(--electric);text-transform:uppercase;letter-spacing:1.5px;font-weight:700}
        .quiz-score{display:flex;align-items:center;gap:8px;font-family:'Fredoka',sans-serif;font-size:14px}
        .quiz-score .correct{color:#2ecc71}.quiz-score .wrong{color:#e74c3c}
        .quiz-num{font-family:'Fredoka',sans-serif;font-size:15px;color:var(--txt);text-align:center;margin:4px 0}
        .quiz-q{background:var(--card);border:1.5px solid rgba(0,212,255,.15);border-radius:var(--r);padding:20px;margin:12px 0;text-align:center;font-size:17px;font-weight:700;line-height:1.5}
        .quiz-opts{width:100%;display:flex;flex-direction:column;gap:10px}
        .quiz-opt{background:var(--card);border:2px solid rgba(255,255,255,.08);border-radius:var(--r);padding:16px 18px;cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:14px;font-size:15px;font-weight:600}
        .quiz-opt:hover{border-color:rgba(255,107,43,.4);background:var(--card2);transform:translateY(-1px)}
        .quiz-opt.correct{border-color:#2ecc71;background:rgba(46,204,113,0.15)}
        .quiz-opt.correct .quiz-letter{background:#2ecc71}
        .quiz-opt.wrong{border-color:#e74c3c;background:rgba(231,76,60,0.15)}
        .quiz-opt.wrong .quiz-letter{background:#e74c3c}
        .quiz-opt.disabled{pointer-events:none;opacity:0.6}
        .quiz-opt.disabled.correct{opacity:1}
        .quiz-letter{width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,.08);display:flex;align-items:center;justify-content:center;font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;flex-shrink:0;transition:all .3s}
        .quiz-explain{background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:var(--r);padding:14px 18px;margin-top:12px;font-size:14px;line-height:1.5;display:none}
        .quiz-explain.show{display:block}
        .quiz-explain b{color:var(--electric)}
        .quiz-next{width:100%;padding:14px;border:none;border-radius:var(--r);background:linear-gradient(135deg,var(--accent),#e84500);color:white;font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;cursor:pointer;margin-top:14px;display:none;transition:all .25s;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .quiz-next:hover{transform:translateY(-2px)}
        .quiz-next.show{display:block}
        .quiz-nav{display:flex;gap:10px;width:100%;margin-top:14px}
        .quiz-nav button{flex:1;padding:14px;border:none;border-radius:var(--r);font-family:'Fredoka',sans-serif;font-size:16px;font-weight:700;cursor:pointer;transition:all .25s;display:none}
        .quiz-nav button.show{display:block}
        .quiz-prev{background:var(--card);border:2px solid rgba(0,212,255,0.3) !important;color:var(--electric)}
        .quiz-prev:hover{border-color:var(--electric) !important;transform:translateY(-2px)}
        .quiz-fwd{background:linear-gradient(135deg,var(--accent),#e84500);color:white;box-shadow:0 4px 18px rgba(255,107,43,.25)}
        .quiz-fwd:hover{transform:translateY(-2px)}
        .quiz-result{text-align:center;width:100%}
        .quiz-result-score{font-family:'Fredoka',sans-serif;font-size:64px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--electric));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .quiz-result-label{font-size:18px;color:var(--muted);margin-top:4px}
        .quiz-result-msg{font-size:16px;margin-top:16px;line-height:1.5}
        .quiz-medal{font-size:80px;margin:16px 0}
        .quiz-stars{display:flex;justify-content:center;gap:6px;margin:12px 0}
        .quiz-stars span{font-size:32px;opacity:0.2;transition:all 0.5s}
        .quiz-stars span.lit{opacity:1;animation:starPop 0.5s ease-out}
        @keyframes starPop{0%{transform:scale(0)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
        
        /* CELEBRATION EFFECTS */
        @keyframes screenShake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-4px)}30%,70%{transform:translateX(4px)}}
        @keyframes bigShake{0%,100%{transform:translateX(0)}10%,50%,90%{transform:translateX(-8px) rotate(-1deg)}30%,70%{transform:translateX(8px) rotate(1deg)}}
        @keyframes lightning{0%{opacity:0}5%{opacity:0.8}10%{opacity:0}15%{opacity:1}20%{opacity:0}100%{opacity:0}}
        @keyframes streakPulse{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
        @keyframes fireFloat{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-120px) scale(0.3);opacity:0}}
        .shake{animation:screenShake 0.4s ease}
        .big-shake{animation:bigShake 0.6s ease}
        .streak-badge{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:900;font-size:48px;font-family:'Fredoka',sans-serif;font-weight:700;color:white;text-shadow:0 0 30px rgba(255,107,43,0.8),0 0 60px rgba(255,107,43,0.4);animation:streakPulse 0.6s ease;pointer-events:none;white-space:nowrap}
        .lightning-flash{position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:850;pointer-events:none;animation:lightning 0.4s ease}
        .fire-emoji{position:fixed;z-index:850;font-size:36px;pointer-events:none;animation:fireFloat 1.2s ease-out forwards}
    </style>
</head>
<body>
<div class="bg"><div class="o"></div><div class="o"></div><div class="o"></div></div>
<div class="gr"></div>

<!-- VIDEO FLOTANTE DESDE LA DERECHA -->
<div class="video-float" id="videoFloat">
    <div class="video-float-glow"></div>
    <div class="video-float-inner">
        <div class="video-float-label">üî¥ EN VIVO</div>
        <button class="video-float-close" onclick="closeVideo()">‚úï</button>
        <video id="marioVideo" playsinline webkit-playsinline></video>
    </div>
</div>

<!-- MODAL AI CHAT -->
<div class="ai-modal" id="aiModal">
    <div class="ai-chat">
        <div class="ai-chat-header">
            <div class="ai-chat-avatar"><img src="mario.jpg" alt="Mario"></div>
            <div class="ai-chat-title"><h3>Maestro Mario AI</h3><span>üü¢ Disponible para ayudarte</span></div>
            <button class="ai-chat-close" onclick="closeAIChat()">‚úï</button>
        </div>
        <div class="ai-chat-messages" id="aiMessages">
            <div class="ai-msg mario">¬°√ìrale t√©cnico! Soy el Maestro Mario con inteligencia artificial. ¬øEn qu√© te puedo ayudar? Preg√∫ntame lo que quieras sobre HVAC, refrigeraci√≥n, o electricidad. üîß</div>
        </div>
        <div class="speaking-indicator" id="speakingIndicator">
            <div class="waves"><div class="wave"></div><div class="wave"></div><div class="wave"></div><div class="wave"></div></div>
            <span>Maestro Mario est√° hablando...</span>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiInput" placeholder="Escribe tu pregunta..." onkeydown="if(event.key==='Enter'&&!event.shiftKey)sendAIMessage()">
            <button id="sendBtn" onclick="sendAIMessage()">‚û§</button>
        </div>
    </div>
</div>

<!-- AUDIO PLAYER PARA VOZ DE AI -->
<audio id="aiAudio" style="display:none"></audio>

<div class="app">
<!-- PANTALLA INICIO -->
<div class="s on" id="s0"><div class="sp">
    <div class="aw lg" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="Maestro Mario"></div><span class="ai-badge">AI</span></div>
    <div><div class="sp-t">MAESTRO<br>MARIO</div><div class="badge">‚ö° NIVEL 33</div></div>
    <div class="sp-s">Si no mides, est√°s adivinando</div>
    <button class="bt" onclick="startWithVideo()" style="max-width:260px">Comenzar / Start</button>
</div></div>

<!-- IDIOMA -->
<div class="s" id="s1">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div><div class="lo-s">HVAC ‚Ä¢ ELECTRICAL ‚Ä¢ TRAINING</div></div>
    <div class="aw md" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb">¬°Hola! Choose your language<br>Elige tu idioma</div>
    <div class="fl"><div class="fc" onclick="setLang('es')"><span class="fe">üá≤üáΩ</span><span class="fn">Espa√±ol</span></div><div class="fc" onclick="setLang('en')"><span class="fe">üá∫üá∏</span><span class="fn">English</span></div></div>
</div>

<!-- NOMBRE -->
<div class="s" id="s2">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:20%"></div></div><div class="ps"><b data-t="step_1"></b></div>
    <div class="aw md" id="a2" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb2"><span data-t="welcome_speech"></span></div>
    <div style="width:100%"><input class="ip" id="nm" data-tp="name_ph" oninput="document.getElementById('b2').disabled=this.value.trim().length<2"><button class="bt" id="b2" disabled onclick="sName()" data-t="continue"></button></div>
</div>

<!-- NIVEL -->
<div class="s" id="s3">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:40%"></div></div><div class="ps"><b data-t="step_2"></b></div>
    <div class="aw sm" id="a3" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb3"><span data-t="level_speech"></span></div>
    <div class="os" id="lo"></div>
    <button class="bt" id="b3" disabled onclick="sLvl()" data-t="continue"></button>
</div>

<!-- ESPECIALIDADES -->
<div class="s" id="s4">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:60%"></div></div><div class="ps"><b data-t="step_3"></b></div>
    <div class="aw sm" id="a4" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb4"><span data-t="spec_speech"></span></div>
    <p class="mh" data-t="multi_hint"></p>
    <div class="os" id="so"></div>
    <button class="bt" id="b4" disabled onclick="sSpc()" data-t="continue"></button>
</div>

<!-- ESCUELA -->
<div class="s" id="s5">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:80%"></div></div><div class="ps"><b data-t="step_4"></b></div>
    <div class="aw sm" id="a5" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb5"><span data-t="school_speech"></span></div>
    <div class="os" id="sco"></div>
    <button class="bt" id="b5" disabled onclick="sSch()" data-t="continue"></button>
</div>

<!-- METAS -->
<div class="s" id="s6">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:90%"></div></div><div class="ps"><b data-t="step_5"></b></div>
    <div class="aw sm" id="a6" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb6"><span data-t="goals_speech"></span></div>
    <p class="mh" data-t="multi_hint"></p>
    <div class="os" id="go2"></div>
    <button class="bt" id="b6" disabled onclick="sGol()" data-t="continue"></button>
</div>

<!-- RUTA FINAL -->
<div class="s" id="s7">
    <div class="lo"><div class="lo-t">MAESTRO MARIO</div></div>
    <div class="pb"><div class="pbf" style="width:100%"></div></div>
    <div class="aw md" id="a7" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--gold) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="bb7"><span data-t="route_speech"></span></div>
    <div id="rl" style="width:100%"></div>
    <button class="bt" onclick="startApp()" data-t="start_btn"></button>
</div>

<!-- QUIZ -->
<div class="s" id="s8">
    <div class="quiz-header">
        <div class="quiz-cat" id="qCat"></div>
        <div class="quiz-score">‚úÖ <span class="correct" id="qRight">0</span> | ‚ùå <span class="wrong" id="qWrong">0</span></div>
    </div>
    <div class="pb"><div class="pbf" id="qBar" style="width:0%"></div></div>
    <div class="quiz-num" id="qNum"></div>
    <div class="aw sm" onclick="openAIChat()"><div class="ag"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="bb" id="qBubble"></div>
    <div class="quiz-q" id="qText"></div>
    <div class="quiz-opts" id="qOpts"></div>
    <div class="quiz-explain" id="qExplain"></div>
    <div class="quiz-nav">
        <button class="quiz-prev" id="qPrev" onclick="prevQuestion()">‚Üê Anterior</button>
        <button class="quiz-fwd" id="qNext" onclick="nextQuestion()">Siguiente ‚Üí</button>
    </div>
</div>

<!-- QUIZ RESULT -->
<div class="s" id="s9">
    <div class="aw md" onclick="openAIChat()"><div class="ag" style="background:radial-gradient(circle,var(--gold) 0%,transparent 70%)"></div><div class="ar"></div><div class="ai"><img src="mario.jpg" alt="M"></div><span class="ai-badge">AI</span></div>
    <div class="quiz-result">
        <div class="quiz-medal" id="rMedal"></div>
        <div class="quiz-result-score" id="rScore"></div>
        <div class="quiz-result-label" id="rLabel"></div>
        <div class="quiz-stars" id="rStars"><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span><span>‚≠ê</span></div>
        <div class="bb quiz-result-msg" id="rMsg"></div>
    </div>
    <button class="bt" onclick="retryQuiz()">üîÑ Intentar de Nuevo</button>
    <button class="bt" onclick="go('s7')" style="background:var(--card);border:2px solid var(--accent);margin-top:10px">‚Üê Volver a Mi Ruta</button>
</div>
</div>
<div class="cw" id="conf"></div>
<button class="music-btn" id="musicBtn" onclick="toggleMusic()">üéµ</button>

<script>
const D={lang:'es',name:'',level:null,specs:[],school:null,goals:[]};
let videoPlaying=false;
let currentVideoCallback=null;
let isSpeaking=false;
let audioUnlocked=false;

function unlockAudio(){
    if(audioUnlocked)return;
    const audio=document.getElementById('aiAudio');
    audio.src='data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYoRwAAAAAAAAAAAAAAAAAAAAAAAA==';
    audio.play().then(()=>{audio.pause();audioUnlocked=true;}).catch(()=>{});
}

// ========== CHIPTUNE MUSIC ENGINE ==========
let musicCtx=null;
let musicPlaying=false;
let musicMuted=false;
let musicGain=null;
let musicTimers=[];
let musicVolume=0.5;
let musicMode='onboarding';

function noteFreq(note,octave){
    const notes={C:261.63,D:293.66,E:329.63,F:349.23,G:392.00,A:440.00,B:493.88};
    const base=notes[note]||261.63;
    return base*Math.pow(2,octave-4);
}

function playNote(type,freq,start,dur,vol){
    if(!musicCtx)return;
    const osc=musicCtx.createOscillator();
    const gain=musicCtx.createGain();
    osc.type=type;
    osc.frequency.setValueAtTime(freq,start);
    gain.gain.setValueAtTime(vol,start);
    gain.gain.setValueAtTime(vol,start+dur*0.8);
    gain.gain.linearRampToValueAtTime(0,start+dur);
    osc.connect(gain);
    gain.connect(musicGain);
    osc.start(start);
    osc.stop(start+dur);
}

function playMusicLoop(){
    if(!musicCtx||!musicPlaying)return;
    const bpm=130;
    const beat=60/bpm;
    const half=beat/2;
    const now=musicCtx.currentTime+0.05;
    
    // Melody (square wave) - Pokemon adventure style
    const melody=[
        ['E',5],['G',5],['A',5],['B',5],
        ['A',5],['G',5],['E',5],['D',5],
        ['C',5],['D',5],['E',5],['G',5],
        ['A',5],['G',5],['E',5],['G',5],
        ['A',5],['B',5],['C',6],['B',5],
        ['A',5],['G',5],['A',5],['B',5],
        ['G',5],['E',5],['D',5],['E',5],
        ['C',5],['D',5],['E',5],['E',5]
    ];
    
    // Bass (triangle wave)
    const bass=[
        ['C',3],['C',3],['G',3],['G',3],
        ['A',3],['A',3],['E',3],['E',3],
        ['F',3],['F',3],['C',3],['C',3],
        ['G',3],['G',3],['G',3],['G',3],
        ['A',3],['A',3],['F',3],['F',3],
        ['C',3],['C',3],['G',3],['G',3],
        ['F',3],['F',3],['G',3],['G',3],
        ['C',3],['C',3],['C',3],['C',3]
    ];
    
    // Arpeggio layer (square wave, quiet)
    const arp=[
        ['C',4],['E',4],['G',4],['E',4],
        ['A',4],['C',5],['E',5],['C',5],
        ['F',4],['A',4],['C',5],['A',4],
        ['G',4],['B',4],['D',5],['B',4],
        ['A',4],['C',5],['E',5],['C',5],
        ['F',4],['A',4],['C',5],['A',4],
        ['G',4],['B',4],['D',5],['B',4],
        ['C',4],['E',4],['G',4],['E',4]
    ];
    
    for(let i=0;i<melody.length;i++){
        const t=now+i*half;
        playNote('square',noteFreq(melody[i][0],melody[i][1]),t,half*0.85,0.08);
    }
    for(let i=0;i<bass.length;i++){
        const t=now+i*half;
        playNote('triangle',noteFreq(bass[i][0],bass[i][1]),t,half*0.9,0.12);
    }
    for(let i=0;i<arp.length;i++){
        const t=now+i*half;
        playNote('square',noteFreq(arp[i][0],arp[i][1]),t,half*0.4,0.03);
    }
    
    const loopDur=melody.length*half;
    const timer=setTimeout(()=>playMusicLoop(),loopDur*1000-100);
    musicTimers.push(timer);
}

function startMusic(){
    if(musicPlaying)return;
    musicCtx=new(window.AudioContext||window.webkitAudioContext)();
    musicGain=musicCtx.createGain();
    musicGain.gain.setValueAtTime(0.5,musicCtx.currentTime);
    musicGain.connect(musicCtx.destination);
    musicPlaying=true;
    musicMuted=false;
    document.getElementById('musicBtn').classList.add('active');
    document.getElementById('musicBtn').textContent='üéµ';
    playMusicLoop();
}

function stopMusic(){
    musicPlaying=false;
    musicTimers.forEach(t=>clearTimeout(t));
    musicTimers=[];
    if(musicCtx){musicCtx.close();musicCtx=null;}
}

function toggleMusic(){
    const btn=document.getElementById('musicBtn');
    if(musicMuted){
        musicMuted=false;
        musicVolume=musicMode==='studying'?0.25:0.5;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        btn.textContent='üéµ';
        btn.classList.remove('muted');
    }else if(musicVolume>=0.4){
        musicVolume=musicMode==='studying'?0.15:0.25;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        btn.textContent='üîâ';
    }else if(musicVolume>=0.15){
        musicVolume=musicMode==='studying'?0.06:0.1;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(musicVolume,musicCtx.currentTime);
        btn.textContent='üîà';
    }else{
        musicMuted=true;
        musicVolume=0;
        if(musicGain&&musicCtx)musicGain.gain.setValueAtTime(0,musicCtx.currentTime);
        btn.textContent='üîá';
        btn.classList.add('muted');
    }
}

function setMusicVolume(vol){
    musicVolume=vol;
    if(musicGain&&musicCtx&&!musicMuted)musicGain.gain.linearRampToValueAtTime(vol,musicCtx.currentTime+0.3);
}

function lowerMusicForSpeech(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(Math.min(musicVolume*0.2,0.05),musicCtx.currentTime+0.3);
}

function restoreMusicAfterSpeech(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(musicVolume,musicCtx.currentTime+0.3);
}

function lowerMusicForVideo(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(Math.min(musicVolume*0.3,0.08),musicCtx.currentTime+0.5);
}

function restoreMusicAfterVideo(){
    if(musicGain&&!musicMuted&&musicCtx)musicGain.gain.linearRampToValueAtTime(musicVolume,musicCtx.currentTime+0.5);
}

function enterStudyMode(){
    musicMode='studying';
    setMusicVolume(0.25);
    document.getElementById('musicBtn').textContent='üîâ';
}

const SUPABASE_URL='https://htklsowiyjwsjnacnvnr.supabase.co/functions/v1';

const VIDEOS={
    bienvenida:'bienvenida.mp4.mp4',
    correcto:'correcto.mp4.mp4',
    incorrecto:'incorrecto.mp4.mp4',
    medalla:'medalla.mp4.mp4'
};

// ========== VIDEO FUNCTIONS ==========
let videoClosing=false;

function showVideo(type,cb){
    if(videoPlaying||videoClosing)return;
    videoPlaying=true;
    videoClosing=false;
    lowerMusicForVideo();
    currentVideoCallback=cb;
    const vf=document.getElementById('videoFloat');
    const v=document.getElementById('marioVideo');
    const videoSrc=VIDEOS[type]||VIDEOS.bienvenida;
    console.log('Loading video:',videoSrc);
    
    // Limpiar handlers anteriores
    v.onended=null;
    v.onerror=null;
    
    v.src=videoSrc;
    v.load();
    vf.classList.remove('hiding');
    vf.classList.add('active');
    v.play().then(()=>{
        console.log('Video playing');
    }).catch(e=>{
        console.log('Video play error:',e);
        closeVideo();
    });
    v.onended=function(){
        console.log('Video ended');
        closeVideo();
    };
    v.onerror=function(e){
        console.log('Video error:',e);
        if(videoPlaying&&!videoClosing)closeVideo();
    };
}

function closeVideo(){
    if(videoClosing)return;
    videoClosing=true;
    const vf=document.getElementById('videoFloat');
    const v=document.getElementById('marioVideo');
    
    // Limpiar handlers ANTES de tocar el src
    v.onended=null;
    v.onerror=null;
    
    vf.classList.add('hiding');
    vf.classList.remove('active');
    restoreMusicAfterVideo();
    setTimeout(()=>{
        v.pause();
        v.removeAttribute('src');
        v.load();
        videoPlaying=false;
        videoClosing=false;
        if(currentVideoCallback){
            const cb=currentVideoCallback;
            currentVideoCallback=null;
            cb();
        }
    },600);
}

function startWithVideo(){
    startMusic();
    showVideo('bienvenida',()=>{
        go('s1');
    });
}

// ========== AI CHAT FUNCTIONS ==========
const MARIO_SYSTEM="Eres el Maestro Mario Flores Corona, instructor de HVAC/Refrigeracion/Electricidad con 25+ a√±os de experiencia. Tu escuela es ACVOLT Tech School en San Bernardino, California. Tu frase: Si no mides, est√°s adivinando. Responde en 2-3 oraciones MAX. S√© personal y motivador. Usa frases como √≥rale, vamos con todo, as√≠ se hace. NO uses markdown ni emojis.";

async function getAIResponse(msg){
    try{
        const r=await fetch(SUPABASE_URL+'/tutor-ia-chat',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                messages:[{role:'user',content:msg}],
                system:MARIO_SYSTEM,
                max_tokens:150
            })
        });
        if(!r.ok)throw new Error('Chat API error');
        const d=await r.json();
        return d.content&&d.content[0]?d.content[0].text:'¬°√ìrale t√©cnico! Hubo un problema, intenta de nuevo.';
    }catch(e){
        console.error('AI Chat Error:',e);
        return '¬°√ìrale! Problema de conexi√≥n. Intenta de nuevo.';
    }
}

async function speakText(text){
    try{
        isSpeaking=true;
        lowerMusicForSpeech();
        document.getElementById('speakingIndicator').classList.add('active');
        const r=await fetch(SUPABASE_URL+'/tutor-ia-voice',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({text:text})
        });
        if(!r.ok)throw new Error('Voice API error');
        const audioBlob=await r.blob();
        const audioUrl=URL.createObjectURL(audioBlob);
        const audio=document.getElementById('aiAudio');
        audio.src=audioUrl;
        audio.onended=function(){
            isSpeaking=false;
            document.getElementById('speakingIndicator').classList.remove('active');
            restoreMusicAfterSpeech();
            URL.revokeObjectURL(audioUrl);
        };
        audio.onerror=function(){
            isSpeaking=false;
            document.getElementById('speakingIndicator').classList.remove('active');
            restoreMusicAfterSpeech();
        };
        await audio.play();
    }catch(e){
        console.error('Voice Error:',e);
        isSpeaking=false;
        document.getElementById('speakingIndicator').classList.remove('active');
        restoreMusicAfterSpeech();
    }
}

function openAIChat(){
    document.getElementById('aiModal').classList.add('active');
}

function closeAIChat(){
    document.getElementById('aiModal').classList.remove('active');
    const audio=document.getElementById('aiAudio');
    audio.pause();
    isSpeaking=false;
    document.getElementById('speakingIndicator').classList.remove('active');
}

async function sendAIMessage(){
    const input=document.getElementById('aiInput');
    const msgs=document.getElementById('aiMessages');
    const sendBtn=document.getElementById('sendBtn');
    const txt=input.value.trim();
    if(!txt||isSpeaking)return;
    
    // Desbloquear audio en el click
    unlockAudio();
    
    // Disable input while processing
    input.disabled=true;
    sendBtn.disabled=true;
    
    // Show user message
    msgs.innerHTML+='<div class="ai-msg user">'+txt+'</div>';
    input.value='';
    
    // Show typing indicator
    msgs.innerHTML+='<div class="ai-msg mario" id="typing"><div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>';
    msgs.scrollTop=msgs.scrollHeight;
    
    // Get AI text response
    const response=await getAIResponse(txt);
    
    // Remove typing indicator and show response
    const typing=document.getElementById('typing');
    if(typing)typing.remove();
    msgs.innerHTML+='<div class="ai-msg mario">'+response+'</div>';
    msgs.scrollTop=msgs.scrollHeight;
    
    // Re-enable input
    input.disabled=false;
    sendBtn.disabled=false;
    input.focus();
    
    // Speak the response
    await speakText(response);
}

// ========== CONFETTI ==========
function cft(){
    const c=document.getElementById('conf');
    const cols=['#ff6b2b','#00d4ff','#f1c40f','#2ecc71','#e74c3c','#9b59b6'];
    for(let i=0;i<55;i++){
        const p=document.createElement('div');
        p.className='cf';
        p.style.left=Math.random()*100+'%';
        p.style.background=cols[Math.floor(Math.random()*cols.length)];
        p.style.animationDelay=Math.random()*1.8+'s';
        p.style.animationDuration=(2+Math.random()*2)+'s';
        p.style.width=(6+Math.random()*7)+'px';
        p.style.height=p.style.width;
        p.style.borderRadius=Math.random()>.5?'50%':'2px';
        c.appendChild(p);
    }
    setTimeout(()=>c.innerHTML='',4500);
}

// ========== TRANSLATIONS ==========
const T={
es:{step_1:'Paso 1 de 5',step_2:'Paso 2 de 5',step_3:'Paso 3 de 5',step_4:'Paso 4 de 5',step_5:'Paso 5 de 5',welcome_speech:'¬°Bienvenido t√©cnico! Soy el Maestro Mario y voy a ser tu gu√≠a. ¬øC√≥mo te llamas?',name_ph:'Escribe tu nombre aqu√≠...',continue:'Continuar ‚Üí',level_speech:'¬°Mucho gusto, {name}! ¬øEn qu√© nivel t√©cnico te encuentras?',spec_speech:'¬°Excelente, {name}! ¬øEn qu√© √°reas te sientes m√°s fuerte?',multi_hint:'Selecciona una o m√°s opciones',school_speech:'¬°Vas muy bien, {name}! ¬øD√≥nde est√°s estudiando?',goals_speech:'¬°√öltima pregunta, {name}! ¬øQu√© quieres lograr?',route_speech:'¬°Perfecto, {name}! He creado tu ruta personalizada. ¬°Vamos con todo!',start_btn:'üöÄ ¬°Empezar a Aprender!',lv1:'Estudiante',lv1d:'Estoy aprendiendo lo b√°sico',lv2:'Ayudante',lv2d:'Ya ando en el campo con un t√©cnico',lv3:'T√©cnico',lv3d:'Ya trabajo solo pero quiero mejorar',lv4:'Avanzado',lv4d:'Quiero dominar el oficio',lv5:'Maestro',lv5d:'Quiero ser l√≠der / abrir mi empresa',sp_e:'Electricidad',sp_ed:'Circuitos, controles, cableado',sp_a:'Aire Acondicionado',sp_ad:'Splits, centrales, mini splits',sp_r:'Refrigeraci√≥n',sp_rd:'C√°maras fr√≠as, refrigeradores comerciales',sp_h:'Calefacci√≥n',sp_hd:'Furnaces, bombas de calor',sp_x:'Estoy empezando en todo',sp_xd:'Quiero aprender de todo',sc_ac:'ACVOLT Tech School',sc_acd:'Estudiante actual de ACVOLT',sc_ot:'Otra escuela',sc_otd:'Estoy en otra instituci√≥n',sc_sf:'Aprendo por mi cuenta',sc_sfd:'YouTube, libros, campo',sc_dn:'Ya termin√© mis estudios',sc_dnd:'Tengo certificaci√≥n/diploma',gl_c:'Pasar mis certificaciones',gl_cd:'EPA, NATE, OSHA, NCCER',gl_d:'Mejorar mis diagn√≥sticos',gl_dd:'Ser m√°s preciso en el campo',gl_b:'Abrir mi propio negocio',gl_bd:'De t√©cnico a empresario',gl_m:'Ganar m√°s dinero',gl_md:'Subir mi valor como t√©cnico',r_elec:'Fundamentos El√©ctricos',r_elecd:'Circuitos, Ley de Ohm, diagramas',r_ac:'Aire Acondicionado',r_acd:'Presiones, carga de refrigerante',r_ref:'Refrigeraci√≥n Comercial',r_refd:'C√°maras fr√≠as, controles, defrost',r_heat:'Calefacci√≥n',r_heatd:'Furnaces, bombas de calor, gas',r_cert:'Preparaci√≥n para Certificaciones',r_certd:'EPA 608 ‚Ä¢ NATE ‚Ä¢ OSHA ‚Ä¢ NCCER',r_biz:'De T√©cnico a Empresario',r_bizd:'Licencias, estimados, clientes'},
en:{step_1:'Step 1 of 5',step_2:'Step 2 of 5',step_3:'Step 3 of 5',step_4:'Step 4 of 5',step_5:'Step 5 of 5',welcome_speech:"Welcome technician! I'm Maestro Mario and I'll be your guide. What's your name?",name_ph:'Type your name here...',continue:'Continue ‚Üí',level_speech:"Nice to meet you, {name}! What's your technical level?",spec_speech:'Excellent, {name}! What areas are you strongest in?',multi_hint:'Select one or more options',school_speech:'Great progress, {name}! Where are you studying?',goals_speech:'Last question, {name}! What do you want to achieve?',route_speech:"Perfect, {name}! I've created your personalized path. Let's go!",start_btn:'üöÄ Start Learning!',lv1:'Student',lv1d:"I'm learning the basics",lv2:'Helper',lv2d:"I'm in the field with a technician",lv3:'Technician',lv3d:'I work solo but want to improve',lv4:'Advanced',lv4d:'I want to master the trade',lv5:'Master',lv5d:'I want to lead / start my business',sp_e:'Electrical',sp_ed:'Circuits, controls, wiring',sp_a:'Air Conditioning',sp_ad:'Splits, central, mini splits',sp_r:'Refrigeration',sp_rd:'Walk-in coolers, commercial',sp_h:'Heating',sp_hd:'Furnaces, heat pumps',sp_x:'Starting in everything',sp_xd:'I want to learn it all',sc_ac:'ACVOLT Tech School',sc_acd:'Current ACVOLT student',sc_ot:'Another school',sc_otd:"I'm at another institution",sc_sf:'Self-taught',sc_sfd:'YouTube, books, field',sc_dn:'Completed studies',sc_dnd:'I have certification/diploma',gl_c:'Pass certifications',gl_cd:'EPA, NATE, OSHA, NCCER',gl_d:'Improve diagnostics',gl_dd:'Be more precise in the field',gl_b:'Start my business',gl_bd:'From tech to owner',gl_m:'Earn more money',gl_md:'Increase my value',r_elec:'Electrical Fundamentals',r_elecd:"Circuits, Ohm's law, diagrams",r_ac:'Air Conditioning',r_acd:'Pressure diagnostics, charging',r_ref:'Commercial Refrigeration',r_refd:'Walk-in coolers, controls, defrost',r_heat:'Heating Systems',r_heatd:'Furnaces, heat pumps, gas',r_cert:'Certification Prep',r_certd:'EPA 608 ‚Ä¢ NATE ‚Ä¢ OSHA ‚Ä¢ NCCER',r_biz:'Tech to Business Owner',r_bizd:'Licensing, estimates, clients'}
};

const t=k=>(T[D.lang][k]||k).replace('{name}',D.name);
const u=()=>{document.querySelectorAll('[data-t]').forEach(e=>e.textContent=t(e.getAttribute('data-t')));document.querySelectorAll('[data-tp]').forEach(e=>e.placeholder=t(e.getAttribute('data-tp')));};
const go=id=>{document.querySelectorAll('.s').forEach(s=>s.classList.remove('on'));document.getElementById(id).classList.add('on');window.scrollTo(0,0);};
const rx=(id,c)=>{const e=document.getElementById(id);if(e){e.classList.add(c);setTimeout(()=>e.classList.remove(c),1500);}};

function setLang(l){D.lang=l;unlockAudio();u();go('s2');document.getElementById('nm').placeholder=t('name_ph');speakText(t('welcome_speech'));}
function sName(){D.name=document.getElementById('nm').value.trim();u();bLvl();go('s3');rx('a3','nod');speakText(t('level_speech'));}
function pLvl(e,v){document.querySelectorAll('#lo .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.level=v;document.getElementById('b3').disabled=false;rx('a3','nod');}
function sLvl(){u();bSpc();go('s4');speakText(t('spec_speech'));}
function tSpc(e,k){if(k==='all'){document.querySelectorAll('#so .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.specs=['all'];}else{document.querySelector('#so .oc:last-child').classList.remove('sel');D.specs=D.specs.filter(s=>s!=='all');e.classList.toggle('sel');if(e.classList.contains('sel'))D.specs.push(k);else D.specs=D.specs.filter(s=>s!==k);}document.getElementById('b4').disabled=D.specs.length===0;rx('a4','nod');}
function sSpc(){u();bSch();go('s5');speakText(t('school_speech'));}
function pSch(e,v){document.querySelectorAll('#sco .oc').forEach(o=>o.classList.remove('sel'));e.classList.add('sel');D.school=v;document.getElementById('b5').disabled=false;rx('a5','nod');}
function sSch(){u();bGol();go('s6');speakText(t('goals_speech'));}
function tGol(e,k){e.classList.toggle('sel');if(e.classList.contains('sel'))D.goals.push(k);else D.goals=D.goals.filter(g=>g!==k);document.getElementById('b6').disabled=D.goals.length===0;rx('a6','nod');}
function sGol(){u();bRt();go('s7');cft();rx('a7','cel');speakText(t('route_speech'));}

function bLvl(){document.getElementById('lo').innerHTML=[{k:1,i:'üìö',t:'lv1',d:'lv1d'},{k:2,i:'üîß',t:'lv2',d:'lv2d'},{k:3,i:'‚öôÔ∏è',t:'lv3',d:'lv3d'},{k:4,i:'üéØ',t:'lv4',d:'lv4d'},{k:5,i:'üëë',t:'lv5',d:'lv5d'}].map(x=>'<div class="oc" onclick="pLvl(this,'+x.k+')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div></div>').join('');}
function bSpc(){document.getElementById('so').innerHTML=[{k:'electrical',i:'‚ö°',t:'sp_e',d:'sp_ed'},{k:'ac',i:'‚ùÑÔ∏è',t:'sp_a',d:'sp_ad'},{k:'refrigeration',i:'üßä',t:'sp_r',d:'sp_rd'},{k:'heating',i:'üî•',t:'sp_h',d:'sp_hd'},{k:'all',i:'üåü',t:'sp_x',d:'sp_xd'}].map(x=>'<div class="oc" onclick="tSpc(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div><div class="ck"></div></div>').join('');}
function bSch(){document.getElementById('sco').innerHTML=[{k:'acvolt',i:'üéì',t:'sc_ac',d:'sc_acd'},{k:'other',i:'üè´',t:'sc_ot',d:'sc_otd'},{k:'self',i:'üí™',t:'sc_sf',d:'sc_sfd'},{k:'done',i:'‚úÖ',t:'sc_dn',d:'sc_dnd'}].map(x=>'<div class="oc" onclick="pSch(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div></div>').join('');}
function bGol(){document.getElementById('go2').innerHTML=[{k:'certs',i:'üìã',t:'gl_c',d:'gl_cd'},{k:'diag',i:'üîç',t:'gl_d',d:'gl_dd'},{k:'biz',i:'üè¢',t:'gl_b',d:'gl_bd'},{k:'money',i:'üí∞',t:'gl_m',d:'gl_md'}].map(x=>'<div class="oc" onclick="tGol(this,\''+x.k+'\')"><div class="oi">'+x.i+'</div><div><div class="ot">'+t(x.t)+'</div><div class="od">'+t(x.d)+'</div></div><div class="ck"></div></div>').join('');}
function bRt(){var r=[];if(D.specs.includes('all')||D.specs.includes('electrical'))r.push({i:'‚ö°',t:'r_elec',d:'r_elecd'});if(D.specs.includes('all')||D.specs.includes('ac'))r.push({i:'‚ùÑÔ∏è',t:'r_ac',d:'r_acd'});if(D.specs.includes('all')||D.specs.includes('refrigeration'))r.push({i:'üßä',t:'r_ref',d:'r_refd'});if(D.specs.includes('all')||D.specs.includes('heating'))r.push({i:'üî•',t:'r_heat',d:'r_heatd'});if(D.goals.includes('certs'))r.push({i:'üìã',t:'r_cert',d:'r_certd'});if(D.goals.includes('biz'))r.push({i:'üè¢',t:'r_biz',d:'r_bizd'});document.getElementById('rl').innerHTML=r.map((x,i)=>'<div class="rt"><div class="rn">'+(i+1)+'</div><div><div class="rtt">'+x.i+' '+t(x.t)+'</div><div class="rd">'+t(x.d)+'</div></div></div>'+(i<r.length-1?'<div class="rl"></div>':'')).join('');}

function startApp(){enterStudyMode();startQuiz();console.log('Profile:',JSON.stringify(D,null,2));}

// ========== QUIZ SYSTEM ==========
const QUIZ_PRINCIPIANTE=[
// ELECTRICIDAD B√ÅSICA (13 preguntas)
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© mide el voltaje?',o:['Resistencia del cable','Diferencia de potencial el√©ctrico','Cantidad de electrones','Temperatura del circuito'],c:1,e:'El voltaje mide la diferencia de potencial, o sea la presi√≥n que empuja los electrones a trav√©s del circuito.'},
{cat:'‚ö° Electricidad B√°sica',q:'Seg√∫n la Ley de Ohm, ¬øcu√°l es la f√≥rmula correcta?',o:['V = I √ó R','V = I √∑ R','V = R √∑ I','V = I + R'],c:0,e:'Voltaje = Corriente √ó Resistencia. Si sabes dos valores, puedes calcular el tercero.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© instrumento usas para medir voltaje?',o:['Amper√≠metro','Meg√≥hmetro','Mult√≠metro','Term√≥metro'],c:2,e:'El mult√≠metro es la herramienta m√°s vers√°til del t√©cnico. Mide voltaje, corriente y resistencia.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© es un circuito en serie?',o:['Componentes conectados en un solo camino','Componentes en caminos separados','Un circuito sin resistencia','Un circuito sin voltaje'],c:0,e:'En serie, la corriente tiene un solo camino. Si un componente falla, todo el circuito se abre.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© pasa si un fusible se quema?',o:['Nada','Se abre el circuito y corta la corriente','Aumenta el voltaje','El motor gira m√°s r√°pido'],c:1,e:'El fusible protege el circuito. Cuando se quema, abre el circuito para prevenir da√±os.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øCu√°ntos voltios tiene un tomacorriente residencial est√°ndar en USA?',o:['110V','240V','12V','440V'],c:0,e:'El est√°ndar residencial en USA es 120V (com√∫nmente dicho 110V). Para estufas y secadoras se usa 240V.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© color de cable es el ground (tierra)?',o:['Rojo','Negro','Verde o verde con franja amarilla','Blanco'],c:2,e:'El verde o verde/amarillo es siempre tierra. Nunca lo uses para otra cosa.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© es un amperio?',o:['Unidad de resistencia','Unidad de voltaje','Unidad de corriente el√©ctrica','Unidad de potencia'],c:2,e:'El amperio mide la cantidad de corriente que fluye por un circuito. Como el Maestro Mario dice: si no mides, est√°s adivinando.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øPara qu√© sirve un capacitor en un motor?',o:['Enfriar el motor','Ayudar a arrancar o mantener el motor girando','Medir la temperatura','Aumentar el voltaje'],c:1,e:'El capacitor almacena energ√≠a y la libera para arrancar (start) o mantener (run) el motor.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© es un cortocircuito?',o:['Un circuito muy corto','Corriente tomando un camino no deseado de baja resistencia','Un circuito sin voltaje','Una conexi√≥n perfecta'],c:1,e:'Un cortocircuito es cuando la corriente toma un camino no deseado, causando exceso de corriente y calor.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© tipo de corriente sale del tomacorriente de tu casa?',o:['DC (corriente directa)','AC (corriente alterna)','Pulsante','Est√°tica'],c:1,e:'La corriente alterna (AC) cambia de direcci√≥n 60 veces por segundo (60Hz) en USA.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øCu√°ntos watts son 10 amperios a 120 voltios?',o:['130 watts','1200 watts','12 watts','120 watts'],c:1,e:'Watts = Voltios √ó Amperios. Entonces 120V √ó 10A = 1200W.'},
{cat:'‚ö° Electricidad B√°sica',q:'¬øQu√© hace un contactor?',o:['Mide voltaje','Es un interruptor controlado el√©ctricamente','Enfr√≠a el compresor','Almacena refrigerante'],c:1,e:'El contactor es como un interruptor grande que se activa con una se√±al del termostato para encender el equipo.'},

// REFRIGERACI√ìN B√ÅSICA (13 preguntas)
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øCu√°les son los 4 componentes principales del ciclo de refrigeraci√≥n?',o:['Compresor, condensador, v√°lvula de expansi√≥n, evaporador','Motor, fan, filtro, ducto','Termostato, cable, fusible, breaker','Bomba, tanque, v√°lvula, medidor'],c:0,e:'El ciclo b√°sico: compresor comprime, condensador enfr√≠a, v√°lvula expande, evaporador absorbe calor.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© hace el compresor?',o:['Enfr√≠a el aire','Comprime el gas refrigerante y lo mueve por el sistema','Mide la temperatura','Filtra el aire'],c:1,e:'El compresor es el coraz√≥n del sistema. Comprime el gas de baja a alta presi√≥n.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øD√≥nde se absorbe el calor del espacio a enfriar?',o:['En el condensador','En el compresor','En el evaporador','En la v√°lvula de expansi√≥n'],c:2,e:'El evaporador absorbe el calor del aire. El refrigerante se evapora al absorber calor.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© tipo de refrigerante es el R-410A?',o:['Un refrigerante obsoleto','Un HFC usado en equipos nuevos','Solo para autos','Solo para refrigeraci√≥n comercial'],c:1,e:'El R-410A es un HFC com√∫n en sistemas residenciales nuevos. Opera a presiones m√°s altas que el R-22.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© pasa cuando el refrigerante cambia de l√≠quido a gas?',o:['Libera calor','Absorbe calor','Nada cambia','Se destruye'],c:1,e:'Cuando el refrigerante se evapora, absorbe calor del ambiente. As√≠ es como enfr√≠a.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© miden los manifold gauges?',o:['Voltaje','Presiones del sistema de refrigeraci√≥n','Temperatura del motor','Velocidad del fan'],c:1,e:'Los gauges miden presi√≥n del lado bajo (azul) y lado alto (rojo) del sistema.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© significa superheat (sobrecalentamiento)?',o:['El sistema est√° en llamas','Temperatura del gas por encima de su punto de ebullici√≥n','El compresor est√° caliente','El condensador est√° tapado'],c:1,e:'Superheat es cu√°nto m√°s caliente est√° el gas refrigerante comparado con su temperatura de ebullici√≥n.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© pasa si hay muy poco refrigerante en el sistema?',o:['Enfr√≠a m√°s','El superheat sube y puede da√±ar el compresor','Nada','El equipo se apaga solo'],c:1,e:'Poco refrigerante = superheat alto = el compresor puede sobrecalentarse y da√±arse.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øDe qu√© color es la manguera del lado de baja presi√≥n?',o:['Roja','Verde','Azul','Amarilla'],c:2,e:'Azul = baja presi√≥n (succi√≥n). Roja = alta presi√≥n (descarga). Amarilla = al tanque.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© hace la v√°lvula de expansi√≥n (TXV)?',o:['Comprime el refrigerante','Reduce la presi√≥n del refrigerante antes del evaporador','Filtra el aire','Mide la temperatura'],c:1,e:'La TXV reduce la presi√≥n, permitiendo que el refrigerante se expanda y baje de temperatura antes del evaporador.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© funci√≥n tiene el filter drier?',o:['Filtrar el aire','Remover humedad y part√≠culas del refrigerante','Enfriar el compresor','Medir presi√≥n'],c:1,e:'El filter drier protege el sistema removiendo humedad y contaminantes del refrigerante.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© certificaci√≥n necesitas para manejar refrigerantes en USA?',o:['NATE','OSHA 30','EPA 608','CPR'],c:2,e:'La certificaci√≥n EPA 608 es obligatoria por ley federal para comprar y manejar refrigerantes.'},
{cat:'üßä Refrigeraci√≥n B√°sica',q:'¬øQu√© es subcooling (subenfriamiento)?',o:['El sistema est√° muy fr√≠o','Temperatura del l√≠quido por debajo de su punto de condensaci√≥n','El evaporador est√° congelado','El motor est√° fr√≠o'],c:1,e:'Subcooling mide cu√°nto m√°s fr√≠o est√° el l√≠quido refrigerante comparado con su temperatura de condensaci√≥n.'},

// HERRAMIENTAS Y SEGURIDAD (12 preguntas)
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øQu√© significa PPE?',o:['Presi√≥n Por Equipo','Personal Protective Equipment','Prueba Para Electricidad','Plan Para Emergencias'],c:1,e:'PPE = Personal Protective Equipment. Guantes, lentes, zapatos de seguridad son lo m√≠nimo.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'Antes de trabajar en un equipo el√©ctrico, ¬øqu√© debes hacer PRIMERO?',o:['Empezar a trabajar r√°pido','Lockout/Tagout - desconectar y asegurar la energ√≠a','Llamar al jefe','Tomar foto'],c:1,e:'SIEMPRE desconecta y verifica que no hay voltaje antes de tocar cualquier componente el√©ctrico.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øQu√© herramienta usas para detectar fugas de refrigerante?',o:['Mult√≠metro','Detector de fugas electr√≥nico','Nivel','Cinta m√©trica'],c:1,e:'El detector electr√≥nico de fugas sensa los gases de refrigerante y alerta cuando encuentra una fuga.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øPara qu√© sirve una bomba de vac√≠o?',o:['Inflar llantas','Remover aire y humedad del sistema antes de cargar refrigerante','Limpiar ductos','Medir presi√≥n'],c:1,e:'La bomba de vac√≠o remueve aire y humedad del sistema. Sin vac√≠o, el sistema no funciona bien.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øCu√°ntos micrones es un buen vac√≠o?',o:['5000 micrones','500 micrones o menos','50,000 micrones','No importa'],c:1,e:'Un vac√≠o de 500 micrones o menos indica que el sistema est√° limpio de aire y humedad.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øQu√© tipo de lentes debes usar al soldar?',o:['Lentes de sol','Lentes de seguridad con protecci√≥n lateral','No necesitas lentes','Lentes de lectura'],c:1,e:'Los lentes de seguridad protegen tus ojos de chispas, metal caliente y radiaci√≥n UV al soldar.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øQu√© haces si hueles gas refrigerante en un cuarto cerrado?',o:['Seguir trabajando','Ventilar el √°rea inmediatamente y salir si es necesario','Ignorarlo','Prender un cerillo'],c:1,e:'Los refrigerantes pueden desplazar el ox√≠geno en espacios cerrados. Ventila primero, seguridad siempre.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øPara qu√© sirve el torque wrench?',o:['Cualquier tuerca','Apretar conexiones con la fuerza exacta especificada','Cortar tuber√≠a','Medir voltaje'],c:1,e:'El torque wrench asegura que las conexiones se aprieten con la fuerza correcta. Ni de m√°s ni de menos.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øCada cu√°nto debes calibrar tu mult√≠metro?',o:['Nunca','Una vez al a√±o o seg√∫n el fabricante','Cada 10 a√±os','Solo cuando se rompe'],c:1,e:'Un mult√≠metro descalibrado te da lecturas falsas. Calibraci√≥n regular es parte de ser profesional.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øQu√© es OSHA?',o:['Una marca de herramientas','Occupational Safety and Health Administration','Un tipo de refrigerante','Una certificaci√≥n de soldadura'],c:1,e:'OSHA establece y hace cumplir las normas de seguridad en el trabajo en USA.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øPor qu√© nunca debes usar ox√≠geno para presurizar un sistema?',o:['Es muy caro','Puede causar una explosi√≥n al mezclarse con aceite','No tiene suficiente presi√≥n','Es ilegal en algunos estados'],c:1,e:'Ox√≠geno + aceite del compresor = EXPLOSI√ìN. Usa nitr√≥geno seco para presurizar. Nunca ox√≠geno.'},
{cat:'üõ°Ô∏è Herramientas y Seguridad',q:'¬øQu√© haces si un capacitor tiene carga despu√©s de desconectar?',o:['Tocarlo con las manos','Descargarlo con una resistencia antes de tocarlo','Dejarlo as√≠','Mojarlo con agua'],c:1,e:'Un capacitor cargado puede darte un shock peligroso. Siempre desc√°rgalo con una resistencia de descarga.'},

// AIRE ACONDICIONADO B√ÅSICO (12 preguntas)
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© es un mini split?',o:['Un compresor peque√±o','Sistema de AC con unidad interior y exterior sin ductos','Un tipo de fusible','Una herramienta'],c:1,e:'El mini split tiene una unidad adentro (evaporador) y una afuera (condensador) conectadas por tuber√≠a de cobre.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© mide el SEER?',o:['La temperatura','La eficiencia energ√©tica del equipo','El tama√±o del ducto','La presi√≥n del gas'],c:1,e:'SEER = Seasonal Energy Efficiency Ratio. Entre m√°s alto el SEER, m√°s eficiente y menos electricidad gasta.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© significa 1 tonelada de refrigeraci√≥n?',o:['El peso del equipo','12,000 BTU/hora de capacidad de enfriamiento','1,000 libras de hielo','La presi√≥n del sistema'],c:1,e:'1 tonelada = 12,000 BTU/h. Una casa promedio usa 2-5 toneladas dependiendo del tama√±o.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øPara qu√© sirve el filtro de aire?',o:['Decoraci√≥n','Atrapar polvo y part√≠culas antes del evaporador','Enfriar el aire','Medir la presi√≥n'],c:1,e:'El filtro protege el evaporador y mejora la calidad del aire. Hay que cambiarlo cada 1-3 meses.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© causa que el evaporador se congele?',o:['Mucho refrigerante','Flujo de aire bajo, poco refrigerante, o filtro sucio','Temperatura muy alta afuera','El condensador est√° limpio'],c:1,e:'Evaporador congelado = algo anda mal. Revisa filtro, flujo de aire, y niveles de refrigerante.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øD√≥nde est√° el condensador en un split system residencial?',o:['En el √°tico','Afuera de la casa','En el closet','En el ba√±o'],c:1,e:'El condensador (unidad exterior) libera el calor al ambiente. Necesita buena ventilaci√≥n afuera.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øCada cu√°nto se recomienda un mantenimiento de AC?',o:['Cada 10 a√±os','2 veces al a√±o (primavera y oto√±o)','Solo cuando falla','Cada mes'],c:1,e:'Mantenimiento preventivo 2 veces al a√±o mantiene el equipo eficiente y previene fallas costosas.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© es el return air?',o:['Aire que sale de los registros','Aire que regresa al equipo para ser acondicionado','Aire del exterior','Aire del ba√±o'],c:1,e:'El return air es el aire que regresa al sistema por el ducto de retorno para ser enfriado o calentado de nuevo.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© componente controla cu√°ndo enciende y apaga el AC?',o:['El capacitor','El termostato','El filtro','El fusible'],c:1,e:'El termostato sensa la temperatura y manda se√±al para encender o apagar el equipo.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© pasa si el condensador est√° sucio?',o:['Enfr√≠a mejor','Las presiones suben y el equipo trabaja m√°s duro','Nada','Baja el voltaje'],c:1,e:'Condensador sucio = no libera calor bien = presiones altas = m√°s consumo de energ√≠a y posible da√±o al compresor.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øQu√© es BTU?',o:['Un tipo de gas','British Thermal Unit, unidad de medida de calor','Una marca de equipo','Un c√≥digo de seguridad'],c:1,e:'BTU = British Thermal Unit. Es la cantidad de calor necesaria para subir 1¬∞F a 1 libra de agua.'},
{cat:'‚ùÑÔ∏è Aire Acondicionado B√°sico',q:'¬øCu√°l es la temperatura ideal del aire que sale del registro de un AC funcionando bien?',o:['50-55¬∞F','55-65¬∞F (15-20 grados menos que el return)','Igual que el return','80¬∞F'],c:1,e:'El diferencial entre supply y return debe ser 15-20¬∞F. Si no, algo anda mal con el sistema.'}
];

let quizData=[];
let quizIdx=0;
let quizRight=0;
let quizWrong=0;
let quizAnswered=false;
let quizAnswers=[];

function shuffleArray(arr){
    const a=[...arr];
    for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
    return a;
}

function startQuiz(){
    quizData=shuffleArray(QUIZ_PRINCIPIANTE);
    quizIdx=0;quizRight=0;quizWrong=0;quizStreak=0;
    quizAnswers=new Array(quizData.length).fill(-1);
    document.getElementById('qRight').textContent='0';
    document.getElementById('qWrong').textContent='0';
    go('s8');
    showQuestion();
    const intro=D.lang==='es'?'¬°Vamos con el quiz, '+D.name+'! Demuestra lo que sabes.':'Let\'s go '+D.name+'! Show what you know.';
    speakText(intro);
}

function retryQuiz(){
    startQuiz();
}

function showQuestion(){
    if(quizIdx>=quizData.length){showResult();return;}
    const q=quizData[quizIdx];
    const alreadyAnswered=quizAnswers[quizIdx]>=0;
    quizAnswered=alreadyAnswered;
    const pct=Math.round((quizIdx/quizData.length)*100);
    document.getElementById('qBar').style.width=pct+'%';
    document.getElementById('qNum').textContent=(D.lang==='es'?'Pregunta ':'Question ')+(quizIdx+1)+' / '+quizData.length;
    document.getElementById('qCat').textContent=q.cat;
    
    // Back button
    const prevBtn=document.getElementById('qPrev');
    if(quizIdx>0){prevBtn.classList.add('show');}else{prevBtn.classList.remove('show');}
    
    if(alreadyAnswered){
        // Revisiting a question already answered
        const userAnswer=quizAnswers[quizIdx];
        const correct=userAnswer===q.c;
        document.getElementById('qBubble').textContent=correct?(D.lang==='es'?'‚úÖ Ya contestaste bien esta pregunta.':'‚úÖ You already got this right.'):(D.lang==='es'?'‚ùå Aqu√≠ fallaste. La correcta es la '+['A','B','C','D'][q.c]+'.':'‚ùå You missed this one. Correct: '+['A','B','C','D'][q.c]+'.');
        document.getElementById('qText').textContent=q.q;
        const letters=['A','B','C','D'];
        document.getElementById('qOpts').innerHTML=q.o.map((o,i)=>{
            let cls='quiz-opt disabled';
            if(i===q.c)cls+=' correct';
            if(i===userAnswer&&!correct)cls+=' wrong';
            return '<div class="'+cls+'"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>';
        }).join('');
        document.getElementById('qExplain').innerHTML='<b>'+(D.lang==='es'?'Explicaci√≥n:':'Explanation:')+'</b> '+q.e;
        document.getElementById('qExplain').classList.add('show');
        const nextBtn=document.getElementById('qNext');
        nextBtn.textContent=(quizIdx<quizData.length-1)?(D.lang==='es'?'Siguiente ‚Üí':'Next ‚Üí'):(D.lang==='es'?'Ver Resultado üèÜ':'See Result üèÜ');
        nextBtn.classList.add('show');
    }else{
        // New unanswered question
        document.getElementById('qBubble').textContent=quizIdx===0?(D.lang==='es'?'¬°Dale, t√∫ puedes!':'You got this!'):(D.lang==='es'?'¬øQu√© piensas, '+D.name+'?':'What do you think, '+D.name+'?');
        document.getElementById('qText').textContent=q.q;
        document.getElementById('qExplain').classList.remove('show');
        document.getElementById('qNext').classList.remove('show');
        const letters=['A','B','C','D'];
        document.getElementById('qOpts').innerHTML=q.o.map((o,i)=>'<div class="quiz-opt" onclick="answerQuiz('+i+',this)"><div class="quiz-letter">'+letters[i]+'</div><div>'+o+'</div></div>').join('');
    }
    window.scrollTo(0,0);
}

let quizStreak=0;

const CHEERS_ES=[
    ['¬°Correcto!','¬°Bien hecho!','¬°As√≠ se hace!','¬°Muy bien, '+'{name}'+'!','¬°Buena elecci√≥n!'],
    ['¬°Divino!','¬°Perfecto!','¬°Excelente!','¬°Maravilloso!','¬°√ìrale, '+'{name}'+'!'],
    ['¬°Espectacular!','¬°Eres crack!','¬°Incre√≠ble, '+'{name}'+'!','¬°Qu√© m√°quina!'],
    ['üî• ¬°IMPARABLE! üî•','‚ö° ¬°NO TE PARA NADIE! ‚ö°','üí™ ¬°ERES UNA BESTIA! üí™','üèÜ ¬°VAS CON TODO! üèÜ']
];
const CHEERS_EN=[
    ['Correct!','Well done!','Nice job!','Good pick, '+'{name}'+'!','That\'s right!'],
    ['Perfect!','Excellent!','Brilliant!','Amazing!','Great work, '+'{name}'+'!'],
    ['Spectacular!','You\'re on fire!','Incredible, '+'{name}'+'!','Crushing it!'],
    ['üî• UNSTOPPABLE! üî•','‚ö° NOBODY STOPS YOU! ‚ö°','üí™ YOU\'RE A BEAST! üí™','üèÜ ALL THE WAY! üèÜ']
];
const MISS_ES=['No te preocupes, as√≠ se aprende.','Casi, pero no. ¬°T√∫ puedes!','√âchale ojo a esto.','No pasa nada, sigue adelante.','A estudiar este tema un poco m√°s.'];
const MISS_EN=['Don\'t worry, that\'s how we learn.','Almost! You got this.','Take a closer look at this one.','No worries, keep going.','Review this topic a bit more.'];

function pickCheer(streak){
    const cheers=D.lang==='es'?CHEERS_ES:CHEERS_EN;
    let tier=0;
    if(streak>=8)tier=3;
    else if(streak>=5)tier=2;
    else if(streak>=3)tier=1;
    const list=cheers[tier];
    return list[Math.floor(Math.random()*list.length)].replace('{name}',D.name);
}

function pickMiss(){
    const list=D.lang==='es'?MISS_ES:MISS_EN;
    return list[Math.floor(Math.random()*list.length)]+' '+(D.lang==='es'?'La correcta es la ':'Correct answer is ')+['A','B','C','D'][quizData[quizIdx].c]+'.';
}

function celebrate(streak){
    const el=document.getElementById('s8');
    // Vibrate phone
    if(navigator.vibrate){
        if(streak>=5)navigator.vibrate([100,50,100,50,200]);
        else navigator.vibrate(80);
    }
    // Screen shake
    if(streak>=5){
        el.classList.add('big-shake');
        setTimeout(()=>el.classList.remove('big-shake'),600);
    }else if(streak>=2){
        el.classList.add('shake');
        setTimeout(()=>el.classList.remove('shake'),400);
    }
    // Lightning flash at 5+ streak
    if(streak>=5){
        const flash=document.createElement('div');
        flash.className='lightning-flash';
        document.body.appendChild(flash);
        setTimeout(()=>flash.remove(),400);
    }
    // Fire emojis at 3+ streak
    if(streak>=3){
        const emojis=streak>=8?['üî•','‚ö°','üí•','üåü','‚ú®']:streak>=5?['üî•','‚ö°','üí•']:['üî•','‚ú®'];
        for(let i=0;i<(streak>=8?12:streak>=5?8:4);i++){
            setTimeout(()=>{
                const fire=document.createElement('div');
                fire.className='fire-emoji';
                fire.textContent=emojis[Math.floor(Math.random()*emojis.length)];
                fire.style.left=Math.random()*80+10+'%';
                fire.style.bottom='10%';
                document.body.appendChild(fire);
                setTimeout(()=>fire.remove(),1200);
            },i*100);
        }
    }
    // Streak badge at 5+ 
    if(streak>=5){
        const badge=document.createElement('div');
        badge.className='streak-badge';
        badge.textContent=streak>=10?'üèÜ '+streak+'x COMBO! üèÜ':streak>=8?'‚ö° '+streak+'x RACHA! ‚ö°':'üî• '+streak+'x STREAK! üî•';
        document.body.appendChild(badge);
        setTimeout(()=>badge.remove(),1500);
    }
    // Confetti at 5+
    if(streak>=5)cft();
}

function answerQuiz(idx,el){
    if(quizAnswered)return;
    quizAnswered=true;
    quizAnswers[quizIdx]=idx;
    const q=quizData[quizIdx];
    const correct=idx===q.c;
    const opts=document.querySelectorAll('.quiz-opt');
    
    opts.forEach((o,i)=>{
        if(i===q.c)o.classList.add('correct');
        if(i===idx&&!correct)o.classList.add('wrong');
        if(i!==q.c&&i!==idx)o.classList.add('disabled');
    });
    
    if(correct){
        quizRight++;
        quizStreak++;
        document.getElementById('qRight').textContent=quizRight;
        document.getElementById('qBubble').textContent=pickCheer(quizStreak);
        celebrate(quizStreak);
    }else{
        quizWrong++;
        quizStreak=0;
        document.getElementById('qWrong').textContent=quizWrong;
        document.getElementById('qBubble').textContent=pickMiss();
    }
    
    document.getElementById('qExplain').innerHTML='<b>'+(D.lang==='es'?'Explicaci√≥n:':'Explanation:')+'</b> '+q.e;
    document.getElementById('qExplain').classList.add('show');
    document.getElementById('qNext').textContent=(quizIdx<quizData.length-1)?(D.lang==='es'?'Siguiente ‚Üí':'Next ‚Üí'):(D.lang==='es'?'Ver Resultado üèÜ':'See Result üèÜ');
    document.getElementById('qNext').classList.add('show');
    
    speakText(correct?(D.lang==='es'?'Correcto. ':'Correct. '):(D.lang==='es'?'Incorrecto. ':'Incorrect. ')+q.e);
}

function nextQuestion(){
    quizIdx++;
    showQuestion();
}

function prevQuestion(){
    if(quizIdx>0){quizIdx--;showQuestion();}
}

function showResult(){
    go('s9');
    const pct=Math.round((quizRight/quizData.length)*100);
    document.getElementById('rScore').textContent=pct+'%';
    document.getElementById('rLabel').textContent=quizRight+' / '+quizData.length+(D.lang==='es'?' correctas':' correct');
    
    let medal,msg,stars;
    if(pct>=90){medal='üèÜ';stars=5;msg=D.lang==='es'?'¬°Incre√≠ble, '+D.name+'! Eres una m√°quina del HVAC. El Maestro Mario est√° orgulloso.':'Incredible, '+D.name+'! You\'re an HVAC machine!';}
    else if(pct>=80){medal='ü•á';stars=4;msg=D.lang==='es'?'¬°Excelente, '+D.name+'! Tienes muy buena base. Sigue as√≠.':'Excellent, '+D.name+'! Great foundation!';}
    else if(pct>=70){medal='ü•à';stars=3;msg=D.lang==='es'?'¬°Bien, '+D.name+'! Vas por buen camino. Repasa los temas que fallaste.':'Good job, '+D.name+'! Review what you missed.';}
    else if(pct>=60){medal='ü•â';stars=2;msg=D.lang==='es'?'¬°No est√° mal, '+D.name+'! Pero hay que estudiar m√°s. T√∫ puedes.':'Not bad, '+D.name+'! But keep studying.';}
    else{medal='üìö';stars=1;msg=D.lang==='es'?'¬°'+D.name+', hay que echarle m√°s ganas! Repasa y vuelve a intentar. Vamos con todo.':D.name+', keep studying and try again!';}
    
    document.getElementById('rMedal').textContent=medal;
    document.getElementById('rMsg').textContent=msg;
    
    const starEls=document.querySelectorAll('#rStars span');
    starEls.forEach((s,i)=>{
        setTimeout(()=>{if(i<stars)s.classList.add('lit');},i*300);
    });
    
    cft();
    speakText(msg);
}
document.getElementById('nm').addEventListener('keydown',e=>{if(e.key==='Enter'&&e.target.value.trim().length>=2)sName();});
</script>
</body>
</html>
